
20190308161606开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190308161606

/* -- 应收ar_detail_ar
drop table if exists pdm.ar_detail_ar
;

20190308161658开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190308161658


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308161658
SQL开始执行时间：20190308161658

truncate table pdm.ar_detail_ar2
;

20190308161919开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190308161919


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as icamount2
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

delete from pdm.ar_ap where y_mon = left('2018-02-01',7)
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308161919
SQL开始执行时间：20190308161919

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;

20190308162330开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190308162330


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

delete from pdm.ar_ap where y_mon = left('2018-02-01',7)
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162331
SQL开始执行时间：20190308162331


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162331

20190308162339开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190308162339


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-03-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-03-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

delete from pdm.ar_ap where y_mon = left('2018-03-01',7)
;
SQL结束执行时间：20190308162339
SQL开始执行时间：20190308162339

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162340
SQL开始执行时间：20190308162340

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162340
SQL开始执行时间：20190308162340


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162340

20190308162349开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190308162349


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190308162349
SQL开始执行时间：20190308162349


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162349
SQL开始执行时间：20190308162349

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162349
SQL开始执行时间：20190308162349
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-04-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-04-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

delete from pdm.ar_ap where y_mon = left('2018-04-01',7)
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162350
SQL开始执行时间：20190308162350


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162350

20190308162353开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190308162353


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190308162353
SQL开始执行时间：20190308162353


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162353
SQL开始执行时间：20190308162353

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162353
SQL开始执行时间：20190308162353
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162353
SQL开始执行时间：20190308162353


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162353
SQL开始执行时间：20190308162353
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162354
SQL开始执行时间：20190308162354

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-05-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162355
SQL开始执行时间：20190308162355

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-05-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162355
SQL开始执行时间：20190308162355

delete from pdm.ar_ap where y_mon = left('2018-05-01',7)
;
SQL结束执行时间：20190308162355
SQL开始执行时间：20190308162355

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162355
SQL开始执行时间：20190308162355

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162355
SQL开始执行时间：20190308162355


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162355

20190308162358开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190308162358


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190308162358
SQL开始执行时间：20190308162358


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162359
SQL开始执行时间：20190308162359

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-06-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162401
SQL开始执行时间：20190308162401

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-06-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162401
SQL开始执行时间：20190308162401

delete from pdm.ar_ap where y_mon = left('2018-06-01',7)
;
SQL结束执行时间：20190308162401
SQL开始执行时间：20190308162401

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162401
SQL开始执行时间：20190308162401

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162401
SQL开始执行时间：20190308162401


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162401

20190308162404开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190308162404


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190308162404
SQL开始执行时间：20190308162404


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162405
SQL开始执行时间：20190308162405
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162406
SQL开始执行时间：20190308162406
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162406
SQL开始执行时间：20190308162406
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162406
SQL开始执行时间：20190308162406
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162406
SQL开始执行时间：20190308162406

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-07-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162410
SQL开始执行时间：20190308162410

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-07-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162410
SQL开始执行时间：20190308162410

delete from pdm.ar_ap where y_mon = left('2018-07-01',7)
;
SQL结束执行时间：20190308162410
SQL开始执行时间：20190308162410

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162410
SQL开始执行时间：20190308162410

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162410
SQL开始执行时间：20190308162410


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162410

20190308162413开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190308162413


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190308162413
SQL开始执行时间：20190308162413


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162414
SQL开始执行时间：20190308162414
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162415
SQL开始执行时间：20190308162415
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162415
SQL开始执行时间：20190308162415

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-08-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162420
SQL开始执行时间：20190308162420

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-08-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162420
SQL开始执行时间：20190308162420

delete from pdm.ar_ap where y_mon = left('2018-08-01',7)
;
SQL结束执行时间：20190308162420
SQL开始执行时间：20190308162420

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162420
SQL开始执行时间：20190308162420

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162420
SQL开始执行时间：20190308162420


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162420

20190308162423开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190308162423


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190308162424
SQL开始执行时间：20190308162424


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162424
SQL开始执行时间：20190308162424

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162424
SQL开始执行时间：20190308162424
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162425
SQL开始执行时间：20190308162425


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162425
SQL开始执行时间：20190308162425
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162425
SQL开始执行时间：20190308162425

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162425
SQL开始执行时间：20190308162425
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162425
SQL开始执行时间：20190308162425
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162426
SQL开始执行时间：20190308162426
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162426
SQL开始执行时间：20190308162426
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162426
SQL开始执行时间：20190308162426

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-09-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162434
SQL开始执行时间：20190308162434

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-09-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162434
SQL开始执行时间：20190308162434

delete from pdm.ar_ap where y_mon = left('2018-09-01',7)
;
SQL结束执行时间：20190308162434
SQL开始执行时间：20190308162434

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162434
SQL开始执行时间：20190308162434

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162434
SQL开始执行时间：20190308162434


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162434

20190308162437开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190308162437


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190308162438
SQL开始执行时间：20190308162438


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162439
SQL开始执行时间：20190308162439

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162439
SQL开始执行时间：20190308162439
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162439
SQL开始执行时间：20190308162439


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162439
SQL开始执行时间：20190308162439
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162439
SQL开始执行时间：20190308162439

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162440
SQL开始执行时间：20190308162440
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162440
SQL开始执行时间：20190308162440
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162440
SQL开始执行时间：20190308162440
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162440
SQL开始执行时间：20190308162440
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162441
SQL开始执行时间：20190308162441

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-10-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162450
SQL开始执行时间：20190308162450

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-10-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162450
SQL开始执行时间：20190308162450

delete from pdm.ar_ap where y_mon = left('2018-10-01',7)
;
SQL结束执行时间：20190308162450
SQL开始执行时间：20190308162450

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162451
SQL开始执行时间：20190308162451

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162451
SQL开始执行时间：20190308162451


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162451

20190308162455开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190308162455


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190308162456
SQL开始执行时间：20190308162456


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162456
SQL开始执行时间：20190308162456

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162457
SQL开始执行时间：20190308162457
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162457
SQL开始执行时间：20190308162457


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162457
SQL开始执行时间：20190308162457
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162457
SQL开始执行时间：20190308162457

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162457
SQL开始执行时间：20190308162457
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162458
SQL开始执行时间：20190308162458
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162458
SQL开始执行时间：20190308162458
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162458
SQL开始执行时间：20190308162458
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162459
SQL开始执行时间：20190308162459

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-11-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162510
SQL开始执行时间：20190308162510

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-11-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162510
SQL开始执行时间：20190308162510

delete from pdm.ar_ap where y_mon = left('2018-11-01',7)
;
SQL结束执行时间：20190308162510
SQL开始执行时间：20190308162510

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162511
SQL开始执行时间：20190308162511

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162511
SQL开始执行时间：20190308162511


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162511

20190308162514开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190308162514


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190308162515
SQL开始执行时间：20190308162515


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162516
SQL开始执行时间：20190308162516

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162516
SQL开始执行时间：20190308162516
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162516
SQL开始执行时间：20190308162516


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162516
SQL开始执行时间：20190308162516
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162517
SQL开始执行时间：20190308162517

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162517
SQL开始执行时间：20190308162517
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162517
SQL开始执行时间：20190308162517
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162518
SQL开始执行时间：20190308162518
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162518
SQL开始执行时间：20190308162518
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162518
SQL开始执行时间：20190308162518

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2018-12-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162532
SQL开始执行时间：20190308162532

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2018-12-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162532
SQL开始执行时间：20190308162532

delete from pdm.ar_ap where y_mon = left('2018-12-01',7)
;
SQL结束执行时间：20190308162532
SQL开始执行时间：20190308162532

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162533
SQL开始执行时间：20190308162533

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162533
SQL开始执行时间：20190308162533


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162533

20190308162540开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190308162540


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190308162541
SQL开始执行时间：20190308162541


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162542
SQL开始执行时间：20190308162542

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162542
SQL开始执行时间：20190308162542
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162542
SQL开始执行时间：20190308162542


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162542
SQL开始执行时间：20190308162542
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162543
SQL开始执行时间：20190308162543

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162543
SQL开始执行时间：20190308162543
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162543
SQL开始执行时间：20190308162543
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162543
SQL开始执行时间：20190308162543
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162544
SQL开始执行时间：20190308162544
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162544
SQL开始执行时间：20190308162544

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2019-01-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162603
SQL开始执行时间：20190308162603

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2019-01-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162604
SQL开始执行时间：20190308162604

delete from pdm.ar_ap where y_mon = left('2019-01-01',7)
;
SQL结束执行时间：20190308162604
SQL开始执行时间：20190308162604

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162604
SQL开始执行时间：20190308162604

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162604
SQL开始执行时间：20190308162604


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162604

20190308162650开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190308162650


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190308162651
SQL开始执行时间：20190308162651


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162652
SQL开始执行时间：20190308162652

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162652
SQL开始执行时间：20190308162652
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162652
SQL开始执行时间：20190308162652


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162652
SQL开始执行时间：20190308162652
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162653
SQL开始执行时间：20190308162653

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162653
SQL开始执行时间：20190308162653
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162653
SQL开始执行时间：20190308162653
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162654
SQL开始执行时间：20190308162654
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162654
SQL开始执行时间：20190308162654
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162654
SQL开始执行时间：20190308162654

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2019-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162714
SQL开始执行时间：20190308162714

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2019-02-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162714
SQL开始执行时间：20190308162714

delete from pdm.ar_ap where y_mon = left('2019-02-01',7)
;
SQL结束执行时间：20190308162714
SQL开始执行时间：20190308162714

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162714
SQL开始执行时间：20190308162714

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162714
SQL开始执行时间：20190308162714


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162715

20190308162724开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190308162724


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190308162726
SQL开始执行时间：20190308162726


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162726
SQL开始执行时间：20190308162726

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162727
SQL开始执行时间：20190308162727
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162727
SQL开始执行时间：20190308162727


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162727
SQL开始执行时间：20190308162727
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162727
SQL开始执行时间：20190308162727

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162727
SQL开始执行时间：20190308162727
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162728
SQL开始执行时间：20190308162728
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162728
SQL开始执行时间：20190308162728
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162728
SQL开始执行时间：20190308162728
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162729
SQL开始执行时间：20190308162729

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2019-03-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162749
SQL开始执行时间：20190308162749

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2019-03-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162749
SQL开始执行时间：20190308162749

delete from pdm.ar_ap where y_mon = left('2019-03-01',7)
;
SQL结束执行时间：20190308162749
SQL开始执行时间：20190308162749

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162749
SQL开始执行时间：20190308162749

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162749
SQL开始执行时间：20190308162749


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162750

20190308162821开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190308162821


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-04-01'
   and dRegDate < '2019-04-01'
;
SQL结束执行时间：20190308162822
SQL开始执行时间：20190308162822


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308162823
SQL开始执行时间：20190308162823

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308162823
SQL开始执行时间：20190308162823
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308162824
SQL开始执行时间：20190308162824


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308162824
SQL开始执行时间：20190308162824
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308162824
SQL开始执行时间：20190308162824

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308162824
SQL开始执行时间：20190308162824
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308162825
SQL开始执行时间：20190308162825
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308162825
SQL开始执行时间：20190308162825
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308162825
SQL开始执行时间：20190308162825
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308162825
SQL开始执行时间：20190308162825

create temporary table pdm.ar_detail_ar2 as
select 
	 left('2019-04-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308162845
SQL开始执行时间：20190308162845

create temporary table pdm.ar_detail_ap2 as
select 
	 left('2019-04-01',7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308162845
SQL开始执行时间：20190308162845

delete from pdm.ar_ap where y_mon = left('2019-04-01',7)
;
SQL结束执行时间：20190308162845
SQL开始执行时间：20190308162845

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308162845
SQL开始执行时间：20190308162845

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308162846
SQL开始执行时间：20190308162846


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308162846

20190308163328开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190308163328


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163328
SQL开始执行时间：20190308163328


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163328

20190308163328开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190308163328


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163329
SQL开始执行时间：20190308163329


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163329

20190308163329开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190308163329


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163330
SQL开始执行时间：20190308163330

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163331

20190308163331开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190308163331


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190308163331
SQL开始执行时间：20190308163331


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163332
SQL开始执行时间：20190308163332

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163333
SQL开始执行时间：20190308163333

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163333
SQL开始执行时间：20190308163333

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190308163333
SQL开始执行时间：20190308163333

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163333
SQL开始执行时间：20190308163333

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163333
SQL开始执行时间：20190308163333


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163333

20190308163333开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190308163333


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190308163334
SQL开始执行时间：20190308163334


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163334
SQL开始执行时间：20190308163334

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163334
SQL开始执行时间：20190308163334
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163334
SQL开始执行时间：20190308163334


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163334
SQL开始执行时间：20190308163334
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163335
SQL开始执行时间：20190308163335

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163337
SQL开始执行时间：20190308163337

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163337
SQL开始执行时间：20190308163337

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190308163337
SQL开始执行时间：20190308163337

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163337
SQL开始执行时间：20190308163337

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163337
SQL开始执行时间：20190308163337


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163337

20190308163337开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190308163337


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163338
SQL开始执行时间：20190308163338
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163339
SQL开始执行时间：20190308163339
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163339
SQL开始执行时间：20190308163339
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163339
SQL开始执行时间：20190308163339
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163339
SQL开始执行时间：20190308163339

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163343
SQL开始执行时间：20190308163343

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163343
SQL开始执行时间：20190308163343

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190308163343
SQL开始执行时间：20190308163343

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163343
SQL开始执行时间：20190308163343

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163343
SQL开始执行时间：20190308163343


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163343

20190308163343开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190308163343


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190308163344
SQL开始执行时间：20190308163344


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163344
SQL开始执行时间：20190308163344

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163344
SQL开始执行时间：20190308163344
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163345
SQL开始执行时间：20190308163345
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163346
SQL开始执行时间：20190308163346

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163351
SQL开始执行时间：20190308163351

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163351
SQL开始执行时间：20190308163351

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190308163351
SQL开始执行时间：20190308163351

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163351
SQL开始执行时间：20190308163351

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163351
SQL开始执行时间：20190308163351


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163351

20190308163351开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190308163351


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190308163352
SQL开始执行时间：20190308163352


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163352
SQL开始执行时间：20190308163352

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163353
SQL开始执行时间：20190308163353
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163353
SQL开始执行时间：20190308163353


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163353
SQL开始执行时间：20190308163353
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163353
SQL开始执行时间：20190308163353

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163353
SQL开始执行时间：20190308163353
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163354
SQL开始执行时间：20190308163354
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163354
SQL开始执行时间：20190308163354
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163354
SQL开始执行时间：20190308163354
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163354
SQL开始执行时间：20190308163354

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163402
SQL开始执行时间：20190308163402

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163402
SQL开始执行时间：20190308163402

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190308163402
SQL开始执行时间：20190308163402

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163402
SQL开始执行时间：20190308163402

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163402
SQL开始执行时间：20190308163402


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163402

20190308163402开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190308163402


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190308163403
SQL开始执行时间：20190308163403


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163404
SQL开始执行时间：20190308163404

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163404
SQL开始执行时间：20190308163404
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163404
SQL开始执行时间：20190308163404


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163404
SQL开始执行时间：20190308163404
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163404
SQL开始执行时间：20190308163404

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163405
SQL开始执行时间：20190308163405
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163405
SQL开始执行时间：20190308163405
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163405
SQL开始执行时间：20190308163405
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163405
SQL开始执行时间：20190308163405
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163406
SQL开始执行时间：20190308163406

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163415
SQL开始执行时间：20190308163415

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163415
SQL开始执行时间：20190308163415

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190308163415
SQL开始执行时间：20190308163415

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163415
SQL开始执行时间：20190308163415

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163415
SQL开始执行时间：20190308163415


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163415

20190308163415开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190308163415


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190308163416
SQL开始执行时间：20190308163416


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163417
SQL开始执行时间：20190308163417

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163417
SQL开始执行时间：20190308163417
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163418
SQL开始执行时间：20190308163418


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163418
SQL开始执行时间：20190308163418
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163418
SQL开始执行时间：20190308163418

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163418
SQL开始执行时间：20190308163418
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163418
SQL开始执行时间：20190308163418
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163419
SQL开始执行时间：20190308163419
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163419
SQL开始执行时间：20190308163419
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163419
SQL开始执行时间：20190308163419

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163431
SQL开始执行时间：20190308163431

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163431
SQL开始执行时间：20190308163431

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190308163431
SQL开始执行时间：20190308163431

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163431
SQL开始执行时间：20190308163431

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163431
SQL开始执行时间：20190308163431


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163431

20190308163431开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190308163431


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190308163432
SQL开始执行时间：20190308163432


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163433
SQL开始执行时间：20190308163433

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163433
SQL开始执行时间：20190308163433
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163434
SQL开始执行时间：20190308163434


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163434
SQL开始执行时间：20190308163434
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163434
SQL开始执行时间：20190308163434

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163434
SQL开始执行时间：20190308163434
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163434
SQL开始执行时间：20190308163434
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163435
SQL开始执行时间：20190308163435
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163435
SQL开始执行时间：20190308163435
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163435
SQL开始执行时间：20190308163435

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163449
SQL开始执行时间：20190308163449

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163450
SQL开始执行时间：20190308163450

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190308163450
SQL开始执行时间：20190308163450

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163450
SQL开始执行时间：20190308163450

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163450
SQL开始执行时间：20190308163450


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163450

20190308163450开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190308163450


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190308163451
SQL开始执行时间：20190308163451


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163452
SQL开始执行时间：20190308163452

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163452
SQL开始执行时间：20190308163452
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163453
SQL开始执行时间：20190308163453


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163453
SQL开始执行时间：20190308163453
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163453
SQL开始执行时间：20190308163453

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163453
SQL开始执行时间：20190308163453
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163454
SQL开始执行时间：20190308163454
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163454
SQL开始执行时间：20190308163454
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163454
SQL开始执行时间：20190308163454
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163454
SQL开始执行时间：20190308163454

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163514
SQL开始执行时间：20190308163514

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163514
SQL开始执行时间：20190308163514

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190308163514
SQL开始执行时间：20190308163514

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163515
SQL开始执行时间：20190308163515

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163515
SQL开始执行时间：20190308163515


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163515

20190308163515开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190308163515


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190308163516
SQL开始执行时间：20190308163516


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163517
SQL开始执行时间：20190308163517

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163517
SQL开始执行时间：20190308163517
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163517
SQL开始执行时间：20190308163517


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163517
SQL开始执行时间：20190308163517
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163518
SQL开始执行时间：20190308163518

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163518
SQL开始执行时间：20190308163518
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163518
SQL开始执行时间：20190308163518
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163518
SQL开始执行时间：20190308163518
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163519
SQL开始执行时间：20190308163519
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163519
SQL开始执行时间：20190308163519

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163539
SQL开始执行时间：20190308163539

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163539
SQL开始执行时间：20190308163539

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190308163539
SQL开始执行时间：20190308163539

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163539
SQL开始执行时间：20190308163539

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163539
SQL开始执行时间：20190308163539


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163539

20190308163539开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190308163539


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190308163541
SQL开始执行时间：20190308163541


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163541
SQL开始执行时间：20190308163541

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163542
SQL开始执行时间：20190308163542
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163542
SQL开始执行时间：20190308163542


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163542
SQL开始执行时间：20190308163542
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163542
SQL开始执行时间：20190308163542

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163543
SQL开始执行时间：20190308163543
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163543
SQL开始执行时间：20190308163543
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163543
SQL开始执行时间：20190308163543
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163543
SQL开始执行时间：20190308163543
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163544
SQL开始执行时间：20190308163544

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163603
SQL开始执行时间：20190308163603

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163604
SQL开始执行时间：20190308163604

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190308163604
SQL开始执行时间：20190308163604

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163604
SQL开始执行时间：20190308163604

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163604
SQL开始执行时间：20190308163604


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163604

20190308163604开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190308163604


create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-04-01'
   and dRegDate < '2019-04-01'
;
SQL结束执行时间：20190308163605
SQL开始执行时间：20190308163605


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190308163606
SQL开始执行时间：20190308163606

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190308163606
SQL开始执行时间：20190308163606
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190308163607
SQL开始执行时间：20190308163607


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190308163607
SQL开始执行时间：20190308163607
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190308163607
SQL开始执行时间：20190308163607

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190308163607
SQL开始执行时间：20190308163607
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190308163607
SQL开始执行时间：20190308163607
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190308163608
SQL开始执行时间：20190308163608
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190308163608
SQL开始执行时间：20190308163608
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190308163608
SQL开始执行时间：20190308163608

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190308163628
SQL开始执行时间：20190308163628

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190308163628
SQL开始执行时间：20190308163628

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-04-01',interval 1 day),7)
;
SQL结束执行时间：20190308163628
SQL开始执行时间：20190308163628

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190308163628
SQL开始执行时间：20190308163628

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190308163628
SQL开始执行时间：20190308163628


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190308163629

20190312170400开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190312170400

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170400
SQL开始执行时间：20190312170400


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170400

20190312170435开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190312170435

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170435
SQL开始执行时间：20190312170435


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170435

20190312170437开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190312170437

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170437
SQL开始执行时间：20190312170437


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170437

20190312170440开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190312170440

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170440
SQL开始执行时间：20190312170440


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170440

20190312170443开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190312170443

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170443
SQL开始执行时间：20190312170443


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170443

20190312170445开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190312170445

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170445
SQL开始执行时间：20190312170445


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170445

20190312170448开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190312170448

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170448
SQL开始执行时间：20190312170448


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170448

20190312170451开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190312170451

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170451
SQL开始执行时间：20190312170451


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170451

20190312170455开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190312170455

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170455
SQL开始执行时间：20190312170455


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170455

20190312170457开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190312170457

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170457
SQL开始执行时间：20190312170457


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170457

20190312170459开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190312170459

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170459
SQL开始执行时间：20190312170459


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170459

20190312170504开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190312170504

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170504
SQL开始执行时间：20190312170504


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170504

20190312170506开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190312170506

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170506
SQL开始执行时间：20190312170506


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170506

20190312170509开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190312170509

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312170509
SQL开始执行时间：20190312170509

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312170510
SQL开始执行时间：20190312170510

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312170510
SQL开始执行时间：20190312170510

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312170510
SQL开始执行时间：20190312170510


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312170510

20190312171136开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190312171136

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171137
SQL开始执行时间：20190312171137


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171137

20190312171137开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190312171137

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171138
SQL开始执行时间：20190312171138


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171138

20190312171138开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190312171138

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171139
SQL开始执行时间：20190312171139

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171140

20190312171140开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190312171140

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190312171140
SQL开始执行时间：20190312171140


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171141
SQL开始执行时间：20190312171141

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171143

20190312171143开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190312171143

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190312171143
SQL开始执行时间：20190312171143


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171144
SQL开始执行时间：20190312171144

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171146
SQL开始执行时间：20190312171146

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171146
SQL开始执行时间：20190312171146

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190312171146
SQL开始执行时间：20190312171146

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171147
SQL开始执行时间：20190312171147

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171147
SQL开始执行时间：20190312171147


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171147

20190312171147开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190312171147

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190312171147
SQL开始执行时间：20190312171147


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171148
SQL开始执行时间：20190312171148
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171149
SQL开始执行时间：20190312171149
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171149
SQL开始执行时间：20190312171149
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171149
SQL开始执行时间：20190312171149

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171154
SQL开始执行时间：20190312171154

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171154
SQL开始执行时间：20190312171154

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190312171154
SQL开始执行时间：20190312171154

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171154
SQL开始执行时间：20190312171154

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171154
SQL开始执行时间：20190312171154


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171154

20190312171154开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190312171154

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190312171155
SQL开始执行时间：20190312171155


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171155
SQL开始执行时间：20190312171155

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171155
SQL开始执行时间：20190312171155
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171156
SQL开始执行时间：20190312171156
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171157
SQL开始执行时间：20190312171157
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171157
SQL开始执行时间：20190312171157

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171203
SQL开始执行时间：20190312171203

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171203
SQL开始执行时间：20190312171203

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190312171203
SQL开始执行时间：20190312171203

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171203
SQL开始执行时间：20190312171203

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171203
SQL开始执行时间：20190312171203


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171203

20190312171203开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190312171203

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190312171204
SQL开始执行时间：20190312171204


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171205
SQL开始执行时间：20190312171205

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171205
SQL开始执行时间：20190312171205
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171205
SQL开始执行时间：20190312171205


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171205
SQL开始执行时间：20190312171205
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171205
SQL开始执行时间：20190312171205

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171206
SQL开始执行时间：20190312171206
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171206
SQL开始执行时间：20190312171206
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171206
SQL开始执行时间：20190312171206
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171206
SQL开始执行时间：20190312171206
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171207
SQL开始执行时间：20190312171207

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171215
SQL开始执行时间：20190312171215

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171215
SQL开始执行时间：20190312171215

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190312171215
SQL开始执行时间：20190312171215

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171215
SQL开始执行时间：20190312171215

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171216
SQL开始执行时间：20190312171216


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171216

20190312171216开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190312171216

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190312171217
SQL开始执行时间：20190312171217


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171217
SQL开始执行时间：20190312171217

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171217
SQL开始执行时间：20190312171217
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171218
SQL开始执行时间：20190312171218


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171218
SQL开始执行时间：20190312171218
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171218
SQL开始执行时间：20190312171218

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171218
SQL开始执行时间：20190312171218
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171219
SQL开始执行时间：20190312171219
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171219
SQL开始执行时间：20190312171219
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171219
SQL开始执行时间：20190312171219
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171219
SQL开始执行时间：20190312171219

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171230
SQL开始执行时间：20190312171230

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171230
SQL开始执行时间：20190312171230

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190312171230
SQL开始执行时间：20190312171230

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171231
SQL开始执行时间：20190312171231

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171231
SQL开始执行时间：20190312171231


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171231

20190312171231开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190312171231

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190312171232
SQL开始执行时间：20190312171232


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171233
SQL开始执行时间：20190312171233

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171233
SQL开始执行时间：20190312171233
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171233
SQL开始执行时间：20190312171233


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171233
SQL开始执行时间：20190312171233
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171234
SQL开始执行时间：20190312171234

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171234
SQL开始执行时间：20190312171234
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171234
SQL开始执行时间：20190312171234
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171234
SQL开始执行时间：20190312171234
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171235
SQL开始执行时间：20190312171235
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171235
SQL开始执行时间：20190312171235

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171248
SQL开始执行时间：20190312171248

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171249
SQL开始执行时间：20190312171249

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190312171249
SQL开始执行时间：20190312171249

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171249
SQL开始执行时间：20190312171249

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171249
SQL开始执行时间：20190312171249


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171249

20190312171249开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190312171249

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190312171250
SQL开始执行时间：20190312171250


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171251
SQL开始执行时间：20190312171251

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171251
SQL开始执行时间：20190312171251
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171252
SQL开始执行时间：20190312171252


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171252
SQL开始执行时间：20190312171252
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171252
SQL开始执行时间：20190312171252

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171252
SQL开始执行时间：20190312171252
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171253
SQL开始执行时间：20190312171253
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171253
SQL开始执行时间：20190312171253
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171253
SQL开始执行时间：20190312171253
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171254
SQL开始执行时间：20190312171254

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171310
SQL开始执行时间：20190312171310

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171310
SQL开始执行时间：20190312171310

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190312171310
SQL开始执行时间：20190312171310

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171310
SQL开始执行时间：20190312171310

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171310
SQL开始执行时间：20190312171310


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171310

20190312171310开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190312171310

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190312171312
SQL开始执行时间：20190312171312


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171313
SQL开始执行时间：20190312171313

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171313
SQL开始执行时间：20190312171313
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171314
SQL开始执行时间：20190312171314


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171314
SQL开始执行时间：20190312171314
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171314
SQL开始执行时间：20190312171314

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171314
SQL开始执行时间：20190312171314
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171315
SQL开始执行时间：20190312171315
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171315
SQL开始执行时间：20190312171315
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171315
SQL开始执行时间：20190312171315
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171316
SQL开始执行时间：20190312171316

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171337
SQL开始执行时间：20190312171337

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171338
SQL开始执行时间：20190312171338

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190312171338
SQL开始执行时间：20190312171338

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171338
SQL开始执行时间：20190312171338

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171338
SQL开始执行时间：20190312171338


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171338

20190312171338开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190312171338

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190312171340
SQL开始执行时间：20190312171340


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171341
SQL开始执行时间：20190312171341

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171341
SQL开始执行时间：20190312171341
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171342
SQL开始执行时间：20190312171342


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171342
SQL开始执行时间：20190312171342
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171342
SQL开始执行时间：20190312171342

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171342
SQL开始执行时间：20190312171342
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171343
SQL开始执行时间：20190312171343
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171343
SQL开始执行时间：20190312171343
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171343
SQL开始执行时间：20190312171343
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171344
SQL开始执行时间：20190312171344

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171410
SQL开始执行时间：20190312171410

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171410
SQL开始执行时间：20190312171410

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312171410
SQL开始执行时间：20190312171410

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171410
SQL开始执行时间：20190312171410

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171410
SQL开始执行时间：20190312171410


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171411

20190312171411开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190312171411

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190312171412
SQL开始执行时间：20190312171412


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171414
SQL开始执行时间：20190312171414

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171414
SQL开始执行时间：20190312171414
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171414
SQL开始执行时间：20190312171414


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171414
SQL开始执行时间：20190312171414
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171415
SQL开始执行时间：20190312171415

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171415
SQL开始执行时间：20190312171415
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171415
SQL开始执行时间：20190312171415
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171416
SQL开始执行时间：20190312171416
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171416
SQL开始执行时间：20190312171416
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171416
SQL开始执行时间：20190312171416

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171444
SQL开始执行时间：20190312171444

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171445
SQL开始执行时间：20190312171445

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312171445
SQL开始执行时间：20190312171445

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171445
SQL开始执行时间：20190312171445

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171445
SQL开始执行时间：20190312171445


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171446

20190312171446开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190312171446

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-04-01'
   and dRegDate < '2019-04-01'
;
SQL结束执行时间：20190312171447
SQL开始执行时间：20190312171447


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312171449
SQL开始执行时间：20190312171449

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312171449
SQL开始执行时间：20190312171449
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312171450
SQL开始执行时间：20190312171450


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312171450
SQL开始执行时间：20190312171450
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312171450
SQL开始执行时间：20190312171450

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312171450
SQL开始执行时间：20190312171450
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312171451
SQL开始执行时间：20190312171451
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312171451
SQL开始执行时间：20190312171451
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312171451
SQL开始执行时间：20190312171451
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312171452
SQL开始执行时间：20190312171452

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312171521
SQL开始执行时间：20190312171521

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312171521
SQL开始执行时间：20190312171521

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-04-01',interval 1 day),7)
;
SQL结束执行时间：20190312171521
SQL开始执行时间：20190312171521

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312171521
SQL开始执行时间：20190312171521

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312171521
SQL开始执行时间：20190312171521


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312171521

20190312173407开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190312173407

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173407
SQL开始执行时间：20190312173407

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173408
SQL开始执行时间：20190312173408

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173408
SQL开始执行时间：20190312173408

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312173410
SQL开始执行时间：20190312173410

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173410
SQL开始执行时间：20190312173410

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173410
SQL开始执行时间：20190312173410


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173410

20190312173410开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190312173410

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173411
SQL开始执行时间：20190312173411

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173412
SQL开始执行时间：20190312173412

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312173412
SQL开始执行时间：20190312173412

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173412
SQL开始执行时间：20190312173412

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173412
SQL开始执行时间：20190312173412


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173412

20190312173412开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190312173412

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190312173412
SQL开始执行时间：20190312173412


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190312173413
SQL开始执行时间：20190312173413

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173414
SQL开始执行时间：20190312173414

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173414
SQL开始执行时间：20190312173414


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173414

20190312173414开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190312173414

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190312173414
SQL开始执行时间：20190312173414


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173415
SQL开始执行时间：20190312173415
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173416
SQL开始执行时间：20190312173416

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173417
SQL开始执行时间：20190312173417

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-05-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173417
SQL开始执行时间：20190312173417

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190312173417
SQL开始执行时间：20190312173417

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173417
SQL开始执行时间：20190312173417

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173417
SQL开始执行时间：20190312173417


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173417

20190312173417开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190312173417

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173418
SQL开始执行时间：20190312173418
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173419
SQL开始执行时间：20190312173419
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173419
SQL开始执行时间：20190312173419
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173419
SQL开始执行时间：20190312173419
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173419
SQL开始执行时间：20190312173419

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173421
SQL开始执行时间：20190312173421

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-06-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173421
SQL开始执行时间：20190312173421

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190312173421
SQL开始执行时间：20190312173421

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173421
SQL开始执行时间：20190312173421

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173421
SQL开始执行时间：20190312173421


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173421

20190312173421开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190312173421

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190312173422
SQL开始执行时间：20190312173422


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173422
SQL开始执行时间：20190312173422

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173422
SQL开始执行时间：20190312173422
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173423
SQL开始执行时间：20190312173423
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173424
SQL开始执行时间：20190312173424

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173428
SQL开始执行时间：20190312173428

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-07-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173428
SQL开始执行时间：20190312173428

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190312173428
SQL开始执行时间：20190312173428

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173428
SQL开始执行时间：20190312173428

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173428
SQL开始执行时间：20190312173428


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173428

20190312173429开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190312173429

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190312173429
SQL开始执行时间：20190312173429


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173430
SQL开始执行时间：20190312173430

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173430
SQL开始执行时间：20190312173430
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173430
SQL开始执行时间：20190312173430


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173430
SQL开始执行时间：20190312173430
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173430
SQL开始执行时间：20190312173430

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173431
SQL开始执行时间：20190312173431
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173431
SQL开始执行时间：20190312173431
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173431
SQL开始执行时间：20190312173431
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173431
SQL开始执行时间：20190312173431
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173431
SQL开始执行时间：20190312173431

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173437
SQL开始执行时间：20190312173437

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-08-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173437
SQL开始执行时间：20190312173437

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190312173437
SQL开始执行时间：20190312173437

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173438
SQL开始执行时间：20190312173438

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173438
SQL开始执行时间：20190312173438


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173438

20190312173438开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190312173438

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190312173439
SQL开始执行时间：20190312173439


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173439
SQL开始执行时间：20190312173439

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173439
SQL开始执行时间：20190312173439
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173440
SQL开始执行时间：20190312173440
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173441
SQL开始执行时间：20190312173441
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173441
SQL开始执行时间：20190312173441

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173450
SQL开始执行时间：20190312173450

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-09-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173450
SQL开始执行时间：20190312173450

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190312173450
SQL开始执行时间：20190312173450

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173450
SQL开始执行时间：20190312173450

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173450
SQL开始执行时间：20190312173450


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173450

20190312173450开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190312173450

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190312173451
SQL开始执行时间：20190312173451


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173452
SQL开始执行时间：20190312173452

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173452
SQL开始执行时间：20190312173452
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173452
SQL开始执行时间：20190312173452


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173452
SQL开始执行时间：20190312173452
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173452
SQL开始执行时间：20190312173452

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173453
SQL开始执行时间：20190312173453
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173453
SQL开始执行时间：20190312173453
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173453
SQL开始执行时间：20190312173453
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173453
SQL开始执行时间：20190312173453
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173454
SQL开始执行时间：20190312173454

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173504
SQL开始执行时间：20190312173504

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-10-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173505
SQL开始执行时间：20190312173505

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190312173505
SQL开始执行时间：20190312173505

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173505
SQL开始执行时间：20190312173505

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173505
SQL开始执行时间：20190312173505


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173505

20190312173505开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190312173505

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190312173506
SQL开始执行时间：20190312173506


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173507
SQL开始执行时间：20190312173507

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173507
SQL开始执行时间：20190312173507
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173508
SQL开始执行时间：20190312173508


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173508
SQL开始执行时间：20190312173508
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173508
SQL开始执行时间：20190312173508

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173508
SQL开始执行时间：20190312173508
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173508
SQL开始执行时间：20190312173508
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173509
SQL开始执行时间：20190312173509
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173509
SQL开始执行时间：20190312173509
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173509
SQL开始执行时间：20190312173509

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173522
SQL开始执行时间：20190312173522

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-11-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173523
SQL开始执行时间：20190312173523

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190312173523
SQL开始执行时间：20190312173523

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173523
SQL开始执行时间：20190312173523

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173523
SQL开始执行时间：20190312173523


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173523

20190312173523开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190312173523

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190312173524
SQL开始执行时间：20190312173524


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173525
SQL开始执行时间：20190312173525

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173526
SQL开始执行时间：20190312173526
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173526
SQL开始执行时间：20190312173526


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173526
SQL开始执行时间：20190312173526
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173526
SQL开始执行时间：20190312173526

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173526
SQL开始执行时间：20190312173526
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173527
SQL开始执行时间：20190312173527
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173527
SQL开始执行时间：20190312173527
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173527
SQL开始执行时间：20190312173527
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173528
SQL开始执行时间：20190312173528

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173544
SQL开始执行时间：20190312173544

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2018-12-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173544
SQL开始执行时间：20190312173544

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190312173544
SQL开始执行时间：20190312173544

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173544
SQL开始执行时间：20190312173544

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173545
SQL开始执行时间：20190312173545


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173545

20190312173545开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190312173545

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190312173546
SQL开始执行时间：20190312173546


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173547
SQL开始执行时间：20190312173547

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173548
SQL开始执行时间：20190312173548
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173548
SQL开始执行时间：20190312173548


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173548
SQL开始执行时间：20190312173548
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173548
SQL开始执行时间：20190312173548

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173549
SQL开始执行时间：20190312173549
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173549
SQL开始执行时间：20190312173549
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173549
SQL开始执行时间：20190312173549
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173550
SQL开始执行时间：20190312173550
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173550
SQL开始执行时间：20190312173550

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173612
SQL开始执行时间：20190312173612

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-01-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173612
SQL开始执行时间：20190312173612

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190312173613
SQL开始执行时间：20190312173613

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173613
SQL开始执行时间：20190312173613

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173613
SQL开始执行时间：20190312173613


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173613

20190312173613开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190312173613

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190312173614
SQL开始执行时间：20190312173614


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173616
SQL开始执行时间：20190312173616

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173616
SQL开始执行时间：20190312173616
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173616
SQL开始执行时间：20190312173616


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173616
SQL开始执行时间：20190312173616
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173617
SQL开始执行时间：20190312173617

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173617
SQL开始执行时间：20190312173617
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173617
SQL开始执行时间：20190312173617
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173618
SQL开始执行时间：20190312173618
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173618
SQL开始执行时间：20190312173618
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173618
SQL开始执行时间：20190312173618

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173645
SQL开始执行时间：20190312173645

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-02-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173645
SQL开始执行时间：20190312173645

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190312173645
SQL开始执行时间：20190312173645

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173645
SQL开始执行时间：20190312173645

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173645
SQL开始执行时间：20190312173645


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173645

20190312173646开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190312173646

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190312173647
SQL开始执行时间：20190312173647


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173648
SQL开始执行时间：20190312173648

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173649
SQL开始执行时间：20190312173649
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173649
SQL开始执行时间：20190312173649


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173649
SQL开始执行时间：20190312173649
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173650
SQL开始执行时间：20190312173650

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173650
SQL开始执行时间：20190312173650
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173650
SQL开始执行时间：20190312173650
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173651
SQL开始执行时间：20190312173651
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173651
SQL开始执行时间：20190312173651
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173651
SQL开始执行时间：20190312173651

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173720
SQL开始执行时间：20190312173720

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-03-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173720
SQL开始执行时间：20190312173720

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190312173720
SQL开始执行时间：20190312173720

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173720
SQL开始执行时间：20190312173720

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173720
SQL开始执行时间：20190312173720


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173720

20190312173721开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190312173721

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-04-01'
   and dRegDate < '2019-04-01'
;
SQL结束执行时间：20190312173722
SQL开始执行时间：20190312173722


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190312173723
SQL开始执行时间：20190312173723

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190312173724
SQL开始执行时间：20190312173724
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190312173724
SQL开始执行时间：20190312173724


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190312173724
SQL开始执行时间：20190312173724
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190312173725
SQL开始执行时间：20190312173725

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190312173725
SQL开始执行时间：20190312173725
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190312173725
SQL开始执行时间：20190312173725
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190312173726
SQL开始执行时间：20190312173726
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190312173726
SQL开始执行时间：20190312173726
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190312173726
SQL开始执行时间：20190312173726

create temporary table pdm.ar_detail_ar2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190312173755
SQL开始执行时间：20190312173755

create temporary table pdm.ar_detail_ap2 as
select 
	 left(DATE_SUB('2019-04-01',interval 1 day),7)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190312173755
SQL开始执行时间：20190312173755

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-04-01',interval 1 day),7)
;
SQL结束执行时间：20190312173755
SQL开始执行时间：20190312173755

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190312173755
SQL开始执行时间：20190312173755

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190312173755
SQL开始执行时间：20190312173755


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190312173756

20190313084819开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190313084819

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313084819
SQL开始执行时间：20190313084819

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084820
SQL开始执行时间：20190313084820

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084820
SQL开始执行时间：20190313084820


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084820

20190313084841开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190313084841

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084842
SQL开始执行时间：20190313084842


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084842

20190313084842开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190313084843

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084843
SQL开始执行时间：20190313084843

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084844
SQL开始执行时间：20190313084844

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084844
SQL开始执行时间：20190313084844

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190313084844
SQL开始执行时间：20190313084844

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084844
SQL开始执行时间：20190313084844

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084844
SQL开始执行时间：20190313084844


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084844

20190313084844开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190313084844

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084845
SQL开始执行时间：20190313084845

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084847
SQL开始执行时间：20190313084847

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084847
SQL开始执行时间：20190313084847

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190313084847
SQL开始执行时间：20190313084847

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084847
SQL开始执行时间：20190313084847

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084847
SQL开始执行时间：20190313084847


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084847

20190313084847开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190313084847

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084848
SQL开始执行时间：20190313084848
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084849
SQL开始执行时间：20190313084849
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084849
SQL开始执行时间：20190313084849
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084849
SQL开始执行时间：20190313084849

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084851
SQL开始执行时间：20190313084851

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084851
SQL开始执行时间：20190313084851

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190313084851
SQL开始执行时间：20190313084851

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084851
SQL开始执行时间：20190313084851

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084851
SQL开始执行时间：20190313084851


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084851

20190313084851开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190313084851

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190313084852
SQL开始执行时间：20190313084852


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084852
SQL开始执行时间：20190313084852

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084853
SQL开始执行时间：20190313084853

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084858
SQL开始执行时间：20190313084858

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084858
SQL开始执行时间：20190313084858

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190313084858
SQL开始执行时间：20190313084858

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084858
SQL开始执行时间：20190313084858

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084858
SQL开始执行时间：20190313084858


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084858

20190313084858开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190313084858

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190313084859
SQL开始执行时间：20190313084859


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084900
SQL开始执行时间：20190313084900
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084901
SQL开始执行时间：20190313084901
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084901
SQL开始执行时间：20190313084901
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084901
SQL开始执行时间：20190313084901
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084901
SQL开始执行时间：20190313084901

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084907
SQL开始执行时间：20190313084907

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084907
SQL开始执行时间：20190313084907

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190313084907
SQL开始执行时间：20190313084907

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084907
SQL开始执行时间：20190313084907

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084907
SQL开始执行时间：20190313084907


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084907

20190313084908开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190313084908

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190313084908
SQL开始执行时间：20190313084908


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084909
SQL开始执行时间：20190313084909

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084909
SQL开始执行时间：20190313084909
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084909
SQL开始执行时间：20190313084909


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084909
SQL开始执行时间：20190313084909
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084910
SQL开始执行时间：20190313084910

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084910
SQL开始执行时间：20190313084910
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084910
SQL开始执行时间：20190313084910
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084910
SQL开始执行时间：20190313084910
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084911
SQL开始执行时间：20190313084911
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084911
SQL开始执行时间：20190313084911

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084919
SQL开始执行时间：20190313084919

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084920
SQL开始执行时间：20190313084920

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190313084920
SQL开始执行时间：20190313084920

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084920
SQL开始执行时间：20190313084920

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084920
SQL开始执行时间：20190313084920


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084920

20190313084920开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190313084920

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190313084922
SQL开始执行时间：20190313084922


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084922
SQL开始执行时间：20190313084922

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084922
SQL开始执行时间：20190313084922
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084923
SQL开始执行时间：20190313084923


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084923
SQL开始执行时间：20190313084923
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084923
SQL开始执行时间：20190313084923

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084923
SQL开始执行时间：20190313084923
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084923
SQL开始执行时间：20190313084923
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084924
SQL开始执行时间：20190313084924
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084924
SQL开始执行时间：20190313084924
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084924
SQL开始执行时间：20190313084924

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084935
SQL开始执行时间：20190313084935

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084935
SQL开始执行时间：20190313084935

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190313084935
SQL开始执行时间：20190313084935

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084935
SQL开始执行时间：20190313084935

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084935
SQL开始执行时间：20190313084935


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084935

20190313084936开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190313084936

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190313084937
SQL开始执行时间：20190313084937


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084937
SQL开始执行时间：20190313084937

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084938
SQL开始执行时间：20190313084938
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084938
SQL开始执行时间：20190313084938


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084938
SQL开始执行时间：20190313084938
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084938
SQL开始执行时间：20190313084938

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084939
SQL开始执行时间：20190313084939
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084939
SQL开始执行时间：20190313084939
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084939
SQL开始执行时间：20190313084939
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084939
SQL开始执行时间：20190313084939
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084940
SQL开始执行时间：20190313084940

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313084953
SQL开始执行时间：20190313084953

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313084953
SQL开始执行时间：20190313084953

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190313084953
SQL开始执行时间：20190313084953

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313084953
SQL开始执行时间：20190313084953

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313084953
SQL开始执行时间：20190313084953


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313084953

20190313084954开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190313084954

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190313084955
SQL开始执行时间：20190313084955


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313084956
SQL开始执行时间：20190313084956

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313084956
SQL开始执行时间：20190313084956
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313084957
SQL开始执行时间：20190313084957


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313084957
SQL开始执行时间：20190313084957
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313084957
SQL开始执行时间：20190313084957

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313084957
SQL开始执行时间：20190313084957
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313084957
SQL开始执行时间：20190313084957
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313084958
SQL开始执行时间：20190313084958
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313084958
SQL开始执行时间：20190313084958
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313084958
SQL开始执行时间：20190313084958

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085015
SQL开始执行时间：20190313085015

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085015
SQL开始执行时间：20190313085015

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190313085015
SQL开始执行时间：20190313085015

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085015
SQL开始执行时间：20190313085015

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085016
SQL开始执行时间：20190313085016


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085016

20190313085016开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190313085016

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190313085017
SQL开始执行时间：20190313085017


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085018
SQL开始执行时间：20190313085018

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085019
SQL开始执行时间：20190313085019
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085019
SQL开始执行时间：20190313085019


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085019
SQL开始执行时间：20190313085019
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085019
SQL开始执行时间：20190313085019

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085020
SQL开始执行时间：20190313085020
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085020
SQL开始执行时间：20190313085020
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085020
SQL开始执行时间：20190313085020
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085020
SQL开始执行时间：20190313085020
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085021
SQL开始执行时间：20190313085021

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085043
SQL开始执行时间：20190313085043

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085043
SQL开始执行时间：20190313085043

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190313085043
SQL开始执行时间：20190313085043

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085043
SQL开始执行时间：20190313085043

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085043
SQL开始执行时间：20190313085043


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085044

20190313085044开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190313085044

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190313085045
SQL开始执行时间：20190313085045


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085046
SQL开始执行时间：20190313085046

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085047
SQL开始执行时间：20190313085047
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085047
SQL开始执行时间：20190313085047


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085047
SQL开始执行时间：20190313085047
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085047
SQL开始执行时间：20190313085047

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085048
SQL开始执行时间：20190313085048
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085048
SQL开始执行时间：20190313085048
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085048
SQL开始执行时间：20190313085048
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085049
SQL开始执行时间：20190313085049
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085049
SQL开始执行时间：20190313085049

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085115
SQL开始执行时间：20190313085115

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085115
SQL开始执行时间：20190313085115

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313085115
SQL开始执行时间：20190313085115

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085115
SQL开始执行时间：20190313085115

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085115
SQL开始执行时间：20190313085115


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085116

20190313085116开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190313085116

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190313085117
SQL开始执行时间：20190313085117


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085119
SQL开始执行时间：20190313085119

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085119
SQL开始执行时间：20190313085119
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085119
SQL开始执行时间：20190313085119


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085119
SQL开始执行时间：20190313085119
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085120
SQL开始执行时间：20190313085120

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085120
SQL开始执行时间：20190313085120
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085120
SQL开始执行时间：20190313085120
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085121
SQL开始执行时间：20190313085121
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085121
SQL开始执行时间：20190313085121
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085121
SQL开始执行时间：20190313085121

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085150
SQL开始执行时间：20190313085150

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085150
SQL开始执行时间：20190313085150

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313085150
SQL开始执行时间：20190313085150

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085150
SQL开始执行时间：20190313085150

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085150
SQL开始执行时间：20190313085150


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085151

20190313085151开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190313085151

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-14'
   and dRegDate < '2019-03-14'
;
SQL结束执行时间：20190313085152
SQL开始执行时间：20190313085152


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085153
SQL开始执行时间：20190313085153

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085154
SQL开始执行时间：20190313085154
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085154
SQL开始执行时间：20190313085154


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085154
SQL开始执行时间：20190313085154
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085155
SQL开始执行时间：20190313085155

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085155
SQL开始执行时间：20190313085155
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085155
SQL开始执行时间：20190313085155
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085156
SQL开始执行时间：20190313085156
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085156
SQL开始执行时间：20190313085156
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085156
SQL开始执行时间：20190313085156

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085225
SQL开始执行时间：20190313085225

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085225
SQL开始执行时间：20190313085225

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-14',interval 1 day),7)
;
SQL结束执行时间：20190313085225
SQL开始执行时间：20190313085225

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085226
SQL开始执行时间：20190313085226

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085226
SQL开始执行时间：20190313085226


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085226

20190313085232开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190313085232

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190313085234
SQL开始执行时间：20190313085234


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085235
SQL开始执行时间：20190313085235

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085236
SQL开始执行时间：20190313085236
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085236
SQL开始执行时间：20190313085236


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085236
SQL开始执行时间：20190313085236
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085237
SQL开始执行时间：20190313085237

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085237
SQL开始执行时间：20190313085237
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085237
SQL开始执行时间：20190313085237
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085237
SQL开始执行时间：20190313085237
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085238
SQL开始执行时间：20190313085238
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085238
SQL开始执行时间：20190313085238

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085306
SQL开始执行时间：20190313085306

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085307
SQL开始执行时间：20190313085307

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313085307
SQL开始执行时间：20190313085307

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085307
SQL开始执行时间：20190313085307

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085307
SQL开始执行时间：20190313085307


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085307

20190313085307开始执行2019-04-14数据加载日志:
SQL开始执行时间：20190313085307

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-04-14'
   and dRegDate < '2019-04-14'
;
SQL结束执行时间：20190313085309
SQL开始执行时间：20190313085309


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085310
SQL开始执行时间：20190313085310

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085311
SQL开始执行时间：20190313085311
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085311
SQL开始执行时间：20190313085311


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085311
SQL开始执行时间：20190313085311
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085312
SQL开始执行时间：20190313085312

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085312
SQL开始执行时间：20190313085312
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085312
SQL开始执行时间：20190313085312
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085313
SQL开始执行时间：20190313085313
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085313
SQL开始执行时间：20190313085313
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085313
SQL开始执行时间：20190313085313

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-04-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085342
SQL开始执行时间：20190313085342

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-04-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085342
SQL开始执行时间：20190313085342

delete from pdm.ar_ap where y_mon = left(DATE_SUB('2019-04-14',interval 1 day),7)
;
SQL结束执行时间：20190313085342
SQL开始执行时间：20190313085342

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085343
SQL开始执行时间：20190313085343

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085343
SQL开始执行时间：20190313085343


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085343

20190313085351开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190313085351

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190313085353
SQL开始执行时间：20190313085353


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085354
SQL开始执行时间：20190313085354

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085355
SQL开始执行时间：20190313085355
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085355
SQL开始执行时间：20190313085355


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085355
SQL开始执行时间：20190313085355
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085355
SQL开始执行时间：20190313085355

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085356
SQL开始执行时间：20190313085356
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085356
SQL开始执行时间：20190313085356
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085356
SQL开始执行时间：20190313085356
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085356
SQL开始执行时间：20190313085356
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085357
SQL开始执行时间：20190313085357

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085425
SQL开始执行时间：20190313085425

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085425
SQL开始执行时间：20190313085425

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313085427
SQL开始执行时间：20190313085427

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085427
SQL开始执行时间：20190313085427

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085427
SQL开始执行时间：20190313085427


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085428

20190313085502开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190313085502

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-14'
   and dRegDate < '2019-03-14'
;
SQL结束执行时间：20190313085503
SQL开始执行时间：20190313085503


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313085505
SQL开始执行时间：20190313085505

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313085505
SQL开始执行时间：20190313085505
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313085506
SQL开始执行时间：20190313085506


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313085506
SQL开始执行时间：20190313085506
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313085506
SQL开始执行时间：20190313085506

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313085506
SQL开始执行时间：20190313085506
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313085507
SQL开始执行时间：20190313085507
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313085507
SQL开始执行时间：20190313085507
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313085507
SQL开始执行时间：20190313085507
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313085508
SQL开始执行时间：20190313085508

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313085536
SQL开始执行时间：20190313085536

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313085536
SQL开始执行时间：20190313085536

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-14',interval 1 day),7)
;
SQL结束执行时间：20190313085537
SQL开始执行时间：20190313085537

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313085537
SQL开始执行时间：20190313085537

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313085538
SQL开始执行时间：20190313085538


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313085538

20190313150908开始执行2017-08-01数据加载日志:
SQL开始执行时间：20190313150908

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-08-01'
   and dRegDate < '2017-08-01'
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150908
SQL开始执行时间：20190313150908

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-08-01',interval 1 day),7)
;
SQL结束执行时间：20190313150915
SQL开始执行时间：20190313150915

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150915
SQL开始执行时间：20190313150915

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150915
SQL开始执行时间：20190313150915


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150915

20190313150915开始执行2017-09-01数据加载日志:
SQL开始执行时间：20190313150915

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-09-01'
   and dRegDate < '2017-09-01'
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-09-01',interval 1 day),7)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150916

20190313150916开始执行2017-10-01数据加载日志:
SQL开始执行时间：20190313150916

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-10-01'
   and dRegDate < '2017-10-01'
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150916
SQL开始执行时间：20190313150916
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-10-01',interval 1 day),7)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150917

20190313150917开始执行2017-11-01数据加载日志:
SQL开始执行时间：20190313150917

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-11-01'
   and dRegDate < '2017-11-01'
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150917
SQL开始执行时间：20190313150917

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-11-01',interval 1 day),7)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150918

20190313150918开始执行2017-12-01数据加载日志:
SQL开始执行时间：20190313150918

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-12-01'
   and dRegDate < '2017-12-01'
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-12-01',interval 1 day),7)
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150918
SQL开始执行时间：20190313150918


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150918

20190313150919开始执行2018-01-01数据加载日志:
SQL开始执行时间：20190313150919

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-01-01'
   and dRegDate < '2018-01-01'
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-01-01',interval 1 day),7)
;
SQL结束执行时间：20190313150919
SQL开始执行时间：20190313150919

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150920

20190313150920开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190313150920

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150920
SQL开始执行时间：20190313150920
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150921
SQL开始执行时间：20190313150921


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150921

20190313150922开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190313150922

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150922
SQL开始执行时间：20190313150922
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150923
SQL开始执行时间：20190313150923


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150924

20190313150924开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190313150924

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190313150924
SQL开始执行时间：20190313150924


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150924
SQL开始执行时间：20190313150924

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150925
SQL开始执行时间：20190313150925

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150926
SQL开始执行时间：20190313150926

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150926
SQL开始执行时间：20190313150926

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190313150926
SQL开始执行时间：20190313150926

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150926
SQL开始执行时间：20190313150926

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150926
SQL开始执行时间：20190313150926


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150926

20190313150926开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190313150926

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190313150927
SQL开始执行时间：20190313150927


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150928
SQL开始执行时间：20190313150928

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150930
SQL开始执行时间：20190313150930

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150930
SQL开始执行时间：20190313150930

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190313150930
SQL开始执行时间：20190313150930

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150930
SQL开始执行时间：20190313150930

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150930
SQL开始执行时间：20190313150930


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150930

20190313150930开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190313150930

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190313150931
SQL开始执行时间：20190313150931


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150931
SQL开始执行时间：20190313150931

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150931
SQL开始执行时间：20190313150931
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150932
SQL开始执行时间：20190313150932

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150934
SQL开始执行时间：20190313150934

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150934
SQL开始执行时间：20190313150934

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190313150934
SQL开始执行时间：20190313150934

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150934
SQL开始执行时间：20190313150934

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150934
SQL开始执行时间：20190313150934


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150934

20190313150935开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190313150935

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190313150936
SQL开始执行时间：20190313150936


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150936
SQL开始执行时间：20190313150936

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150936
SQL开始执行时间：20190313150936
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150936
SQL开始执行时间：20190313150936


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150936
SQL开始执行时间：20190313150936
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150937
SQL开始执行时间：20190313150937

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150937
SQL开始执行时间：20190313150937
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150937
SQL开始执行时间：20190313150937
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150937
SQL开始执行时间：20190313150937
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150938
SQL开始执行时间：20190313150938
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150938
SQL开始执行时间：20190313150938

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150943
SQL开始执行时间：20190313150943

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150943
SQL开始执行时间：20190313150943

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190313150943
SQL开始执行时间：20190313150943

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150943
SQL开始执行时间：20190313150943

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150943
SQL开始执行时间：20190313150943


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150943

20190313150943开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190313150943

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190313150944
SQL开始执行时间：20190313150944


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150945
SQL开始执行时间：20190313150945

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150945
SQL开始执行时间：20190313150945
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150945
SQL开始执行时间：20190313150945


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150945
SQL开始执行时间：20190313150945
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150945
SQL开始执行时间：20190313150945

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150946
SQL开始执行时间：20190313150946
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150946
SQL开始执行时间：20190313150946
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150946
SQL开始执行时间：20190313150946
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150946
SQL开始执行时间：20190313150946
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150947
SQL开始执行时间：20190313150947

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313150953
SQL开始执行时间：20190313150953

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313150953
SQL开始执行时间：20190313150953

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190313150953
SQL开始执行时间：20190313150953

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313150953
SQL开始执行时间：20190313150953

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313150953
SQL开始执行时间：20190313150953


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313150953

20190313150953开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190313150953

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190313150954
SQL开始执行时间：20190313150954


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313150955
SQL开始执行时间：20190313150955

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313150955
SQL开始执行时间：20190313150955
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313150956
SQL开始执行时间：20190313150956


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313150956
SQL开始执行时间：20190313150956
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313150956
SQL开始执行时间：20190313150956

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313150956
SQL开始执行时间：20190313150956
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313150956
SQL开始执行时间：20190313150956
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313150957
SQL开始执行时间：20190313150957
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313150957
SQL开始执行时间：20190313150957
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313150958
SQL开始执行时间：20190313150958

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151006
SQL开始执行时间：20190313151006

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151007
SQL开始执行时间：20190313151007

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190313151007
SQL开始执行时间：20190313151007

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151007
SQL开始执行时间：20190313151007

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151007
SQL开始执行时间：20190313151007


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151007

20190313151007开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190313151007

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190313151008
SQL开始执行时间：20190313151008


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151009
SQL开始执行时间：20190313151009

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151009
SQL开始执行时间：20190313151009
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151010
SQL开始执行时间：20190313151010


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151010
SQL开始执行时间：20190313151010
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151010
SQL开始执行时间：20190313151010

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151010
SQL开始执行时间：20190313151010
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151010
SQL开始执行时间：20190313151010
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151011
SQL开始执行时间：20190313151011
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151011
SQL开始执行时间：20190313151011
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151012
SQL开始执行时间：20190313151012

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151023
SQL开始执行时间：20190313151023

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151023
SQL开始执行时间：20190313151023

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190313151023
SQL开始执行时间：20190313151023

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151023
SQL开始执行时间：20190313151023

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151023
SQL开始执行时间：20190313151023


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151023

20190313151023开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190313151023

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190313151025
SQL开始执行时间：20190313151025


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151026
SQL开始执行时间：20190313151026

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151026
SQL开始执行时间：20190313151026
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151026
SQL开始执行时间：20190313151026


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151026
SQL开始执行时间：20190313151026
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151027
SQL开始执行时间：20190313151027

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151027
SQL开始执行时间：20190313151027
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151027
SQL开始执行时间：20190313151027
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151028
SQL开始执行时间：20190313151028
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151028
SQL开始执行时间：20190313151028
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151028
SQL开始执行时间：20190313151028

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151042
SQL开始执行时间：20190313151042

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151042
SQL开始执行时间：20190313151042

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190313151042
SQL开始执行时间：20190313151042

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151042
SQL开始执行时间：20190313151042

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151042
SQL开始执行时间：20190313151042


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151042

20190313151043开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190313151043

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190313151044
SQL开始执行时间：20190313151044


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151045
SQL开始执行时间：20190313151045

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151045
SQL开始执行时间：20190313151045
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151046
SQL开始执行时间：20190313151046


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151046
SQL开始执行时间：20190313151046
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151046
SQL开始执行时间：20190313151046

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151046
SQL开始执行时间：20190313151046
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151047
SQL开始执行时间：20190313151047
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151047
SQL开始执行时间：20190313151047
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151048
SQL开始执行时间：20190313151048
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151048
SQL开始执行时间：20190313151048

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151104
SQL开始执行时间：20190313151104

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151104
SQL开始执行时间：20190313151104

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190313151105
SQL开始执行时间：20190313151105

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151105
SQL开始执行时间：20190313151105

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151105
SQL开始执行时间：20190313151105


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151105

20190313151105开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190313151105

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190313151107
SQL开始执行时间：20190313151107


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151108
SQL开始执行时间：20190313151108

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151108
SQL开始执行时间：20190313151108
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151109
SQL开始执行时间：20190313151109


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151109
SQL开始执行时间：20190313151109
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151109
SQL开始执行时间：20190313151109

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151109
SQL开始执行时间：20190313151109
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151110
SQL开始执行时间：20190313151110
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151110
SQL开始执行时间：20190313151110
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151110
SQL开始执行时间：20190313151110
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151111
SQL开始执行时间：20190313151111

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151134
SQL开始执行时间：20190313151134

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151134
SQL开始执行时间：20190313151134

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190313151134
SQL开始执行时间：20190313151134

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151134
SQL开始执行时间：20190313151134

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151134
SQL开始执行时间：20190313151134


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151135

20190313151135开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190313151135

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190313151136
SQL开始执行时间：20190313151136


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151138
SQL开始执行时间：20190313151138

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151138
SQL开始执行时间：20190313151138
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151139
SQL开始执行时间：20190313151139


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151139
SQL开始执行时间：20190313151139
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151139
SQL开始执行时间：20190313151139

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151139
SQL开始执行时间：20190313151139
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151140
SQL开始执行时间：20190313151140
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151140
SQL开始执行时间：20190313151140
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151140
SQL开始执行时间：20190313151140
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151141
SQL开始执行时间：20190313151141

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151208
SQL开始执行时间：20190313151208

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151208
SQL开始执行时间：20190313151208

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313151208
SQL开始执行时间：20190313151208

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151209
SQL开始执行时间：20190313151209

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151209
SQL开始执行时间：20190313151209


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151209

20190313151209开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190313151209

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190313151211
SQL开始执行时间：20190313151211


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151212
SQL开始执行时间：20190313151212

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151212
SQL开始执行时间：20190313151212
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151213
SQL开始执行时间：20190313151213


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151213
SQL开始执行时间：20190313151213
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151214
SQL开始执行时间：20190313151214

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151214
SQL开始执行时间：20190313151214
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151214
SQL开始执行时间：20190313151214
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151214
SQL开始执行时间：20190313151214
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151215
SQL开始执行时间：20190313151215
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151216
SQL开始执行时间：20190313151216

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151245
SQL开始执行时间：20190313151245

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151245
SQL开始执行时间：20190313151245

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313151245
SQL开始执行时间：20190313151245

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151245
SQL开始执行时间：20190313151245

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151245
SQL开始执行时间：20190313151245


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151246

20190313151246开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190313151246

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-14'
   and dRegDate < '2019-03-14'
;
SQL结束执行时间：20190313151248
SQL开始执行时间：20190313151248


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313151250
SQL开始执行时间：20190313151250

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313151250
SQL开始执行时间：20190313151250
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313151251
SQL开始执行时间：20190313151251


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313151251
SQL开始执行时间：20190313151251
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313151251
SQL开始执行时间：20190313151251

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313151251
SQL开始执行时间：20190313151251
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313151252
SQL开始执行时间：20190313151252
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313151252
SQL开始执行时间：20190313151252
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313151252
SQL开始执行时间：20190313151252
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313151253
SQL开始执行时间：20190313151253

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313151322
SQL开始执行时间：20190313151322

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313151322
SQL开始执行时间：20190313151322

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-14',interval 1 day),7)
;
SQL结束执行时间：20190313151322
SQL开始执行时间：20190313151322

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313151322
SQL开始执行时间：20190313151322

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313151323
SQL开始执行时间：20190313151323


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313151323

20190313171513开始执行2017-08-01数据加载日志:
SQL开始执行时间：20190313171513

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-08-01'
   and dRegDate < '2017-08-01'
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171513
SQL开始执行时间：20190313171513

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-08-01',interval 1 day),7)
;
SQL结束执行时间：20190313171517
SQL开始执行时间：20190313171517

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171518

20190313171518开始执行2017-09-01数据加载日志:
SQL开始执行时间：20190313171518

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-09-01'
   and dRegDate < '2017-09-01'
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-09-01',interval 1 day),7)
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171518
SQL开始执行时间：20190313171518


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171518

20190313171518开始执行2017-10-01数据加载日志:
SQL开始执行时间：20190313171518

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-10-01'
   and dRegDate < '2017-10-01'
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-10-01',interval 1 day),7)
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171519
SQL开始执行时间：20190313171519


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171519

20190313171519开始执行2017-11-01数据加载日志:
SQL开始执行时间：20190313171519

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-11-01'
   and dRegDate < '2017-11-01'
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-11-01',interval 1 day),7)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171520

20190313171520开始执行2017-12-01数据加载日志:
SQL开始执行时间：20190313171520

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2017-12-01'
   and dRegDate < '2017-12-01'
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171520
SQL开始执行时间：20190313171520
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2017-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2017-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2017-12-01',interval 1 day),7)
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171521

20190313171521开始执行2018-01-01数据加载日志:
SQL开始执行时间：20190313171521

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-01-01'
   and dRegDate < '2018-01-01'
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171521
SQL开始执行时间：20190313171521
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-01-01',interval 1 day),7)
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171522

20190313171522开始执行2018-02-01数据加载日志:
SQL开始执行时间：20190313171522

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-02-01'
   and dRegDate < '2018-02-01'
;
SQL结束执行时间：20190313171522
SQL开始执行时间：20190313171522


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171523
SQL开始执行时间：20190313171523


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171524

20190313171524开始执行2018-03-01数据加载日志:
SQL开始执行时间：20190313171524

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-03-01'
   and dRegDate < '2018-03-01'
;
SQL结束执行时间：20190313171524
SQL开始执行时间：20190313171524


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171524
SQL开始执行时间：20190313171524

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171524
SQL开始执行时间：20190313171524
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313171525
SQL开始执行时间：20190313171525

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171526
SQL开始执行时间：20190313171526

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171526
SQL开始执行时间：20190313171526


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171526

20190313171526开始执行2018-04-01数据加载日志:
SQL开始执行时间：20190313171526

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-04-01'
   and dRegDate < '2018-04-01'
;
SQL结束执行时间：20190313171526
SQL开始执行时间：20190313171526


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171527
SQL开始执行时间：20190313171527
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171528
SQL开始执行时间：20190313171528
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171528
SQL开始执行时间：20190313171528

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171528
SQL开始执行时间：20190313171528

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-04-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171528
SQL开始执行时间：20190313171528

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-04-01',interval 1 day),7)
;
SQL结束执行时间：20190313171528
SQL开始执行时间：20190313171528

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171529
SQL开始执行时间：20190313171529

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171529
SQL开始执行时间：20190313171529


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171529

20190313171529开始执行2018-05-01数据加载日志:
SQL开始执行时间：20190313171529

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-05-01'
   and dRegDate < '2018-05-01'
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171530
SQL开始执行时间：20190313171530
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171531
SQL开始执行时间：20190313171531
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171531
SQL开始执行时间：20190313171531

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171532
SQL开始执行时间：20190313171532

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-05-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171532
SQL开始执行时间：20190313171532

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-05-01',interval 1 day),7)
;
SQL结束执行时间：20190313171533
SQL开始执行时间：20190313171533

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171533
SQL开始执行时间：20190313171533

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171533
SQL开始执行时间：20190313171533


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171533

20190313171533开始执行2018-06-01数据加载日志:
SQL开始执行时间：20190313171533

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-06-01'
   and dRegDate < '2018-06-01'
;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171534
SQL开始执行时间：20190313171534

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171535
SQL开始执行时间：20190313171535
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171535
SQL开始执行时间：20190313171535
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171535
SQL开始执行时间：20190313171535
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171535
SQL开始执行时间：20190313171535
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171535
SQL开始执行时间：20190313171535

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171537
SQL开始执行时间：20190313171537

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-06-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171538
SQL开始执行时间：20190313171538

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-06-01',interval 1 day),7)
;
SQL结束执行时间：20190313171538
SQL开始执行时间：20190313171538

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171538
SQL开始执行时间：20190313171538

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171538
SQL开始执行时间：20190313171538


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171538

20190313171538开始执行2018-07-01数据加载日志:
SQL开始执行时间：20190313171538

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-07-01'
   and dRegDate < '2018-07-01'
;
SQL结束执行时间：20190313171539
SQL开始执行时间：20190313171539


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171539
SQL开始执行时间：20190313171539

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171539
SQL开始执行时间：20190313171539
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171540
SQL开始执行时间：20190313171540
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171541
SQL开始执行时间：20190313171541

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171545
SQL开始执行时间：20190313171545

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-07-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171545
SQL开始执行时间：20190313171545

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-07-01',interval 1 day),7)
;
SQL结束执行时间：20190313171545
SQL开始执行时间：20190313171545

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171546
SQL开始执行时间：20190313171546

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171546
SQL开始执行时间：20190313171546


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171546

20190313171546开始执行2018-08-01数据加载日志:
SQL开始执行时间：20190313171546

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-08-01'
   and dRegDate < '2018-08-01'
;
SQL结束执行时间：20190313171546
SQL开始执行时间：20190313171546


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171547
SQL开始执行时间：20190313171547

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171547
SQL开始执行时间：20190313171547
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171548
SQL开始执行时间：20190313171548
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171549
SQL开始执行时间：20190313171549
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171549
SQL开始执行时间：20190313171549

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171555
SQL开始执行时间：20190313171555

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-08-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171555
SQL开始执行时间：20190313171555

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-08-01',interval 1 day),7)
;
SQL结束执行时间：20190313171555
SQL开始执行时间：20190313171555

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171556
SQL开始执行时间：20190313171556

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171556
SQL开始执行时间：20190313171556


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171556

20190313171556开始执行2018-09-01数据加载日志:
SQL开始执行时间：20190313171556

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-09-01'
   and dRegDate < '2018-09-01'
;
SQL结束执行时间：20190313171557
SQL开始执行时间：20190313171557


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171557
SQL开始执行时间：20190313171557

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171558
SQL开始执行时间：20190313171558
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171558
SQL开始执行时间：20190313171558


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171558
SQL开始执行时间：20190313171558
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171558
SQL开始执行时间：20190313171558

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171558
SQL开始执行时间：20190313171558
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171559
SQL开始执行时间：20190313171559
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171559
SQL开始执行时间：20190313171559
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171600
SQL开始执行时间：20190313171600
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171600
SQL开始执行时间：20190313171600

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171609
SQL开始执行时间：20190313171609

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-09-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171609
SQL开始执行时间：20190313171609

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-09-01',interval 1 day),7)
;
SQL结束执行时间：20190313171609
SQL开始执行时间：20190313171609

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171609
SQL开始执行时间：20190313171609

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171609
SQL开始执行时间：20190313171609


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171609

20190313171610开始执行2018-10-01数据加载日志:
SQL开始执行时间：20190313171610

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-10-01'
   and dRegDate < '2018-10-01'
;
SQL结束执行时间：20190313171611
SQL开始执行时间：20190313171611


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171611
SQL开始执行时间：20190313171611

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171612
SQL开始执行时间：20190313171612
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171612
SQL开始执行时间：20190313171612


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171612
SQL开始执行时间：20190313171612
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171612
SQL开始执行时间：20190313171612

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171613
SQL开始执行时间：20190313171613
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171613
SQL开始执行时间：20190313171613
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171613
SQL开始执行时间：20190313171613
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171614
SQL开始执行时间：20190313171614
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171614
SQL开始执行时间：20190313171614

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171625
SQL开始执行时间：20190313171625

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-10-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171625
SQL开始执行时间：20190313171625

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-10-01',interval 1 day),7)
;
SQL结束执行时间：20190313171625
SQL开始执行时间：20190313171625

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171625
SQL开始执行时间：20190313171625

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171625
SQL开始执行时间：20190313171625


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171625

20190313171626开始执行2018-11-01数据加载日志:
SQL开始执行时间：20190313171626

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-11-01'
   and dRegDate < '2018-11-01'
;
SQL结束执行时间：20190313171627
SQL开始执行时间：20190313171627


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171628
SQL开始执行时间：20190313171628

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171628
SQL开始执行时间：20190313171628
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171628
SQL开始执行时间：20190313171628


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171628
SQL开始执行时间：20190313171628
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171629
SQL开始执行时间：20190313171629

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171629
SQL开始执行时间：20190313171629
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171630
SQL开始执行时间：20190313171630
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171630
SQL开始执行时间：20190313171630
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171630
SQL开始执行时间：20190313171630
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171630
SQL开始执行时间：20190313171630

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171644
SQL开始执行时间：20190313171644

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-11-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171644
SQL开始执行时间：20190313171644

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-11-01',interval 1 day),7)
;
SQL结束执行时间：20190313171644
SQL开始执行时间：20190313171644

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171644
SQL开始执行时间：20190313171644

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171644
SQL开始执行时间：20190313171644


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171644

20190313171644开始执行2018-12-01数据加载日志:
SQL开始执行时间：20190313171644

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2018-12-01'
   and dRegDate < '2018-12-01'
;
SQL结束执行时间：20190313171646
SQL开始执行时间：20190313171646


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171647
SQL开始执行时间：20190313171647

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171647
SQL开始执行时间：20190313171647
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171648
SQL开始执行时间：20190313171648


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171648
SQL开始执行时间：20190313171648
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171648
SQL开始执行时间：20190313171648

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171648
SQL开始执行时间：20190313171648
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171649
SQL开始执行时间：20190313171649
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171649
SQL开始执行时间：20190313171649
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171649
SQL开始执行时间：20190313171649
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171650
SQL开始执行时间：20190313171650

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171706
SQL开始执行时间：20190313171706

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2018-12-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171706
SQL开始执行时间：20190313171706

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2018-12-01',interval 1 day),7)
;
SQL结束执行时间：20190313171707
SQL开始执行时间：20190313171707

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171707
SQL开始执行时间：20190313171707

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171707
SQL开始执行时间：20190313171707


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171707

20190313171707开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190313171707

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-01-01'
   and dRegDate < '2019-01-01'
;
SQL结束执行时间：20190313171708
SQL开始执行时间：20190313171708


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171710
SQL开始执行时间：20190313171710

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171710
SQL开始执行时间：20190313171710
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171710
SQL开始执行时间：20190313171710


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171710
SQL开始执行时间：20190313171710
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171711
SQL开始执行时间：20190313171711

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171711
SQL开始执行时间：20190313171711
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171711
SQL开始执行时间：20190313171711
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171712
SQL开始执行时间：20190313171712
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171712
SQL开始执行时间：20190313171712
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171712
SQL开始执行时间：20190313171712

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171734
SQL开始执行时间：20190313171734

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-01-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171735
SQL开始执行时间：20190313171735

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-01-01',interval 1 day),7)
;
SQL结束执行时间：20190313171735
SQL开始执行时间：20190313171735

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171735
SQL开始执行时间：20190313171735

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171735
SQL开始执行时间：20190313171735


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171735

20190313171735开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190313171735

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-02-01'
   and dRegDate < '2019-02-01'
;
SQL结束执行时间：20190313171737
SQL开始执行时间：20190313171737


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171738
SQL开始执行时间：20190313171738

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171739
SQL开始执行时间：20190313171739
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171739
SQL开始执行时间：20190313171739


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171739
SQL开始执行时间：20190313171739
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171740
SQL开始执行时间：20190313171740

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171740
SQL开始执行时间：20190313171740
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171740
SQL开始执行时间：20190313171740
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171741
SQL开始执行时间：20190313171741
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171741
SQL开始执行时间：20190313171741
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171741
SQL开始执行时间：20190313171741

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171808
SQL开始执行时间：20190313171808

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-02-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171808
SQL开始执行时间：20190313171808

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-02-01',interval 1 day),7)
;
SQL结束执行时间：20190313171808
SQL开始执行时间：20190313171808

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171809
SQL开始执行时间：20190313171809

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171809
SQL开始执行时间：20190313171809


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171809

20190313171809开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190313171809

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190313171810
SQL开始执行时间：20190313171810


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171812
SQL开始执行时间：20190313171812

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171812
SQL开始执行时间：20190313171812
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171813
SQL开始执行时间：20190313171813


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171813
SQL开始执行时间：20190313171813
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171813
SQL开始执行时间：20190313171813

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171814
SQL开始执行时间：20190313171814
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171814
SQL开始执行时间：20190313171814
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171814
SQL开始执行时间：20190313171814
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171815
SQL开始执行时间：20190313171815
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171815
SQL开始执行时间：20190313171815

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171844
SQL开始执行时间：20190313171844

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171845
SQL开始执行时间：20190313171845

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190313171845
SQL开始执行时间：20190313171845

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171845
SQL开始执行时间：20190313171845

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171845
SQL开始执行时间：20190313171845


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171845

20190313171846开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190313171846

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-14'
   and dRegDate < '2019-03-14'
;
SQL结束执行时间：20190313171847
SQL开始执行时间：20190313171847


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid
;
SQL结束执行时间：20190313171849
SQL开始执行时间：20190313171849

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190313171849
SQL开始执行时间：20190313171849
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190313171850
SQL开始执行时间：20190313171850


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190313171850
SQL开始执行时间：20190313171850
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190313171850
SQL开始执行时间：20190313171850

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190313171850
SQL开始执行时间：20190313171850
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190313171851
SQL开始执行时间：20190313171851
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190313171851
SQL开始执行时间：20190313171851
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190313171851
SQL开始执行时间：20190313171851
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190313171852
SQL开始执行时间：20190313171852

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by matchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190313171921
SQL开始执行时间：20190313171921

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-14',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190313171921
SQL开始执行时间：20190313171921

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-14',interval 1 day),7)
;
SQL结束执行时间：20190313171921
SQL开始执行时间：20190313171921

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190313171922
SQL开始执行时间：20190313171922

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190313171922
SQL开始执行时间：20190313171922


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190313171922

20190314120457开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190314120457

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190314120459
SQL开始执行时间：20190314120459


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid,cCoVouchType
;
SQL结束执行时间：20190314120500
SQL开始执行时间：20190314120500

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190314120501
SQL开始执行时间：20190314120501
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190314120501
SQL开始执行时间：20190314120501


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190314120501
SQL开始执行时间：20190314120501
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190314120501
SQL开始执行时间：20190314120501

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190314120502
SQL开始执行时间：20190314120502
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190314120502
SQL开始执行时间：20190314120502
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190314120502
SQL开始执行时间：20190314120502
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190314120503
SQL开始执行时间：20190314120503
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190314120503
SQL开始执行时间：20190314120503

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,case when a.cCoVouchType = a.cvouchtype then round(ifnull(b.icamount,0),2)
	      else 0 end as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by db,cvouchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190314120531
SQL开始执行时间：20190314120531

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190314120531
SQL开始执行时间：20190314120531

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190314120533
SQL开始执行时间：20190314120533

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190314120535
SQL开始执行时间：20190314120535

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190314120535
SQL开始执行时间：20190314120535


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190314120535

20190314121044开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190314121044

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190314121046
SQL开始执行时间：20190314121046


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid,cCoVouchType
;
SQL结束执行时间：20190314121047
SQL开始执行时间：20190314121047

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190314121048
SQL开始执行时间：20190314121048
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190314121048
SQL开始执行时间：20190314121048


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190314121048
SQL开始执行时间：20190314121048
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190314121048
SQL开始执行时间：20190314121048

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190314121049
SQL开始执行时间：20190314121049
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190314121049
SQL开始执行时间：20190314121049
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190314121049
SQL开始执行时间：20190314121049
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190314121050
SQL开始执行时间：20190314121050
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190314121050
SQL开始执行时间：20190314121050

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchtype
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,case when a.cCoVouchType = a.cvouchtype then round(ifnull(b.icamount,0),2)
	      else 0 end as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by db,cvouchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190314121118
SQL开始执行时间：20190314121118

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchtype
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190314121119
SQL开始执行时间：20190314121119

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190314121119
SQL开始执行时间：20190314121119

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190314121120
SQL开始执行时间：20190314121120

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190314121120
SQL开始执行时间：20190314121120


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190314121120

20190314122109开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190314122109

create temporary table edw.ar_detail_pre as
select *
  from edw.ar_detail
 where dVouchDate < '2019-03-01'
   and dRegDate < '2019-03-01'
;
SQL结束执行时间：20190314122111
SQL开始执行时间：20190314122111


create temporary table pdm.ar_detail_ar as
select 
	 concat(db,cvouchid) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("26","27","R0")
group by db,cvouchid,cProcStyle
;
SQL结束执行时间：20190314122113
SQL开始执行时间：20190314122113

create temporary table pdm.ar_detail_ap as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle in ("48","49","50","51","BZ")
group by db,cCoVouchID

;
SQL结束执行时间：20190314122113
SQL开始执行时间：20190314122113
create temporary table pdm.ar_detail_hx as
select 
	 concat(db,cCoVouchID) as matchid
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P"
group by db,cCoVouchID
;
SQL结束执行时间：20190314122113
SQL开始执行时间：20190314122113


drop temporary table if exists pdm.ar_detail_date
;
SQL结束执行时间：20190314122113
SQL开始执行时间：20190314122113
create temporary table if not exists pdm.ar_detail_date
select 
	 concat(db,cCoVouchID,dVouchDate,cDwCode,ifnull(cCode,"null")) as matchid
	,concat(db,cvouchid,cdwcode,ifnull(ccode,"null")) as matchid2
	,db
	,cvouchtype
	,cvouchid
	,dvouchdate
	,dregdate
	,cdwcode
	,true_ccuscode
	,true_ccusname
	,true_cinvcode
	,true_cinvname
	,ar_class
	,ccode
	,cProcStyle
	,cCoVouchType
	,cCoVouchID
	,sum(idamount) as idamount 
	,sum(icamount) as icamount
	,sum(ifnull(invoice_amount,0)) as invoice_amount
from edw.ar_detail_pre
where cvouchtype in ("48","49","50","51") and cProcStyle = "9P" and cCoVouchType in ("48","49","50","51")
group by db,cVouchType,cVouchID,dVouchDate,dRegDate,cDwCode,cCode,cProcStyle,cCoVouchType,cCoVouchID
;
SQL结束执行时间：20190314122114
SQL开始执行时间：20190314122114

alter table pdm.ar_detail_date add index index_ar_detail_date_matchid (matchid)
;
SQL结束执行时间：20190314122114
SQL开始执行时间：20190314122114
alter table pdm.ar_detail_date add index index_ar_detail_date_db (db)
;
SQL结束执行时间：20190314122114
SQL开始执行时间：20190314122114
alter table pdm.ar_detail_date add index index_ar_detail_date_cvouchid (cvouchid)
;
SQL结束执行时间：20190314122115
SQL开始执行时间：20190314122115
alter table pdm.ar_detail_date add index index_ar_detail_date_cdwcode (cdwcode)
;
SQL结束执行时间：20190314122115
SQL开始执行时间：20190314122115
alter table pdm.ar_detail_date add index index_ar_detail_date_ccode (ccode)
;
SQL结束执行时间：20190314122115
SQL开始执行时间：20190314122115

create temporary table pdm.ar_detail_ar2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchtype
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,b.cvouchid as cvouchid_ap
	,ifnull(c.dvouchdate,a.dvouchdate) as dvouchdate_ap
	,null as cProcstype_ap
	,c.dregdate as dregdate_ap
	,round(a.idamount,2) as amount_ar
	,case when a.cProcStyle = a.cvouchtype then round(ifnull(b.icamount,0),2)
	      else 0 end as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ar as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
left join 
(
	select db,cvouchid,dvouchdate,dregdate,cdwcode,ccode
	from pdm.ar_detail_date group by db,cvouchid
) as c 
on concat(a.db,b.cVouchID,a.cDwCode,ifnull(a.cCode,"null")) = concat(c.db,c.cvouchid,c.cdwcode,ifnull(c.ccode,"null"))
;
SQL结束执行时间：20190314122144
SQL开始执行时间：20190314122144

create temporary table pdm.ar_detail_ap2 as
select 
	 DATE_SUB('2019-03-01',interval 1 day)
	,a.db
	,a.cvouchtype
	,a.cvouchid as cvouchid_ar
	,a.dvouchdate as dvouchdate_ar
	,a.cdwcode
	,a.true_ccuscode
	,a.true_ccusname
	,a.true_cinvcode
	,a.true_cinvname
	,a.ar_class
	,a.ccode
	,a.cProcStyle as cProcStyle_ar
	,null as cvouchid_ap
	,a.dvouchdate as dvouchdate_ap
	,null as cProcstype_ap
	,null as dregdate_ap
	,-1*round(a.icamount,2) as amount_ar
	,round(ifnull(b.icamount,0),2) as amount_ap
	,round(a.invoice_amount,2) as invoice_amount
from pdm.ar_detail_ap as a
left join 
(
	select matchid,cvouchid,sum(icamount) as icamount 
	from pdm.ar_detail_hx group by matchid
) as b 
on a.matchid = b.matchid
;
SQL结束执行时间：20190314122144
SQL开始执行时间：20190314122144

delete from pdm.ar_ap where left(y_mon,7) = left(DATE_SUB('2019-03-01',interval 1 day),7)
;
SQL结束执行时间：20190314122144
SQL开始执行时间：20190314122144

insert into pdm.ar_ap
select 
'ar'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ar2 as a
;
SQL结束执行时间：20190314122145
SQL开始执行时间：20190314122145

insert into pdm.ar_ap
select 
'ap'
,a.*
,(a.amount_ar-a.amount_ap)
from pdm.ar_detail_ap2 as a
;
SQL结束执行时间：20190314122145
SQL开始执行时间：20190314122145


delete from pdm.ar_ap
where left(true_ccuscode,2)= "gl"
;
SQL结束执行时间：20190314122145
