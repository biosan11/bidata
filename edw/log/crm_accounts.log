
20190124100045开始执行2019-01-25数据加载日志:
SQL开始执行时间：20190124100045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-25' or left(a.modifiedon,10) = '2019-01-25')
;
SQL结束执行时间：20190124100045
SQL开始执行时间：20190124100045

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from ufdata.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;

20190124100114开始执行2019-01-25数据加载日志:
SQL开始执行时间：20190124100114
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-25' or left(a.modifiedon,10) = '2019-01-25')
;
SQL结束执行时间：20190124100114
SQL开始执行时间：20190124100114

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190124100114
SQL开始执行时间：20190124100114

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts) a
;

20190124100246开始执行2019-01-25数据加载日志:
SQL开始执行时间：20190124100246
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-25' or left(a.modifiedon,10) = '2019-01-25')
;
SQL结束执行时间：20190124100246
SQL开始执行时间：20190124100246

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190124100246
SQL开始执行时间：20190124100246

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190124100246
SQL开始执行时间：20190124100246
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-25'
;
SQL结束执行时间：20190124100246
SQL开始执行时间：20190124100246

update edw.crm_accounts set end_dt = '2019-01-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190124100246
SQL开始执行时间：20190124100246

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190124100246

20190125104953开始执行2019-01-24数据加载日志:
SQL开始执行时间：20190125104953
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-24' or left(a.modifiedon,10) = '2019-01-24')
;
SQL结束执行时间：20190125104953
SQL开始执行时间：20190125104953

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;

20190125105157开始执行2019-01-24数据加载日志:
SQL开始执行时间：20190125105157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-24' or left(a.modifiedon,10) = '2019-01-24')
;
SQL结束执行时间：20190125105157
SQL开始执行时间：20190125105157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190125105158
SQL开始执行时间：20190125105158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;

20190125105343开始执行2019-01-24数据加载日志:
SQL开始执行时间：20190125105343
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-24' or left(a.modifiedon,10) = '2019-01-24')
;
SQL结束执行时间：20190125105343
SQL开始执行时间：20190125105343

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190125105343
SQL开始执行时间：20190125105343

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190125105343
SQL开始执行时间：20190125105343
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-24'
;
SQL结束执行时间：20190125105343
SQL开始执行时间：20190125105343

update edw.crm_accounts set end_dt = '2019-01-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190125105343
SQL开始执行时间：20190125105343

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190125105343

20190126030011开始执行2019-01-25数据加载日志:
SQL开始执行时间：20190126030011
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-25' or left(a.modifiedon,10) = '2019-01-25')
;
SQL结束执行时间：20190126030011
SQL开始执行时间：20190126030011

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190126030011
SQL开始执行时间：20190126030011

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190126030011
SQL开始执行时间：20190126030011
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-25'
;
SQL结束执行时间：20190126030011
SQL开始执行时间：20190126030011

update edw.crm_accounts set end_dt = '2019-01-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190126030011
SQL开始执行时间：20190126030011

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190126030011

20190127030008开始执行2019-01-26数据加载日志:
SQL开始执行时间：20190127030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-26' or left(a.modifiedon,10) = '2019-01-26')
;
SQL结束执行时间：20190127030008
SQL开始执行时间：20190127030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190127030008
SQL开始执行时间：20190127030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190127030008
SQL开始执行时间：20190127030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-26'
;
SQL结束执行时间：20190127030008
SQL开始执行时间：20190127030008

update edw.crm_accounts set end_dt = '2019-01-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190127030008
SQL开始执行时间：20190127030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190127030008

20190128030008开始执行2019-01-27数据加载日志:
SQL开始执行时间：20190128030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-27' or left(a.modifiedon,10) = '2019-01-27')
;
SQL结束执行时间：20190128030008
SQL开始执行时间：20190128030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190128030008
SQL开始执行时间：20190128030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190128030008
SQL开始执行时间：20190128030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-27'
;
SQL结束执行时间：20190128030008
SQL开始执行时间：20190128030008

update edw.crm_accounts set end_dt = '2019-01-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190128030008
SQL开始执行时间：20190128030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190128030008

20190129030009开始执行2019-01-28数据加载日志:
SQL开始执行时间：20190129030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-28' or left(a.modifiedon,10) = '2019-01-28')
;
SQL结束执行时间：20190129030009
SQL开始执行时间：20190129030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190129030009
SQL开始执行时间：20190129030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190129030009
SQL开始执行时间：20190129030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-28'
;
SQL结束执行时间：20190129030009
SQL开始执行时间：20190129030009

update edw.crm_accounts set end_dt = '2019-01-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190129030009
SQL开始执行时间：20190129030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190129030009

20190130030008开始执行2019-01-29数据加载日志:
SQL开始执行时间：20190130030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-29' or left(a.modifiedon,10) = '2019-01-29')
;
SQL结束执行时间：20190130030008
SQL开始执行时间：20190130030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190130030008
SQL开始执行时间：20190130030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190130030008
SQL开始执行时间：20190130030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-29'
;
SQL结束执行时间：20190130030008
SQL开始执行时间：20190130030008

update edw.crm_accounts set end_dt = '2019-01-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190130030008
SQL开始执行时间：20190130030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190130030008

20190131030008开始执行2019-01-30数据加载日志:
SQL开始执行时间：20190131030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-30' or left(a.modifiedon,10) = '2019-01-30')
;
SQL结束执行时间：20190131030008
SQL开始执行时间：20190131030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190131030009
SQL开始执行时间：20190131030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190131030009
SQL开始执行时间：20190131030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-30'
;
SQL结束执行时间：20190131030009
SQL开始执行时间：20190131030009

update edw.crm_accounts set end_dt = '2019-01-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190131030009
SQL开始执行时间：20190131030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190131030009

20190201030008开始执行2019-01-31数据加载日志:
SQL开始执行时间：20190201030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-01-31' or left(a.modifiedon,10) = '2019-01-31')
;
SQL结束执行时间：20190201030008
SQL开始执行时间：20190201030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190201030008
SQL开始执行时间：20190201030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190201030008
SQL开始执行时间：20190201030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-01-31'
;
SQL结束执行时间：20190201030008
SQL开始执行时间：20190201030008

update edw.crm_accounts set end_dt = '2019-01-31' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190201030008
SQL开始执行时间：20190201030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190201030008

20190202030008开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190202030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-01' or left(a.modifiedon,10) = '2019-02-01')
;
SQL结束执行时间：20190202030008
SQL开始执行时间：20190202030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190202030008
SQL开始执行时间：20190202030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190202030008
SQL开始执行时间：20190202030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-01'
;
SQL结束执行时间：20190202030008
SQL开始执行时间：20190202030008

update edw.crm_accounts set end_dt = '2019-02-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190202030008
SQL开始执行时间：20190202030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190202030008

20190203030008开始执行2019-02-02数据加载日志:
SQL开始执行时间：20190203030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-02' or left(a.modifiedon,10) = '2019-02-02')
;
SQL结束执行时间：20190203030008
SQL开始执行时间：20190203030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190203030008
SQL开始执行时间：20190203030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190203030008
SQL开始执行时间：20190203030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-02'
;
SQL结束执行时间：20190203030008
SQL开始执行时间：20190203030008

update edw.crm_accounts set end_dt = '2019-02-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190203030008
SQL开始执行时间：20190203030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190203030008

20190204030009开始执行2019-02-03数据加载日志:
SQL开始执行时间：20190204030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-03' or left(a.modifiedon,10) = '2019-02-03')
;
SQL结束执行时间：20190204030009
SQL开始执行时间：20190204030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190204030009
SQL开始执行时间：20190204030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190204030009
SQL开始执行时间：20190204030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-03'
;
SQL结束执行时间：20190204030009
SQL开始执行时间：20190204030009

update edw.crm_accounts set end_dt = '2019-02-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190204030009
SQL开始执行时间：20190204030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190204030009

20190205030009开始执行2019-02-04数据加载日志:
SQL开始执行时间：20190205030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-04' or left(a.modifiedon,10) = '2019-02-04')
;
SQL结束执行时间：20190205030009
SQL开始执行时间：20190205030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190205030009
SQL开始执行时间：20190205030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190205030009
SQL开始执行时间：20190205030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-04'
;
SQL结束执行时间：20190205030009
SQL开始执行时间：20190205030009

update edw.crm_accounts set end_dt = '2019-02-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190205030009
SQL开始执行时间：20190205030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190205030009

20190206030008开始执行2019-02-05数据加载日志:
SQL开始执行时间：20190206030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-05' or left(a.modifiedon,10) = '2019-02-05')
;
SQL结束执行时间：20190206030008
SQL开始执行时间：20190206030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190206030008
SQL开始执行时间：20190206030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190206030008
SQL开始执行时间：20190206030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-05'
;
SQL结束执行时间：20190206030008
SQL开始执行时间：20190206030008

update edw.crm_accounts set end_dt = '2019-02-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190206030008
SQL开始执行时间：20190206030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190206030008

20190207030014开始执行2019-02-06数据加载日志:
SQL开始执行时间：20190207030014
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-06' or left(a.modifiedon,10) = '2019-02-06')
;
SQL结束执行时间：20190207030014
SQL开始执行时间：20190207030014

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190207030014
SQL开始执行时间：20190207030014

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190207030014
SQL开始执行时间：20190207030014
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-06'
;
SQL结束执行时间：20190207030014
SQL开始执行时间：20190207030014

update edw.crm_accounts set end_dt = '2019-02-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190207030014
SQL开始执行时间：20190207030014

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190207030014

20190208030013开始执行2019-02-07数据加载日志:
SQL开始执行时间：20190208030013
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-07' or left(a.modifiedon,10) = '2019-02-07')
;
SQL结束执行时间：20190208030013
SQL开始执行时间：20190208030013

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190208030013
SQL开始执行时间：20190208030013

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190208030013
SQL开始执行时间：20190208030013
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-07'
;
SQL结束执行时间：20190208030013
SQL开始执行时间：20190208030013

update edw.crm_accounts set end_dt = '2019-02-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190208030013
SQL开始执行时间：20190208030013

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190208030013

20190209030008开始执行2019-02-08数据加载日志:
SQL开始执行时间：20190209030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-08' or left(a.modifiedon,10) = '2019-02-08')
;
SQL结束执行时间：20190209030008
SQL开始执行时间：20190209030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190209030008
SQL开始执行时间：20190209030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190209030008
SQL开始执行时间：20190209030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-08'
;
SQL结束执行时间：20190209030008
SQL开始执行时间：20190209030008

update edw.crm_accounts set end_dt = '2019-02-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190209030008
SQL开始执行时间：20190209030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190209030008

20190210030008开始执行2019-02-09数据加载日志:
SQL开始执行时间：20190210030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-09' or left(a.modifiedon,10) = '2019-02-09')
;
SQL结束执行时间：20190210030008
SQL开始执行时间：20190210030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190210030008
SQL开始执行时间：20190210030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190210030008
SQL开始执行时间：20190210030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-09'
;
SQL结束执行时间：20190210030008
SQL开始执行时间：20190210030008

update edw.crm_accounts set end_dt = '2019-02-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190210030008
SQL开始执行时间：20190210030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190210030008

20190211030008开始执行2019-02-10数据加载日志:
SQL开始执行时间：20190211030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-10' or left(a.modifiedon,10) = '2019-02-10')
;
SQL结束执行时间：20190211030008
SQL开始执行时间：20190211030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190211030008
SQL开始执行时间：20190211030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190211030008
SQL开始执行时间：20190211030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-10'
;
SQL结束执行时间：20190211030008
SQL开始执行时间：20190211030008

update edw.crm_accounts set end_dt = '2019-02-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190211030008
SQL开始执行时间：20190211030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190211030008

20190212030008开始执行2019-02-11数据加载日志:
SQL开始执行时间：20190212030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-11' or left(a.modifiedon,10) = '2019-02-11')
;
SQL结束执行时间：20190212030008
SQL开始执行时间：20190212030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190212030008
SQL开始执行时间：20190212030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190212030008
SQL开始执行时间：20190212030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-11'
;
SQL结束执行时间：20190212030009
SQL开始执行时间：20190212030009

update edw.crm_accounts set end_dt = '2019-02-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190212030009
SQL开始执行时间：20190212030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190212030009

20190213030009开始执行2019-02-12数据加载日志:
SQL开始执行时间：20190213030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-12' or left(a.modifiedon,10) = '2019-02-12')
;
SQL结束执行时间：20190213030009
SQL开始执行时间：20190213030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190213030009
SQL开始执行时间：20190213030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190213030009
SQL开始执行时间：20190213030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-12'
;
SQL结束执行时间：20190213030009
SQL开始执行时间：20190213030009

update edw.crm_accounts set end_dt = '2019-02-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190213030009
SQL开始执行时间：20190213030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190213030009

20190214030013开始执行2019-02-13数据加载日志:
SQL开始执行时间：20190214030013
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-13' or left(a.modifiedon,10) = '2019-02-13')
;
SQL结束执行时间：20190214030013
SQL开始执行时间：20190214030013

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190214030013
SQL开始执行时间：20190214030013

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190214030013
SQL开始执行时间：20190214030013
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-13'
;
SQL结束执行时间：20190214030013
SQL开始执行时间：20190214030013

update edw.crm_accounts set end_dt = '2019-02-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190214030013
SQL开始执行时间：20190214030013

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190214030013

20190215030009开始执行2019-02-14数据加载日志:
SQL开始执行时间：20190215030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-14' or left(a.modifiedon,10) = '2019-02-14')
;
SQL结束执行时间：20190215030009
SQL开始执行时间：20190215030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190215030010
SQL开始执行时间：20190215030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190215030010
SQL开始执行时间：20190215030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-14'
;
SQL结束执行时间：20190215030010
SQL开始执行时间：20190215030010

update edw.crm_accounts set end_dt = '2019-02-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190215030010
SQL开始执行时间：20190215030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190215030010

20190216030011开始执行2019-02-15数据加载日志:
SQL开始执行时间：20190216030011
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-15' or left(a.modifiedon,10) = '2019-02-15')
;
SQL结束执行时间：20190216030011
SQL开始执行时间：20190216030011

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190216030011
SQL开始执行时间：20190216030011

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190216030011
SQL开始执行时间：20190216030011
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-15'
;
SQL结束执行时间：20190216030011
SQL开始执行时间：20190216030011

update edw.crm_accounts set end_dt = '2019-02-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190216030011
SQL开始执行时间：20190216030011

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190216030011

20190217030008开始执行2019-02-16数据加载日志:
SQL开始执行时间：20190217030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-16' or left(a.modifiedon,10) = '2019-02-16')
;
SQL结束执行时间：20190217030008
SQL开始执行时间：20190217030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190217030008
SQL开始执行时间：20190217030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190217030008
SQL开始执行时间：20190217030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-16'
;
SQL结束执行时间：20190217030008
SQL开始执行时间：20190217030008

update edw.crm_accounts set end_dt = '2019-02-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190217030008
SQL开始执行时间：20190217030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190217030008

20190218030008开始执行2019-02-17数据加载日志:
SQL开始执行时间：20190218030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-17' or left(a.modifiedon,10) = '2019-02-17')
;
SQL结束执行时间：20190218030008
SQL开始执行时间：20190218030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190218030009
SQL开始执行时间：20190218030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190218030009
SQL开始执行时间：20190218030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-17'
;
SQL结束执行时间：20190218030009
SQL开始执行时间：20190218030009

update edw.crm_accounts set end_dt = '2019-02-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190218030009
SQL开始执行时间：20190218030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190218030009

20190219030008开始执行2019-02-18数据加载日志:
SQL开始执行时间：20190219030008
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-18' or left(a.modifiedon,10) = '2019-02-18')
;
SQL结束执行时间：20190219030008
SQL开始执行时间：20190219030008

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190219030008
SQL开始执行时间：20190219030008

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190219030008
SQL开始执行时间：20190219030008
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-18'
;
SQL结束执行时间：20190219030008
SQL开始执行时间：20190219030008

update edw.crm_accounts set end_dt = '2019-02-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190219030008
SQL开始执行时间：20190219030008

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190219030008

20190220030012开始执行2019-02-19数据加载日志:
SQL开始执行时间：20190220030012
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-19' or left(a.modifiedon,10) = '2019-02-19')
;
SQL结束执行时间：20190220030012
SQL开始执行时间：20190220030012

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190220030013
SQL开始执行时间：20190220030013

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190220030013
SQL开始执行时间：20190220030013
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-19'
;
SQL结束执行时间：20190220030013
SQL开始执行时间：20190220030013

update edw.crm_accounts set end_dt = '2019-02-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190220030013
SQL开始执行时间：20190220030013

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190220030013

20190221030009开始执行2019-02-20数据加载日志:
SQL开始执行时间：20190221030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-20' or left(a.modifiedon,10) = '2019-02-20')
;
SQL结束执行时间：20190221030009
SQL开始执行时间：20190221030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190221030010
SQL开始执行时间：20190221030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190221030010
SQL开始执行时间：20190221030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-20'
;
SQL结束执行时间：20190221030010
SQL开始执行时间：20190221030010

update edw.crm_accounts set end_dt = '2019-02-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190221030010
SQL开始执行时间：20190221030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190221030010

20190222030010开始执行2019-02-21数据加载日志:
SQL开始执行时间：20190222030010
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-21' or left(a.modifiedon,10) = '2019-02-21')
;
SQL结束执行时间：20190222030010
SQL开始执行时间：20190222030010

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190222030010
SQL开始执行时间：20190222030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190222030010
SQL开始执行时间：20190222030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-21'
;
SQL结束执行时间：20190222030010
SQL开始执行时间：20190222030010

update edw.crm_accounts set end_dt = '2019-02-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190222030010
SQL开始执行时间：20190222030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190222030010

20190223030009开始执行2019-02-22数据加载日志:
SQL开始执行时间：20190223030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-22' or left(a.modifiedon,10) = '2019-02-22')
;
SQL结束执行时间：20190223030009
SQL开始执行时间：20190223030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190223030010
SQL开始执行时间：20190223030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190223030010
SQL开始执行时间：20190223030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-22'
;
SQL结束执行时间：20190223030010
SQL开始执行时间：20190223030010

update edw.crm_accounts set end_dt = '2019-02-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190223030010
SQL开始执行时间：20190223030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190223030010

20190224030009开始执行2019-02-23数据加载日志:
SQL开始执行时间：20190224030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-23' or left(a.modifiedon,10) = '2019-02-23')
;
SQL结束执行时间：20190224030009
SQL开始执行时间：20190224030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190224030009
SQL开始执行时间：20190224030009

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190224030009
SQL开始执行时间：20190224030009
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-23'
;
SQL结束执行时间：20190224030009
SQL开始执行时间：20190224030009

update edw.crm_accounts set end_dt = '2019-02-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190224030009
SQL开始执行时间：20190224030009

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190224030009

20190225030009开始执行2019-02-24数据加载日志:
SQL开始执行时间：20190225030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-24' or left(a.modifiedon,10) = '2019-02-24')
;
SQL结束执行时间：20190225030009
SQL开始执行时间：20190225030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190225030010
SQL开始执行时间：20190225030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190225030010
SQL开始执行时间：20190225030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-24'
;
SQL结束执行时间：20190225030010
SQL开始执行时间：20190225030010

update edw.crm_accounts set end_dt = '2019-02-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190225030010
SQL开始执行时间：20190225030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190225030010

20190226030030开始执行2019-02-25数据加载日志:
SQL开始执行时间：20190226030030
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-25' or left(a.modifiedon,10) = '2019-02-25')
;
SQL结束执行时间：20190226030030
SQL开始执行时间：20190226030030

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190226030030
SQL开始执行时间：20190226030030

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190226030030
SQL开始执行时间：20190226030030
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-25'
;
SQL结束执行时间：20190226030030
SQL开始执行时间：20190226030030

update edw.crm_accounts set end_dt = '2019-02-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190226030030
SQL开始执行时间：20190226030030

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190226030030

20190227030009开始执行2019-02-26数据加载日志:
SQL开始执行时间：20190227030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-26' or left(a.modifiedon,10) = '2019-02-26')
;
SQL结束执行时间：20190227030009
SQL开始执行时间：20190227030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190227030010
SQL开始执行时间：20190227030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190227030010
SQL开始执行时间：20190227030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-26'
;
SQL结束执行时间：20190227030010
SQL开始执行时间：20190227030010

update edw.crm_accounts set end_dt = '2019-02-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190227030010
SQL开始执行时间：20190227030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190227030010

20190228030010开始执行2019-02-27数据加载日志:
SQL开始执行时间：20190228030010
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-27' or left(a.modifiedon,10) = '2019-02-27')
;
SQL结束执行时间：20190228030010
SQL开始执行时间：20190228030010

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190228030010
SQL开始执行时间：20190228030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190228030010
SQL开始执行时间：20190228030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-27'
;
SQL结束执行时间：20190228030010
SQL开始执行时间：20190228030010

update edw.crm_accounts set end_dt = '2019-02-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190228030010
SQL开始执行时间：20190228030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190228030010

20190301030009开始执行2019-02-28数据加载日志:
SQL开始执行时间：20190301030009
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-02-28' or left(a.modifiedon,10) = '2019-02-28')
;
SQL结束执行时间：20190301030009
SQL开始执行时间：20190301030009

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190301030010
SQL开始执行时间：20190301030010

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190301030010
SQL开始执行时间：20190301030010
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-02-28'
;
SQL结束执行时间：20190301030010
SQL开始执行时间：20190301030010

update edw.crm_accounts set end_dt = '2019-02-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190301030010
SQL开始执行时间：20190301030010

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190301030010

20190304102842开始执行2019-03-03数据加载日志:
SQL开始执行时间：20190304102842
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-03' or left(a.modifiedon,10) = '2019-03-03')
;
SQL结束执行时间：20190304102842
SQL开始执行时间：20190304102842

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190304102842
SQL开始执行时间：20190304102842

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190304102842
SQL开始执行时间：20190304102842
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-03'
;
SQL结束执行时间：20190304102842
SQL开始执行时间：20190304102842

update edw.crm_accounts set end_dt = '2019-03-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190304102842
SQL开始执行时间：20190304102842

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190304102842

20190305030034开始执行2019-03-04数据加载日志:
SQL开始执行时间：20190305030034
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-04' or left(a.modifiedon,10) = '2019-03-04')
;
SQL结束执行时间：20190305030035
SQL开始执行时间：20190305030035

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190305030035
SQL开始执行时间：20190305030035

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190305030035
SQL开始执行时间：20190305030035
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-04'
;
SQL结束执行时间：20190305030035
SQL开始执行时间：20190305030035

update edw.crm_accounts set end_dt = '2019-03-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190305030035
SQL开始执行时间：20190305030035

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190305030035

20190306030157开始执行2019-03-05数据加载日志:
SQL开始执行时间：20190306030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-05' or left(a.modifiedon,10) = '2019-03-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190306030157
SQL开始执行时间：20190306030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190306030157
SQL开始执行时间：20190306030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190306030158
SQL开始执行时间：20190306030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-05'
;
SQL结束执行时间：20190306030158
SQL开始执行时间：20190306030158

update edw.crm_accounts set end_dt = '2019-03-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190306030158
SQL开始执行时间：20190306030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190306030158

20190307030157开始执行2019-03-06数据加载日志:
SQL开始执行时间：20190307030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-06' or left(a.modifiedon,10) = '2019-03-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190307030157
SQL开始执行时间：20190307030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190307030157
SQL开始执行时间：20190307030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190307030158
SQL开始执行时间：20190307030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-06'
;
SQL结束执行时间：20190307030158
SQL开始执行时间：20190307030158

update edw.crm_accounts set end_dt = '2019-03-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190307030158
SQL开始执行时间：20190307030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190307030158

20190308030159开始执行2019-03-07数据加载日志:
SQL开始执行时间：20190308030159
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-07' or left(a.modifiedon,10) = '2019-03-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190308030159
SQL开始执行时间：20190308030159

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190308030159
SQL开始执行时间：20190308030159

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190308030200
SQL开始执行时间：20190308030200
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-07'
;
SQL结束执行时间：20190308030200
SQL开始执行时间：20190308030200

update edw.crm_accounts set end_dt = '2019-03-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190308030200
SQL开始执行时间：20190308030200

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190308030200

20190309030156开始执行2019-03-08数据加载日志:
SQL开始执行时间：20190309030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-08' or left(a.modifiedon,10) = '2019-03-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190309030156
SQL开始执行时间：20190309030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190309030157
SQL开始执行时间：20190309030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190309030157
SQL开始执行时间：20190309030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-08'
;
SQL结束执行时间：20190309030157
SQL开始执行时间：20190309030157

update edw.crm_accounts set end_dt = '2019-03-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190309030157
SQL开始执行时间：20190309030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190309030157

20190310030158开始执行2019-03-09数据加载日志:
SQL开始执行时间：20190310030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-09' or left(a.modifiedon,10) = '2019-03-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190310030158
SQL开始执行时间：20190310030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190310030159
SQL开始执行时间：20190310030159

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190310030159
SQL开始执行时间：20190310030159
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-09'
;
SQL结束执行时间：20190310030159
SQL开始执行时间：20190310030159

update edw.crm_accounts set end_dt = '2019-03-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190310030159
SQL开始执行时间：20190310030159

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190310030159

20190311030156开始执行2019-03-10数据加载日志:
SQL开始执行时间：20190311030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-10' or left(a.modifiedon,10) = '2019-03-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190311030156
SQL开始执行时间：20190311030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190311030157
SQL开始执行时间：20190311030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190311030157
SQL开始执行时间：20190311030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-10'
;
SQL结束执行时间：20190311030157
SQL开始执行时间：20190311030157

update edw.crm_accounts set end_dt = '2019-03-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190311030157
SQL开始执行时间：20190311030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190311030157

20190312030158开始执行2019-03-11数据加载日志:
SQL开始执行时间：20190312030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-11' or left(a.modifiedon,10) = '2019-03-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190312030159
SQL开始执行时间：20190312030159

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190312030213
SQL开始执行时间：20190312030213

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190312030214
SQL开始执行时间：20190312030214
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-11'
;
SQL结束执行时间：20190312030214
SQL开始执行时间：20190312030214

update edw.crm_accounts set end_dt = '2019-03-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190312030214
SQL开始执行时间：20190312030214

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190312030214

20190313030156开始执行2019-03-12数据加载日志:
SQL开始执行时间：20190313030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-12' or left(a.modifiedon,10) = '2019-03-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190313030156
SQL开始执行时间：20190313030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190313030157
SQL开始执行时间：20190313030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190313030157
SQL开始执行时间：20190313030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-12'
;
SQL结束执行时间：20190313030157
SQL开始执行时间：20190313030157

update edw.crm_accounts set end_dt = '2019-03-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190313030157
SQL开始执行时间：20190313030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190313030157

20190314030158开始执行2019-03-13数据加载日志:
SQL开始执行时间：20190314030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-13' or left(a.modifiedon,10) = '2019-03-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190314030158
SQL开始执行时间：20190314030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190314030158
SQL开始执行时间：20190314030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190314030158
SQL开始执行时间：20190314030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-13'
;
SQL结束执行时间：20190314030158
SQL开始执行时间：20190314030158

update edw.crm_accounts set end_dt = '2019-03-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190314030158
SQL开始执行时间：20190314030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190314030158

20190315030156开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190315030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-14' or left(a.modifiedon,10) = '2019-03-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190315030157
SQL开始执行时间：20190315030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190315030157
SQL开始执行时间：20190315030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190315030157
SQL开始执行时间：20190315030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-14'
;
SQL结束执行时间：20190315030157
SQL开始执行时间：20190315030157

update edw.crm_accounts set end_dt = '2019-03-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190315030157
SQL开始执行时间：20190315030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190315030157

20190316030156开始执行2019-03-15数据加载日志:
SQL开始执行时间：20190316030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-15' or left(a.modifiedon,10) = '2019-03-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190316030156
SQL开始执行时间：20190316030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190316030157
SQL开始执行时间：20190316030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190316030157
SQL开始执行时间：20190316030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-15'
;
SQL结束执行时间：20190316030157
SQL开始执行时间：20190316030157

update edw.crm_accounts set end_dt = '2019-03-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190316030158
SQL开始执行时间：20190316030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190316030158

20190317030200开始执行2019-03-16数据加载日志:
SQL开始执行时间：20190317030200
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-16' or left(a.modifiedon,10) = '2019-03-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190317030200
SQL开始执行时间：20190317030200

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190317030200
SQL开始执行时间：20190317030200

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190317030200
SQL开始执行时间：20190317030200
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-16'
;
SQL结束执行时间：20190317030200
SQL开始执行时间：20190317030200

update edw.crm_accounts set end_dt = '2019-03-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190317030200
SQL开始执行时间：20190317030200

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190317030200

20190318030156开始执行2019-03-17数据加载日志:
SQL开始执行时间：20190318030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-17' or left(a.modifiedon,10) = '2019-03-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190318030156
SQL开始执行时间：20190318030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190318030156
SQL开始执行时间：20190318030156

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190318030156
SQL开始执行时间：20190318030156
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-17'
;
SQL结束执行时间：20190318030156
SQL开始执行时间：20190318030156

update edw.crm_accounts set end_dt = '2019-03-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190318030156
SQL开始执行时间：20190318030156

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190318030156

20190319030156开始执行2019-03-18数据加载日志:
SQL开始执行时间：20190319030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-18' or left(a.modifiedon,10) = '2019-03-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190319030156
SQL开始执行时间：20190319030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190319030156
SQL开始执行时间：20190319030156

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190319030156
SQL开始执行时间：20190319030156
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-18'
;
SQL结束执行时间：20190319030157
SQL开始执行时间：20190319030157

update edw.crm_accounts set end_dt = '2019-03-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190319030157
SQL开始执行时间：20190319030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190319030157

20190320030156开始执行2019-03-19数据加载日志:
SQL开始执行时间：20190320030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-19' or left(a.modifiedon,10) = '2019-03-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190320030156
SQL开始执行时间：20190320030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190320030156
SQL开始执行时间：20190320030156

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190320030156
SQL开始执行时间：20190320030156
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-19'
;
SQL结束执行时间：20190320030156
SQL开始执行时间：20190320030156

update edw.crm_accounts set end_dt = '2019-03-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190320030156
SQL开始执行时间：20190320030156

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190320030156

20190321030200开始执行2019-03-20数据加载日志:
SQL开始执行时间：20190321030200
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-20' or left(a.modifiedon,10) = '2019-03-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190321030200
SQL开始执行时间：20190321030200

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190321030200
SQL开始执行时间：20190321030200

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190321030200
SQL开始执行时间：20190321030200
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-20'
;
SQL结束执行时间：20190321030200
SQL开始执行时间：20190321030200

update edw.crm_accounts set end_dt = '2019-03-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190321030200
SQL开始执行时间：20190321030200

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190321030200

20190322030157开始执行2019-03-21数据加载日志:
SQL开始执行时间：20190322030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-21' or left(a.modifiedon,10) = '2019-03-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190322030157
SQL开始执行时间：20190322030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190322030157
SQL开始执行时间：20190322030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190322030157
SQL开始执行时间：20190322030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-21'
;
SQL结束执行时间：20190322030157
SQL开始执行时间：20190322030157

update edw.crm_accounts set end_dt = '2019-03-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190322030157
SQL开始执行时间：20190322030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190322030157

20190323030157开始执行2019-03-22数据加载日志:
SQL开始执行时间：20190323030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-22' or left(a.modifiedon,10) = '2019-03-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190323030157
SQL开始执行时间：20190323030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190323030158
SQL开始执行时间：20190323030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190323030158
SQL开始执行时间：20190323030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-22'
;
SQL结束执行时间：20190323030158
SQL开始执行时间：20190323030158

update edw.crm_accounts set end_dt = '2019-03-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190323030158
SQL开始执行时间：20190323030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190323030158

20190324030157开始执行2019-03-23数据加载日志:
SQL开始执行时间：20190324030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-23' or left(a.modifiedon,10) = '2019-03-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190324030157
SQL开始执行时间：20190324030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190324030157
SQL开始执行时间：20190324030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190324030157
SQL开始执行时间：20190324030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-23'
;
SQL结束执行时间：20190324030157
SQL开始执行时间：20190324030157

update edw.crm_accounts set end_dt = '2019-03-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190324030157
SQL开始执行时间：20190324030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190324030157

20190325030158开始执行2019-03-24数据加载日志:
SQL开始执行时间：20190325030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-24' or left(a.modifiedon,10) = '2019-03-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190325030158
SQL开始执行时间：20190325030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190325030158
SQL开始执行时间：20190325030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190325030158
SQL开始执行时间：20190325030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-24'
;
SQL结束执行时间：20190325030158
SQL开始执行时间：20190325030158

update edw.crm_accounts set end_dt = '2019-03-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190325030158
SQL开始执行时间：20190325030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190325030158

20190326030156开始执行2019-03-25数据加载日志:
SQL开始执行时间：20190326030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-25' or left(a.modifiedon,10) = '2019-03-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190326030156
SQL开始执行时间：20190326030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190326030156
SQL开始执行时间：20190326030156

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190326030157
SQL开始执行时间：20190326030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-25'
;
SQL结束执行时间：20190326030157
SQL开始执行时间：20190326030157

update edw.crm_accounts set end_dt = '2019-03-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190326030157
SQL开始执行时间：20190326030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190326030157

20190327030156开始执行2019-03-26数据加载日志:
SQL开始执行时间：20190327030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-26' or left(a.modifiedon,10) = '2019-03-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190327030156
SQL开始执行时间：20190327030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190327030157
SQL开始执行时间：20190327030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190327030157
SQL开始执行时间：20190327030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-26'
;
SQL结束执行时间：20190327030157
SQL开始执行时间：20190327030157

update edw.crm_accounts set end_dt = '2019-03-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190327030157
SQL开始执行时间：20190327030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190327030157

20190328030158开始执行2019-03-27数据加载日志:
SQL开始执行时间：20190328030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-27' or left(a.modifiedon,10) = '2019-03-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190328030158
SQL开始执行时间：20190328030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190328030158
SQL开始执行时间：20190328030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190328030158
SQL开始执行时间：20190328030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-27'
;
SQL结束执行时间：20190328030158
SQL开始执行时间：20190328030158

update edw.crm_accounts set end_dt = '2019-03-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190328030158
SQL开始执行时间：20190328030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190328030158

20190329030157开始执行2019-03-28数据加载日志:
SQL开始执行时间：20190329030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-28' or left(a.modifiedon,10) = '2019-03-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190329030157
SQL开始执行时间：20190329030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190329030157
SQL开始执行时间：20190329030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190329030157
SQL开始执行时间：20190329030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-28'
;
SQL结束执行时间：20190329030157
SQL开始执行时间：20190329030157

update edw.crm_accounts set end_dt = '2019-03-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190329030157
SQL开始执行时间：20190329030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190329030157

20190330030157开始执行2019-03-29数据加载日志:
SQL开始执行时间：20190330030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-29' or left(a.modifiedon,10) = '2019-03-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190330030157
SQL开始执行时间：20190330030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190330030157
SQL开始执行时间：20190330030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190330030157
SQL开始执行时间：20190330030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-29'
;
SQL结束执行时间：20190330030157
SQL开始执行时间：20190330030157

update edw.crm_accounts set end_dt = '2019-03-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190330030157
SQL开始执行时间：20190330030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190330030157

20190331030156开始执行2019-03-30数据加载日志:
SQL开始执行时间：20190331030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-30' or left(a.modifiedon,10) = '2019-03-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190331030156
SQL开始执行时间：20190331030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190331030157
SQL开始执行时间：20190331030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190331030157
SQL开始执行时间：20190331030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-30'
;
SQL结束执行时间：20190331030157
SQL开始执行时间：20190331030157

update edw.crm_accounts set end_dt = '2019-03-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190331030157
SQL开始执行时间：20190331030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190331030157

20190401030156开始执行2019-03-31数据加载日志:
SQL开始执行时间：20190401030156
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-03-31' or left(a.modifiedon,10) = '2019-03-31')
   and a.statecode = '0'
;
SQL结束执行时间：20190401030156
SQL开始执行时间：20190401030156

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190401030157
SQL开始执行时间：20190401030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190401030157
SQL开始执行时间：20190401030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-03-31'
;
SQL结束执行时间：20190401030157
SQL开始执行时间：20190401030157

update edw.crm_accounts set end_dt = '2019-03-31' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190401030157
SQL开始执行时间：20190401030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190401030157

20190402030158开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190402030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-01' or left(a.modifiedon,10) = '2019-04-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190402030158
SQL开始执行时间：20190402030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190402030158
SQL开始执行时间：20190402030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190402030158
SQL开始执行时间：20190402030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-01'
;
SQL结束执行时间：20190402030158
SQL开始执行时间：20190402030158

update edw.crm_accounts set end_dt = '2019-04-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190402030158
SQL开始执行时间：20190402030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190402030158

20190403030157开始执行2019-04-02数据加载日志:
SQL开始执行时间：20190403030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-02' or left(a.modifiedon,10) = '2019-04-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190403030158
SQL开始执行时间：20190403030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190403030158
SQL开始执行时间：20190403030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190403030158
SQL开始执行时间：20190403030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-02'
;
SQL结束执行时间：20190403030158
SQL开始执行时间：20190403030158

update edw.crm_accounts set end_dt = '2019-04-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190403030158
SQL开始执行时间：20190403030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190403030158

20190404030158开始执行2019-04-03数据加载日志:
SQL开始执行时间：20190404030158
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-03' or left(a.modifiedon,10) = '2019-04-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190404030158
SQL开始执行时间：20190404030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190404030159
SQL开始执行时间：20190404030159

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190404030159
SQL开始执行时间：20190404030159
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-03'
;
SQL结束执行时间：20190404030159
SQL开始执行时间：20190404030159

update edw.crm_accounts set end_dt = '2019-04-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190404030159
SQL开始执行时间：20190404030159

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190404030159

20190405030200开始执行2019-04-04数据加载日志:
SQL开始执行时间：20190405030200
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-04' or left(a.modifiedon,10) = '2019-04-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190405030200
SQL开始执行时间：20190405030200

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190405030200
SQL开始执行时间：20190405030200

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190405030200
SQL开始执行时间：20190405030200
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-04'
;
SQL结束执行时间：20190405030200
SQL开始执行时间：20190405030200

update edw.crm_accounts set end_dt = '2019-04-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190405030200
SQL开始执行时间：20190405030200

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190405030200

20190406030159开始执行2019-04-05数据加载日志:
SQL开始执行时间：20190406030159
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-05' or left(a.modifiedon,10) = '2019-04-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190406030159
SQL开始执行时间：20190406030159

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190406030159
SQL开始执行时间：20190406030159

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190406030159
SQL开始执行时间：20190406030159
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-05'
;
SQL结束执行时间：20190406030159
SQL开始执行时间：20190406030159

update edw.crm_accounts set end_dt = '2019-04-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190406030159
SQL开始执行时间：20190406030159

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190406030159

20190407030157开始执行2019-04-06数据加载日志:
SQL开始执行时间：20190407030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-06' or left(a.modifiedon,10) = '2019-04-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190407030158
SQL开始执行时间：20190407030158

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190407030158
SQL开始执行时间：20190407030158

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190407030158
SQL开始执行时间：20190407030158
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-06'
;
SQL结束执行时间：20190407030158
SQL开始执行时间：20190407030158

update edw.crm_accounts set end_dt = '2019-04-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190407030158
SQL开始执行时间：20190407030158

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190407030158

20190408030157开始执行2019-04-07数据加载日志:
SQL开始执行时间：20190408030157
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-07' or left(a.modifiedon,10) = '2019-04-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190408030157
SQL开始执行时间：20190408030157

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190408030157
SQL开始执行时间：20190408030157

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190408030157
SQL开始执行时间：20190408030157
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-07'
;
SQL结束执行时间：20190408030157
SQL开始执行时间：20190408030157

update edw.crm_accounts set end_dt = '2019-04-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190408030157
SQL开始执行时间：20190408030157

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190408030157

20190409030047开始执行2019-04-08数据加载日志:
SQL开始执行时间：20190409030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-08' or left(a.modifiedon,10) = '2019-04-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190409030047
SQL开始执行时间：20190409030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190409030047
SQL开始执行时间：20190409030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190409030047
SQL开始执行时间：20190409030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-08'
;
SQL结束执行时间：20190409030047
SQL开始执行时间：20190409030047

update edw.crm_accounts set end_dt = '2019-04-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190409030047
SQL开始执行时间：20190409030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190409030047

20190410030046开始执行2019-04-09数据加载日志:
SQL开始执行时间：20190410030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-09' or left(a.modifiedon,10) = '2019-04-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-09'
;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046

update edw.crm_accounts set end_dt = '2019-04-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190410030046
SQL开始执行时间：20190410030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190410030046

20190412030045开始执行2019-04-11数据加载日志:
SQL开始执行时间：20190412030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-11' or left(a.modifiedon,10) = '2019-04-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190412030045
SQL开始执行时间：20190412030045

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190412030046
SQL开始执行时间：20190412030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190412030046
SQL开始执行时间：20190412030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-11'
;
SQL结束执行时间：20190412030046
SQL开始执行时间：20190412030046

update edw.crm_accounts set end_dt = '2019-04-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190412030046
SQL开始执行时间：20190412030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190412030046
SQL开始执行时间：20190412030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190412030046

20190413030045开始执行2019-04-12数据加载日志:
SQL开始执行时间：20190413030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-12' or left(a.modifiedon,10) = '2019-04-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-12'
;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045

update edw.crm_accounts set end_dt = '2019-04-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190413030045
SQL开始执行时间：20190413030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190413030045

20190414030046开始执行2019-04-13数据加载日志:
SQL开始执行时间：20190414030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-13' or left(a.modifiedon,10) = '2019-04-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190414030046
SQL开始执行时间：20190414030046

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190414030047
SQL开始执行时间：20190414030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190414030047
SQL开始执行时间：20190414030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-13'
;
SQL结束执行时间：20190414030047
SQL开始执行时间：20190414030047

update edw.crm_accounts set end_dt = '2019-04-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190414030047
SQL开始执行时间：20190414030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190414030047
SQL开始执行时间：20190414030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190414030047

20190415030046开始执行2019-04-14数据加载日志:
SQL开始执行时间：20190415030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-14' or left(a.modifiedon,10) = '2019-04-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-14'
;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046

update edw.crm_accounts set end_dt = '2019-04-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190415030046
SQL开始执行时间：20190415030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190415030046

20190416030047开始执行2019-04-15数据加载日志:
SQL开始执行时间：20190416030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-15' or left(a.modifiedon,10) = '2019-04-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190416030047
SQL开始执行时间：20190416030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190416030047
SQL开始执行时间：20190416030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190416030047
SQL开始执行时间：20190416030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-15'
;
SQL结束执行时间：20190416030047
SQL开始执行时间：20190416030047

update edw.crm_accounts set end_dt = '2019-04-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190416030048
SQL开始执行时间：20190416030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190416030048
SQL开始执行时间：20190416030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190416030048

20190417030045开始执行2019-04-16数据加载日志:
SQL开始执行时间：20190417030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-16' or left(a.modifiedon,10) = '2019-04-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190417030045
SQL开始执行时间：20190417030045

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190417030046
SQL开始执行时间：20190417030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190417030046
SQL开始执行时间：20190417030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-16'
;
SQL结束执行时间：20190417030046
SQL开始执行时间：20190417030046

update edw.crm_accounts set end_dt = '2019-04-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190417030046
SQL开始执行时间：20190417030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190417030046
SQL开始执行时间：20190417030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190417030046

20190418030048开始执行2019-04-17数据加载日志:
SQL开始执行时间：20190418030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-17' or left(a.modifiedon,10) = '2019-04-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-17'
;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048

update edw.crm_accounts set end_dt = '2019-04-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190418030048
SQL开始执行时间：20190418030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190418030048

20190419030051开始执行2019-04-18数据加载日志:
SQL开始执行时间：20190419030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-18' or left(a.modifiedon,10) = '2019-04-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-18'
;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051

update edw.crm_accounts set end_dt = '2019-04-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190419030051
SQL开始执行时间：20190419030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190419030052

20190420030046开始执行2019-04-19数据加载日志:
SQL开始执行时间：20190420030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-19' or left(a.modifiedon,10) = '2019-04-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-19'
;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046

update edw.crm_accounts set end_dt = '2019-04-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190420030046
SQL开始执行时间：20190420030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190420030046

20190421030047开始执行2019-04-20数据加载日志:
SQL开始执行时间：20190421030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-20' or left(a.modifiedon,10) = '2019-04-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-20'
;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047

update edw.crm_accounts set end_dt = '2019-04-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190421030047
SQL开始执行时间：20190421030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190421030047

20190422030047开始执行2019-04-21数据加载日志:
SQL开始执行时间：20190422030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-21' or left(a.modifiedon,10) = '2019-04-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190422030047
SQL开始执行时间：20190422030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190422030048
SQL开始执行时间：20190422030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190422030048
SQL开始执行时间：20190422030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-21'
;
SQL结束执行时间：20190422030048
SQL开始执行时间：20190422030048

update edw.crm_accounts set end_dt = '2019-04-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190422030048
SQL开始执行时间：20190422030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190422030048
SQL开始执行时间：20190422030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190422030048

20190423030047开始执行2019-04-22数据加载日志:
SQL开始执行时间：20190423030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-22' or left(a.modifiedon,10) = '2019-04-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-22'
;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047

update edw.crm_accounts set end_dt = '2019-04-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190423030047
SQL开始执行时间：20190423030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190423030047

20190424030048开始执行2019-04-23数据加载日志:
SQL开始执行时间：20190424030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-23' or left(a.modifiedon,10) = '2019-04-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-23'
;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048

update edw.crm_accounts set end_dt = '2019-04-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190424030048
SQL开始执行时间：20190424030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190424030048

20190425030048开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-24' or left(a.modifiedon,10) = '2019-04-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048

update edw.crm_accounts set end_dt = '2019-04-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190425030048
SQL开始执行时间：20190425030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190425030048

20190426030048开始执行2019-04-25数据加载日志:
SQL开始执行时间：20190426030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-25' or left(a.modifiedon,10) = '2019-04-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-25'
;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048

update edw.crm_accounts set end_dt = '2019-04-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190426030048
SQL开始执行时间：20190426030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190426030048

20190427030047开始执行2019-04-26数据加载日志:
SQL开始执行时间：20190427030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-26' or left(a.modifiedon,10) = '2019-04-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190427030047
SQL开始执行时间：20190427030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190427030047
SQL开始执行时间：20190427030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190427030048
SQL开始执行时间：20190427030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-26'
;
SQL结束执行时间：20190427030048
SQL开始执行时间：20190427030048

update edw.crm_accounts set end_dt = '2019-04-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190427030048
SQL开始执行时间：20190427030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190427030048
SQL开始执行时间：20190427030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190427030048

20190428030048开始执行2019-04-27数据加载日志:
SQL开始执行时间：20190428030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-27' or left(a.modifiedon,10) = '2019-04-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190428030048
SQL开始执行时间：20190428030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190428030049
SQL开始执行时间：20190428030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190428030049
SQL开始执行时间：20190428030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-27'
;
SQL结束执行时间：20190428030049
SQL开始执行时间：20190428030049

update edw.crm_accounts set end_dt = '2019-04-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190428030049
SQL开始执行时间：20190428030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190428030049
SQL开始执行时间：20190428030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190428030049

20190429030047开始执行2019-04-28数据加载日志:
SQL开始执行时间：20190429030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-28' or left(a.modifiedon,10) = '2019-04-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190429030047
SQL开始执行时间：20190429030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190429030048
SQL开始执行时间：20190429030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190429030048
SQL开始执行时间：20190429030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-28'
;
SQL结束执行时间：20190429030048
SQL开始执行时间：20190429030048

update edw.crm_accounts set end_dt = '2019-04-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190429030048
SQL开始执行时间：20190429030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190429030048
SQL开始执行时间：20190429030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190429030048

20190430030047开始执行2019-04-29数据加载日志:
SQL开始执行时间：20190430030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-29' or left(a.modifiedon,10) = '2019-04-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-29'
;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047

update edw.crm_accounts set end_dt = '2019-04-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190430030047
SQL开始执行时间：20190430030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190430030047

20190501030046开始执行2019-04-30数据加载日志:
SQL开始执行时间：20190501030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-04-30' or left(a.modifiedon,10) = '2019-04-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-04-30'
;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046

update edw.crm_accounts set end_dt = '2019-04-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190501030046
SQL开始执行时间：20190501030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190501030046

20190502030048开始执行2019-05-01数据加载日志:
SQL开始执行时间：20190502030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-01' or left(a.modifiedon,10) = '2019-05-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-01'
;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048

update edw.crm_accounts set end_dt = '2019-05-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190502030048
SQL开始执行时间：20190502030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190502030048

20190503030047开始执行2019-05-02数据加载日志:
SQL开始执行时间：20190503030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-02' or left(a.modifiedon,10) = '2019-05-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-02'
;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047

update edw.crm_accounts set end_dt = '2019-05-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190503030047
SQL开始执行时间：20190503030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190503030047

20190504030047开始执行2019-05-03数据加载日志:
SQL开始执行时间：20190504030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-03' or left(a.modifiedon,10) = '2019-05-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-03'
;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047

update edw.crm_accounts set end_dt = '2019-05-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190504030047
SQL开始执行时间：20190504030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190504030047

20190505030048开始执行2019-05-04数据加载日志:
SQL开始执行时间：20190505030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-04' or left(a.modifiedon,10) = '2019-05-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-04'
;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048

update edw.crm_accounts set end_dt = '2019-05-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190505030048
SQL开始执行时间：20190505030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190505030048

20190506030049开始执行2019-05-05数据加载日志:
SQL开始执行时间：20190506030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-05' or left(a.modifiedon,10) = '2019-05-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-05'
;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049

update edw.crm_accounts set end_dt = '2019-05-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190506030049
SQL开始执行时间：20190506030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190506030049

20190507030047开始执行2019-05-06数据加载日志:
SQL开始执行时间：20190507030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-06' or left(a.modifiedon,10) = '2019-05-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190507030047
SQL开始执行时间：20190507030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190507030048
SQL开始执行时间：20190507030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190507030048
SQL开始执行时间：20190507030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-06'
;
SQL结束执行时间：20190507030048
SQL开始执行时间：20190507030048

update edw.crm_accounts set end_dt = '2019-05-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190507030048
SQL开始执行时间：20190507030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190507030048
SQL开始执行时间：20190507030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190507030048

20190508030047开始执行2019-05-07数据加载日志:
SQL开始执行时间：20190508030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-07' or left(a.modifiedon,10) = '2019-05-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190508030047
SQL开始执行时间：20190508030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190508030047
SQL开始执行时间：20190508030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190508030047
SQL开始执行时间：20190508030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-07'
;
SQL结束执行时间：20190508030047
SQL开始执行时间：20190508030047

update edw.crm_accounts set end_dt = '2019-05-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190508030048
SQL开始执行时间：20190508030048

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190508030048
SQL开始执行时间：20190508030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190508030048

20190510030058开始执行2019-05-09数据加载日志:
SQL开始执行时间：20190510030058
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-09' or left(a.modifiedon,10) = '2019-05-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-09'
;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058

update edw.crm_accounts set end_dt = '2019-05-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190510030058
SQL开始执行时间：20190510030058

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190510030058

20190511030049开始执行2019-05-10数据加载日志:
SQL开始执行时间：20190511030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-10' or left(a.modifiedon,10) = '2019-05-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190511030049
SQL开始执行时间：20190511030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190511030050
SQL开始执行时间：20190511030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190511030050
SQL开始执行时间：20190511030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-10'
;
SQL结束执行时间：20190511030050
SQL开始执行时间：20190511030050

update edw.crm_accounts set end_dt = '2019-05-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190511030050
SQL开始执行时间：20190511030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190511030050
SQL开始执行时间：20190511030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190511030050

20190512030049开始执行2019-05-11数据加载日志:
SQL开始执行时间：20190512030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-11' or left(a.modifiedon,10) = '2019-05-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-11'
;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049

update edw.crm_accounts set end_dt = '2019-05-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190512030049
SQL开始执行时间：20190512030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190512030049

20190513030048开始执行2019-05-12数据加载日志:
SQL开始执行时间：20190513030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-12' or left(a.modifiedon,10) = '2019-05-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190513030048
SQL开始执行时间：20190513030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190513030049
SQL开始执行时间：20190513030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190513030049
SQL开始执行时间：20190513030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-12'
;
SQL结束执行时间：20190513030049
SQL开始执行时间：20190513030049

update edw.crm_accounts set end_dt = '2019-05-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190513030049
SQL开始执行时间：20190513030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190513030049
SQL开始执行时间：20190513030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190513030049

20190514030053开始执行2019-05-13数据加载日志:
SQL开始执行时间：20190514030053
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-13' or left(a.modifiedon,10) = '2019-05-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190514030053
SQL开始执行时间：20190514030053

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190514030053
SQL开始执行时间：20190514030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190514030053
SQL开始执行时间：20190514030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-13'
;
SQL结束执行时间：20190514030053
SQL开始执行时间：20190514030053

update edw.crm_accounts set end_dt = '2019-05-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190514030054
SQL开始执行时间：20190514030054

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190514030054
SQL开始执行时间：20190514030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190514030054

20190515030051开始执行2019-05-14数据加载日志:
SQL开始执行时间：20190515030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-14' or left(a.modifiedon,10) = '2019-05-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-14'
;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051

update edw.crm_accounts set end_dt = '2019-05-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190515030051
SQL开始执行时间：20190515030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190515030051

20190516030049开始执行2019-05-15数据加载日志:
SQL开始执行时间：20190516030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-15' or left(a.modifiedon,10) = '2019-05-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190516030049
SQL开始执行时间：20190516030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190516030050
SQL开始执行时间：20190516030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190516030050
SQL开始执行时间：20190516030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-15'
;
SQL结束执行时间：20190516030050
SQL开始执行时间：20190516030050

update edw.crm_accounts set end_dt = '2019-05-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190516030050
SQL开始执行时间：20190516030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190516030050
SQL开始执行时间：20190516030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190516030050

20190517030050开始执行2019-05-16数据加载日志:
SQL开始执行时间：20190517030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-16' or left(a.modifiedon,10) = '2019-05-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-16'
;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050

update edw.crm_accounts set end_dt = '2019-05-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190517030050
SQL开始执行时间：20190517030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190517030050

20190518030050开始执行2019-05-17数据加载日志:
SQL开始执行时间：20190518030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-17' or left(a.modifiedon,10) = '2019-05-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-17'
;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050

update edw.crm_accounts set end_dt = '2019-05-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190518030050
SQL开始执行时间：20190518030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190518030050

20190519030049开始执行2019-05-18数据加载日志:
SQL开始执行时间：20190519030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-18' or left(a.modifiedon,10) = '2019-05-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190519030049
SQL开始执行时间：20190519030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190519030050
SQL开始执行时间：20190519030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190519030050
SQL开始执行时间：20190519030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-18'
;
SQL结束执行时间：20190519030050
SQL开始执行时间：20190519030050

update edw.crm_accounts set end_dt = '2019-05-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190519030050
SQL开始执行时间：20190519030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190519030050
SQL开始执行时间：20190519030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190519030050

20190520030054开始执行2019-05-19数据加载日志:
SQL开始执行时间：20190520030054
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-19' or left(a.modifiedon,10) = '2019-05-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190520030054
SQL开始执行时间：20190520030054

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190520030054
SQL开始执行时间：20190520030054

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190520030055
SQL开始执行时间：20190520030055
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-19'
;
SQL结束执行时间：20190520030055
SQL开始执行时间：20190520030055

update edw.crm_accounts set end_dt = '2019-05-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190520030055
SQL开始执行时间：20190520030055

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190520030055
SQL开始执行时间：20190520030055

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190520030055

20190521030048开始执行2019-05-20数据加载日志:
SQL开始执行时间：20190521030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-20' or left(a.modifiedon,10) = '2019-05-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190521030048
SQL开始执行时间：20190521030048

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190521030049
SQL开始执行时间：20190521030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190521030049
SQL开始执行时间：20190521030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-20'
;
SQL结束执行时间：20190521030049
SQL开始执行时间：20190521030049

update edw.crm_accounts set end_dt = '2019-05-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190521030049
SQL开始执行时间：20190521030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190521030049
SQL开始执行时间：20190521030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190521030049

20190522030049开始执行2019-05-21数据加载日志:
SQL开始执行时间：20190522030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-21' or left(a.modifiedon,10) = '2019-05-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-21'
;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049

update edw.crm_accounts set end_dt = '2019-05-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190522030049
SQL开始执行时间：20190522030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190522030049

20190523030049开始执行2019-05-22数据加载日志:
SQL开始执行时间：20190523030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-22' or left(a.modifiedon,10) = '2019-05-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190523030049
SQL开始执行时间：20190523030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190523030050
SQL开始执行时间：20190523030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190523030050
SQL开始执行时间：20190523030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-22'
;
SQL结束执行时间：20190523030050
SQL开始执行时间：20190523030050

update edw.crm_accounts set end_dt = '2019-05-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190523030050
SQL开始执行时间：20190523030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190523030050
SQL开始执行时间：20190523030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190523030050

20190524030049开始执行2019-05-23数据加载日志:
SQL开始执行时间：20190524030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-23' or left(a.modifiedon,10) = '2019-05-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-23'
;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049

update edw.crm_accounts set end_dt = '2019-05-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190524030049
SQL开始执行时间：20190524030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190524030049

20190525030049开始执行2019-05-24数据加载日志:
SQL开始执行时间：20190525030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-24' or left(a.modifiedon,10) = '2019-05-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190525030049
SQL开始执行时间：20190525030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190525030050
SQL开始执行时间：20190525030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190525030050
SQL开始执行时间：20190525030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-24'
;
SQL结束执行时间：20190525030050
SQL开始执行时间：20190525030050

update edw.crm_accounts set end_dt = '2019-05-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190525030050
SQL开始执行时间：20190525030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190525030050
SQL开始执行时间：20190525030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190525030050

20190526030049开始执行2019-05-25数据加载日志:
SQL开始执行时间：20190526030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-25' or left(a.modifiedon,10) = '2019-05-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-25'
;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049

update edw.crm_accounts set end_dt = '2019-05-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190526030049
SQL开始执行时间：20190526030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190526030050

20190527030051开始执行2019-05-26数据加载日志:
SQL开始执行时间：20190527030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-26' or left(a.modifiedon,10) = '2019-05-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190527030051
SQL开始执行时间：20190527030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190527030052
SQL开始执行时间：20190527030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190527030052
SQL开始执行时间：20190527030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-26'
;
SQL结束执行时间：20190527030052
SQL开始执行时间：20190527030052

update edw.crm_accounts set end_dt = '2019-05-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190527030052
SQL开始执行时间：20190527030052

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190527030052
SQL开始执行时间：20190527030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190527030052

20190528030051开始执行2019-05-27数据加载日志:
SQL开始执行时间：20190528030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-27' or left(a.modifiedon,10) = '2019-05-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-27'
;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051

update edw.crm_accounts set end_dt = '2019-05-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190528030051
SQL开始执行时间：20190528030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190528030051

20190529030050开始执行2019-05-28数据加载日志:
SQL开始执行时间：20190529030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-28' or left(a.modifiedon,10) = '2019-05-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190529030050
SQL开始执行时间：20190529030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190529030051
SQL开始执行时间：20190529030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190529030051
SQL开始执行时间：20190529030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-28'
;
SQL结束执行时间：20190529030051
SQL开始执行时间：20190529030051

update edw.crm_accounts set end_dt = '2019-05-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190529030051
SQL开始执行时间：20190529030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190529030051
SQL开始执行时间：20190529030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190529030051

20190530030051开始执行2019-05-29数据加载日志:
SQL开始执行时间：20190530030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-29' or left(a.modifiedon,10) = '2019-05-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-29'
;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051

update edw.crm_accounts set end_dt = '2019-05-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190530030051
SQL开始执行时间：20190530030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190530030051

20190531030050开始执行2019-05-30数据加载日志:
SQL开始执行时间：20190531030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-30' or left(a.modifiedon,10) = '2019-05-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-30'
;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050

update edw.crm_accounts set end_dt = '2019-05-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190531030050
SQL开始执行时间：20190531030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190531030050

20190601030051开始执行2019-05-31数据加载日志:
SQL开始执行时间：20190601030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-05-31' or left(a.modifiedon,10) = '2019-05-31')
   and a.statecode = '0'
;
SQL结束执行时间：20190601030051
SQL开始执行时间：20190601030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190601030052
SQL开始执行时间：20190601030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190601030052
SQL开始执行时间：20190601030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-05-31'
;
SQL结束执行时间：20190601030052
SQL开始执行时间：20190601030052

update edw.crm_accounts set end_dt = '2019-05-31' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190601030052
SQL开始执行时间：20190601030052

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190601030052
SQL开始执行时间：20190601030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190601030052

20190602030050开始执行2019-06-01数据加载日志:
SQL开始执行时间：20190602030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-01' or left(a.modifiedon,10) = '2019-06-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190602030050
SQL开始执行时间：20190602030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190602030051
SQL开始执行时间：20190602030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190602030051
SQL开始执行时间：20190602030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-01'
;
SQL结束执行时间：20190602030051
SQL开始执行时间：20190602030051

update edw.crm_accounts set end_dt = '2019-06-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190602030051
SQL开始执行时间：20190602030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190602030051
SQL开始执行时间：20190602030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190602030051

20190603030056开始执行2019-06-02数据加载日志:
SQL开始执行时间：20190603030056
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-02' or left(a.modifiedon,10) = '2019-06-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-02'
;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056

update edw.crm_accounts set end_dt = '2019-06-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190603030056
SQL开始执行时间：20190603030056

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190603030056

20190604030050开始执行2019-06-03数据加载日志:
SQL开始执行时间：20190604030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-03' or left(a.modifiedon,10) = '2019-06-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190604030050
SQL开始执行时间：20190604030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190604030053
SQL开始执行时间：20190604030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190604030053
SQL开始执行时间：20190604030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-03'
;
SQL结束执行时间：20190604030053
SQL开始执行时间：20190604030053

update edw.crm_accounts set end_dt = '2019-06-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190604030053
SQL开始执行时间：20190604030053

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190604030053
SQL开始执行时间：20190604030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190604030053

20190605030050开始执行2019-06-04数据加载日志:
SQL开始执行时间：20190605030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-04' or left(a.modifiedon,10) = '2019-06-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-04'
;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050

update edw.crm_accounts set end_dt = '2019-06-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190605030050
SQL开始执行时间：20190605030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190605030050

20190606030049开始执行2019-06-05数据加载日志:
SQL开始执行时间：20190606030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-05' or left(a.modifiedon,10) = '2019-06-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190606030049
SQL开始执行时间：20190606030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190606030050
SQL开始执行时间：20190606030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190606030050
SQL开始执行时间：20190606030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-05'
;
SQL结束执行时间：20190606030050
SQL开始执行时间：20190606030050

update edw.crm_accounts set end_dt = '2019-06-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190606030050
SQL开始执行时间：20190606030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190606030050
SQL开始执行时间：20190606030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190606030050

20190607030050开始执行2019-06-06数据加载日志:
SQL开始执行时间：20190607030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-06' or left(a.modifiedon,10) = '2019-06-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-06'
;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050

update edw.crm_accounts set end_dt = '2019-06-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190607030050
SQL开始执行时间：20190607030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190607030050

20190608030051开始执行2019-06-07数据加载日志:
SQL开始执行时间：20190608030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-07' or left(a.modifiedon,10) = '2019-06-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-07'
;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051

update edw.crm_accounts set end_dt = '2019-06-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190608030051
SQL开始执行时间：20190608030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190608030051

20190609030050开始执行2019-06-08数据加载日志:
SQL开始执行时间：20190609030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-08' or left(a.modifiedon,10) = '2019-06-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-08'
;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050

update edw.crm_accounts set end_dt = '2019-06-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190609030050
SQL开始执行时间：20190609030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190609030050

20190610030049开始执行2019-06-09数据加载日志:
SQL开始执行时间：20190610030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-09' or left(a.modifiedon,10) = '2019-06-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-09'
;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049

update edw.crm_accounts set end_dt = '2019-06-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190610030049
SQL开始执行时间：20190610030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190610030050

20190611030051开始执行2019-06-10数据加载日志:
SQL开始执行时间：20190611030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-10' or left(a.modifiedon,10) = '2019-06-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-10'
;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051

update edw.crm_accounts set end_dt = '2019-06-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190611030051
SQL开始执行时间：20190611030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190611030051

20190612030052开始执行2019-06-11数据加载日志:
SQL开始执行时间：20190612030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-11' or left(a.modifiedon,10) = '2019-06-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-11'
;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052

update edw.crm_accounts set end_dt = '2019-06-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190612030052
SQL开始执行时间：20190612030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190612030052

20190613030050开始执行2019-06-12数据加载日志:
SQL开始执行时间：20190613030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-12' or left(a.modifiedon,10) = '2019-06-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190613030050
SQL开始执行时间：20190613030050

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190613030051
SQL开始执行时间：20190613030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190613030051
SQL开始执行时间：20190613030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-12'
;
SQL结束执行时间：20190613030051
SQL开始执行时间：20190613030051

update edw.crm_accounts set end_dt = '2019-06-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190613030051
SQL开始执行时间：20190613030051

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190613030051
SQL开始执行时间：20190613030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.crm_accounts_pre group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190613030051

20190614030053开始执行2019-06-13数据加载日志:
SQL开始执行时间：20190614030053
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-13' or left(a.modifiedon,10) = '2019-06-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-13'
;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053

update edw.crm_accounts set end_dt = '2019-06-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190614030053
SQL开始执行时间：20190614030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190614030053

20190615030054开始执行2019-06-14数据加载日志:
SQL开始执行时间：20190615030054
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-14' or left(a.modifiedon,10) = '2019-06-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-14'
;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054

update edw.crm_accounts set end_dt = '2019-06-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190615030054
SQL开始执行时间：20190615030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190615030054

20190616030053开始执行2019-06-15数据加载日志:
SQL开始执行时间：20190616030053
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-15' or left(a.modifiedon,10) = '2019-06-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-15'
;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053

update edw.crm_accounts set end_dt = '2019-06-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190616030053
SQL开始执行时间：20190616030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190616030054

20190617030052开始执行2019-06-16数据加载日志:
SQL开始执行时间：20190617030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-16' or left(a.modifiedon,10) = '2019-06-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190617030052
SQL开始执行时间：20190617030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190617030053
SQL开始执行时间：20190617030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190617030053
SQL开始执行时间：20190617030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-16'
;
SQL结束执行时间：20190617030053
SQL开始执行时间：20190617030053

update edw.crm_accounts set end_dt = '2019-06-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190617030053
SQL开始执行时间：20190617030053

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190617030053
SQL开始执行时间：20190617030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190617030053

20190618030052开始执行2019-06-17数据加载日志:
SQL开始执行时间：20190618030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-17' or left(a.modifiedon,10) = '2019-06-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190618030052
SQL开始执行时间：20190618030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190618030053
SQL开始执行时间：20190618030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190618030054
SQL开始执行时间：20190618030054
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-17'
;
SQL结束执行时间：20190618030054
SQL开始执行时间：20190618030054

update edw.crm_accounts set end_dt = '2019-06-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190618030054
SQL开始执行时间：20190618030054

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190618030054
SQL开始执行时间：20190618030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190618030054

20190619030052开始执行2019-06-18数据加载日志:
SQL开始执行时间：20190619030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-18' or left(a.modifiedon,10) = '2019-06-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190619030052
SQL开始执行时间：20190619030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190619030054
SQL开始执行时间：20190619030054

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190619030054
SQL开始执行时间：20190619030054
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-18'
;
SQL结束执行时间：20190619030054
SQL开始执行时间：20190619030054

update edw.crm_accounts set end_dt = '2019-06-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190619030054
SQL开始执行时间：20190619030054

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190619030054
SQL开始执行时间：20190619030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190619030054

20190620030055开始执行2019-06-19数据加载日志:
SQL开始执行时间：20190620030055
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-19' or left(a.modifiedon,10) = '2019-06-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190620030055
SQL开始执行时间：20190620030055

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190620030056
SQL开始执行时间：20190620030056

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190620030056
SQL开始执行时间：20190620030056
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-19'
;
SQL结束执行时间：20190620030056
SQL开始执行时间：20190620030056

update edw.crm_accounts set end_dt = '2019-06-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190620030056
SQL开始执行时间：20190620030056

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190620030056
SQL开始执行时间：20190620030056

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190620030056

20190621030052开始执行2019-06-20数据加载日志:
SQL开始执行时间：20190621030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-20' or left(a.modifiedon,10) = '2019-06-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190621030052
SQL开始执行时间：20190621030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190621030053
SQL开始执行时间：20190621030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190621030053
SQL开始执行时间：20190621030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-20'
;
SQL结束执行时间：20190621030053
SQL开始执行时间：20190621030053

update edw.crm_accounts set end_dt = '2019-06-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190621030053
SQL开始执行时间：20190621030053

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190621030053
SQL开始执行时间：20190621030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190621030053

20190622030053开始执行2019-06-21数据加载日志:
SQL开始执行时间：20190622030053
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-21' or left(a.modifiedon,10) = '2019-06-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190622030053
SQL开始执行时间：20190622030053

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190622030053
SQL开始执行时间：20190622030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190622030053
SQL开始执行时间：20190622030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-21'
;
SQL结束执行时间：20190622030053
SQL开始执行时间：20190622030053

update edw.crm_accounts set end_dt = '2019-06-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190622030054
SQL开始执行时间：20190622030054

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190622030054
SQL开始执行时间：20190622030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190622030054

20190623030052开始执行2019-06-22数据加载日志:
SQL开始执行时间：20190623030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-22' or left(a.modifiedon,10) = '2019-06-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-22'
;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052

update edw.crm_accounts set end_dt = '2019-06-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190623030052
SQL开始执行时间：20190623030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190623030052

20190624030052开始执行2019-06-23数据加载日志:
SQL开始执行时间：20190624030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-23' or left(a.modifiedon,10) = '2019-06-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190624030052
SQL开始执行时间：20190624030052

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190624030052
SQL开始执行时间：20190624030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190624030052
SQL开始执行时间：20190624030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-23'
;
SQL结束执行时间：20190624030052
SQL开始执行时间：20190624030052

update edw.crm_accounts set end_dt = '2019-06-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190624030052
SQL开始执行时间：20190624030052

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190624030053
SQL开始执行时间：20190624030053

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190624030053

20190625030040开始执行2019-06-24数据加载日志:
SQL开始执行时间：20190625030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-24' or left(a.modifiedon,10) = '2019-06-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-24'
;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041

update edw.crm_accounts set end_dt = '2019-06-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190625030041
SQL开始执行时间：20190625030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190625030041

20190626030044开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190626030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-25' or left(a.modifiedon,10) = '2019-06-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-25'
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044

update edw.crm_accounts set end_dt = '2019-06-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190626030044

20190627030040开始执行2019-06-26数据加载日志:
SQL开始执行时间：20190627030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-26' or left(a.modifiedon,10) = '2019-06-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-26'
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040

update edw.crm_accounts set end_dt = '2019-06-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190627030040

20190628030041开始执行2019-06-27数据加载日志:
SQL开始执行时间：20190628030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-27' or left(a.modifiedon,10) = '2019-06-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190628030041
SQL开始执行时间：20190628030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190628030042
SQL开始执行时间：20190628030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190628030042
SQL开始执行时间：20190628030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-27'
;
SQL结束执行时间：20190628030042
SQL开始执行时间：20190628030042

update edw.crm_accounts set end_dt = '2019-06-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190628030042
SQL开始执行时间：20190628030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190628030042
SQL开始执行时间：20190628030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190628030042

20190629030041开始执行2019-06-28数据加载日志:
SQL开始执行时间：20190629030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-28' or left(a.modifiedon,10) = '2019-06-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190629030041
SQL开始执行时间：20190629030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190629030042
SQL开始执行时间：20190629030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190629030042
SQL开始执行时间：20190629030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-28'
;
SQL结束执行时间：20190629030042
SQL开始执行时间：20190629030042

update edw.crm_accounts set end_dt = '2019-06-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190629030042
SQL开始执行时间：20190629030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190629030042
SQL开始执行时间：20190629030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190629030042

20190630030040开始执行2019-06-29数据加载日志:
SQL开始执行时间：20190630030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-29' or left(a.modifiedon,10) = '2019-06-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190630030040
SQL开始执行时间：20190630030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190630030041
SQL开始执行时间：20190630030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190630030041
SQL开始执行时间：20190630030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-29'
;
SQL结束执行时间：20190630030041
SQL开始执行时间：20190630030041

update edw.crm_accounts set end_dt = '2019-06-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190630030041
SQL开始执行时间：20190630030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190630030041
SQL开始执行时间：20190630030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190630030041

20190701030042开始执行2019-06-30数据加载日志:
SQL开始执行时间：20190701030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-06-30' or left(a.modifiedon,10) = '2019-06-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190701030042
SQL开始执行时间：20190701030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190701030042
SQL开始执行时间：20190701030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190701030043
SQL开始执行时间：20190701030043
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-06-30'
;
SQL结束执行时间：20190701030043
SQL开始执行时间：20190701030043

update edw.crm_accounts set end_dt = '2019-06-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190701030043
SQL开始执行时间：20190701030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190701030043
SQL开始执行时间：20190701030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190701030043

20190702030045开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-01' or left(a.modifiedon,10) = '2019-07-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190702030045
SQL开始执行时间：20190702030045

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190702030046
SQL开始执行时间：20190702030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-01'
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047

update edw.crm_accounts set end_dt = '2019-07-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190702030048

20190702091032开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702091032
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-01' or left(a.modifiedon,10) = '2019-07-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190702091032
SQL开始执行时间：20190702091032

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190702091034
SQL开始执行时间：20190702091034

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-01'
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035

update edw.crm_accounts set end_dt = '2019-07-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190702091035

20190702091240开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702091240
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-01' or left(a.modifiedon,10) = '2019-07-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190702091240
SQL开始执行时间：20190702091240

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190702091242
SQL开始执行时间：20190702091242

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-01'
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243

update edw.crm_accounts set end_dt = '2019-07-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190702091243

20190703030040开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190703030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-02' or left(a.modifiedon,10) = '2019-07-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190703030040
SQL开始执行时间：20190703030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190703030041
SQL开始执行时间：20190703030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190703030041
SQL开始执行时间：20190703030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-02'
;
SQL结束执行时间：20190703030041
SQL开始执行时间：20190703030041

update edw.crm_accounts set end_dt = '2019-07-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190703030041
SQL开始执行时间：20190703030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190703030041
SQL开始执行时间：20190703030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190703030041

20190704030040开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190704030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-03' or left(a.modifiedon,10) = '2019-07-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190704030040
SQL开始执行时间：20190704030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190704030041
SQL开始执行时间：20190704030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190704030041
SQL开始执行时间：20190704030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-03'
;
SQL结束执行时间：20190704030041
SQL开始执行时间：20190704030041

update edw.crm_accounts set end_dt = '2019-07-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190704030041
SQL开始执行时间：20190704030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190704030041
SQL开始执行时间：20190704030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190704030041

20190705030041开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190705030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-04' or left(a.modifiedon,10) = '2019-07-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190705030041
SQL开始执行时间：20190705030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190705030042
SQL开始执行时间：20190705030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190705030042
SQL开始执行时间：20190705030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-04'
;
SQL结束执行时间：20190705030042
SQL开始执行时间：20190705030042

update edw.crm_accounts set end_dt = '2019-07-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190705030042
SQL开始执行时间：20190705030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190705030042
SQL开始执行时间：20190705030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190705030042

20190706030043开始执行2019-07-05数据加载日志:
SQL开始执行时间：20190706030043
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-05' or left(a.modifiedon,10) = '2019-07-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-05'
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043

update edw.crm_accounts set end_dt = '2019-07-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190706030043

20190707030042开始执行2019-07-06数据加载日志:
SQL开始执行时间：20190707030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-06' or left(a.modifiedon,10) = '2019-07-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-06'
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042

update edw.crm_accounts set end_dt = '2019-07-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190707030042

20190708030041开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190708030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-07' or left(a.modifiedon,10) = '2019-07-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-07'
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041

update edw.crm_accounts set end_dt = '2019-07-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190708030041

20190709030041开始执行2019-07-08数据加载日志:
SQL开始执行时间：20190709030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-08' or left(a.modifiedon,10) = '2019-07-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190709030041
SQL开始执行时间：20190709030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190709030042
SQL开始执行时间：20190709030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190709030042
SQL开始执行时间：20190709030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-08'
;
SQL结束执行时间：20190709030042
SQL开始执行时间：20190709030042

update edw.crm_accounts set end_dt = '2019-07-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190709030042
SQL开始执行时间：20190709030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190709030042
SQL开始执行时间：20190709030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190709030042

20190710030042开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190710030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-09' or left(a.modifiedon,10) = '2019-07-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190710030042
SQL开始执行时间：20190710030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190710030043
SQL开始执行时间：20190710030043

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190710030043
SQL开始执行时间：20190710030043
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-09'
;
SQL结束执行时间：20190710030043
SQL开始执行时间：20190710030043

update edw.crm_accounts set end_dt = '2019-07-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190710030043
SQL开始执行时间：20190710030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190710030043
SQL开始执行时间：20190710030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190710030043

20190711030041开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190711030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-10' or left(a.modifiedon,10) = '2019-07-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190711030041
SQL开始执行时间：20190711030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190711030042
SQL开始执行时间：20190711030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190711030042
SQL开始执行时间：20190711030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-10'
;
SQL结束执行时间：20190711030042
SQL开始执行时间：20190711030042

update edw.crm_accounts set end_dt = '2019-07-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190711030042
SQL开始执行时间：20190711030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190711030042
SQL开始执行时间：20190711030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190711030042

20190712030041开始执行2019-07-11数据加载日志:
SQL开始执行时间：20190712030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-11' or left(a.modifiedon,10) = '2019-07-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190712030041
SQL开始执行时间：20190712030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190712030042
SQL开始执行时间：20190712030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190712030042
SQL开始执行时间：20190712030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-11'
;
SQL结束执行时间：20190712030042
SQL开始执行时间：20190712030042

update edw.crm_accounts set end_dt = '2019-07-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190712030042
SQL开始执行时间：20190712030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190712030042
SQL开始执行时间：20190712030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190712030042

20190713030041开始执行2019-07-12数据加载日志:
SQL开始执行时间：20190713030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-12' or left(a.modifiedon,10) = '2019-07-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190713030041
SQL开始执行时间：20190713030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190713030042
SQL开始执行时间：20190713030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190713030043
SQL开始执行时间：20190713030043
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-12'
;
SQL结束执行时间：20190713030043
SQL开始执行时间：20190713030043

update edw.crm_accounts set end_dt = '2019-07-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190713030043
SQL开始执行时间：20190713030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190713030043
SQL开始执行时间：20190713030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190713030043

20190716030042开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190716030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-15' or left(a.modifiedon,10) = '2019-07-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190716030042
SQL开始执行时间：20190716030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190716030042
SQL开始执行时间：20190716030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190716030043
SQL开始执行时间：20190716030043
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-15'
;
SQL结束执行时间：20190716030043
SQL开始执行时间：20190716030043

update edw.crm_accounts set end_dt = '2019-07-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190716030043
SQL开始执行时间：20190716030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190716030043
SQL开始执行时间：20190716030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190716030043

20190717030042开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190717030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-16' or left(a.modifiedon,10) = '2019-07-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-16'
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042

update edw.crm_accounts set end_dt = '2019-07-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190717030042

20190718030041开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190718030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-17' or left(a.modifiedon,10) = '2019-07-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190718030041
SQL开始执行时间：20190718030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190718030043
SQL开始执行时间：20190718030043

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-17'
;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044

update edw.crm_accounts set end_dt = '2019-07-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190718030044

20190719030044开始执行2019-07-18数据加载日志:
SQL开始执行时间：20190719030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-18' or left(a.modifiedon,10) = '2019-07-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-18'
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044

update edw.crm_accounts set end_dt = '2019-07-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190719030044

20190720030041开始执行2019-07-19数据加载日志:
SQL开始执行时间：20190720030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-19' or left(a.modifiedon,10) = '2019-07-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-19'
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041

update edw.crm_accounts set end_dt = '2019-07-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190720030041

20190721030040开始执行2019-07-20数据加载日志:
SQL开始执行时间：20190721030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-20' or left(a.modifiedon,10) = '2019-07-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-20'
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040

update edw.crm_accounts set end_dt = '2019-07-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190721030040

20190722030042开始执行2019-07-21数据加载日志:
SQL开始执行时间：20190722030042
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-21' or left(a.modifiedon,10) = '2019-07-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190722030042
SQL开始执行时间：20190722030042

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190722030042
SQL开始执行时间：20190722030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190722030042
SQL开始执行时间：20190722030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-21'
;
SQL结束执行时间：20190722030042
SQL开始执行时间：20190722030042

update edw.crm_accounts set end_dt = '2019-07-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190722030043
SQL开始执行时间：20190722030043

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190722030043
SQL开始执行时间：20190722030043

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190722030043

20190723030041开始执行2019-07-22数据加载日志:
SQL开始执行时间：20190723030041
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-22' or left(a.modifiedon,10) = '2019-07-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190723030041
SQL开始执行时间：20190723030041

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190723030042
SQL开始执行时间：20190723030042

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190723030042
SQL开始执行时间：20190723030042
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-22'
;
SQL结束执行时间：20190723030042
SQL开始执行时间：20190723030042

update edw.crm_accounts set end_dt = '2019-07-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190723030042
SQL开始执行时间：20190723030042

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190723030042
SQL开始执行时间：20190723030042

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190723030042

20190724030040开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190724030040
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-23' or left(a.modifiedon,10) = '2019-07-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-23'
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040

update edw.crm_accounts set end_dt = '2019-07-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190724030041

20190725030047开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190725030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-24' or left(a.modifiedon,10) = '2019-07-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047

create temporary table edw.mid1_crm_accounts as
select a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-24'
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047

update edw.crm_accounts set end_dt = '2019-07-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047

insert into edw.crm_accounts
select new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190725030047

20190726030044开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190726030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-25' or left(a.modifiedon,10) = '2019-07-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190726030044
SQL开始执行时间：20190726030044

create temporary table edw.mid1_crm_accounts as
select a.ownerid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190726030044
SQL开始执行时间：20190726030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190726030044
SQL开始执行时间：20190726030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-25'
;
SQL结束执行时间：20190726030044
SQL开始执行时间：20190726030044

update edw.crm_accounts set end_dt = '2019-07-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190726030045
SQL开始执行时间：20190726030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190726030045
SQL开始执行时间：20190726030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190726030045

20190727030044开始执行2019-07-26数据加载日志:
SQL开始执行时间：20190727030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-26' or left(a.modifiedon,10) = '2019-07-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190727030044
SQL开始执行时间：20190727030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190727030044
SQL开始执行时间：20190727030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190727030045
SQL开始执行时间：20190727030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-26'
;
SQL结束执行时间：20190727030045
SQL开始执行时间：20190727030045

update edw.crm_accounts set end_dt = '2019-07-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190727030045
SQL开始执行时间：20190727030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190727030045
SQL开始执行时间：20190727030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190727030045

20190728030044开始执行2019-07-27数据加载日志:
SQL开始执行时间：20190728030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-27' or left(a.modifiedon,10) = '2019-07-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-27'
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044

update edw.crm_accounts set end_dt = '2019-07-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190728030044

20190729030044开始执行2019-07-28数据加载日志:
SQL开始执行时间：20190729030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-28' or left(a.modifiedon,10) = '2019-07-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-28'
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044

update edw.crm_accounts set end_dt = '2019-07-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190729030044

20190730030045开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190730030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-29' or left(a.modifiedon,10) = '2019-07-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190730030045
SQL开始执行时间：20190730030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190730030046
SQL开始执行时间：20190730030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190730030046
SQL开始执行时间：20190730030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-29'
;
SQL结束执行时间：20190730030046
SQL开始执行时间：20190730030046

update edw.crm_accounts set end_dt = '2019-07-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190730030046
SQL开始执行时间：20190730030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190730030046
SQL开始执行时间：20190730030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190730030046

20190731030049开始执行2019-07-30数据加载日志:
SQL开始执行时间：20190731030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-30' or left(a.modifiedon,10) = '2019-07-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-30'
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049

update edw.crm_accounts set end_dt = '2019-07-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190731030049

20190801091151开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190801091151
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-07-31' or left(a.modifiedon,10) = '2019-07-31')
   and a.statecode = '0'
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-07-31'
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151

update edw.crm_accounts set end_dt = '2019-07-31' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190801091151

20190802030044开始执行2019-08-01数据加载日志:
SQL开始执行时间：20190802030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-01' or left(a.modifiedon,10) = '2019-08-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-01'
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044

update edw.crm_accounts set end_dt = '2019-08-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190802030044

20190803030045开始执行2019-08-02数据加载日志:
SQL开始执行时间：20190803030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-02' or left(a.modifiedon,10) = '2019-08-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-02'
;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045

update edw.crm_accounts set end_dt = '2019-08-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190803030045
SQL开始执行时间：20190803030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190803030045

20190804030045开始执行2019-08-03数据加载日志:
SQL开始执行时间：20190804030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-03' or left(a.modifiedon,10) = '2019-08-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-03'
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045

update edw.crm_accounts set end_dt = '2019-08-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190804030045

20190805030045开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190805030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-04' or left(a.modifiedon,10) = '2019-08-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190805030045
SQL开始执行时间：20190805030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190805030046
SQL开始执行时间：20190805030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190805030046
SQL开始执行时间：20190805030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-04'
;
SQL结束执行时间：20190805030046
SQL开始执行时间：20190805030046

update edw.crm_accounts set end_dt = '2019-08-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190805030046
SQL开始执行时间：20190805030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190805030046
SQL开始执行时间：20190805030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190805030046

20190806030045开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190806030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-05' or left(a.modifiedon,10) = '2019-08-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190806030045
SQL开始执行时间：20190806030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190806030046
SQL开始执行时间：20190806030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190806030046
SQL开始执行时间：20190806030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-05'
;
SQL结束执行时间：20190806030046
SQL开始执行时间：20190806030046

update edw.crm_accounts set end_dt = '2019-08-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190806030046
SQL开始执行时间：20190806030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190806030046
SQL开始执行时间：20190806030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190806030046

20190807030045开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190807030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-06' or left(a.modifiedon,10) = '2019-08-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190807030045
SQL开始执行时间：20190807030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190807030046
SQL开始执行时间：20190807030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190807030046
SQL开始执行时间：20190807030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-06'
;
SQL结束执行时间：20190807030046
SQL开始执行时间：20190807030046

update edw.crm_accounts set end_dt = '2019-08-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190807030046
SQL开始执行时间：20190807030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190807030046
SQL开始执行时间：20190807030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190807030046

20190808030045开始执行2019-08-07数据加载日志:
SQL开始执行时间：20190808030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-07' or left(a.modifiedon,10) = '2019-08-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190808030045
SQL开始执行时间：20190808030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190808030046
SQL开始执行时间：20190808030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190808030046
SQL开始执行时间：20190808030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-07'
;
SQL结束执行时间：20190808030046
SQL开始执行时间：20190808030046

update edw.crm_accounts set end_dt = '2019-08-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190808030046
SQL开始执行时间：20190808030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190808030046
SQL开始执行时间：20190808030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190808030046

20190809030044开始执行2019-08-08数据加载日志:
SQL开始执行时间：20190809030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-08' or left(a.modifiedon,10) = '2019-08-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190809030044
SQL开始执行时间：20190809030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190809030045
SQL开始执行时间：20190809030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190809030045
SQL开始执行时间：20190809030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-08'
;
SQL结束执行时间：20190809030045
SQL开始执行时间：20190809030045

update edw.crm_accounts set end_dt = '2019-08-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190809030045
SQL开始执行时间：20190809030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190809030045
SQL开始执行时间：20190809030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190809030045

20190810030046开始执行2019-08-09数据加载日志:
SQL开始执行时间：20190810030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-09' or left(a.modifiedon,10) = '2019-08-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-09'
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047

update edw.crm_accounts set end_dt = '2019-08-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190810030047

20190811030046开始执行2019-08-10数据加载日志:
SQL开始执行时间：20190811030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190811030046
SQL开始执行时间：20190811030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-10' or left(a.modifiedon,10) = '2019-08-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190811030046
SQL开始执行时间：20190811030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190811030047
SQL开始执行时间：20190811030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190811030047
SQL开始执行时间：20190811030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-10'
;
SQL结束执行时间：20190811030047
SQL开始执行时间：20190811030047

update edw.crm_accounts set end_dt = '2019-08-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190811030047
SQL开始执行时间：20190811030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190811030047
SQL开始执行时间：20190811030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190811030047

20190812030045开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190812030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-11' or left(a.modifiedon,10) = '2019-08-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-11'
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045

update edw.crm_accounts set end_dt = '2019-08-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190812030045

20190813030045开始执行2019-08-12数据加载日志:
SQL开始执行时间：20190813030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-12' or left(a.modifiedon,10) = '2019-08-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-12'
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045

update edw.crm_accounts set end_dt = '2019-08-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190813030045

20190814030044开始执行2019-08-13数据加载日志:
SQL开始执行时间：20190814030044
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190814030044
SQL开始执行时间：20190814030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-13' or left(a.modifiedon,10) = '2019-08-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190814030044
SQL开始执行时间：20190814030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190814030045
SQL开始执行时间：20190814030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190814030045
SQL开始执行时间：20190814030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-13'
;
SQL结束执行时间：20190814030045
SQL开始执行时间：20190814030045

update edw.crm_accounts set end_dt = '2019-08-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190814030045
SQL开始执行时间：20190814030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190814030045
SQL开始执行时间：20190814030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190814030045

20190815030046开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190815030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-14' or left(a.modifiedon,10) = '2019-08-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-14'
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046

update edw.crm_accounts set end_dt = '2019-08-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190815030046

20190816030044开始执行2019-08-15数据加载日志:
SQL开始执行时间：20190816030044
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-15' or left(a.modifiedon,10) = '2019-08-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-15'
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044

update edw.crm_accounts set end_dt = '2019-08-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190816030045

20190817030046开始执行2019-08-16数据加载日志:
SQL开始执行时间：20190817030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190817030046
SQL开始执行时间：20190817030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-16' or left(a.modifiedon,10) = '2019-08-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190817030046
SQL开始执行时间：20190817030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190817030046
SQL开始执行时间：20190817030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190817030047
SQL开始执行时间：20190817030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-16'
;
SQL结束执行时间：20190817030047
SQL开始执行时间：20190817030047

update edw.crm_accounts set end_dt = '2019-08-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190817030047
SQL开始执行时间：20190817030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190817030047
SQL开始执行时间：20190817030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190817030047

20190820091705开始执行2019-08-19数据加载日志:
SQL开始执行时间：20190820091705
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190820091705
SQL开始执行时间：20190820091705
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-19' or left(a.modifiedon,10) = '2019-08-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190820091705
SQL开始执行时间：20190820091705

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190820091706
SQL开始执行时间：20190820091706

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190820091706
SQL开始执行时间：20190820091706
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-19'
;
SQL结束执行时间：20190820091706
SQL开始执行时间：20190820091706

update edw.crm_accounts set end_dt = '2019-08-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190820091706
SQL开始执行时间：20190820091706

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190820091706
SQL开始执行时间：20190820091706

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190820091706

20190821030046开始执行2019-08-20数据加载日志:
SQL开始执行时间：20190821030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-20' or left(a.modifiedon,10) = '2019-08-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-20'
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046

update edw.crm_accounts set end_dt = '2019-08-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190821030046

20190822030046开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190822030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-21' or left(a.modifiedon,10) = '2019-08-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-21'
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046

update edw.crm_accounts set end_dt = '2019-08-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190822030046

20190822170332开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190822170332
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-21' or left(a.modifiedon,10) = '2019-08-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-21'
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332

update edw.crm_accounts set end_dt = '2019-08-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190822170354

20190823030045开始执行2019-08-22数据加载日志:
SQL开始执行时间：20190823030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190823030045
SQL开始执行时间：20190823030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-22' or left(a.modifiedon,10) = '2019-08-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-22'
;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046

update edw.crm_accounts set end_dt = '2019-08-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190823030046
SQL开始执行时间：20190823030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190823030046

20190824030044开始执行2019-08-23数据加载日志:
SQL开始执行时间：20190824030044
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190824030044
SQL开始执行时间：20190824030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-23' or left(a.modifiedon,10) = '2019-08-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190824030044
SQL开始执行时间：20190824030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190824030045
SQL开始执行时间：20190824030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190824030045
SQL开始执行时间：20190824030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-23'
;
SQL结束执行时间：20190824030045
SQL开始执行时间：20190824030045

update edw.crm_accounts set end_dt = '2019-08-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190824030045
SQL开始执行时间：20190824030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190824030045
SQL开始执行时间：20190824030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190824030045

20190825030045开始执行2019-08-24数据加载日志:
SQL开始执行时间：20190825030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-24' or left(a.modifiedon,10) = '2019-08-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-24'
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045

update edw.crm_accounts set end_dt = '2019-08-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190825030045

20190826030045开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190826030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-25' or left(a.modifiedon,10) = '2019-08-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-25'
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045

update edw.crm_accounts set end_dt = '2019-08-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190826030045

20190827030045开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190827030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190827030045
SQL开始执行时间：20190827030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-26' or left(a.modifiedon,10) = '2019-08-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190827030045
SQL开始执行时间：20190827030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190827030046
SQL开始执行时间：20190827030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190827030046
SQL开始执行时间：20190827030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-26'
;
SQL结束执行时间：20190827030046
SQL开始执行时间：20190827030046

update edw.crm_accounts set end_dt = '2019-08-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190827030046
SQL开始执行时间：20190827030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190827030046
SQL开始执行时间：20190827030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190827030046

20190828030044开始执行2019-08-27数据加载日志:
SQL开始执行时间：20190828030044
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190828030044
SQL开始执行时间：20190828030044
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-27' or left(a.modifiedon,10) = '2019-08-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190828030044
SQL开始执行时间：20190828030044

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190828030045
SQL开始执行时间：20190828030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190828030045
SQL开始执行时间：20190828030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-27'
;
SQL结束执行时间：20190828030045
SQL开始执行时间：20190828030045

update edw.crm_accounts set end_dt = '2019-08-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190828030045
SQL开始执行时间：20190828030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190828030045
SQL开始执行时间：20190828030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190828030045

20190829030049开始执行2019-08-28数据加载日志:
SQL开始执行时间：20190829030049
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190829030049
SQL开始执行时间：20190829030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-28' or left(a.modifiedon,10) = '2019-08-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190829030049
SQL开始执行时间：20190829030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190829030050
SQL开始执行时间：20190829030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190829030050
SQL开始执行时间：20190829030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-28'
;
SQL结束执行时间：20190829030050
SQL开始执行时间：20190829030050

update edw.crm_accounts set end_dt = '2019-08-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190829030050
SQL开始执行时间：20190829030050

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190829030050
SQL开始执行时间：20190829030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190829030050

20190830030045开始执行2019-08-29数据加载日志:
SQL开始执行时间：20190830030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-29' or left(a.modifiedon,10) = '2019-08-29')
   and a.statecode = '0'
;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-29'
;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045

update edw.crm_accounts set end_dt = '2019-08-29' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190830030046
SQL开始执行时间：20190830030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190830030046
SQL开始执行时间：20190830030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190830030046

20190831030045开始执行2019-08-30数据加载日志:
SQL开始执行时间：20190831030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-30' or left(a.modifiedon,10) = '2019-08-30')
   and a.statecode = '0'
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-30'
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045

update edw.crm_accounts set end_dt = '2019-08-30' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190831030046

20190901030047开始执行2019-08-31数据加载日志:
SQL开始执行时间：20190901030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190901030047
SQL开始执行时间：20190901030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-08-31' or left(a.modifiedon,10) = '2019-08-31')
   and a.statecode = '0'
;
SQL结束执行时间：20190901030047
SQL开始执行时间：20190901030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190901030048
SQL开始执行时间：20190901030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190901030048
SQL开始执行时间：20190901030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-08-31'
;
SQL结束执行时间：20190901030048
SQL开始执行时间：20190901030048

update edw.crm_accounts set end_dt = '2019-08-31' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190901030048
SQL开始执行时间：20190901030048

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190901030048
SQL开始执行时间：20190901030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190901030048

20190902030046开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190902030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190902030046
SQL开始执行时间：20190902030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-01' or left(a.modifiedon,10) = '2019-09-01')
   and a.statecode = '0'
;
SQL结束执行时间：20190902030046
SQL开始执行时间：20190902030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190902030047
SQL开始执行时间：20190902030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190902030047
SQL开始执行时间：20190902030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-01'
;
SQL结束执行时间：20190902030047
SQL开始执行时间：20190902030047

update edw.crm_accounts set end_dt = '2019-09-01' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190902030047
SQL开始执行时间：20190902030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190902030047
SQL开始执行时间：20190902030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190902030047

20190903030045开始执行2019-09-02数据加载日志:
SQL开始执行时间：20190903030045
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190903030045
SQL开始执行时间：20190903030045
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-02' or left(a.modifiedon,10) = '2019-09-02')
   and a.statecode = '0'
;
SQL结束执行时间：20190903030045
SQL开始执行时间：20190903030045

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190903030046
SQL开始执行时间：20190903030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190903030046
SQL开始执行时间：20190903030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-02'
;
SQL结束执行时间：20190903030046
SQL开始执行时间：20190903030046

update edw.crm_accounts set end_dt = '2019-09-02' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190903030046
SQL开始执行时间：20190903030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190903030046
SQL开始执行时间：20190903030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190903030046

20190904030047开始执行2019-09-03数据加载日志:
SQL开始执行时间：20190904030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-03' or left(a.modifiedon,10) = '2019-09-03')
   and a.statecode = '0'
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-03'
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047

update edw.crm_accounts set end_dt = '2019-09-03' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190904030047

20190905030046开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190905030046
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-04' or left(a.modifiedon,10) = '2019-09-04')
   and a.statecode = '0'
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-04'
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046

update edw.crm_accounts set end_dt = '2019-09-04' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190905030046

20190906030047开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190906030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-05' or left(a.modifiedon,10) = '2019-09-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-05'
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047

update edw.crm_accounts set end_dt = '2019-09-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190906030047

20190906171331开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190906171331
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-05' or left(a.modifiedon,10) = '2019-09-05')
   and a.statecode = '0'
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-05'
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331

update edw.crm_accounts set end_dt = '2019-09-05' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190906171331

20190907030047开始执行2019-09-06数据加载日志:
SQL开始执行时间：20190907030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190907030047
SQL开始执行时间：20190907030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-06' or left(a.modifiedon,10) = '2019-09-06')
   and a.statecode = '0'
;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-06'
;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048

update edw.crm_accounts set end_dt = '2019-09-06' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190907030048
SQL开始执行时间：20190907030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190907030048

20190908030047开始执行2019-09-07数据加载日志:
SQL开始执行时间：20190908030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-07' or left(a.modifiedon,10) = '2019-09-07')
   and a.statecode = '0'
;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-07'
;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047

update edw.crm_accounts set end_dt = '2019-09-07' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190908030048
SQL开始执行时间：20190908030048

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190908030048
SQL开始执行时间：20190908030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190908030048

20190909030047开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190909030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190909030047
SQL开始执行时间：20190909030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-08' or left(a.modifiedon,10) = '2019-09-08')
   and a.statecode = '0'
;
SQL结束执行时间：20190909030047
SQL开始执行时间：20190909030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190909030048
SQL开始执行时间：20190909030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190909030048
SQL开始执行时间：20190909030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-08'
;
SQL结束执行时间：20190909030048
SQL开始执行时间：20190909030048

update edw.crm_accounts set end_dt = '2019-09-08' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190909030048
SQL开始执行时间：20190909030048

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190909030048
SQL开始执行时间：20190909030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190909030048

20190910030047开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190910030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190910030047
SQL开始执行时间：20190910030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-09' or left(a.modifiedon,10) = '2019-09-09')
   and a.statecode = '0'
;
SQL结束执行时间：20190910030047
SQL开始执行时间：20190910030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190910030048
SQL开始执行时间：20190910030048

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190910030048
SQL开始执行时间：20190910030048
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-09'
;
SQL结束执行时间：20190910030048
SQL开始执行时间：20190910030048

update edw.crm_accounts set end_dt = '2019-09-09' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190910030048
SQL开始执行时间：20190910030048

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190910030048
SQL开始执行时间：20190910030048

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190910030048

20190911030048开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190911030048
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190911030048
SQL开始执行时间：20190911030048
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-10' or left(a.modifiedon,10) = '2019-09-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190911030048
SQL开始执行时间：20190911030048

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190911030055
SQL开始执行时间：20190911030055

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190911030056
SQL开始执行时间：20190911030056
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-10'
;
SQL结束执行时间：20190911030056
SQL开始执行时间：20190911030056

update edw.crm_accounts set end_dt = '2019-09-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190911030056
SQL开始执行时间：20190911030056

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190911030056
SQL开始执行时间：20190911030056

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190911030056

20190911163302开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190911163302
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190911163302
SQL开始执行时间：20190911163302
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-10' or left(a.modifiedon,10) = '2019-09-10')
   and a.statecode = '0'
;
SQL结束执行时间：20190911163302
SQL开始执行时间：20190911163302

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190911163304
SQL开始执行时间：20190911163304

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190911163304
SQL开始执行时间：20190911163304
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-10'
;
SQL结束执行时间：20190911163304
SQL开始执行时间：20190911163304

update edw.crm_accounts set end_dt = '2019-09-10' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190911163304
SQL开始执行时间：20190911163304

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190911163304
SQL开始执行时间：20190911163304

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190911163304

20190912030047开始执行2019-09-11数据加载日志:
SQL开始执行时间：20190912030047
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190912030047
SQL开始执行时间：20190912030047
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-11' or left(a.modifiedon,10) = '2019-09-11')
   and a.statecode = '0'
;
SQL结束执行时间：20190912030047
SQL开始执行时间：20190912030047

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190912030053
SQL开始执行时间：20190912030053

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190912030053
SQL开始执行时间：20190912030053
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-11'
;
SQL结束执行时间：20190912030053
SQL开始执行时间：20190912030053

update edw.crm_accounts set end_dt = '2019-09-11' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190912030054
SQL开始执行时间：20190912030054

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190912030054
SQL开始执行时间：20190912030054

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190912030054

20190913030054开始执行2019-09-12数据加载日志:
SQL开始执行时间：20190913030054
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190913030054
SQL开始执行时间：20190913030054
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-12' or left(a.modifiedon,10) = '2019-09-12')
   and a.statecode = '0'
;
SQL结束执行时间：20190913030054
SQL开始执行时间：20190913030054

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190913030055
SQL开始执行时间：20190913030055

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190913030055
SQL开始执行时间：20190913030055
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-12'
;
SQL结束执行时间：20190913030055
SQL开始执行时间：20190913030055

update edw.crm_accounts set end_dt = '2019-09-12' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190913030055
SQL开始执行时间：20190913030055

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190913030055
SQL开始执行时间：20190913030055

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190913030055

20190914030049开始执行2019-09-13数据加载日志:
SQL开始执行时间：20190914030049
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-13' or left(a.modifiedon,10) = '2019-09-13')
   and a.statecode = '0'
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-13'
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049

update edw.crm_accounts set end_dt = '2019-09-13' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190914030049

20190915030049开始执行2019-09-14数据加载日志:
SQL开始执行时间：20190915030049
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-14' or left(a.modifiedon,10) = '2019-09-14')
   and a.statecode = '0'
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-14'
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049

update edw.crm_accounts set end_dt = '2019-09-14' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190915030049

20190916030050开始执行2019-09-15数据加载日志:
SQL开始执行时间：20190916030050
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190916030050
SQL开始执行时间：20190916030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-15' or left(a.modifiedon,10) = '2019-09-15')
   and a.statecode = '0'
;
SQL结束执行时间：20190916030050
SQL开始执行时间：20190916030050

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190916030050
SQL开始执行时间：20190916030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190916030051
SQL开始执行时间：20190916030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-15'
;
SQL结束执行时间：20190916030051
SQL开始执行时间：20190916030051

update edw.crm_accounts set end_dt = '2019-09-15' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190916030051
SQL开始执行时间：20190916030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190916030051
SQL开始执行时间：20190916030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190916030051

20190917030052开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190917030052
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-16' or left(a.modifiedon,10) = '2019-09-16')
   and a.statecode = '0'
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-16'
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052

update edw.crm_accounts set end_dt = '2019-09-16' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190917030052

20190918030051开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190918030051
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-17' or left(a.modifiedon,10) = '2019-09-17')
   and a.statecode = '0'
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-17'
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051

update edw.crm_accounts set end_dt = '2019-09-17' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190918030051

20190919030050开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190919030050
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190919030050
SQL开始执行时间：20190919030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-18' or left(a.modifiedon,10) = '2019-09-18')
   and a.statecode = '0'
;
SQL结束执行时间：20190919030050
SQL开始执行时间：20190919030050

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190919030050
SQL开始执行时间：20190919030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190919030051
SQL开始执行时间：20190919030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-18'
;
SQL结束执行时间：20190919030051
SQL开始执行时间：20190919030051

update edw.crm_accounts set end_dt = '2019-09-18' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190919030051
SQL开始执行时间：20190919030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190919030051
SQL开始执行时间：20190919030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190919030051

20190920030050开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190920030050
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190920030050
SQL开始执行时间：20190920030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-19' or left(a.modifiedon,10) = '2019-09-19')
   and a.statecode = '0'
;
SQL结束执行时间：20190920030050
SQL开始执行时间：20190920030050

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190920030051
SQL开始执行时间：20190920030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190920030051
SQL开始执行时间：20190920030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-19'
;
SQL结束执行时间：20190920030051
SQL开始执行时间：20190920030051

update edw.crm_accounts set end_dt = '2019-09-19' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190920030051
SQL开始执行时间：20190920030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190920030051
SQL开始执行时间：20190920030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190920030051

20190921030051开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190921030051
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-20' or left(a.modifiedon,10) = '2019-09-20')
   and a.statecode = '0'
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-20'
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051

update edw.crm_accounts set end_dt = '2019-09-20' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190921030051

20190922030052开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190922030052
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-21' or left(a.modifiedon,10) = '2019-09-21')
   and a.statecode = '0'
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-21'
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052

update edw.crm_accounts set end_dt = '2019-09-21' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190922030052

20190923030049开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190923030049
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190923030049
SQL开始执行时间：20190923030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-22' or left(a.modifiedon,10) = '2019-09-22')
   and a.statecode = '0'
;
SQL结束执行时间：20190923030049
SQL开始执行时间：20190923030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190923030050
SQL开始执行时间：20190923030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190923030050
SQL开始执行时间：20190923030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-22'
;
SQL结束执行时间：20190923030050
SQL开始执行时间：20190923030050

update edw.crm_accounts set end_dt = '2019-09-22' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190923030050
SQL开始执行时间：20190923030050

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190923030050
SQL开始执行时间：20190923030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190923030050

20190924030051开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190924030051
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190924030051
SQL开始执行时间：20190924030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-23' or left(a.modifiedon,10) = '2019-09-23')
   and a.statecode = '0'
;
SQL结束执行时间：20190924030051
SQL开始执行时间：20190924030051

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190924030052
SQL开始执行时间：20190924030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190924030052
SQL开始执行时间：20190924030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-23'
;
SQL结束执行时间：20190924030052
SQL开始执行时间：20190924030052

update edw.crm_accounts set end_dt = '2019-09-23' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190924030052
SQL开始执行时间：20190924030052

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190924030052
SQL开始执行时间：20190924030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190924030052

20190925030052开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190925030052
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-24' or left(a.modifiedon,10) = '2019-09-24')
   and a.statecode = '0'
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-24'
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052

update edw.crm_accounts set end_dt = '2019-09-24' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190925030052

20190926030049开始执行2019-09-25数据加载日志:
SQL开始执行时间：20190926030049
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190926030049
SQL开始执行时间：20190926030049
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-25' or left(a.modifiedon,10) = '2019-09-25')
   and a.statecode = '0'
;
SQL结束执行时间：20190926030049
SQL开始执行时间：20190926030049

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190926030050
SQL开始执行时间：20190926030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190926030050
SQL开始执行时间：20190926030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-25'
;
SQL结束执行时间：20190926030050
SQL开始执行时间：20190926030050

update edw.crm_accounts set end_dt = '2019-09-25' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190926030050
SQL开始执行时间：20190926030050

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190926030050
SQL开始执行时间：20190926030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190926030050

20190927030050开始执行2019-09-26数据加载日志:
SQL开始执行时间：20190927030050
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-26' or left(a.modifiedon,10) = '2019-09-26')
   and a.statecode = '0'
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-26'
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050

update edw.crm_accounts set end_dt = '2019-09-26' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190927030050

20190928030050开始执行2019-09-27数据加载日志:
SQL开始执行时间：20190928030050
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190928030050
SQL开始执行时间：20190928030050
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-27' or left(a.modifiedon,10) = '2019-09-27')
   and a.statecode = '0'
;
SQL结束执行时间：20190928030050
SQL开始执行时间：20190928030050

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190928030051
SQL开始执行时间：20190928030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190928030051
SQL开始执行时间：20190928030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-27'
;
SQL结束执行时间：20190928030051
SQL开始执行时间：20190928030051

update edw.crm_accounts set end_dt = '2019-09-27' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190928030051
SQL开始执行时间：20190928030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190928030051
SQL开始执行时间：20190928030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190928030051

20190929030051开始执行2019-09-28数据加载日志:
SQL开始执行时间：20190929030051
update ufdata.crm_accounts set statecode = '0' where accountid = '8ef218e9-9e75-e811-80c6-0050569a5e34'
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051
create temporary table edw.crm_accounts_pre as
select * 
  from ufdata.crm_accounts a
 where (left(a.createdon,10) = '2019-09-28' or left(a.modifiedon,10) = '2019-09-28')
   and a.statecode = '0'
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051

create temporary table edw.mid1_crm_accounts as
select a.accountid as crm_num
      ,a.new_num
      ,a.new_erp_num
      ,a.new_oa_id
      ,a.NAME
      ,a.new_ccusabbname
      ,case when a.new_type = 1 then '医院/终端'
            when a.new_type = 2 then '公卫'
            when a.new_type = 3 then '政府'
            when a.new_type = 4 then '渠道/代理'
            when a.new_type = 5 then '关联公司' else '未知' end as new_type
      ,case when a.new_account = 1 then '未占有'
            when a.new_account = 2 then '已占有'
            when a.new_account = 3 then '已发货' else '未知' end as new_account
      ,a.new_other_name
      ,a.parentaccountid
      ,a.websiteurl
      ,a.new_autonomic
      ,c.name as new_area
      ,b.new_name as new_province
      ,d.new_name as new_city
      ,e.new_name as new_county
      ,a.new_ccusoaddress
      ,f.lastname as ownerid
      ,a.new_develop_date
      ,a.new_hint
      ,case when a.new_grade = 1 then 'V VIP'
            when a.new_grade = 2 then 'V+ VIP'
            when a.new_grade = 3 then 'VIP'
            when a.new_grade = 4 then '一般客户'
            when a.new_grade = 5 then '其他' else '未知' end as new_grade
      ,case when a.new_hierarchy = 1 then '省级'
            when a.new_hierarchy = 2 then '市级'
            when a.new_hierarchy = 3 then '区县级'
            when a.new_hierarchy = 4 then '区县级以下' else '未知' end as new_hierarchy
      ,case when a.new_nature = 1 then '综合医院'
            when a.new_nature = 2 then '妇幼体系'
            when a.new_nature = 3 then '中医院'
            when a.new_nature = 4 then '其他' else '未知' end as new_nature
      ,case when a.new_enterprise_type = 1 then '公立'
            when a.new_enterprise_type = 2 then '私立' else '未知' end as new_enterprise_type
      ,case when a.new_hospital_level = 11 then '一甲'
            when a.new_hospital_level = 12 then '一乙'
            when a.new_hospital_level = 13 then '一丙'
            when a.new_hospital_level = 14 then '未定级'
            when a.new_hospital_level = 21 then '二甲'
            when a.new_hospital_level = 22 then '二乙'
            when a.new_hospital_level = 23 then '二丙'
            when a.new_hospital_level = 31 then '三甲'
            when a.new_hospital_level = 32 then '三乙'
            when a.new_hospital_level = 33 then '三丙'  else '未知' end as new_hospital_level
      ,a.new_credit_status
      ,a.new_xs
      ,a.new_xsc
      ,a.new_cs
      ,a.new_csc
      ,a.new_cz
      ,a.new_czc
      ,case when a.new_pcr = 1 then '有'
            when a.new_pcr = 2 then '无'
            when a.new_pcr = 3 then '正在申请' else '未知' end as new_pcr
      ,a.new_gspp9
      ,g.lastname as createdby
      ,a.createdon
      ,h.lastname as modifiedby
      ,a.modifiedon
      ,a.customertypecode
      ,case when a.statecode = 0 then '可用'
            when a.statecode = 1 then '不可用' else '未知' end as statecode
      ,case when a.statuscode = 1 then '可用'
            when a.statuscode = 2 then '不可用' else '未知' end as statuscode
      ,a.sys_time
  from edw.crm_accounts_pre a
	left join ufdata.crm_sales_areas b
	  on a.new_province = b.new_siteid
	left join edw.dic_crm c
	  on a.new_area = c.id
	left join ufdata.crm_sales_areas d
	  on a.new_city = d.new_siteid
	left join ufdata.crm_sales_areas e
	  on a.new_county = e.new_siteid
	left join ufdata.crm_systemusers f
	  on a.ownerid = f.ownerid
	left join ufdata.crm_systemusers g
	  on a.createdby = g.ownerid
	left join ufdata.crm_systemusers h
	  on a.modifiedby = h.ownerid

;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051

delete from edw.crm_accounts where end_dt = '3000-12-31' and new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051
update edw.crm_accounts set end_dt = '3000-12-31' where end_dt = '2019-09-28'
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051

update edw.crm_accounts set end_dt = '2019-09-28' where new_num in (select new_num from edw.mid1_crm_accounts)
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051

insert into edw.crm_accounts
select crm_num 
      ,new_num
      ,'3000-12-31'
      ,new_erp_num
      ,new_oa_id
      ,NAME
      ,new_ccusabbname
      ,new_type
      ,new_account
      ,new_other_name
      ,parentaccountid
      ,websiteurl
      ,new_autonomic
      ,new_area
      ,new_province
      ,new_city
      ,new_county
      ,new_ccusoaddress
      ,ownerid
      ,new_develop_date
      ,new_hint
      ,new_grade
      ,new_hierarchy
      ,new_nature
      ,new_enterprise_type
      ,new_hospital_level
      ,new_credit_status
      ,new_xs
      ,new_xsc
      ,new_cs
      ,new_csc
      ,new_cz
      ,new_czc
      ,new_pcr
      ,new_gspp9
      ,createdby
      ,createdon
      ,modifiedby
      ,modifiedon
      ,customertypecode
      ,statecode
      ,statuscode
      ,localtimestamp() as sys_time
  from edw.mid1_crm_accounts
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051

update edw.map_customer a
inner join (select * from edw.dic_customer group by bi_cuscode) b
  on a.bi_cuscode = b.bi_cuscode
inner join (select * from edw.mid1_crm_accounts group by new_num) c
  on b.ccuscode = c.new_num
set a.ccusgrade          = c.new_grade
   ,a.cus_type           = c.new_enterprise_type
   ,a.ccus_Hierarchy     = c.new_hierarchy
   ,a.Hospital_grade     = c.new_hospital_level
   ,a.cus_nature         = c.new_nature
   ,a.Credit_rating      = c.new_credit_status
   ,a.ccus_sname         = c.new_ccusabbname
   ,a.ccus_uname         = c.new_other_name
   ,a.nsieve_mechanism   = c.new_xs
   ,a.medical_mechanism  = c.new_cz
   ,a.screen_mechanism   = c.new_cs
   ,a.license_plate      = c.new_pcr
   ,a.ccsu_strdate       = c.new_develop_date 
   ,a.ccus_situation     = c.new_account

;
SQL结束执行时间：20190929030051
