
20190917013311开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190917013311

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190917013312
SQL开始执行时间：20190917013312

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190917013313
SQL开始执行时间：20190917013313

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190917013320
SQL开始执行时间：20190917013320
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190917013322
SQL开始执行时间：20190917013322




set @n = 99999
;
SQL结束执行时间：20190917013322
SQL开始执行时间：20190917013322
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190917013325
SQL开始执行时间：20190917013325
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,b.finnal_cuscode
      ,b.finnal_ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190917013327

20190918013249开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190918013249

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190918013250
SQL开始执行时间：20190918013250

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190918013250
SQL开始执行时间：20190918013250

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190918013257
SQL开始执行时间：20190918013257
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190918013300
SQL开始执行时间：20190918013300




set @n = 99999
;
SQL结束执行时间：20190918013300
SQL开始执行时间：20190918013300
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190918013304
SQL开始执行时间：20190918013304
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,b.finnal_cuscode
      ,b.finnal_ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190918013305

20190919013253开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190919013253

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190919013253
SQL开始执行时间：20190919013253

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190919013254
SQL开始执行时间：20190919013254

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190919013300
SQL开始执行时间：20190919013300
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190919013302
SQL开始执行时间：20190919013302




set @n = 99999
;
SQL结束执行时间：20190919013302
SQL开始执行时间：20190919013302
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190919013306
SQL开始执行时间：20190919013306
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,b.finnal_cuscode
      ,b.finnal_ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190919013308

20190920013246开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190920013246

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190920013247
SQL开始执行时间：20190920013247

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190920013247
SQL开始执行时间：20190920013247

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190920013253
SQL开始执行时间：20190920013253
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190920013256
SQL开始执行时间：20190920013256




set @n = 99999
;
SQL结束执行时间：20190920013256
SQL开始执行时间：20190920013256
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190920013300
SQL开始执行时间：20190920013300
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190920013301

20190921013252开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190921013252

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190921013253
SQL开始执行时间：20190921013253

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190921013253
SQL开始执行时间：20190921013253

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190921013300
SQL开始执行时间：20190921013300
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190921013302
SQL开始执行时间：20190921013302




set @n = 99999
;
SQL结束执行时间：20190921013302
SQL开始执行时间：20190921013302
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190921013306
SQL开始执行时间：20190921013306
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190921013307

20190922013239开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190922013239

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190922013240
SQL开始执行时间：20190922013240

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190922013240
SQL开始执行时间：20190922013240

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190922013247
SQL开始执行时间：20190922013247
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190922013250
SQL开始执行时间：20190922013250




set @n = 99999
;
SQL结束执行时间：20190922013250
SQL开始执行时间：20190922013250
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190922013253
SQL开始执行时间：20190922013253
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190922013255

20190923013237开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190923013237

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190923013237
SQL开始执行时间：20190923013237

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190923013238
SQL开始执行时间：20190923013238

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190923013244
SQL开始执行时间：20190923013244
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190923013248
SQL开始执行时间：20190923013248




set @n = 99999
;
SQL结束执行时间：20190923013248
SQL开始执行时间：20190923013248
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190923013252
SQL开始执行时间：20190923013252
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190923013254

20190924013312开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190924013312

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190924013313
SQL开始执行时间：20190924013313

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190924013314
SQL开始执行时间：20190924013314

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190924013320
SQL开始执行时间：20190924013320
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190924013323
SQL开始执行时间：20190924013323




set @n = 99999
;
SQL结束执行时间：20190924013323
SQL开始执行时间：20190924013323
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190924013328
SQL开始执行时间：20190924013328
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190924013330

20190925013313开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190925013313

create temporary table pdm.x_outdepot_history as
select a.*
      ,b.type as ccustype
  from edw.x_outdepot_history a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
 where year(ddate) < 2018
;
SQL结束执行时间：20190925013314
SQL开始执行时间：20190925013314

create temporary table pdm.outdepot_order_item as
select e.bi_cinvcode
      ,e.business_class
      ,e.cinvbrand
      ,e.item_code
      ,f.plan_class
      ,f.key_project
   from (select bi_cinvcode,item_code,business_class,cinvbrand from edw.map_inventory group by bi_cinvcode) e
   left join (select ccuscode,true_item_code,plan_class,key_project from edw.x_sales_budget_18 group by ccuscode,true_item_code) f
    on e.item_code = f.true_item_code

;
SQL结束执行时间：20190925013314
SQL开始执行时间：20190925013314

delete from pdm.outdepot_order where db = 'old'
;
SQL结束执行时间：20190925013321
SQL开始执行时间：20190925013321
insert into pdm.outdepot_order
select null
      ,a.auto_id
      ,'old'
      ,'博圣'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,a.cverifier
      ,b.sales_region
      ,b.province
      ,b.city
      ,a.ccustype
      ,a.true_ccuscode as ccuscode
      ,a.true_ccusname as ccusname
      ,a.true_finnal_ccuscode as finnal_ccuscode
      ,a.true_finnal_ccusname as finnal_ccusname
      ,e.business_class
      ,null
      ,a.true_cinvcode as cinvcode
      ,a.true_cinvname as cinvname
      ,a.price1
      ,case when a.iquantity is null and g.inum_unit_person > 0 then a.inum_person/g.inum_unit_person
            when a.iquantity is null and g.inum_unit_person is null then '请核查'
            else a.iquantity end as iquantity
      ,null
      ,a.inum_person
      ,g.item_code
      ,e.plan_class
      ,e.key_project
      ,g.level_three
      ,null
      ,e.cinvbrand
      ,null
      ,null
      ,localtimestamp()
  from pdm.x_outdepot_history a
  left join edw.map_customer b
    on a.true_finnal_ccuscode = b.bi_cuscode 
  left join (select bi_cinvcode,plan_class,key_project,business_class,cinvbrand from pdm.outdepot_order_item group by bi_cinvcode) e
    on a.true_cinvcode = e.bi_cinvcode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.true_item_code = f.item_code
  left join (select * from edw.map_inventory group by bi_cinvcode) g
    on a.true_cinvcode = g.bi_cinvcode

;
SQL结束执行时间：20190925013324
SQL开始执行时间：20190925013324




set @n = 99999
;
SQL结束执行时间：20190925013324
SQL开始执行时间：20190925013324
delete from pdm.outdepot_order where db = 'bkgr'
;
SQL结束执行时间：20190925013329
SQL开始执行时间：20190925013329
insert into pdm.outdepot_order
select null
      ,(@n := @n + 1) as id
      ,'bkgr'
      ,'贝康个人'
      ,null
      ,a.ddate
      ,null
      ,null
      ,null
      ,null
      ,null
      ,b.sales_region
      ,b.province
      ,b.city
      ,b.type
      ,a.ccuscode
      ,a.ccusname
      ,a.ccuscode
      ,a.ccusname
      ,'LDT'
      ,null
      ,a.cinvcode
      ,a.cinvname
      ,null
      ,case when g.inum_unit_person > 0 then inum_person/g.inum_unit_person
            when g.inum_unit_person is null then inum_person -- 这里存在一点瑕疵
            else inum_person end as iquantity
      ,null
      ,a.inum_person
      ,a.item_code
      ,null
      ,null
      ,case when f.item_code is not null then f.level_three end 
      ,null
      ,null
      ,null
      ,null
      ,localtimestamp()
  from pdm.checklist a
  left join edw.map_customer b
    on a.ccuscode = b.bi_cuscode
  left join (select item_code,level_three from edw.map_item group by item_code) f
    on a.item_code = f.item_code
  left join (select bi_cinvcode,inum_unit_person from edw.map_inventory group by bi_cinvcode) g
    on a.cinvcode = g.bi_cinvcode
 where left(ccuscode,2) <> 'GL' 
   and a.cbustype = 'LDT'
   and a.competitor = '否'

;
SQL结束执行时间：20190925013331
