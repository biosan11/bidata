
20190523102000开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190523102000

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190523102000
SQL开始执行时间：20190523102000



drop table if exists edw.employment_record
;
SQL结束执行时间：20190523102000
SQL开始执行时间：20190523102000
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190523102002
SQL开始执行时间：20190523102002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190523102008
SQL开始执行时间：20190523102008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190523102008
SQL开始执行时间：20190523102008
insert into edw.ehr_employee_id
select distinct * 
  from edw.mid1_ehr_employee_id
;
SQL结束执行时间：20190523102008

20190523102908开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190523102908

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190523102908
SQL开始执行时间：20190523102908



drop table if exists edw.employment_record
;
SQL结束执行时间：20190523102908
SQL开始执行时间：20190523102908
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190523102910
SQL开始执行时间：20190523102910



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190523102915
SQL开始执行时间：20190523102915


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190523102915
SQL开始执行时间：20190523102915
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190523102916

20190523105919开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190523105919

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190523105919
SQL开始执行时间：20190523105919



drop table if exists edw.employment_record
;
SQL结束执行时间：20190523105919
SQL开始执行时间：20190523105919
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190523105921
SQL开始执行时间：20190523105921



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190523105926
SQL开始执行时间：20190523105926


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190523105926
SQL开始执行时间：20190523105926
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190523105927

20190524015921开始执行2019-05-24数据加载日志:
SQL开始执行时间：20190524015921

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190524015921
SQL开始执行时间：20190524015921



drop table if exists edw.employment_record
;
SQL结束执行时间：20190524015921
SQL开始执行时间：20190524015921
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190524015923
SQL开始执行时间：20190524015923



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190524015929
SQL开始执行时间：20190524015929


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190524015929
SQL开始执行时间：20190524015929
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190524015929

20190525015919开始执行2019-05-25数据加载日志:
SQL开始执行时间：20190525015919

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190525015919
SQL开始执行时间：20190525015919



drop table if exists edw.employment_record
;
SQL结束执行时间：20190525015919
SQL开始执行时间：20190525015919
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190525015921
SQL开始执行时间：20190525015921



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190525015927
SQL开始执行时间：20190525015927


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190525015927
SQL开始执行时间：20190525015927
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190525015927

20190526015938开始执行2019-05-26数据加载日志:
SQL开始执行时间：20190526015938

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190526015938
SQL开始执行时间：20190526015938



drop table if exists edw.employment_record
;
SQL结束执行时间：20190526015938
SQL开始执行时间：20190526015938
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190526015940
SQL开始执行时间：20190526015940



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190526015946
SQL开始执行时间：20190526015946


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190526015946
SQL开始执行时间：20190526015946
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190526015946

20190527015917开始执行2019-05-27数据加载日志:
SQL开始执行时间：20190527015917

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190527015917
SQL开始执行时间：20190527015917



drop table if exists edw.employment_record
;
SQL结束执行时间：20190527015917
SQL开始执行时间：20190527015917
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190527015919
SQL开始执行时间：20190527015919



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190527015925
SQL开始执行时间：20190527015925


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190527015925
SQL开始执行时间：20190527015925
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190527015925

20190527104947开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190527104947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190527104947
SQL开始执行时间：20190527104947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190527104947
SQL开始执行时间：20190527104947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190527104949
SQL开始执行时间：20190527104949



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190527104955
SQL开始执行时间：20190527104955


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190527104955
SQL开始执行时间：20190527104955
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190527104955

20190528015921开始执行2019-05-28数据加载日志:
SQL开始执行时间：20190528015921

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190528015921
SQL开始执行时间：20190528015921



drop table if exists edw.employment_record
;
SQL结束执行时间：20190528015921
SQL开始执行时间：20190528015921
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190528015923
SQL开始执行时间：20190528015923



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190528015929
SQL开始执行时间：20190528015929


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190528015929
SQL开始执行时间：20190528015929
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190528015929

20190529015917开始执行2019-05-29数据加载日志:
SQL开始执行时间：20190529015917

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190529015917
SQL开始执行时间：20190529015917



drop table if exists edw.employment_record
;
SQL结束执行时间：20190529015917
SQL开始执行时间：20190529015917
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190529015920
SQL开始执行时间：20190529015920



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190529015925
SQL开始执行时间：20190529015925


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190529015925
SQL开始执行时间：20190529015925
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190529015926

20190530015922开始执行2019-05-30数据加载日志:
SQL开始执行时间：20190530015922

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190530015922
SQL开始执行时间：20190530015922



drop table if exists edw.employment_record
;
SQL结束执行时间：20190530015922
SQL开始执行时间：20190530015922
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190530015924
SQL开始执行时间：20190530015924



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190530015930
SQL开始执行时间：20190530015930


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190530015930
SQL开始执行时间：20190530015930
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190530015930

20190531015923开始执行2019-05-31数据加载日志:
SQL开始执行时间：20190531015923

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190531015923
SQL开始执行时间：20190531015923



drop table if exists edw.employment_record
;
SQL结束执行时间：20190531015923
SQL开始执行时间：20190531015923
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190531015925
SQL开始执行时间：20190531015925



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190531015931
SQL开始执行时间：20190531015931


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190531015931
SQL开始执行时间：20190531015931
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190531015931

20190601015934开始执行2019-06-01数据加载日志:
SQL开始执行时间：20190601015934

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190601015934
SQL开始执行时间：20190601015934



drop table if exists edw.employment_record
;
SQL结束执行时间：20190601015934
SQL开始执行时间：20190601015934
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190601015936
SQL开始执行时间：20190601015936



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190601015942
SQL开始执行时间：20190601015942


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190601015942
SQL开始执行时间：20190601015942
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190601015942

20190602015925开始执行2019-06-02数据加载日志:
SQL开始执行时间：20190602015925

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190602015925
SQL开始执行时间：20190602015925



drop table if exists edw.employment_record
;
SQL结束执行时间：20190602015925
SQL开始执行时间：20190602015925
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190602015927
SQL开始执行时间：20190602015927



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190602015933
SQL开始执行时间：20190602015933


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190602015933
SQL开始执行时间：20190602015933
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190602015933

20190603015926开始执行2019-06-03数据加载日志:
SQL开始执行时间：20190603015926

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190603015926
SQL开始执行时间：20190603015926



drop table if exists edw.employment_record
;
SQL结束执行时间：20190603015926
SQL开始执行时间：20190603015926
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190603015928
SQL开始执行时间：20190603015928



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190603015934
SQL开始执行时间：20190603015934


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190603015934
SQL开始执行时间：20190603015934
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190603015934

20190604015938开始执行2019-06-04数据加载日志:
SQL开始执行时间：20190604015938

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190604015938
SQL开始执行时间：20190604015938



drop table if exists edw.employment_record
;
SQL结束执行时间：20190604015938
SQL开始执行时间：20190604015938
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190604015940
SQL开始执行时间：20190604015940



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190604015946
SQL开始执行时间：20190604015946


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190604015946
SQL开始执行时间：20190604015946
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190604015946

20190605015949开始执行2019-06-05数据加载日志:
SQL开始执行时间：20190605015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190605015949
SQL开始执行时间：20190605015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190605015949
SQL开始执行时间：20190605015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190605015951
SQL开始执行时间：20190605015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190605015957
SQL开始执行时间：20190605015957


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190605015957
SQL开始执行时间：20190605015957
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190605015957

20190606015932开始执行2019-06-06数据加载日志:
SQL开始执行时间：20190606015932

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190606015932
SQL开始执行时间：20190606015932



drop table if exists edw.employment_record
;
SQL结束执行时间：20190606015932
SQL开始执行时间：20190606015932
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190606015934
SQL开始执行时间：20190606015934



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190606015940
SQL开始执行时间：20190606015940


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190606015940
SQL开始执行时间：20190606015940
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190606015940

20190607015927开始执行2019-06-07数据加载日志:
SQL开始执行时间：20190607015927

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190607015927
SQL开始执行时间：20190607015927



drop table if exists edw.employment_record
;
SQL结束执行时间：20190607015927
SQL开始执行时间：20190607015927
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190607015930
SQL开始执行时间：20190607015930



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190607015935
SQL开始执行时间：20190607015935


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190607015935
SQL开始执行时间：20190607015935
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190607015936

20190608015932开始执行2019-06-08数据加载日志:
SQL开始执行时间：20190608015932

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190608015932
SQL开始执行时间：20190608015932



drop table if exists edw.employment_record
;
SQL结束执行时间：20190608015932
SQL开始执行时间：20190608015932
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190608015934
SQL开始执行时间：20190608015934



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190608015940
SQL开始执行时间：20190608015940


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190608015940
SQL开始执行时间：20190608015940
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190608015940

20190609015932开始执行2019-06-09数据加载日志:
SQL开始执行时间：20190609015932

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190609015932
SQL开始执行时间：20190609015932



drop table if exists edw.employment_record
;
SQL结束执行时间：20190609015932
SQL开始执行时间：20190609015932
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190609015934
SQL开始执行时间：20190609015934



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190609015940
SQL开始执行时间：20190609015940


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190609015940
SQL开始执行时间：20190609015940
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190609015940

20190610015953开始执行2019-06-10数据加载日志:
SQL开始执行时间：20190610015953

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190610015953
SQL开始执行时间：20190610015953



drop table if exists edw.employment_record
;
SQL结束执行时间：20190610015953
SQL开始执行时间：20190610015953
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190610015955
SQL开始执行时间：20190610015955



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190610020001
SQL开始执行时间：20190610020001


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190610020001
SQL开始执行时间：20190610020001
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190610020001

20190611015925开始执行2019-06-11数据加载日志:
SQL开始执行时间：20190611015925

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190611015925
SQL开始执行时间：20190611015925



drop table if exists edw.employment_record
;
SQL结束执行时间：20190611015925
SQL开始执行时间：20190611015925
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190611015927
SQL开始执行时间：20190611015927



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190611015933
SQL开始执行时间：20190611015933


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190611015933
SQL开始执行时间：20190611015933
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190611015933

20190612020002开始执行2019-06-12数据加载日志:
SQL开始执行时间：20190612020002

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190612020003
SQL开始执行时间：20190612020003



drop table if exists edw.employment_record
;
SQL结束执行时间：20190612020003
SQL开始执行时间：20190612020003
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190612020005
SQL开始执行时间：20190612020005



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190612020011
SQL开始执行时间：20190612020011


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190612020011
SQL开始执行时间：20190612020011
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190612020011

20190613015956开始执行2019-06-13数据加载日志:
SQL开始执行时间：20190613015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190613015956
SQL开始执行时间：20190613015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190613015956
SQL开始执行时间：20190613015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190613015958
SQL开始执行时间：20190613015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190613020004
SQL开始执行时间：20190613020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190613020004
SQL开始执行时间：20190613020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190613020004

20190614015955开始执行2019-06-14数据加载日志:
SQL开始执行时间：20190614015955

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190614015955
SQL开始执行时间：20190614015955



drop table if exists edw.employment_record
;
SQL结束执行时间：20190614015955
SQL开始执行时间：20190614015955
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190614015957
SQL开始执行时间：20190614015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190614020003
SQL开始执行时间：20190614020003


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190614020003
SQL开始执行时间：20190614020003
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190614020004

20190615015951开始执行2019-06-15数据加载日志:
SQL开始执行时间：20190615015951

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190615015951
SQL开始执行时间：20190615015951



drop table if exists edw.employment_record
;
SQL结束执行时间：20190615015951
SQL开始执行时间：20190615015951
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190615015954
SQL开始执行时间：20190615015954



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190615020000
SQL开始执行时间：20190615020000


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190615020000
SQL开始执行时间：20190615020000
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190615020000

20190616015956开始执行2019-06-16数据加载日志:
SQL开始执行时间：20190616015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190616015956
SQL开始执行时间：20190616015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190616015956
SQL开始执行时间：20190616015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190616015959
SQL开始执行时间：20190616015959



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190616020005
SQL开始执行时间：20190616020005


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190616020005
SQL开始执行时间：20190616020005
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190616020005

20190617020002开始执行2019-06-17数据加载日志:
SQL开始执行时间：20190617020002

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190617020002
SQL开始执行时间：20190617020002



drop table if exists edw.employment_record
;
SQL结束执行时间：20190617020002
SQL开始执行时间：20190617020002
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190617020005
SQL开始执行时间：20190617020005



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190617020011
SQL开始执行时间：20190617020011


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190617020011
SQL开始执行时间：20190617020011
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190617020011

20190618015938开始执行2019-06-18数据加载日志:
SQL开始执行时间：20190618015938

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190618015938
SQL开始执行时间：20190618015938



drop table if exists edw.employment_record
;
SQL结束执行时间：20190618015938
SQL开始执行时间：20190618015938
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190618015941
SQL开始执行时间：20190618015941



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190618015947
SQL开始执行时间：20190618015947


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190618015947
SQL开始执行时间：20190618015947
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190618015947

20190619015956开始执行2019-06-19数据加载日志:
SQL开始执行时间：20190619015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190619015956
SQL开始执行时间：20190619015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190619015956
SQL开始执行时间：20190619015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190619015958
SQL开始执行时间：20190619015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190619020004
SQL开始执行时间：20190619020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190619020004
SQL开始执行时间：20190619020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190619020004

20190620015934开始执行2019-06-20数据加载日志:
SQL开始执行时间：20190620015934

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190620015934
SQL开始执行时间：20190620015934



drop table if exists edw.employment_record
;
SQL结束执行时间：20190620015934
SQL开始执行时间：20190620015934
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190620015936
SQL开始执行时间：20190620015936



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190620015942
SQL开始执行时间：20190620015942


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190620015942
SQL开始执行时间：20190620015942
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190620015942

20190621015933开始执行2019-06-21数据加载日志:
SQL开始执行时间：20190621015933

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190621015933
SQL开始执行时间：20190621015933



drop table if exists edw.employment_record
;
SQL结束执行时间：20190621015933
SQL开始执行时间：20190621015933
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190621015936
SQL开始执行时间：20190621015936



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190621015941
SQL开始执行时间：20190621015941


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190621015941
SQL开始执行时间：20190621015941
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190621015942

20190622015949开始执行2019-06-22数据加载日志:
SQL开始执行时间：20190622015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190622015949
SQL开始执行时间：20190622015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190622015949
SQL开始执行时间：20190622015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190622015951
SQL开始执行时间：20190622015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190622015957
SQL开始执行时间：20190622015957


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190622015957
SQL开始执行时间：20190622015957
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190622015957

20190623015934开始执行2019-06-23数据加载日志:
SQL开始执行时间：20190623015934

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190623015934
SQL开始执行时间：20190623015934



drop table if exists edw.employment_record
;
SQL结束执行时间：20190623015934
SQL开始执行时间：20190623015934
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190623015936
SQL开始执行时间：20190623015936



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190623015942
SQL开始执行时间：20190623015942


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190623015942
SQL开始执行时间：20190623015942
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190623015942

20190624015942开始执行2019-06-24数据加载日志:
SQL开始执行时间：20190624015942

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190624015943
SQL开始执行时间：20190624015943



drop table if exists edw.employment_record
;
SQL结束执行时间：20190624015943
SQL开始执行时间：20190624015943
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190624015945
SQL开始执行时间：20190624015945



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190624015951
SQL开始执行时间：20190624015951


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190624015951
SQL开始执行时间：20190624015951
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190624015951

20190625020036开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190625020036

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190625020036
SQL开始执行时间：20190625020036



drop table if exists edw.employment_record
;
SQL结束执行时间：20190625020036
SQL开始执行时间：20190625020036
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190625020038
SQL开始执行时间：20190625020038



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190625020044
SQL开始执行时间：20190625020044


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190625020044
SQL开始执行时间：20190625020044
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190625020044

20190626015939开始执行2019-06-26数据加载日志:
SQL开始执行时间：20190626015939

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190626015939
SQL开始执行时间：20190626015939



drop table if exists edw.employment_record
;
SQL结束执行时间：20190626015939
SQL开始执行时间：20190626015939
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190626015942
SQL开始执行时间：20190626015942



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190626015948
SQL开始执行时间：20190626015948


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190626015948
SQL开始执行时间：20190626015948
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190626015948

20190627020002开始执行2019-06-27数据加载日志:
SQL开始执行时间：20190627020002

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190627020002
SQL开始执行时间：20190627020002



drop table if exists edw.employment_record
;
SQL结束执行时间：20190627020002
SQL开始执行时间：20190627020002
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190627020004
SQL开始执行时间：20190627020004



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190627020010
SQL开始执行时间：20190627020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190627020010
SQL开始执行时间：20190627020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190627020010

20190628020018开始执行2019-06-28数据加载日志:
SQL开始执行时间：20190628020018

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190628020018
SQL开始执行时间：20190628020018



drop table if exists edw.employment_record
;
SQL结束执行时间：20190628020018
SQL开始执行时间：20190628020018
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190628020021
SQL开始执行时间：20190628020021



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190628020027
SQL开始执行时间：20190628020027


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190628020027
SQL开始执行时间：20190628020027
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190628020027

20190629015929开始执行2019-06-29数据加载日志:
SQL开始执行时间：20190629015929

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190629015929
SQL开始执行时间：20190629015929



drop table if exists edw.employment_record
;
SQL结束执行时间：20190629015929
SQL开始执行时间：20190629015929
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190629015931
SQL开始执行时间：20190629015931



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190629015938
SQL开始执行时间：20190629015938


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190629015938
SQL开始执行时间：20190629015938
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190629015938

20190630015956开始执行2019-06-30数据加载日志:
SQL开始执行时间：20190630015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190630015956
SQL开始执行时间：20190630015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190630015956
SQL开始执行时间：20190630015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190630015958
SQL开始执行时间：20190630015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190630020004
SQL开始执行时间：20190630020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190630020004
SQL开始执行时间：20190630020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190630020004

20190701015932开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190701015932

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190701015932
SQL开始执行时间：20190701015932



drop table if exists edw.employment_record
;
SQL结束执行时间：20190701015932
SQL开始执行时间：20190701015932
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190701015935
SQL开始执行时间：20190701015935



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190701015941
SQL开始执行时间：20190701015941


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190701015941
SQL开始执行时间：20190701015941
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190701015941

20190702015952开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190702015952

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190702015952
SQL开始执行时间：20190702015952



drop table if exists edw.employment_record
;
SQL结束执行时间：20190702015952
SQL开始执行时间：20190702015952
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190702015955
SQL开始执行时间：20190702015955



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190702020001
SQL开始执行时间：20190702020001


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190702020001
SQL开始执行时间：20190702020001
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190702020001

20190703015956开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190703015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190703015956
SQL开始执行时间：20190703015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190703015956
SQL开始执行时间：20190703015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190703015958
SQL开始执行时间：20190703015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190703020004
SQL开始执行时间：20190703020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190703020004
SQL开始执行时间：20190703020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190703020005

20190704015939开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190704015939

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190704015939
SQL开始执行时间：20190704015939



drop table if exists edw.employment_record
;
SQL结束执行时间：20190704015939
SQL开始执行时间：20190704015939
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190704015941
SQL开始执行时间：20190704015941



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190704015947
SQL开始执行时间：20190704015947


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190704015947
SQL开始执行时间：20190704015947
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190704015947

20190705020000开始执行2019-07-05数据加载日志:
SQL开始执行时间：20190705020000

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190705020000
SQL开始执行时间：20190705020000



drop table if exists edw.employment_record
;
SQL结束执行时间：20190705020000
SQL开始执行时间：20190705020000
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190705020002
SQL开始执行时间：20190705020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190705020008
SQL开始执行时间：20190705020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190705020009
SQL开始执行时间：20190705020009
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190705020009

20190706020011开始执行2019-07-06数据加载日志:
SQL开始执行时间：20190706020011

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190706020011
SQL开始执行时间：20190706020011



drop table if exists edw.employment_record
;
SQL结束执行时间：20190706020011
SQL开始执行时间：20190706020011
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190706020013
SQL开始执行时间：20190706020013



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190706020019
SQL开始执行时间：20190706020019


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190706020019
SQL开始执行时间：20190706020019
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190706020020

20190707015947开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190707015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190707015947
SQL开始执行时间：20190707015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190707015947
SQL开始执行时间：20190707015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190707015949
SQL开始执行时间：20190707015949



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190707015956
SQL开始执行时间：20190707015956


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190707015956
SQL开始执行时间：20190707015956
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190707015956

20190708015959开始执行2019-07-08数据加载日志:
SQL开始执行时间：20190708015959

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190708015959
SQL开始执行时间：20190708015959



drop table if exists edw.employment_record
;
SQL结束执行时间：20190708015959
SQL开始执行时间：20190708015959
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190708020002
SQL开始执行时间：20190708020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190708020008
SQL开始执行时间：20190708020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190708020008
SQL开始执行时间：20190708020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190708020008

20190709015940开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190709015940

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190709015940
SQL开始执行时间：20190709015940



drop table if exists edw.employment_record
;
SQL结束执行时间：20190709015940
SQL开始执行时间：20190709015940
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190709015942
SQL开始执行时间：20190709015942



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190709015948
SQL开始执行时间：20190709015948


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190709015948
SQL开始执行时间：20190709015948
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190709015949

20190710015958开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190710015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190710015958
SQL开始执行时间：20190710015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190710015958
SQL开始执行时间：20190710015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190710020001
SQL开始执行时间：20190710020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190710020007
SQL开始执行时间：20190710020007


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190710020007
SQL开始执行时间：20190710020007
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190710020008

20190711015947开始执行2019-07-11数据加载日志:
SQL开始执行时间：20190711015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190711015947
SQL开始执行时间：20190711015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190711015947
SQL开始执行时间：20190711015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190711015950
SQL开始执行时间：20190711015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190711015957
SQL开始执行时间：20190711015957


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190711015957
SQL开始执行时间：20190711015957
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190711015957

20190712015955开始执行2019-07-12数据加载日志:
SQL开始执行时间：20190712015955

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190712015955
SQL开始执行时间：20190712015955



drop table if exists edw.employment_record
;
SQL结束执行时间：20190712015955
SQL开始执行时间：20190712015955
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190712015958
SQL开始执行时间：20190712015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190712020004
SQL开始执行时间：20190712020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190712020004
SQL开始执行时间：20190712020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190712020004

20190713015935开始执行2019-07-13数据加载日志:
SQL开始执行时间：20190713015935

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190713015935
SQL开始执行时间：20190713015935



drop table if exists edw.employment_record
;
SQL结束执行时间：20190713015935
SQL开始执行时间：20190713015935
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190713015938
SQL开始执行时间：20190713015938



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190713015944
SQL开始执行时间：20190713015944


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190713015944
SQL开始执行时间：20190713015944
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190713015944

20190714015935开始执行2019-07-14数据加载日志:
SQL开始执行时间：20190714015935

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190714015935
SQL开始执行时间：20190714015935



drop table if exists edw.employment_record
;
SQL结束执行时间：20190714015935
SQL开始执行时间：20190714015935
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190714015938
SQL开始执行时间：20190714015938



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190714015945
SQL开始执行时间：20190714015945


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190714015945
SQL开始执行时间：20190714015945
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190714015945

20190715015934开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190715015934

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190715015935
SQL开始执行时间：20190715015935



drop table if exists edw.employment_record
;
SQL结束执行时间：20190715015935
SQL开始执行时间：20190715015935
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190715015937
SQL开始执行时间：20190715015937



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190715015944
SQL开始执行时间：20190715015944


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190715015944
SQL开始执行时间：20190715015944
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190715015944

20190716015934开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190716015934

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190716015934
SQL开始执行时间：20190716015934



drop table if exists edw.employment_record
;
SQL结束执行时间：20190716015934
SQL开始执行时间：20190716015934
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190716015937
SQL开始执行时间：20190716015937



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190716015943
SQL开始执行时间：20190716015943


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190716015943
SQL开始执行时间：20190716015943
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190716015943

20190717015949开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190717015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190717015949
SQL开始执行时间：20190717015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190717015949
SQL开始执行时间：20190717015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190717015951
SQL开始执行时间：20190717015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190717015958
SQL开始执行时间：20190717015958


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190717015958
SQL开始执行时间：20190717015958
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190717015958

20190718015937开始执行2019-07-18数据加载日志:
SQL开始执行时间：20190718015937

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190718015937
SQL开始执行时间：20190718015937



drop table if exists edw.employment_record
;
SQL结束执行时间：20190718015937
SQL开始执行时间：20190718015937
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190718015939
SQL开始执行时间：20190718015939



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190718015946
SQL开始执行时间：20190718015946


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190718015946
SQL开始执行时间：20190718015946
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190718015946

20190719015931开始执行2019-07-19数据加载日志:
SQL开始执行时间：20190719015931

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190719015931
SQL开始执行时间：20190719015931



drop table if exists edw.employment_record
;
SQL结束执行时间：20190719015931
SQL开始执行时间：20190719015931
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190719015933
SQL开始执行时间：20190719015933



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190719015940
SQL开始执行时间：20190719015940


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190719015940
SQL开始执行时间：20190719015940
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190719015940

20190722094812开始执行2019-07-22数据加载日志:
SQL开始执行时间：20190722094812

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190722094812
SQL开始执行时间：20190722094812



drop table if exists edw.employment_record
;
SQL结束执行时间：20190722094812
SQL开始执行时间：20190722094812
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190722094814
SQL开始执行时间：20190722094814



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190722094821
SQL开始执行时间：20190722094821


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190722094821
SQL开始执行时间：20190722094821
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190722094821

20190723015944开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190723015944

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190723015944
SQL开始执行时间：20190723015944



drop table if exists edw.employment_record
;
SQL结束执行时间：20190723015944
SQL开始执行时间：20190723015944
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190723015947
SQL开始执行时间：20190723015947



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190723015953
SQL开始执行时间：20190723015953


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190723015953
SQL开始执行时间：20190723015953
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190723015953

20190724020023开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190724020023

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190724020023
SQL开始执行时间：20190724020023



drop table if exists edw.employment_record
;
SQL结束执行时间：20190724020023
SQL开始执行时间：20190724020023
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190724020026
SQL开始执行时间：20190724020026



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190724020032
SQL开始执行时间：20190724020032


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190724020032
SQL开始执行时间：20190724020032
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190724020032

20190725020047开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190725020047

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190725020047
SQL开始执行时间：20190725020047



drop table if exists edw.employment_record
;
SQL结束执行时间：20190725020047
SQL开始执行时间：20190725020047
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190725020049
SQL开始执行时间：20190725020049



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190725020056
SQL开始执行时间：20190725020056


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190725020056
SQL开始执行时间：20190725020056
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190725020056

20190726091851开始执行2019-07-26数据加载日志:
SQL开始执行时间：20190726091851

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190726091851
SQL开始执行时间：20190726091851



drop table if exists edw.employment_record
;
SQL结束执行时间：20190726091851
SQL开始执行时间：20190726091851
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190726091854
SQL开始执行时间：20190726091854



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190726091900
SQL开始执行时间：20190726091900


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190726091900
SQL开始执行时间：20190726091900
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190726091900

20190727015958开始执行2019-07-27数据加载日志:
SQL开始执行时间：20190727015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190727015958
SQL开始执行时间：20190727015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190727015958
SQL开始执行时间：20190727015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190727020001
SQL开始执行时间：20190727020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190727020008
SQL开始执行时间：20190727020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190727020008
SQL开始执行时间：20190727020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190727020008

20190728015941开始执行2019-07-28数据加载日志:
SQL开始执行时间：20190728015941

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190728015941
SQL开始执行时间：20190728015941



drop table if exists edw.employment_record
;
SQL结束执行时间：20190728015941
SQL开始执行时间：20190728015941
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190728015943
SQL开始执行时间：20190728015943



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190728015950
SQL开始执行时间：20190728015950


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190728015950
SQL开始执行时间：20190728015950
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190728015951

20190729015942开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190729015942

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190729015942
SQL开始执行时间：20190729015942



drop table if exists edw.employment_record
;
SQL结束执行时间：20190729015942
SQL开始执行时间：20190729015942
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190729015945
SQL开始执行时间：20190729015945



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190729015952
SQL开始执行时间：20190729015952


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190729015952
SQL开始执行时间：20190729015952
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190729015952

20190730015936开始执行2019-07-30数据加载日志:
SQL开始执行时间：20190730015936

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190730015936
SQL开始执行时间：20190730015936



drop table if exists edw.employment_record
;
SQL结束执行时间：20190730015936
SQL开始执行时间：20190730015936
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190730015939
SQL开始执行时间：20190730015939



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190730015946
SQL开始执行时间：20190730015946


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190730015946
SQL开始执行时间：20190730015946
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190730015946

20190731020027开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190731020027

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190731020027
SQL开始执行时间：20190731020027



drop table if exists edw.employment_record
;
SQL结束执行时间：20190731020027
SQL开始执行时间：20190731020027
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190731020029
SQL开始执行时间：20190731020029



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190731020036
SQL开始执行时间：20190731020036


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190731020036
SQL开始执行时间：20190731020036
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190731020036

20190801015953开始执行2019-08-01数据加载日志:
SQL开始执行时间：20190801015953

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190801015953
SQL开始执行时间：20190801015953



drop table if exists edw.employment_record
;
SQL结束执行时间：20190801015953
SQL开始执行时间：20190801015953
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190801015956
SQL开始执行时间：20190801015956



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190801020002
SQL开始执行时间：20190801020002


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190801020002
SQL开始执行时间：20190801020002
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190801020002

20190802020009开始执行2019-08-02数据加载日志:
SQL开始执行时间：20190802020009

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190802020009
SQL开始执行时间：20190802020009



drop table if exists edw.employment_record
;
SQL结束执行时间：20190802020009
SQL开始执行时间：20190802020009
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190802020011
SQL开始执行时间：20190802020011



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190802020018
SQL开始执行时间：20190802020018


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190802020018
SQL开始执行时间：20190802020018
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190802020018

20190803015956开始执行2019-08-03数据加载日志:
SQL开始执行时间：20190803015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190803015956
SQL开始执行时间：20190803015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190803015956
SQL开始执行时间：20190803015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190803015959
SQL开始执行时间：20190803015959



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190803020006
SQL开始执行时间：20190803020006


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190803020006
SQL开始执行时间：20190803020006
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190803020006

20190804015953开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190804015953

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190804015953
SQL开始执行时间：20190804015953



drop table if exists edw.employment_record
;
SQL结束执行时间：20190804015953
SQL开始执行时间：20190804015953
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190804015956
SQL开始执行时间：20190804015956



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190804020002
SQL开始执行时间：20190804020002


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190804020002
SQL开始执行时间：20190804020002
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190804020003

20190805015949开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190805015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190805015949
SQL开始执行时间：20190805015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190805015949
SQL开始执行时间：20190805015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190805015951
SQL开始执行时间：20190805015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190805015958
SQL开始执行时间：20190805015958


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190805015958
SQL开始执行时间：20190805015958
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190805015958

20190806015947开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190806015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190806015947
SQL开始执行时间：20190806015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190806015947
SQL开始执行时间：20190806015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190806015950
SQL开始执行时间：20190806015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190806015956
SQL开始执行时间：20190806015956


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190806015956
SQL开始执行时间：20190806015956
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190806015957

20190807015948开始执行2019-08-07数据加载日志:
SQL开始执行时间：20190807015948

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190807015948
SQL开始执行时间：20190807015948



drop table if exists edw.employment_record
;
SQL结束执行时间：20190807015948
SQL开始执行时间：20190807015948
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190807015950
SQL开始执行时间：20190807015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190807015957
SQL开始执行时间：20190807015957
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190807015957

20190808015945开始执行2019-08-08数据加载日志:
SQL开始执行时间：20190808015945

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190808015945
SQL开始执行时间：20190808015945



drop table if exists edw.employment_record
;
SQL结束执行时间：20190808015945
SQL开始执行时间：20190808015945
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190808015947
SQL开始执行时间：20190808015947



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190808015954

20190809015946开始执行2019-08-09数据加载日志:
SQL开始执行时间：20190809015946

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190809015946
SQL开始执行时间：20190809015946



drop table if exists edw.employment_record
;
SQL结束执行时间：20190809015946
SQL开始执行时间：20190809015946
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190809015948
SQL开始执行时间：20190809015948



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190809015955
SQL开始执行时间：20190809015955
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190809015955

20190810015943开始执行2019-08-10数据加载日志:
SQL开始执行时间：20190810015943

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190810015943
SQL开始执行时间：20190810015943



drop table if exists edw.employment_record
;
SQL结束执行时间：20190810015943
SQL开始执行时间：20190810015943
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190810015946
SQL开始执行时间：20190810015946



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190810015953

20190811015943开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190811015943

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190811015943
SQL开始执行时间：20190811015943



drop table if exists edw.employment_record
;
SQL结束执行时间：20190811015943
SQL开始执行时间：20190811015943
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190811015945
SQL开始执行时间：20190811015945



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190811015952
SQL开始执行时间：20190811015952


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190811015952
SQL开始执行时间：20190811015952
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190811015953

20190812015946开始执行2019-08-12数据加载日志:
SQL开始执行时间：20190812015946

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190812015946
SQL开始执行时间：20190812015946



drop table if exists edw.employment_record
;
SQL结束执行时间：20190812015946
SQL开始执行时间：20190812015946
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190812015948
SQL开始执行时间：20190812015948



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190812015955
SQL开始执行时间：20190812015955
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190812015955

20190813015944开始执行2019-08-13数据加载日志:
SQL开始执行时间：20190813015944

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190813015945
SQL开始执行时间：20190813015945



drop table if exists edw.employment_record
;
SQL结束执行时间：20190813015945
SQL开始执行时间：20190813015945
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190813015947
SQL开始执行时间：20190813015947



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190813015954

20190814015946开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190814015946

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190814015946
SQL开始执行时间：20190814015946



drop table if exists edw.employment_record
;
SQL结束执行时间：20190814015946
SQL开始执行时间：20190814015946
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190814015949
SQL开始执行时间：20190814015949



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190814015955
SQL开始执行时间：20190814015955


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190814015955
SQL开始执行时间：20190814015955
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190814015956

20190815015956开始执行2019-08-15数据加载日志:
SQL开始执行时间：20190815015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190815015956
SQL开始执行时间：20190815015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190815015956
SQL开始执行时间：20190815015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190815015959
SQL开始执行时间：20190815015959



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190815020006
SQL开始执行时间：20190815020006
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190815020006

20190816015954开始执行2019-08-16数据加载日志:
SQL开始执行时间：20190816015954

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190816015954
SQL开始执行时间：20190816015954



drop table if exists edw.employment_record
;
SQL结束执行时间：20190816015954
SQL开始执行时间：20190816015954
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190816015957
SQL开始执行时间：20190816015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190816020004
SQL开始执行时间：20190816020004
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190816020004

20190817015954开始执行2019-08-17数据加载日志:
SQL开始执行时间：20190817015954

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190817015955
SQL开始执行时间：20190817015955



drop table if exists edw.employment_record
;
SQL结束执行时间：20190817015955
SQL开始执行时间：20190817015955
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190817015957
SQL开始执行时间：20190817015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190817020005
SQL开始执行时间：20190817020005
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190817020005

20190818015950开始执行2019-08-18数据加载日志:
SQL开始执行时间：20190818015950

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190818015950
SQL开始执行时间：20190818015950



drop table if exists edw.employment_record
;
SQL结束执行时间：20190818015950
SQL开始执行时间：20190818015950
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190818015953
SQL开始执行时间：20190818015953



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190818020000
SQL开始执行时间：20190818020000
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190818020000

20190819015952开始执行2019-08-19数据加载日志:
SQL开始执行时间：20190819015952

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190819015952
SQL开始执行时间：20190819015952



drop table if exists edw.employment_record
;
SQL结束执行时间：20190819015952
SQL开始执行时间：20190819015952
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190819015955
SQL开始执行时间：20190819015955



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190819020003

20190820015957开始执行2019-08-20数据加载日志:
SQL开始执行时间：20190820015957

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190820015958
SQL开始执行时间：20190820015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190820015958
SQL开始执行时间：20190820015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190820020001
SQL开始执行时间：20190820020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190820020009

20190821020001开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190821020001

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190821020001
SQL开始执行时间：20190821020001



drop table if exists edw.employment_record
;
SQL结束执行时间：20190821020001
SQL开始执行时间：20190821020001
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190821020004
SQL开始执行时间：20190821020004



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190821020012

20190822020004开始执行2019-08-22数据加载日志:
SQL开始执行时间：20190822020004

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190822020005
SQL开始执行时间：20190822020005



drop table if exists edw.employment_record
;
SQL结束执行时间：20190822020005
SQL开始执行时间：20190822020005
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190822020008
SQL开始执行时间：20190822020008



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190822020016

20190823015959开始执行2019-08-23数据加载日志:
SQL开始执行时间：20190823015959

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190823015959
SQL开始执行时间：20190823015959



drop table if exists edw.employment_record
;
SQL结束执行时间：20190823015959
SQL开始执行时间：20190823015959
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190823020002
SQL开始执行时间：20190823020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190823020010
SQL开始执行时间：20190823020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190823020010

20190824015958开始执行2019-08-24数据加载日志:
SQL开始执行时间：20190824015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190824015959
SQL开始执行时间：20190824015959



drop table if exists edw.employment_record
;
SQL结束执行时间：20190824015959
SQL开始执行时间：20190824015959
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190824020002
SQL开始执行时间：20190824020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190824020010

20190825015957开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190825015957

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190825015957
SQL开始执行时间：20190825015957



drop table if exists edw.employment_record
;
SQL结束执行时间：20190825015957
SQL开始执行时间：20190825015957
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190825020000
SQL开始执行时间：20190825020000



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190825020008
SQL开始执行时间：20190825020008
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190825020008

20190826020000开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190826020000

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190826020000
SQL开始执行时间：20190826020000



drop table if exists edw.employment_record
;
SQL结束执行时间：20190826020000
SQL开始执行时间：20190826020000
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190826020003
SQL开始执行时间：20190826020003



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190826020011
SQL开始执行时间：20190826020011
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190826020011

20190827015957开始执行2019-08-27数据加载日志:
SQL开始执行时间：20190827015957

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190827015957
SQL开始执行时间：20190827015957



drop table if exists edw.employment_record
;
SQL结束执行时间：20190827015957
SQL开始执行时间：20190827015957
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190827020000
SQL开始执行时间：20190827020000



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190827020008
SQL开始执行时间：20190827020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190827020008
SQL开始执行时间：20190827020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190827020009

20190828015956开始执行2019-08-28数据加载日志:
SQL开始执行时间：20190828015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190828015956
SQL开始执行时间：20190828015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190828015956
SQL开始执行时间：20190828015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190828015959
SQL开始执行时间：20190828015959



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190828020008

20190829015958开始执行2019-08-29数据加载日志:
SQL开始执行时间：20190829015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190829015958
SQL开始执行时间：20190829015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190829015958
SQL开始执行时间：20190829015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190829020001
SQL开始执行时间：20190829020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190829020010

20190830015958开始执行2019-08-30数据加载日志:
SQL开始执行时间：20190830015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190830015958
SQL开始执行时间：20190830015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190830015958
SQL开始执行时间：20190830015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190830020001
SQL开始执行时间：20190830020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190830020010

20190831015959开始执行2019-08-31数据加载日志:
SQL开始执行时间：20190831015959

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190831015959
SQL开始执行时间：20190831015959



drop table if exists edw.employment_record
;
SQL结束执行时间：20190831015959
SQL开始执行时间：20190831015959
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190831020002
SQL开始执行时间：20190831020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190831020010
SQL开始执行时间：20190831020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190831020010

20190901015958开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190901015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190901015958
SQL开始执行时间：20190901015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190901015958
SQL开始执行时间：20190901015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190901020002
SQL开始执行时间：20190901020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190901020010

20190902015953开始执行2019-09-02数据加载日志:
SQL开始执行时间：20190902015953

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190902015953
SQL开始执行时间：20190902015953



drop table if exists edw.employment_record
;
SQL结束执行时间：20190902015953
SQL开始执行时间：20190902015953
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190902015957
SQL开始执行时间：20190902015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190902020005

20190903015954开始执行2019-09-03数据加载日志:
SQL开始执行时间：20190903015954

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190903015954
SQL开始执行时间：20190903015954



drop table if exists edw.employment_record
;
SQL结束执行时间：20190903015954
SQL开始执行时间：20190903015954
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190903015957
SQL开始执行时间：20190903015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190903020005
SQL开始执行时间：20190903020005
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190903020005

20190904015953开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190904015953

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190904015953
SQL开始执行时间：20190904015953



drop table if exists edw.employment_record
;
SQL结束执行时间：20190904015953
SQL开始执行时间：20190904015953
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190904015956
SQL开始执行时间：20190904015956



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190904020005
SQL开始执行时间：20190904020005
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190904020005

20190905020003开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190905020003

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190905020003
SQL开始执行时间：20190905020003



drop table if exists edw.employment_record
;
SQL结束执行时间：20190905020003
SQL开始执行时间：20190905020003
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190905020007
SQL开始执行时间：20190905020007



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190905020015
SQL开始执行时间：20190905020015
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190905020015

20190906015959开始执行2019-09-06数据加载日志:
SQL开始执行时间：20190906015959

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190906015959
SQL开始执行时间：20190906015959



drop table if exists edw.employment_record
;
SQL结束执行时间：20190906015959
SQL开始执行时间：20190906015959
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190906020002
SQL开始执行时间：20190906020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190906020010
SQL开始执行时间：20190906020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190906020010
SQL开始执行时间：20190906020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190906020010
SQL开始执行时间：20190906020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190906020010
SQL开始执行时间：20190906020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190906020011
SQL开始执行时间：20190906020011
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190906020011
SQL开始执行时间：20190906020011
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190906020011
SQL开始执行时间：20190906020011
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190906020011

20190907015958开始执行2019-09-07数据加载日志:
SQL开始执行时间：20190907015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190907015958
SQL开始执行时间：20190907015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190907015958
SQL开始执行时间：20190907015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190907020001
SQL开始执行时间：20190907020001



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190907020009
SQL开始执行时间：20190907020009


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190907020009
SQL开始执行时间：20190907020009
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190907020010

20190908015958开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190908015958

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190908015958
SQL开始执行时间：20190908015958



drop table if exists edw.employment_record
;
SQL结束执行时间：20190908015958
SQL开始执行时间：20190908015958
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190908020002
SQL开始执行时间：20190908020002



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190908020010
SQL开始执行时间：20190908020010
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190908020010

20190909015955开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190909015955

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190909015955
SQL开始执行时间：20190909015955



drop table if exists edw.employment_record
;
SQL结束执行时间：20190909015955
SQL开始执行时间：20190909015955
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190909015958
SQL开始执行时间：20190909015958



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190909020007
SQL开始执行时间：20190909020007
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190909020007

20190910020004开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190910020004

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190910020004
SQL开始执行时间：20190910020004



drop table if exists edw.employment_record
;
SQL结束执行时间：20190910020004
SQL开始执行时间：20190910020004
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190910020007
SQL开始执行时间：20190910020007



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190910020016

20190911015959开始执行2019-09-11数据加载日志:
SQL开始执行时间：20190911015959

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190911020000
SQL开始执行时间：20190911020000



drop table if exists edw.employment_record
;
SQL结束执行时间：20190911020000
SQL开始执行时间：20190911020000
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190911020003
SQL开始执行时间：20190911020003



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190911020011
SQL开始执行时间：20190911020011


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190911020011
SQL开始执行时间：20190911020011
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190911020012

20190912015956开始执行2019-09-12数据加载日志:
SQL开始执行时间：20190912015956

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190912015956
SQL开始执行时间：20190912015956



drop table if exists edw.employment_record
;
SQL结束执行时间：20190912015956
SQL开始执行时间：20190912015956
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190912015959
SQL开始执行时间：20190912015959



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190912020008
SQL开始执行时间：20190912020008
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190912020008

20190913015948开始执行2019-09-13数据加载日志:
SQL开始执行时间：20190913015948

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190913015948
SQL开始执行时间：20190913015948



drop table if exists edw.employment_record
;
SQL结束执行时间：20190913015948
SQL开始执行时间：20190913015948
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190913015952
SQL开始执行时间：20190913015952



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190913020000
SQL开始执行时间：20190913020000
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190913020000

20190914015946开始执行2019-09-14数据加载日志:
SQL开始执行时间：20190914015946

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190914015947
SQL开始执行时间：20190914015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190914015947
SQL开始执行时间：20190914015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190914015950
SQL开始执行时间：20190914015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190914015958
SQL开始执行时间：20190914015958


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190914015958
SQL开始执行时间：20190914015958
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190914015959

20190915015947开始执行2019-09-15数据加载日志:
SQL开始执行时间：20190915015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190915015948
SQL开始执行时间：20190915015948



drop table if exists edw.employment_record
;
SQL结束执行时间：20190915015948
SQL开始执行时间：20190915015948
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190915015951
SQL开始执行时间：20190915015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190915020000
SQL开始执行时间：20190915020000
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190915020000

20190916015947开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190916015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190916015947
SQL开始执行时间：20190916015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190916015947
SQL开始执行时间：20190916015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190916015951
SQL开始执行时间：20190916015951



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190916015959
SQL开始执行时间：20190916015959


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190916015959
SQL开始执行时间：20190916015959
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190916020000

20190917015948开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190917015948

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190917015948
SQL开始执行时间：20190917015948



drop table if exists edw.employment_record
;
SQL结束执行时间：20190917015948
SQL开始执行时间：20190917015948
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190917015952
SQL开始执行时间：20190917015952



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190917020000
SQL开始执行时间：20190917020000


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190917020000
SQL开始执行时间：20190917020000
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190917020001

20190918015954开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190918015954

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190918015954
SQL开始执行时间：20190918015954



drop table if exists edw.employment_record
;
SQL结束执行时间：20190918015954
SQL开始执行时间：20190918015954
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190918015957
SQL开始执行时间：20190918015957



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190918020006
SQL开始执行时间：20190918020006
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190918020006

20190919015946开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190919015946

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190919015946
SQL开始执行时间：20190919015946



drop table if exists edw.employment_record
;
SQL结束执行时间：20190919015946
SQL开始执行时间：20190919015946
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190919015950
SQL开始执行时间：20190919015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190919015959
SQL开始执行时间：20190919015959
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190919015959

20190920015951开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190920015951

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190920015951
SQL开始执行时间：20190920015951



drop table if exists edw.employment_record
;
SQL结束执行时间：20190920015951
SQL开始执行时间：20190920015951
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190920015955
SQL开始执行时间：20190920015955



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190920020004

20190921015949开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190921015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190921015949
SQL开始执行时间：20190921015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190921015949
SQL开始执行时间：20190921015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190921015952
SQL开始执行时间：20190921015952



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190921020001
SQL开始执行时间：20190921020001


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190921020001
SQL开始执行时间：20190921020001
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190921020002

20190922015949开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190922015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190922015949
SQL开始执行时间：20190922015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190922015949
SQL开始执行时间：20190922015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190922015953
SQL开始执行时间：20190922015953



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190922020002

20190923015947开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190923015947

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190923015947
SQL开始执行时间：20190923015947



drop table if exists edw.employment_record
;
SQL结束执行时间：20190923015947
SQL开始执行时间：20190923015947
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190923015950
SQL开始执行时间：20190923015950



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190923015959
SQL开始执行时间：20190923015959
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190923015959

20190924015949开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190924015949

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190924015949
SQL开始执行时间：20190924015949



drop table if exists edw.employment_record
;
SQL结束执行时间：20190924015949
SQL开始执行时间：20190924015949
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190924015953
SQL开始执行时间：20190924015953



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190924020002
SQL开始执行时间：20190924020002
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190924020002

20190925015950开始执行2019-09-25数据加载日志:
SQL开始执行时间：20190925015950

create temporary table edw.ehr_employee_id_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190925015950
SQL开始执行时间：20190925015950



drop table if exists edw.employment_record
;
SQL结束执行时间：20190925015950
SQL开始执行时间：20190925015950
create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record_id a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b

;
SQL结束执行时间：20190925015954
SQL开始执行时间：20190925015954



create temporary table edw.mid1_ehr_employee_id as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
  from edw.ehr_employee_id_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003


truncate table edw.ehr_employee_id
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003
insert into edw.ehr_employee_id
select distinct a.*
               ,localtimestamp() as sys_time 
  from edw.mid1_ehr_employee_id a
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003


delete from edw.ehr_employee_id where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003
delete from edw.ehr_employee_id where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003
delete from edw.ehr_employee_id where userid = '124741099'
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003
delete from edw.ehr_employee_id where userid = '120421497'
;
SQL结束执行时间：20190925020003
SQL开始执行时间：20190925020003
delete from edw.ehr_employee_id where userid = '122762056'
;
SQL结束执行时间：20190925020003
