
20190625161314开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190625161314

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190625161314
SQL开始执行时间：20190625161314
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190625161316
SQL开始执行时间：20190625161316

drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190625161316
SQL开始执行时间：20190625161316
create table edw.crm_key_events as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode

;
SQL结束执行时间：20190625161316

20190626030044开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190626030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190626030044
SQL开始执行时间：20190626030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190626030046
SQL开始执行时间：20190626030046

drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190626030046
SQL开始执行时间：20190626030046
create table edw.crm_key_events as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode

;
SQL结束执行时间：20190626030047

20190627030040开始执行2019-06-26数据加载日志:
SQL开始执行时间：20190627030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190627030040
SQL开始执行时间：20190627030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190627030042
SQL开始执行时间：20190627030042

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190627030042
SQL开始执行时间：20190627030042
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by name,new_deadline

;
SQL结束执行时间：20190627030042
SQL开始执行时间：20190627030042


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190627030042
SQL开始执行时间：20190627030042
create table edw.crm_key_events as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,@r:= case when @name=a.name then @r+1 else 1 end as rownum
      ,@name:= a.name as name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@name:='',@new_deadline:='') b

;
SQL结束执行时间：20190627030043

20190628030041开始执行2019-06-27数据加载日志:
SQL开始执行时间：20190628030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190628030041
SQL开始执行时间：20190628030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190628030044
SQL开始执行时间：20190628030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190628030044
SQL开始执行时间：20190628030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190628030044
SQL开始执行时间：20190628030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190628030044
SQL开始执行时间：20190628030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190628030044

20190629030041开始执行2019-06-28数据加载日志:
SQL开始执行时间：20190629030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190629030041
SQL开始执行时间：20190629030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190629030044
SQL开始执行时间：20190629030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190629030044
SQL开始执行时间：20190629030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190629030044
SQL开始执行时间：20190629030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190629030044
SQL开始执行时间：20190629030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190629030044

20190630030040开始执行2019-06-29数据加载日志:
SQL开始执行时间：20190630030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190630030040
SQL开始执行时间：20190630030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190630030043
SQL开始执行时间：20190630030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190630030043
SQL开始执行时间：20190630030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190630030043
SQL开始执行时间：20190630030043


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190630030043
SQL开始执行时间：20190630030043
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190630030043

20190701030042开始执行2019-06-30数据加载日志:
SQL开始执行时间：20190701030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190701030042
SQL开始执行时间：20190701030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190701030044
SQL开始执行时间：20190701030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190701030044
SQL开始执行时间：20190701030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190701030044
SQL开始执行时间：20190701030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190701030044
SQL开始执行时间：20190701030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190701030045

20190702030045开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190702030045
SQL开始执行时间：20190702030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190702030047
SQL开始执行时间：20190702030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190702030048

20190702091032开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702091032

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190702091032
SQL开始执行时间：20190702091032
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190702091035
SQL开始执行时间：20190702091035
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190702091035

20190702091240开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702091240

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190702091240
SQL开始执行时间：20190702091240
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190702091243
SQL开始执行时间：20190702091243
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190702091243

20190703030040开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190703030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190703030040
SQL开始执行时间：20190703030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190703030043
SQL开始执行时间：20190703030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190703030043
SQL开始执行时间：20190703030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190703030043
SQL开始执行时间：20190703030043


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190703030043
SQL开始执行时间：20190703030043
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190703030043

20190704030040开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190704030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190704030040
SQL开始执行时间：20190704030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190704030042
SQL开始执行时间：20190704030042

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190704030042
SQL开始执行时间：20190704030042
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190704030042
SQL开始执行时间：20190704030042


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190704030042
SQL开始执行时间：20190704030042
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190704030042

20190705030041开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190705030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190705030041
SQL开始执行时间：20190705030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190705030044
SQL开始执行时间：20190705030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190705030044
SQL开始执行时间：20190705030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190705030044
SQL开始执行时间：20190705030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190705030044
SQL开始执行时间：20190705030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190705030044

20190706030043开始执行2019-07-05数据加载日志:
SQL开始执行时间：20190706030043

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190706030043
SQL开始执行时间：20190706030043
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190706030045
SQL开始执行时间：20190706030045

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190706030045
SQL开始执行时间：20190706030045
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190706030045
SQL开始执行时间：20190706030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190706030045
SQL开始执行时间：20190706030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190706030045

20190707030042开始执行2019-07-06数据加载日志:
SQL开始执行时间：20190707030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190707030042
SQL开始执行时间：20190707030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190707030044
SQL开始执行时间：20190707030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190707030044
SQL开始执行时间：20190707030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190707030045
SQL开始执行时间：20190707030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190707030045
SQL开始执行时间：20190707030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190707030045

20190708030041开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190708030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190708030041
SQL开始执行时间：20190708030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190708030043
SQL开始执行时间：20190708030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190708030043
SQL开始执行时间：20190708030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190708030043
SQL开始执行时间：20190708030043


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190708030044
SQL开始执行时间：20190708030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190708030044

20190709030041开始执行2019-07-08数据加载日志:
SQL开始执行时间：20190709030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190709030041
SQL开始执行时间：20190709030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190709030043
SQL开始执行时间：20190709030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190709030043
SQL开始执行时间：20190709030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190709030044
SQL开始执行时间：20190709030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190709030044
SQL开始执行时间：20190709030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190709030044

20190710030042开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190710030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190710030042
SQL开始执行时间：20190710030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190710030045
SQL开始执行时间：20190710030045

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190710030045
SQL开始执行时间：20190710030045
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190710030045
SQL开始执行时间：20190710030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190710030045
SQL开始执行时间：20190710030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190710030045

20190711030041开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190711030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190711030041
SQL开始执行时间：20190711030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190711030044
SQL开始执行时间：20190711030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190711030044
SQL开始执行时间：20190711030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190711030044
SQL开始执行时间：20190711030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190711030044
SQL开始执行时间：20190711030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190711030044

20190712030041开始执行2019-07-11数据加载日志:
SQL开始执行时间：20190712030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190712030041
SQL开始执行时间：20190712030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190712030044
SQL开始执行时间：20190712030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190712030044
SQL开始执行时间：20190712030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190712030044
SQL开始执行时间：20190712030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190712030044
SQL开始执行时间：20190712030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190712030044

20190713030041开始执行2019-07-12数据加载日志:
SQL开始执行时间：20190713030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190713030041
SQL开始执行时间：20190713030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190713030044
SQL开始执行时间：20190713030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190713030044
SQL开始执行时间：20190713030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190713030045
SQL开始执行时间：20190713030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190713030045
SQL开始执行时间：20190713030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190713030045

20190716030042开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190716030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190716030042
SQL开始执行时间：20190716030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190716030045
SQL开始执行时间：20190716030045

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190716030045
SQL开始执行时间：20190716030045
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190716030045
SQL开始执行时间：20190716030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190716030045
SQL开始执行时间：20190716030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190716030045

20190717030042开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190717030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190717030042
SQL开始执行时间：20190717030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190717030044
SQL开始执行时间：20190717030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190717030044
SQL开始执行时间：20190717030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190717030045
SQL开始执行时间：20190717030045


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190717030045
SQL开始执行时间：20190717030045
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190717030045

20190718030041开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190718030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190718030041
SQL开始执行时间：20190718030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190718030043
SQL开始执行时间：20190718030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190718030043
SQL开始执行时间：20190718030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190718030044
SQL开始执行时间：20190718030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190718030044

20190719030044开始执行2019-07-18数据加载日志:
SQL开始执行时间：20190719030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190719030044
SQL开始执行时间：20190719030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190719030047
SQL开始执行时间：20190719030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190719030047
SQL开始执行时间：20190719030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190719030047
SQL开始执行时间：20190719030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190719030047
SQL开始执行时间：20190719030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190719030047

20190720030041开始执行2019-07-19数据加载日志:
SQL开始执行时间：20190720030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190720030041
SQL开始执行时间：20190720030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190720030043
SQL开始执行时间：20190720030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190720030043
SQL开始执行时间：20190720030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190720030043
SQL开始执行时间：20190720030043


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190720030043
SQL开始执行时间：20190720030043
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190720030043

20190721030040开始执行2019-07-20数据加载日志:
SQL开始执行时间：20190721030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190721030040
SQL开始执行时间：20190721030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190721030042
SQL开始执行时间：20190721030042

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190721030042
SQL开始执行时间：20190721030042
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190721030042
SQL开始执行时间：20190721030042


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190721030042
SQL开始执行时间：20190721030042
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190721030042

20190722030042开始执行2019-07-21数据加载日志:
SQL开始执行时间：20190722030042

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190722030042
SQL开始执行时间：20190722030042
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190722030044
SQL开始执行时间：20190722030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190722030044
SQL开始执行时间：20190722030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190722030044
SQL开始执行时间：20190722030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190722030044
SQL开始执行时间：20190722030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190722030045

20190723030041开始执行2019-07-22数据加载日志:
SQL开始执行时间：20190723030041

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190723030041
SQL开始执行时间：20190723030041
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190723030044
SQL开始执行时间：20190723030044

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190723030044
SQL开始执行时间：20190723030044
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190723030044
SQL开始执行时间：20190723030044


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190723030044
SQL开始执行时间：20190723030044
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190723030044

20190724030040开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190724030040

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190724030040
SQL开始执行时间：20190724030040
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190724030043
SQL开始执行时间：20190724030043

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190724030043
SQL开始执行时间：20190724030043
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190724030043
SQL开始执行时间：20190724030043


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190724030043
SQL开始执行时间：20190724030043
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190724030043

20190725030047开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190725030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190725030047
SQL开始执行时间：20190725030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190725030049
SQL开始执行时间：20190725030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190725030049
SQL开始执行时间：20190725030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190725030049
SQL开始执行时间：20190725030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190725030049
SQL开始执行时间：20190725030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190725030049

20190726030044开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190726030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190726030044
SQL开始执行时间：20190726030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190726030046
SQL开始执行时间：20190726030046

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190726030046
SQL开始执行时间：20190726030046
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190726030047
SQL开始执行时间：20190726030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190726030047
SQL开始执行时间：20190726030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190726030047

20190727030044开始执行2019-07-26数据加载日志:
SQL开始执行时间：20190727030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190727030044
SQL开始执行时间：20190727030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190727030046
SQL开始执行时间：20190727030046

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190727030046
SQL开始执行时间：20190727030046
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190727030047
SQL开始执行时间：20190727030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190727030047
SQL开始执行时间：20190727030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190727030047

20190728030044开始执行2019-07-27数据加载日志:
SQL开始执行时间：20190728030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190728030044
SQL开始执行时间：20190728030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190728030046
SQL开始执行时间：20190728030046

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190728030046
SQL开始执行时间：20190728030046
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190728030046
SQL开始执行时间：20190728030046


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190728030046
SQL开始执行时间：20190728030046
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190728030047

20190729030044开始执行2019-07-28数据加载日志:
SQL开始执行时间：20190729030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190729030044
SQL开始执行时间：20190729030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190729030046
SQL开始执行时间：20190729030046

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190729030046
SQL开始执行时间：20190729030046
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190729030046
SQL开始执行时间：20190729030046


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190729030046
SQL开始执行时间：20190729030046
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190729030047

20190730030045开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190730030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190730030045
SQL开始执行时间：20190730030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190730030048
SQL开始执行时间：20190730030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190730030048
SQL开始执行时间：20190730030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190730030048
SQL开始执行时间：20190730030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190730030048
SQL开始执行时间：20190730030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190730030048

20190731030049开始执行2019-07-30数据加载日志:
SQL开始执行时间：20190731030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190731030049
SQL开始执行时间：20190731030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190731030051
SQL开始执行时间：20190731030051

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190731030051
SQL开始执行时间：20190731030051
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190731030052
SQL开始执行时间：20190731030052


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190731030052
SQL开始执行时间：20190731030052
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190731030052

20190801091151开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190801091151

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190801091151
SQL开始执行时间：20190801091151
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190801091153
SQL开始执行时间：20190801091153

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190801091153
SQL开始执行时间：20190801091153
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190801091153
SQL开始执行时间：20190801091153


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190801091153
SQL开始执行时间：20190801091153
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190801091153

20190802030044开始执行2019-08-01数据加载日志:
SQL开始执行时间：20190802030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190802030044
SQL开始执行时间：20190802030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190802030046
SQL开始执行时间：20190802030046

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190802030046
SQL开始执行时间：20190802030046
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190802030047
SQL开始执行时间：20190802030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190802030047
SQL开始执行时间：20190802030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190802030047

20190803030044开始执行2019-08-02数据加载日志:
SQL开始执行时间：20190803030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190803030044
SQL开始执行时间：20190803030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190803030047
SQL开始执行时间：20190803030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190803030047
SQL开始执行时间：20190803030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190803030047
SQL开始执行时间：20190803030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190803030047
SQL开始执行时间：20190803030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190803030047

20190804030045开始执行2019-08-03数据加载日志:
SQL开始执行时间：20190804030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190804030045
SQL开始执行时间：20190804030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190804030047
SQL开始执行时间：20190804030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190804030047
SQL开始执行时间：20190804030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190804030048
SQL开始执行时间：20190804030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190804030048
SQL开始执行时间：20190804030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190804030048

20190805030045开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190805030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190805030045
SQL开始执行时间：20190805030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190805030048
SQL开始执行时间：20190805030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190805030048
SQL开始执行时间：20190805030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190805030048
SQL开始执行时间：20190805030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190805030048
SQL开始执行时间：20190805030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190805030048

20190806030045开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190806030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190806030045
SQL开始执行时间：20190806030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190806030048
SQL开始执行时间：20190806030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190806030048
SQL开始执行时间：20190806030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190806030048
SQL开始执行时间：20190806030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190806030048
SQL开始执行时间：20190806030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190806030048

20190807030045开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190807030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190807030045
SQL开始执行时间：20190807030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190807030048
SQL开始执行时间：20190807030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190807030048
SQL开始执行时间：20190807030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190807030048
SQL开始执行时间：20190807030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190807030048
SQL开始执行时间：20190807030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190807030048

20190808030045开始执行2019-08-07数据加载日志:
SQL开始执行时间：20190808030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190808030045
SQL开始执行时间：20190808030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190808030048
SQL开始执行时间：20190808030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190808030048
SQL开始执行时间：20190808030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190808030048
SQL开始执行时间：20190808030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190808030048
SQL开始执行时间：20190808030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190808030048

20190809030044开始执行2019-08-08数据加载日志:
SQL开始执行时间：20190809030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190809030044
SQL开始执行时间：20190809030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190809030047
SQL开始执行时间：20190809030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190809030047
SQL开始执行时间：20190809030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190809030047
SQL开始执行时间：20190809030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190809030047
SQL开始执行时间：20190809030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190809030047

20190810030047开始执行2019-08-09数据加载日志:
SQL开始执行时间：20190810030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190810030047
SQL开始执行时间：20190810030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190810030049
SQL开始执行时间：20190810030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190810030049
SQL开始执行时间：20190810030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190810030049
SQL开始执行时间：20190810030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190810030049
SQL开始执行时间：20190810030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190810030049

20190811030046开始执行2019-08-10数据加载日志:
SQL开始执行时间：20190811030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190811030046
SQL开始执行时间：20190811030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190811030049
SQL开始执行时间：20190811030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190811030049
SQL开始执行时间：20190811030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190811030049
SQL开始执行时间：20190811030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190811030049
SQL开始执行时间：20190811030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190811030049

20190812030045开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190812030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190812030045
SQL开始执行时间：20190812030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190812030048
SQL开始执行时间：20190812030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190812030048
SQL开始执行时间：20190812030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190812030048
SQL开始执行时间：20190812030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190812030048
SQL开始执行时间：20190812030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190812030048

20190813030045开始执行2019-08-12数据加载日志:
SQL开始执行时间：20190813030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190813030045
SQL开始执行时间：20190813030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190813030047
SQL开始执行时间：20190813030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190813030047
SQL开始执行时间：20190813030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190813030048
SQL开始执行时间：20190813030048


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190813030048
SQL开始执行时间：20190813030048
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190813030048

20190814030044开始执行2019-08-13数据加载日志:
SQL开始执行时间：20190814030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190814030044
SQL开始执行时间：20190814030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190814030047
SQL开始执行时间：20190814030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190814030047
SQL开始执行时间：20190814030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190814030047
SQL开始执行时间：20190814030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190814030047
SQL开始执行时间：20190814030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190814030047

20190815030046开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190815030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190815030046
SQL开始执行时间：20190815030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190815030049
SQL开始执行时间：20190815030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190815030049
SQL开始执行时间：20190815030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190815030049
SQL开始执行时间：20190815030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190815030049
SQL开始执行时间：20190815030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190815030049

20190816030044开始执行2019-08-15数据加载日志:
SQL开始执行时间：20190816030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190816030044
SQL开始执行时间：20190816030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190816030047
SQL开始执行时间：20190816030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190816030047
SQL开始执行时间：20190816030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190816030047
SQL开始执行时间：20190816030047


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190816030047
SQL开始执行时间：20190816030047
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190816030047

20190817030046开始执行2019-08-16数据加载日志:
SQL开始执行时间：20190817030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190817030046
SQL开始执行时间：20190817030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190817030049
SQL开始执行时间：20190817030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190817030049
SQL开始执行时间：20190817030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190817030049
SQL开始执行时间：20190817030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190817030049
SQL开始执行时间：20190817030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190817030049

20190820091705开始执行2019-08-19数据加载日志:
SQL开始执行时间：20190820091705

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190820091705
SQL开始执行时间：20190820091705
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190820091708
SQL开始执行时间：20190820091708

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190820091708
SQL开始执行时间：20190820091708
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190820091708
SQL开始执行时间：20190820091708


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190820091708
SQL开始执行时间：20190820091708
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190820091708

20190821030046开始执行2019-08-20数据加载日志:
SQL开始执行时间：20190821030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190821030046
SQL开始执行时间：20190821030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190821030048
SQL开始执行时间：20190821030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190821030048
SQL开始执行时间：20190821030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190821030049
SQL开始执行时间：20190821030049


drop table if exists edw.crm_key_events
;
SQL结束执行时间：20190821030049
SQL开始执行时间：20190821030049
create table edw.crm_key_events as 
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190821030049

20190822030046开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190822030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190822030046
SQL开始执行时间：20190822030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190822030049
SQL开始执行时间：20190822030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190822030049
SQL开始执行时间：20190822030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190822030049
SQL开始执行时间：20190822030049


truncate table edw.crm_key_events
;
SQL结束执行时间：20190822030049
SQL开始执行时间：20190822030049
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190822030049

20190822170332开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190822170332

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190822170332
SQL开始执行时间：20190822170332
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190822170357
SQL开始执行时间：20190822170357

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190822170357
SQL开始执行时间：20190822170357
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190822170357
SQL开始执行时间：20190822170357


truncate table edw.crm_key_events
;
SQL结束执行时间：20190822170357
SQL开始执行时间：20190822170357
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190822170357

20190823030045开始执行2019-08-22数据加载日志:
SQL开始执行时间：20190823030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190823030045
SQL开始执行时间：20190823030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190823030048
SQL开始执行时间：20190823030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190823030048
SQL开始执行时间：20190823030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190823030048
SQL开始执行时间：20190823030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190823030048
SQL开始执行时间：20190823030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190823030048

20190824030044开始执行2019-08-23数据加载日志:
SQL开始执行时间：20190824030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190824030044
SQL开始执行时间：20190824030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190824030047
SQL开始执行时间：20190824030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190824030047
SQL开始执行时间：20190824030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190824030047
SQL开始执行时间：20190824030047


truncate table edw.crm_key_events
;
SQL结束执行时间：20190824030047
SQL开始执行时间：20190824030047
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190824030047

20190825030045开始执行2019-08-24数据加载日志:
SQL开始执行时间：20190825030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190825030045
SQL开始执行时间：20190825030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190825030048
SQL开始执行时间：20190825030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190825030048
SQL开始执行时间：20190825030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190825030048
SQL开始执行时间：20190825030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190825030048
SQL开始执行时间：20190825030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190825030048

20190826030045开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190826030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190826030045
SQL开始执行时间：20190826030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190826030048
SQL开始执行时间：20190826030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190826030048
SQL开始执行时间：20190826030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190826030048
SQL开始执行时间：20190826030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190826030048
SQL开始执行时间：20190826030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190826030048

20190827030045开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190827030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190827030045
SQL开始执行时间：20190827030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190827030048
SQL开始执行时间：20190827030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190827030048
SQL开始执行时间：20190827030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190827030048
SQL开始执行时间：20190827030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190827030048
SQL开始执行时间：20190827030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190827030048

20190828030044开始执行2019-08-27数据加载日志:
SQL开始执行时间：20190828030044

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190828030044
SQL开始执行时间：20190828030044
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190828030047
SQL开始执行时间：20190828030047

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190828030047
SQL开始执行时间：20190828030047
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190828030047
SQL开始执行时间：20190828030047


truncate table edw.crm_key_events
;
SQL结束执行时间：20190828030047
SQL开始执行时间：20190828030047
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190828030047

20190829030049开始执行2019-08-28数据加载日志:
SQL开始执行时间：20190829030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190829030049
SQL开始执行时间：20190829030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190829030052
SQL开始执行时间：20190829030052

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190829030052
SQL开始执行时间：20190829030052
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190829030053
SQL开始执行时间：20190829030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190829030053
SQL开始执行时间：20190829030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190829030053

20190830030045开始执行2019-08-29数据加载日志:
SQL开始执行时间：20190830030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190830030045
SQL开始执行时间：20190830030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190830030048
SQL开始执行时间：20190830030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190830030048
SQL开始执行时间：20190830030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190830030048
SQL开始执行时间：20190830030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190830030048
SQL开始执行时间：20190830030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190830030048

20190831030045开始执行2019-08-30数据加载日志:
SQL开始执行时间：20190831030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190831030045
SQL开始执行时间：20190831030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190831030048
SQL开始执行时间：20190831030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190831030048
SQL开始执行时间：20190831030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190831030048
SQL开始执行时间：20190831030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190831030048
SQL开始执行时间：20190831030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190831030048

20190901030047开始执行2019-08-31数据加载日志:
SQL开始执行时间：20190901030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190901030047
SQL开始执行时间：20190901030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190901030050
SQL开始执行时间：20190901030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190901030050
SQL开始执行时间：20190901030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190901030051
SQL开始执行时间：20190901030051


truncate table edw.crm_key_events
;
SQL结束执行时间：20190901030051
SQL开始执行时间：20190901030051
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190901030051

20190902030046开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190902030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190902030046
SQL开始执行时间：20190902030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190902030049
SQL开始执行时间：20190902030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190902030049
SQL开始执行时间：20190902030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190902030049
SQL开始执行时间：20190902030049


truncate table edw.crm_key_events
;
SQL结束执行时间：20190902030049
SQL开始执行时间：20190902030049
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190902030049

20190903030045开始执行2019-09-02数据加载日志:
SQL开始执行时间：20190903030045

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190903030045
SQL开始执行时间：20190903030045
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190903030048
SQL开始执行时间：20190903030048

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190903030048
SQL开始执行时间：20190903030048
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190903030048
SQL开始执行时间：20190903030048


truncate table edw.crm_key_events
;
SQL结束执行时间：20190903030048
SQL开始执行时间：20190903030048
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190903030048

20190904030047开始执行2019-09-03数据加载日志:
SQL开始执行时间：20190904030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190904030047
SQL开始执行时间：20190904030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190904030050
SQL开始执行时间：20190904030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190904030050
SQL开始执行时间：20190904030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190904030050
SQL开始执行时间：20190904030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190904030050
SQL开始执行时间：20190904030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190904030050

20190905030046开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190905030046

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190905030046
SQL开始执行时间：20190905030046
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190905030049
SQL开始执行时间：20190905030049

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190905030049
SQL开始执行时间：20190905030049
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190905030049
SQL开始执行时间：20190905030049


truncate table edw.crm_key_events
;
SQL结束执行时间：20190905030049
SQL开始执行时间：20190905030049
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190905030049

20190906030047开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190906030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190906030047
SQL开始执行时间：20190906030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190906030050
SQL开始执行时间：20190906030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190906030050
SQL开始执行时间：20190906030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190906030050
SQL开始执行时间：20190906030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190906030050
SQL开始执行时间：20190906030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190906030050

20190906171331开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190906171331

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190906171331
SQL开始执行时间：20190906171331
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190906171334
SQL开始执行时间：20190906171334

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190906171334
SQL开始执行时间：20190906171334
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190906171334
SQL开始执行时间：20190906171334


truncate table edw.crm_key_events
;
SQL结束执行时间：20190906171334
SQL开始执行时间：20190906171334
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190906171334

20190907030047开始执行2019-09-06数据加载日志:
SQL开始执行时间：20190907030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190907030047
SQL开始执行时间：20190907030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190907030050
SQL开始执行时间：20190907030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190907030050
SQL开始执行时间：20190907030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190907030050
SQL开始执行时间：20190907030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190907030050
SQL开始执行时间：20190907030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190907030051

20190908030047开始执行2019-09-07数据加载日志:
SQL开始执行时间：20190908030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190908030047
SQL开始执行时间：20190908030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190908030050
SQL开始执行时间：20190908030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190908030050
SQL开始执行时间：20190908030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190908030050
SQL开始执行时间：20190908030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190908030050
SQL开始执行时间：20190908030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190908030050

20190909030047开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190909030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190909030047
SQL开始执行时间：20190909030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190909030050
SQL开始执行时间：20190909030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190909030050
SQL开始执行时间：20190909030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190909030050
SQL开始执行时间：20190909030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190909030050
SQL开始执行时间：20190909030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190909030050

20190910030047开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190910030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190910030047
SQL开始执行时间：20190910030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190910030050
SQL开始执行时间：20190910030050

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190910030050
SQL开始执行时间：20190910030050
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190910030050
SQL开始执行时间：20190910030050


truncate table edw.crm_key_events
;
SQL结束执行时间：20190910030050
SQL开始执行时间：20190910030050
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190910030050

20190911030048开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190911030048

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190911030048
SQL开始执行时间：20190911030048
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190911030059
SQL开始执行时间：20190911030059

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190911030059
SQL开始执行时间：20190911030059
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190911030059
SQL开始执行时间：20190911030059


truncate table edw.crm_key_events
;
SQL结束执行时间：20190911030059
SQL开始执行时间：20190911030059
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190911030059

20190911163303开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190911163303

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190911163303
SQL开始执行时间：20190911163303
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190911163307
SQL开始执行时间：20190911163307

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190911163307
SQL开始执行时间：20190911163307
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190911163307
SQL开始执行时间：20190911163307


truncate table edw.crm_key_events
;
SQL结束执行时间：20190911163307
SQL开始执行时间：20190911163307
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190911163307

20190912030047开始执行2019-09-11数据加载日志:
SQL开始执行时间：20190912030047

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190912030047
SQL开始执行时间：20190912030047
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190912030056
SQL开始执行时间：20190912030056

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190912030056
SQL开始执行时间：20190912030056
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190912030056
SQL开始执行时间：20190912030056


truncate table edw.crm_key_events
;
SQL结束执行时间：20190912030056
SQL开始执行时间：20190912030056
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190912030056

20190913030054开始执行2019-09-12数据加载日志:
SQL开始执行时间：20190913030054

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190913030054
SQL开始执行时间：20190913030054
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190913030057
SQL开始执行时间：20190913030057

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190913030057
SQL开始执行时间：20190913030057
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190913030057
SQL开始执行时间：20190913030057


truncate table edw.crm_key_events
;
SQL结束执行时间：20190913030057
SQL开始执行时间：20190913030057
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190913030057

20190914030049开始执行2019-09-13数据加载日志:
SQL开始执行时间：20190914030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190914030049
SQL开始执行时间：20190914030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190914030052
SQL开始执行时间：20190914030052

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190914030052
SQL开始执行时间：20190914030052
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190914030052
SQL开始执行时间：20190914030052


truncate table edw.crm_key_events
;
SQL结束执行时间：20190914030052
SQL开始执行时间：20190914030052
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190914030052

20190915030049开始执行2019-09-14数据加载日志:
SQL开始执行时间：20190915030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190915030049
SQL开始执行时间：20190915030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190915030052
SQL开始执行时间：20190915030052

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190915030052
SQL开始执行时间：20190915030052
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190915030052
SQL开始执行时间：20190915030052


truncate table edw.crm_key_events
;
SQL结束执行时间：20190915030052
SQL开始执行时间：20190915030052
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190915030052

20190916030050开始执行2019-09-15数据加载日志:
SQL开始执行时间：20190916030050

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190916030050
SQL开始执行时间：20190916030050
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190916030053
SQL开始执行时间：20190916030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190916030053
SQL开始执行时间：20190916030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190916030053
SQL开始执行时间：20190916030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190916030053
SQL开始执行时间：20190916030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190916030053

20190917030052开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190917030052

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190917030052
SQL开始执行时间：20190917030052
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190917030055
SQL开始执行时间：20190917030055

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190917030055
SQL开始执行时间：20190917030055
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190917030055
SQL开始执行时间：20190917030055


truncate table edw.crm_key_events
;
SQL结束执行时间：20190917030055
SQL开始执行时间：20190917030055
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190917030055

20190918030051开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190918030051

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190918030051
SQL开始执行时间：20190918030051
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190918030054
SQL开始执行时间：20190918030054

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190918030054
SQL开始执行时间：20190918030054
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190918030054
SQL开始执行时间：20190918030054


truncate table edw.crm_key_events
;
SQL结束执行时间：20190918030054
SQL开始执行时间：20190918030054
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190918030054

20190919030050开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190919030050

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190919030050
SQL开始执行时间：20190919030050
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190919030053
SQL开始执行时间：20190919030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190919030053
SQL开始执行时间：20190919030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190919030053
SQL开始执行时间：20190919030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190919030053
SQL开始执行时间：20190919030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190919030053

20190920030050开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190920030050

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190920030050
SQL开始执行时间：20190920030050
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190920030053
SQL开始执行时间：20190920030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190920030053
SQL开始执行时间：20190920030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190920030053
SQL开始执行时间：20190920030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190920030053
SQL开始执行时间：20190920030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190920030053

20190921030051开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190921030051

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190921030051
SQL开始执行时间：20190921030051
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190921030054
SQL开始执行时间：20190921030054

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190921030054
SQL开始执行时间：20190921030054
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190921030054
SQL开始执行时间：20190921030054


truncate table edw.crm_key_events
;
SQL结束执行时间：20190921030054
SQL开始执行时间：20190921030054
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190921030054

20190922030052开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190922030052

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190922030052
SQL开始执行时间：20190922030052
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190922030055
SQL开始执行时间：20190922030055

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190922030055
SQL开始执行时间：20190922030055
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190922030055
SQL开始执行时间：20190922030055


truncate table edw.crm_key_events
;
SQL结束执行时间：20190922030055
SQL开始执行时间：20190922030055
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190922030055

20190923030049开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190923030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190923030049
SQL开始执行时间：20190923030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190923030052
SQL开始执行时间：20190923030052

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190923030052
SQL开始执行时间：20190923030052
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190923030052
SQL开始执行时间：20190923030052


truncate table edw.crm_key_events
;
SQL结束执行时间：20190923030052
SQL开始执行时间：20190923030052
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190923030052

20190924030051开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190924030051

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190924030051
SQL开始执行时间：20190924030051
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190924030054
SQL开始执行时间：20190924030054

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190924030054
SQL开始执行时间：20190924030054
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190924030054
SQL开始执行时间：20190924030054


truncate table edw.crm_key_events
;
SQL结束执行时间：20190924030054
SQL开始执行时间：20190924030054
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190924030054

20190925030052开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190925030052

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190925030052
SQL开始执行时间：20190925030052
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190925030055
SQL开始执行时间：20190925030055

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190925030055
SQL开始执行时间：20190925030055
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190925030055
SQL开始执行时间：20190925030055


truncate table edw.crm_key_events
;
SQL结束执行时间：20190925030055
SQL开始执行时间：20190925030055
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190925030055

20190926030049开始执行2019-09-25数据加载日志:
SQL开始执行时间：20190926030049

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190926030049
SQL开始执行时间：20190926030049
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190926030053
SQL开始执行时间：20190926030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190926030053
SQL开始执行时间：20190926030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190926030053
SQL开始执行时间：20190926030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190926030053
SQL开始执行时间：20190926030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190926030053

20190927030050开始执行2019-09-26数据加载日志:
SQL开始执行时间：20190927030050

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190927030050
SQL开始执行时间：20190927030050
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190927030053
SQL开始执行时间：20190927030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190927030053
SQL开始执行时间：20190927030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190927030053
SQL开始执行时间：20190927030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190927030053
SQL开始执行时间：20190927030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190927030053

20190928030050开始执行2019-09-27数据加载日志:
SQL开始执行时间：20190928030050

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190928030050
SQL开始执行时间：20190928030050
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190928030053
SQL开始执行时间：20190928030053

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190928030053
SQL开始执行时间：20190928030053
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190928030053
SQL开始执行时间：20190928030053


truncate table edw.crm_key_events
;
SQL结束执行时间：20190928030053
SQL开始执行时间：20190928030053
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190928030053

20190929030051开始执行2019-09-28数据加载日志:
SQL开始执行时间：20190929030051

drop table if exists edw.crm_key_events_pre
;
SQL结束执行时间：20190929030051
SQL开始执行时间：20190929030051
create temporary table edw.crm_key_events_pre as
select a.new_key_eventid
      ,a.new_opp
      ,d.new_area
      ,d.new_province
      ,d.new_city
      ,d.new_county
      ,d.new_num as cuscode
      ,d.name as cusname
      ,f.name
      ,b.lastname as new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,e.lastname as ownerid
      ,date_add(a.new_deadline, interval 8 hour) as new_deadline
      ,case when new_status = '1' then '计划'
            when new_status = '2' then '进行中'
            when new_status = '3' then '已完成'
            when new_status = '4' then '延期'
            when new_status = '5' then '未定义'
            when new_status = '6' then '暂停'
            else '未知' end as new_status
      ,date_add(a.new_finish_date, interval 8 hour) as new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,localtimestamp() as sys_time
  from ufdata.crm_new_key_events a
  left join ufdata.crm_systemusers b
    on a.new_contact = b.ownerid
  left join ufdata.crm_accounts c
    on a.new_kehu = c.accountid
  left join edw.crm_accounts d
    on c.new_num = d.new_num
  left join ufdata.crm_systemusers e
    on a.ownerid = b.ownerid
  left join ufdata.crm_gantt_opportunities f
    on a.new_opp = f.opportunityid
 where a.statecode = '0'

;
SQL结束执行时间：20190929030054
SQL开始执行时间：20190929030054

drop table if exists edw.crm_key_events_pre2
;
SQL结束执行时间：20190929030054
SQL开始执行时间：20190929030054
create temporary table edw.crm_key_events_pre2 as 
select a.new_key_eventid
      ,a.new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cuscode end as bi_cuscode
      ,case when c.bi_cuscode is null then '请核查' else c.bi_cusname end as bi_cusname
      ,a.name
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_deadline
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre a
 left join (select * from edw.dic_customer group by ccuscode) c
   on a.cuscode = c.ccuscode
 where a.cuscode is not null
 order by new_opp,new_deadline

;
SQL结束执行时间：20190929030054
SQL开始执行时间：20190929030054


truncate table edw.crm_key_events
;
SQL结束执行时间：20190929030054
SQL开始执行时间：20190929030054
insert into edw.crm_key_events
select a.new_key_eventid
      ,@r:= case when @new_opp=a.new_opp then @r+1 else 1 end as rownum
      ,@new_opp:= a.new_opp as new_opp
      ,a.new_area
      ,a.new_province
      ,a.new_city
      ,a.new_county
      ,a.cuscode
      ,a.cusname
      ,a.bi_cuscode
      ,a.bi_cusname
      ,a.name
      ,a.new_deadline
      ,a.new_contact
      ,a.new_name
      ,a.new_finish_time
      ,a.new_region_trace
      ,a.new_province_trace
      ,a.ownerid
      ,a.new_status
      ,a.new_finish_date
      ,a.new_deflection
      ,a.new_memo
      ,a.sys_time
  from edw.crm_key_events_pre2 a
      ,(select @r:=0 ,@new_opp:='',@new_deadline:='') b

;
SQL结束执行时间：20190929030054
