
20181126163338开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181126163338

use edw
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181126163338
SQL开始执行时间：20181126163338

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163339
SQL开始执行时间：20181126163339

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181126163339
SQL开始执行时间：20181126163339


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp()
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;

20181126163624开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181126163624

use edw
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181126163624
SQL开始执行时间：20181126163624


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp()
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163652
SQL开始执行时间：20181126163652

insert into edw.sales_order
select db
      ,csocode
      ,id
      ,ddate
      ,ccuscode
      ,ccusname
      ,true_ccuscode
      ,true_ccusname
      ,finnal_ccusname
      ,true_finnal_ccuscode
      ,true_finnal_ccusname1
      ,true_finnal_ccusname2
      ,cmaker
      ,cverifier
      ,cmodifier
      ,dcreatesystime
      ,dmodifysystime
      ,cdepcode
      ,cstcode
      ,cpersoncode
      ,ccusperson
      ,ccuspersoncode
      ,cdefine2
      ,cdefine3
      ,autoid
      ,cdefine22
      ,child_csocode
      ,cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,iquantity
      ,itaxunitprice
      ,itax
      ,isum
      ,itaxrate
      ,citemcode
      ,citem_class
      ,citemname
      ,citem_cname
      ,sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;

20181126163804开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181126163804

use edw
;
SQL结束执行时间：20181126163804
SQL开始执行时间：20181126163804
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181126163804
SQL开始执行时间：20181126163804
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181126163804
SQL开始执行时间：20181126163804


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181126163804
SQL开始执行时间：20181126163804


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181126163804
SQL开始执行时间：20181126163804
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181126163805
SQL开始执行时间：20181126163805

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163805
SQL开始执行时间：20181126163805

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181126163805
SQL开始执行时间：20181126163805


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp()
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163833
SQL开始执行时间：20181126163833

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;

20181126163931开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181126163931

use edw
;
SQL结束执行时间：20181126163931
SQL开始执行时间：20181126163931
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181126163931
SQL开始执行时间：20181126163931
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181126163932
SQL开始执行时间：20181126163932


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181126164000
SQL开始执行时间：20181126164000

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181126164001
SQL开始执行时间：20181126164001

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181126164001

20181128104343开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181128104343

use edw
;
SQL结束执行时间：20181128104343
SQL开始执行时间：20181128104343
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181128104343
SQL开始执行时间：20181128104343
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181128104344
SQL开始执行时间：20181128104344


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cvenabbname
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;

20181128104530开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181128104530

use edw
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181128104530
SQL开始执行时间：20181128104530


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181128104559
SQL开始执行时间：20181128104559

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181128104600
SQL开始执行时间：20181128104600

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181128104600

20181129011025开始执行2018-11-28数据加载日志:
SQL开始执行时间：20181129011025

use edw
;
SQL结束执行时间：20181129011025
SQL开始执行时间：20181129011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181129011025
SQL开始执行时间：20181129011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-11-28' or left(a.dmodifysystime,10) >= '2018-11-28')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-11-28' or left(a.dmodifysystime,10) >= '2018-11-28')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181129011026
SQL开始执行时间：20181129011026

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181129011026

20181130011023开始执行2018-11-29数据加载日志:
SQL开始执行时间：20181130011023

use edw
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-11-29' or left(a.dmodifysystime,10) >= '2018-11-29')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-11-29' or left(a.dmodifysystime,10) >= '2018-11-29')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181130011023
SQL开始执行时间：20181130011023

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181130011024
SQL开始执行时间：20181130011024

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181130011024

20181201011027开始执行2018-11-30数据加载日志:
SQL开始执行时间：20181201011027

use edw
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-11-30' or left(a.dmodifysystime,10) >= '2018-11-30')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-11-30' or left(a.dmodifysystime,10) >= '2018-11-30')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181201011027
SQL开始执行时间：20181201011027

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181201011027

20181202011026开始执行2018-12-01数据加载日志:
SQL开始执行时间：20181202011026

use edw
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-01' or left(a.dmodifysystime,10) >= '2018-12-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-01' or left(a.dmodifysystime,10) >= '2018-12-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181202011026
SQL开始执行时间：20181202011026

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181202011026

20181203011023开始执行2018-12-02数据加载日志:
SQL开始执行时间：20181203011023

use edw
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-02' or left(a.dmodifysystime,10) >= '2018-12-02')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-02' or left(a.dmodifysystime,10) >= '2018-12-02')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181203011023
SQL开始执行时间：20181203011023

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181203011023

20181204011023开始执行2018-12-03数据加载日志:
SQL开始执行时间：20181204011023

use edw
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-03' or left(a.dmodifysystime,10) >= '2018-12-03')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-03' or left(a.dmodifysystime,10) >= '2018-12-03')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181204011023
SQL开始执行时间：20181204011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181204011024
SQL开始执行时间：20181204011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181204011024
SQL开始执行时间：20181204011024

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181204011024
SQL开始执行时间：20181204011024

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181204011024

20181205011023开始执行2018-12-04数据加载日志:
SQL开始执行时间：20181205011023

use edw
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-04' or left(a.dmodifysystime,10) >= '2018-12-04')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-04' or left(a.dmodifysystime,10) >= '2018-12-04')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181205011023
SQL开始执行时间：20181205011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181205011024
SQL开始执行时间：20181205011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181205011024
SQL开始执行时间：20181205011024

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181205011024
SQL开始执行时间：20181205011024

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181205011024

20181206011024开始执行2018-12-05数据加载日志:
SQL开始执行时间：20181206011024

use edw
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-05' or left(a.dmodifysystime,10) >= '2018-12-05')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-05' or left(a.dmodifysystime,10) >= '2018-12-05')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181206011024
SQL开始执行时间：20181206011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206011025
SQL开始执行时间：20181206011025

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181206011025
SQL开始执行时间：20181206011025

insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181206011025

20181206102437开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181206102437

use edw
;
SQL结束执行时间：20181206102437
SQL开始执行时间：20181206102437
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181206102437
SQL开始执行时间：20181206102437
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181206102437
SQL开始执行时间：20181206102437


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181206102437
SQL开始执行时间：20181206102437


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181206102437
SQL开始执行时间：20181206102437
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181206102438
SQL开始执行时间：20181206102438

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206102438
SQL开始执行时间：20181206102438

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181206102457
SQL开始执行时间：20181206102457


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;

20181206102535开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181206102535

use edw
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181206102535
SQL开始执行时间：20181206102535

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206102536
SQL开始执行时间：20181206102536

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181206102536
SQL开始执行时间：20181206102536


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206102605
SQL开始执行时间：20181206102605

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181206102606
SQL开始执行时间：20181206102606

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181206102606
SQL开始执行时间：20181206102606


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;

20181206102834开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181206102834

use edw
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181206102834
SQL开始执行时间：20181206102834

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206102835
SQL开始执行时间：20181206102835

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181206102835
SQL开始执行时间：20181206102835


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.bi_cusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181206102905
SQL开始执行时间：20181206102905

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181206102906
SQL开始执行时间：20181206102906

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181206102906
SQL开始执行时间：20181206102906


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181206102923

20181207011026开始执行2018-12-06数据加载日志:
SQL开始执行时间：20181207011026


use edw
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-06' or left(a.dmodifysystime,10) >= '2018-12-06')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-06' or left(a.dmodifysystime,10) >= '2018-12-06')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181207011026
SQL开始执行时间：20181207011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181207011027
SQL开始执行时间：20181207011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181207011027
SQL开始执行时间：20181207011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181207011027
SQL开始执行时间：20181207011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181207011027

20181208011024开始执行2018-12-07数据加载日志:
SQL开始执行时间：20181208011024


use edw
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-07' or left(a.dmodifysystime,10) >= '2018-12-07')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-07' or left(a.dmodifysystime,10) >= '2018-12-07')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181208011024
SQL开始执行时间：20181208011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181208011025
SQL开始执行时间：20181208011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181208011025
SQL开始执行时间：20181208011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181208011025
SQL开始执行时间：20181208011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181208011025

20181209011023开始执行2018-12-08数据加载日志:
SQL开始执行时间：20181209011023


use edw
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-08' or left(a.dmodifysystime,10) >= '2018-12-08')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-08' or left(a.dmodifysystime,10) >= '2018-12-08')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181209011023
SQL开始执行时间：20181209011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181209011023

20181210011024开始执行2018-12-09数据加载日志:
SQL开始执行时间：20181210011024


use edw
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-09' or left(a.dmodifysystime,10) >= '2018-12-09')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-09' or left(a.dmodifysystime,10) >= '2018-12-09')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181210011024
SQL开始执行时间：20181210011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181210011024

20181211011024开始执行2018-12-10数据加载日志:
SQL开始执行时间：20181211011024


use edw
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-10' or left(a.dmodifysystime,10) >= '2018-12-10')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-10' or left(a.dmodifysystime,10) >= '2018-12-10')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181211011024
SQL开始执行时间：20181211011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181211011025
SQL开始执行时间：20181211011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181211011025
SQL开始执行时间：20181211011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181211011025
SQL开始执行时间：20181211011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181211011025
SQL开始执行时间：20181211011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181211011025

20181212011023开始执行2018-12-11数据加载日志:
SQL开始执行时间：20181212011023


use edw
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-11' or left(a.dmodifysystime,10) >= '2018-12-11')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-11' or left(a.dmodifysystime,10) >= '2018-12-11')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181212011023
SQL开始执行时间：20181212011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181212011023

20181213011024开始执行2018-12-12数据加载日志:
SQL开始执行时间：20181213011024


use edw
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-12' or left(a.dmodifysystime,10) >= '2018-12-12')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-12' or left(a.dmodifysystime,10) >= '2018-12-12')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181213011024
SQL开始执行时间：20181213011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181213011025

20181214011026开始执行2018-12-13数据加载日志:
SQL开始执行时间：20181214011026


use edw
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-13' or left(a.dmodifysystime,10) >= '2018-12-13')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-13' or left(a.dmodifysystime,10) >= '2018-12-13')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181214011026
SQL开始执行时间：20181214011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181214011027
SQL开始执行时间：20181214011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181214011027
SQL开始执行时间：20181214011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181214011027
SQL开始执行时间：20181214011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181214011027
SQL开始执行时间：20181214011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181214011027

20181215011024开始执行2018-12-14数据加载日志:
SQL开始执行时间：20181215011024


use edw
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-14' or left(a.dmodifysystime,10) >= '2018-12-14')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-14' or left(a.dmodifysystime,10) >= '2018-12-14')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181215011024
SQL开始执行时间：20181215011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181215011025
SQL开始执行时间：20181215011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181215011025
SQL开始执行时间：20181215011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181215011025

20181216011024开始执行2018-12-15数据加载日志:
SQL开始执行时间：20181216011024


use edw
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-15' or left(a.dmodifysystime,10) >= '2018-12-15')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-15' or left(a.dmodifysystime,10) >= '2018-12-15')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181216011024
SQL开始执行时间：20181216011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181216011024

20181217011026开始执行2018-12-16数据加载日志:
SQL开始执行时间：20181217011026


use edw
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-16' or left(a.dmodifysystime,10) >= '2018-12-16')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-16' or left(a.dmodifysystime,10) >= '2018-12-16')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181217011026
SQL开始执行时间：20181217011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181217011026

20181218011024开始执行2018-12-17数据加载日志:
SQL开始执行时间：20181218011024


use edw
;
SQL结束执行时间：20181218011024
SQL开始执行时间：20181218011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181218011024
SQL开始执行时间：20181218011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-17' or left(a.dmodifysystime,10) >= '2018-12-17')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-17' or left(a.dmodifysystime,10) >= '2018-12-17')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181218011025
SQL开始执行时间：20181218011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181218011026
SQL开始执行时间：20181218011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181218011026
SQL开始执行时间：20181218011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181218011026

20181219011026开始执行2018-12-18数据加载日志:
SQL开始执行时间：20181219011026


use edw
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-18' or left(a.dmodifysystime,10) >= '2018-12-18')
   and (b.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013") or b.ccuscode is null)
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-18' or left(a.dmodifysystime,10) >= '2018-12-18')
   and b.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181219011026
SQL开始执行时间：20181219011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181219011027
SQL开始执行时间：20181219011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181219011027
SQL开始执行时间：20181219011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181219011027
SQL开始执行时间：20181219011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181219011027

20181219110707开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181219110707


use edw
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181219110707
SQL开始执行时间：20181219110707


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181219110744
SQL开始执行时间：20181219110744

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181219110744
SQL开始执行时间：20181219110744

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181219110744
SQL开始执行时间：20181219110744


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181219110804

20181219181444开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181219181444


use edw
;
SQL结束执行时间：20181219181444
SQL开始执行时间：20181219181444
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181219181444
SQL开始执行时间：20181219181444
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181219181445
SQL开始执行时间：20181219181445


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181219181521
SQL开始执行时间：20181219181521

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181219181521
SQL开始执行时间：20181219181521

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181219181521
SQL开始执行时间：20181219181521


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181219181540

20181220011027开始执行2018-12-19数据加载日志:
SQL开始执行时间：20181220011027


use edw
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-19' or left(a.dmodifysystime,10) >= '2018-12-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-19' or left(a.dmodifysystime,10) >= '2018-12-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181220011027
SQL开始执行时间：20181220011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181220011028
SQL开始执行时间：20181220011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181220011028
SQL开始执行时间：20181220011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181220011028
SQL开始执行时间：20181220011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181220011028

20181221011024开始执行2018-12-20数据加载日志:
SQL开始执行时间：20181221011024


use edw
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-20' or left(a.dmodifysystime,10) >= '2018-12-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-20' or left(a.dmodifysystime,10) >= '2018-12-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181221011024
SQL开始执行时间：20181221011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181221011025
SQL开始执行时间：20181221011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181221011025
SQL开始执行时间：20181221011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181221011025
SQL开始执行时间：20181221011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181221011025

20181221150952开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181221150952


use edw
;
SQL结束执行时间：20181221150952
SQL开始执行时间：20181221150952
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181221150952
SQL开始执行时间：20181221150952
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181221150952
SQL开始执行时间：20181221150952


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181221150952
SQL开始执行时间：20181221150952


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181221150952
SQL开始执行时间：20181221150952
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181221150953
SQL开始执行时间：20181221150953

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181221150953
SQL开始执行时间：20181221150953

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181221150953
SQL开始执行时间：20181221150953


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181221151028
SQL开始执行时间：20181221151028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181221151028
SQL开始执行时间：20181221151028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181221151028
SQL开始执行时间：20181221151028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181221151047

20181222011024开始执行2018-12-21数据加载日志:
SQL开始执行时间：20181222011024


use edw
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181222011024
SQL开始执行时间：20181222011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181222011025
SQL开始执行时间：20181222011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181222011025
SQL开始执行时间：20181222011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181222011025
SQL开始执行时间：20181222011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181222011025
SQL开始执行时间：20181222011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181222011025

20181223011024开始执行2018-12-22数据加载日志:
SQL开始执行时间：20181223011024


use edw
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-22' or left(a.dmodifysystime,10) >= '2018-12-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-22' or left(a.dmodifysystime,10) >= '2018-12-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181223011024
SQL开始执行时间：20181223011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181223011024

20181224011024开始执行2018-12-23数据加载日志:
SQL开始执行时间：20181224011024


use edw
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-23' or left(a.dmodifysystime,10) >= '2018-12-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-23' or left(a.dmodifysystime,10) >= '2018-12-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181224011024
SQL开始执行时间：20181224011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181224011024

20181224095233开始执行2018-12-22数据加载日志:
SQL开始执行时间：20181224095233


use edw
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-22' or left(a.dmodifysystime,10) >= '2018-12-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-22' or left(a.dmodifysystime,10) >= '2018-12-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181224095233
SQL开始执行时间：20181224095233


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181224095233

20181224095238开始执行2018-12-21数据加载日志:
SQL开始执行时间：20181224095238


use edw
;
SQL结束执行时间：20181224095238
SQL开始执行时间：20181224095238
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181224095238
SQL开始执行时间：20181224095238
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181224095239
SQL开始执行时间：20181224095239


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181224095240

20181224095816开始执行2018-12-21数据加载日志:
SQL开始执行时间：20181224095816


use edw
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-21' or left(a.dmodifysystime,10) >= '2018-12-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181224095816
SQL开始执行时间：20181224095816


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181224095817
SQL开始执行时间：20181224095817

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181224095817
SQL开始执行时间：20181224095817

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181224095817
SQL开始执行时间：20181224095817


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181224095817

20181225011023开始执行2018-12-24数据加载日志:
SQL开始执行时间：20181225011023


use edw
;
SQL结束执行时间：20181225011023
SQL开始执行时间：20181225011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181225011023
SQL开始执行时间：20181225011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-24' or left(a.dmodifysystime,10) >= '2018-12-24')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-24' or left(a.dmodifysystime,10) >= '2018-12-24')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181225011024
SQL开始执行时间：20181225011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181225011025

20181225103856开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181225103856


use edw
;
SQL结束执行时间：20181225103856
SQL开始执行时间：20181225103856
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181225103856
SQL开始执行时间：20181225103856
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181225103857
SQL开始执行时间：20181225103857


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181225103933
SQL开始执行时间：20181225103933

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181225103933
SQL开始执行时间：20181225103933

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181225103933
SQL开始执行时间：20181225103933


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181225103952

20181225201548开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181225201548


use edw
;
SQL结束执行时间：20181225201548
SQL开始执行时间：20181225201548
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181225201548
SQL开始执行时间：20181225201548
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181225201549
SQL开始执行时间：20181225201549


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181225201626
SQL开始执行时间：20181225201626

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181225201626
SQL开始执行时间：20181225201626

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181225201626
SQL开始执行时间：20181225201626


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181225201645

20181226011024开始执行2018-12-25数据加载日志:
SQL开始执行时间：20181226011024


use edw
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-25' or left(a.dmodifysystime,10) >= '2018-12-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-25' or left(a.dmodifysystime,10) >= '2018-12-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181226011024
SQL开始执行时间：20181226011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181226011025
SQL开始执行时间：20181226011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181226011025
SQL开始执行时间：20181226011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181226011025

20181226141641开始执行1900-01-01数据加载日志:
SQL开始执行时间：20181226141641


use edw
;
SQL结束执行时间：20181226141641
SQL开始执行时间：20181226141641
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181226141641
SQL开始执行时间：20181226141641
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181226141642
SQL开始执行时间：20181226141642


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181226141642
SQL开始执行时间：20181226141642


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181226141642
SQL开始执行时间：20181226141642
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181226141642
SQL开始执行时间：20181226141642

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181226141643
SQL开始执行时间：20181226141643

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181226141643
SQL开始执行时间：20181226141643


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181226141720
SQL开始执行时间：20181226141720

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181226141720
SQL开始执行时间：20181226141720

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181226141720
SQL开始执行时间：20181226141720


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181226141740

20181227011027开始执行2018-12-26数据加载日志:
SQL开始执行时间：20181227011027


use edw
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-26' or left(a.dmodifysystime,10) >= '2018-12-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-26' or left(a.dmodifysystime,10) >= '2018-12-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181227011027
SQL开始执行时间：20181227011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181227011028
SQL开始执行时间：20181227011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181227011028
SQL开始执行时间：20181227011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181227011028
SQL开始执行时间：20181227011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181227011028

20181228011027开始执行2018-12-27数据加载日志:
SQL开始执行时间：20181228011027


use edw
;
SQL结束执行时间：20181228011027
SQL开始执行时间：20181228011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181228011027
SQL开始执行时间：20181228011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-27' or left(a.dmodifysystime,10) >= '2018-12-27')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181228011027
SQL开始执行时间：20181228011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-27' or left(a.dmodifysystime,10) >= '2018-12-27')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181228011027
SQL开始执行时间：20181228011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181228011027
SQL开始执行时间：20181228011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181228011028
SQL开始执行时间：20181228011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181228011028

20181229011026开始执行2018-12-28数据加载日志:
SQL开始执行时间：20181229011026


use edw
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-28' or left(a.dmodifysystime,10) >= '2018-12-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-28' or left(a.dmodifysystime,10) >= '2018-12-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181229011026
SQL开始执行时间：20181229011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181229011027
SQL开始执行时间：20181229011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181229011027
SQL开始执行时间：20181229011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181229011027
SQL开始执行时间：20181229011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181229011027
SQL开始执行时间：20181229011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181229011027

20181230011027开始执行2018-12-29数据加载日志:
SQL开始执行时间：20181230011027


use edw
;
SQL结束执行时间：20181230011027
SQL开始执行时间：20181230011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181230011027
SQL开始执行时间：20181230011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-29' or left(a.dmodifysystime,10) >= '2018-12-29')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181230011027
SQL开始执行时间：20181230011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-29' or left(a.dmodifysystime,10) >= '2018-12-29')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181230011027
SQL开始执行时间：20181230011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181230011027
SQL开始执行时间：20181230011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181230011028
SQL开始执行时间：20181230011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181230011028

20181231011025开始执行2018-12-30数据加载日志:
SQL开始执行时间：20181231011025


use edw
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-30' or left(a.dmodifysystime,10) >= '2018-12-30')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-30' or left(a.dmodifysystime,10) >= '2018-12-30')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20181231011025
SQL开始执行时间：20181231011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20181231011025

20190101011025开始执行2018-12-31数据加载日志:
SQL开始执行时间：20190101011025


use edw
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2018-12-31' or left(a.dmodifysystime,10) >= '2018-12-31')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2018-12-31' or left(a.dmodifysystime,10) >= '2018-12-31')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190101011025
SQL开始执行时间：20190101011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190101011025

20190102011025开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190102011025


use edw
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190102011025
SQL开始执行时间：20190102011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190102011025

20190103011026开始执行2019-01-02数据加载日志:
SQL开始执行时间：20190103011026


use edw
;
SQL结束执行时间：20190103011026
SQL开始执行时间：20190103011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190103011026
SQL开始执行时间：20190103011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-02' or left(a.dmodifysystime,10) >= '2019-01-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-02' or left(a.dmodifysystime,10) >= '2019-01-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190103011027
SQL开始执行时间：20190103011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190103011027

20190104011024开始执行2019-01-03数据加载日志:
SQL开始执行时间：20190104011024


use edw
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-03' or left(a.dmodifysystime,10) >= '2019-01-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-03' or left(a.dmodifysystime,10) >= '2019-01-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190104011024
SQL开始执行时间：20190104011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190104011025
SQL开始执行时间：20190104011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190104011025
SQL开始执行时间：20190104011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190104011025
SQL开始执行时间：20190104011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190104011025
SQL开始执行时间：20190104011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190104011025

20190105011025开始执行2019-01-04数据加载日志:
SQL开始执行时间：20190105011025


use edw
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-04' or left(a.dmodifysystime,10) >= '2019-01-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-04' or left(a.dmodifysystime,10) >= '2019-01-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190105011025
SQL开始执行时间：20190105011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190105011026
SQL开始执行时间：20190105011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190105011026
SQL开始执行时间：20190105011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190105011026
SQL开始执行时间：20190105011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190105011026
SQL开始执行时间：20190105011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190105011026

20190106011025开始执行2019-01-05数据加载日志:
SQL开始执行时间：20190106011025


use edw
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-05' or left(a.dmodifysystime,10) >= '2019-01-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-05' or left(a.dmodifysystime,10) >= '2019-01-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190106011025
SQL开始执行时间：20190106011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190106011025

20190107011024开始执行2019-01-06数据加载日志:
SQL开始执行时间：20190107011024


use edw
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-06' or left(a.dmodifysystime,10) >= '2019-01-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-06' or left(a.dmodifysystime,10) >= '2019-01-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190107011024
SQL开始执行时间：20190107011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190107011024

20190108011024开始执行2019-01-07数据加载日志:
SQL开始执行时间：20190108011024


use edw
;
SQL结束执行时间：20190108011024
SQL开始执行时间：20190108011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190108011024
SQL开始执行时间：20190108011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-07' or left(a.dmodifysystime,10) >= '2019-01-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-07' or left(a.dmodifysystime,10) >= '2019-01-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190108011025
SQL开始执行时间：20190108011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190108011026
SQL开始执行时间：20190108011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190108011026
SQL开始执行时间：20190108011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190108011026

20190109011027开始执行2019-01-08数据加载日志:
SQL开始执行时间：20190109011027


use edw
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-08' or left(a.dmodifysystime,10) >= '2019-01-08')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-08' or left(a.dmodifysystime,10) >= '2019-01-08')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190109011027
SQL开始执行时间：20190109011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190109011028
SQL开始执行时间：20190109011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190109011028
SQL开始执行时间：20190109011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190109011028
SQL开始执行时间：20190109011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190109011028
SQL开始执行时间：20190109011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190109011028

20190110011024开始执行2019-01-09数据加载日志:
SQL开始执行时间：20190110011024


use edw
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-09' or left(a.dmodifysystime,10) >= '2019-01-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-09' or left(a.dmodifysystime,10) >= '2019-01-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190110011024
SQL开始执行时间：20190110011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190110011025
SQL开始执行时间：20190110011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190110011025
SQL开始执行时间：20190110011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190110011025
SQL开始执行时间：20190110011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190110011025
SQL开始执行时间：20190110011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190110011025

20190111011027开始执行2019-01-10数据加载日志:
SQL开始执行时间：20190111011027


use edw
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-10' or left(a.dmodifysystime,10) >= '2019-01-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-10' or left(a.dmodifysystime,10) >= '2019-01-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190111011027
SQL开始执行时间：20190111011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190111011028
SQL开始执行时间：20190111011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190111011028
SQL开始执行时间：20190111011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190111011028
SQL开始执行时间：20190111011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190111011028
SQL开始执行时间：20190111011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190111011028

20190112011028开始执行2019-01-11数据加载日志:
SQL开始执行时间：20190112011028


use edw
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-11' or left(a.dmodifysystime,10) >= '2019-01-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-11' or left(a.dmodifysystime,10) >= '2019-01-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190112011028
SQL开始执行时间：20190112011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190112011028

20190113011025开始执行2019-01-12数据加载日志:
SQL开始执行时间：20190113011025


use edw
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-12' or left(a.dmodifysystime,10) >= '2019-01-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-12' or left(a.dmodifysystime,10) >= '2019-01-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190113011025
SQL开始执行时间：20190113011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190113011025

20190114011024开始执行2019-01-13数据加载日志:
SQL开始执行时间：20190114011024


use edw
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-13' or left(a.dmodifysystime,10) >= '2019-01-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-13' or left(a.dmodifysystime,10) >= '2019-01-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190114011024
SQL开始执行时间：20190114011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190114011024

20190115011024开始执行2019-01-14数据加载日志:
SQL开始执行时间：20190115011024


use edw
;
SQL结束执行时间：20190115011024
SQL开始执行时间：20190115011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190115011024
SQL开始执行时间：20190115011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-14' or left(a.dmodifysystime,10) >= '2019-01-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-14' or left(a.dmodifysystime,10) >= '2019-01-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190115011025
SQL开始执行时间：20190115011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190115011026

20190116011025开始执行2019-01-15数据加载日志:
SQL开始执行时间：20190116011025


use edw
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-15' or left(a.dmodifysystime,10) >= '2019-01-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-15' or left(a.dmodifysystime,10) >= '2019-01-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190116011025
SQL开始执行时间：20190116011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190116011025

20190117011025开始执行2019-01-16数据加载日志:
SQL开始执行时间：20190117011025


use edw
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-16' or left(a.dmodifysystime,10) >= '2019-01-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-16' or left(a.dmodifysystime,10) >= '2019-01-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190117011025
SQL开始执行时间：20190117011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190117011026
SQL开始执行时间：20190117011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190117011026
SQL开始执行时间：20190117011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190117011026
SQL开始执行时间：20190117011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190117011026
SQL开始执行时间：20190117011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190117011026

20190117095554开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190117095554


use edw
;
SQL结束执行时间：20190117095554
SQL开始执行时间：20190117095554
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190117095554
SQL开始执行时间：20190117095554
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117095554
SQL开始执行时间：20190117095554


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117095554
SQL开始执行时间：20190117095554


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190117095554
SQL开始执行时间：20190117095554
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190117095555
SQL开始执行时间：20190117095555

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190117095555
SQL开始执行时间：20190117095555

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190117095620
SQL开始执行时间：20190117095620


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190117095701
SQL开始执行时间：20190117095701

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190117095702
SQL开始执行时间：20190117095702

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190117095702
SQL开始执行时间：20190117095702


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190117095724

20190117105104开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190117105104


use edw
;
SQL结束执行时间：20190117105104
SQL开始执行时间：20190117105104
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190117105104
SQL开始执行时间：20190117105104
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117105105
SQL开始执行时间：20190117105105


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190117105105
SQL开始执行时间：20190117105105


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190117105105
SQL开始执行时间：20190117105105
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190117105105
SQL开始执行时间：20190117105105

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190117105105
SQL开始执行时间：20190117105105

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190117105131
SQL开始执行时间：20190117105131
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190117105131
SQL开始执行时间：20190117105131
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190117105131
SQL开始执行时间：20190117105131


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190117105213
SQL开始执行时间：20190117105213

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190117105213
SQL开始执行时间：20190117105213

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190117105213
SQL开始执行时间：20190117105213


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190117105235

20190118011025开始执行2019-01-17数据加载日志:
SQL开始执行时间：20190118011025


use edw
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-17' or left(a.dmodifysystime,10) >= '2019-01-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-17' or left(a.dmodifysystime,10) >= '2019-01-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190118011025
SQL开始执行时间：20190118011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190118011026
SQL开始执行时间：20190118011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190118011026
SQL开始执行时间：20190118011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190118011026
SQL开始执行时间：20190118011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190118011026

20190122165508开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190122165508


use edw
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190122165508
SQL开始执行时间：20190122165508

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190122165512
SQL开始执行时间：20190122165512
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190122165512
SQL开始执行时间：20190122165512
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190122165512
SQL开始执行时间：20190122165512


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190122165515
SQL开始执行时间：20190122165515

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190122165515
SQL开始执行时间：20190122165515

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190122165515
SQL开始执行时间：20190122165515


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190122165517

20190123011027开始执行2019-01-22数据加载日志:
SQL开始执行时间：20190123011027


use edw
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-22' or left(a.dmodifysystime,10) >= '2019-01-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-22' or left(a.dmodifysystime,10) >= '2019-01-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190123011027
SQL开始执行时间：20190123011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190123011028
SQL开始执行时间：20190123011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190123011028

20190124011025开始执行2019-01-23数据加载日志:
SQL开始执行时间：20190124011025


use edw
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-23' or left(a.dmodifysystime,10) >= '2019-01-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-23' or left(a.dmodifysystime,10) >= '2019-01-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190124011025
SQL开始执行时间：20190124011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190124011025

20190126011023开始执行2019-01-25数据加载日志:
SQL开始执行时间：20190126011023


use edw
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-25' or left(a.dmodifysystime,10) >= '2019-01-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-25' or left(a.dmodifysystime,10) >= '2019-01-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190126011023
SQL开始执行时间：20190126011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190126011023

20190129011023开始执行2019-01-28数据加载日志:
SQL开始执行时间：20190129011023


use edw
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-28' or left(a.dmodifysystime,10) >= '2019-01-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-28' or left(a.dmodifysystime,10) >= '2019-01-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190129011023
SQL开始执行时间：20190129011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190129011024
SQL开始执行时间：20190129011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190129011024
SQL开始执行时间：20190129011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190129011024
SQL开始执行时间：20190129011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190129011024

20190130011024开始执行2019-01-29数据加载日志:
SQL开始执行时间：20190130011024


use edw
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-29' or left(a.dmodifysystime,10) >= '2019-01-29')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-29' or left(a.dmodifysystime,10) >= '2019-01-29')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190130011024
SQL开始执行时间：20190130011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190130011024

20190131011021开始执行2019-01-30数据加载日志:
SQL开始执行时间：20190131011021


use edw
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-30' or left(a.dmodifysystime,10) >= '2019-01-30')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-30' or left(a.dmodifysystime,10) >= '2019-01-30')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190131011021
SQL开始执行时间：20190131011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190131011022
SQL开始执行时间：20190131011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190131011022

20190201011023开始执行2019-01-31数据加载日志:
SQL开始执行时间：20190201011023


use edw
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-31' or left(a.dmodifysystime,10) >= '2019-01-31')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-31' or left(a.dmodifysystime,10) >= '2019-01-31')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190201011023
SQL开始执行时间：20190201011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190201011024
SQL开始执行时间：20190201011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190201011024
SQL开始执行时间：20190201011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190201011024
SQL开始执行时间：20190201011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190201011024

20190202011021开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190202011021


use edw
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-01' or left(a.dmodifysystime,10) >= '2019-02-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-01' or left(a.dmodifysystime,10) >= '2019-02-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190202011021
SQL开始执行时间：20190202011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190202011022
SQL开始执行时间：20190202011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190202011022
SQL开始执行时间：20190202011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190202011022
SQL开始执行时间：20190202011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190202011022

20190203011021开始执行2019-02-02数据加载日志:
SQL开始执行时间：20190203011021


use edw
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-02' or left(a.dmodifysystime,10) >= '2019-02-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-02' or left(a.dmodifysystime,10) >= '2019-02-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190203011021
SQL开始执行时间：20190203011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190203011021

20190204011023开始执行2019-02-03数据加载日志:
SQL开始执行时间：20190204011023


use edw
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-03' or left(a.dmodifysystime,10) >= '2019-02-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-03' or left(a.dmodifysystime,10) >= '2019-02-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190204011023
SQL开始执行时间：20190204011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190204011023

20190205011021开始执行2019-02-04数据加载日志:
SQL开始执行时间：20190205011021


use edw
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-04' or left(a.dmodifysystime,10) >= '2019-02-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-04' or left(a.dmodifysystime,10) >= '2019-02-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190205011021
SQL开始执行时间：20190205011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190205011021

20190206011020开始执行2019-02-05数据加载日志:
SQL开始执行时间：20190206011020


use edw
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-05' or left(a.dmodifysystime,10) >= '2019-02-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-05' or left(a.dmodifysystime,10) >= '2019-02-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190206011020
SQL开始执行时间：20190206011020


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190206011020

20190207011024开始执行2019-02-06数据加载日志:
SQL开始执行时间：20190207011024


use edw
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-06' or left(a.dmodifysystime,10) >= '2019-02-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-06' or left(a.dmodifysystime,10) >= '2019-02-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190207011024
SQL开始执行时间：20190207011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190207011024

20190208011024开始执行2019-02-07数据加载日志:
SQL开始执行时间：20190208011024


use edw
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-07' or left(a.dmodifysystime,10) >= '2019-02-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-07' or left(a.dmodifysystime,10) >= '2019-02-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190208011024
SQL开始执行时间：20190208011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190208011024

20190209011021开始执行2019-02-08数据加载日志:
SQL开始执行时间：20190209011021


use edw
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-08' or left(a.dmodifysystime,10) >= '2019-02-08')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-08' or left(a.dmodifysystime,10) >= '2019-02-08')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190209011021
SQL开始执行时间：20190209011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190209011021

20190210011024开始执行2019-02-09数据加载日志:
SQL开始执行时间：20190210011024


use edw
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-09' or left(a.dmodifysystime,10) >= '2019-02-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-09' or left(a.dmodifysystime,10) >= '2019-02-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190210011024
SQL开始执行时间：20190210011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190210011024

20190211011023开始执行2019-02-10数据加载日志:
SQL开始执行时间：20190211011023


use edw
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-10' or left(a.dmodifysystime,10) >= '2019-02-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-10' or left(a.dmodifysystime,10) >= '2019-02-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190211011023
SQL开始执行时间：20190211011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190211011023

20190212011021开始执行2019-02-11数据加载日志:
SQL开始执行时间：20190212011021


use edw
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-11' or left(a.dmodifysystime,10) >= '2019-02-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-11' or left(a.dmodifysystime,10) >= '2019-02-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190212011021
SQL开始执行时间：20190212011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190212011022
SQL开始执行时间：20190212011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190212011022
SQL开始执行时间：20190212011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190212011022
SQL开始执行时间：20190212011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190212011022

20190213011023开始执行2019-02-12数据加载日志:
SQL开始执行时间：20190213011023


use edw
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-12' or left(a.dmodifysystime,10) >= '2019-02-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-12' or left(a.dmodifysystime,10) >= '2019-02-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190213011023
SQL开始执行时间：20190213011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190213011024

20190214011024开始执行2019-02-13数据加载日志:
SQL开始执行时间：20190214011024


use edw
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-13' or left(a.dmodifysystime,10) >= '2019-02-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-13' or left(a.dmodifysystime,10) >= '2019-02-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190214011024
SQL开始执行时间：20190214011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190214011024

20190215011021开始执行2019-02-14数据加载日志:
SQL开始执行时间：20190215011021


use edw
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-14' or left(a.dmodifysystime,10) >= '2019-02-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-14' or left(a.dmodifysystime,10) >= '2019-02-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190215011021
SQL开始执行时间：20190215011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190215011022
SQL开始执行时间：20190215011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190215011022
SQL开始执行时间：20190215011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190215011022
SQL开始执行时间：20190215011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190215011022

20190216011021开始执行2019-02-15数据加载日志:
SQL开始执行时间：20190216011021


use edw
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-15' or left(a.dmodifysystime,10) >= '2019-02-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-15' or left(a.dmodifysystime,10) >= '2019-02-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190216011021
SQL开始执行时间：20190216011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190216011021

20190217011021开始执行2019-02-16数据加载日志:
SQL开始执行时间：20190217011021


use edw
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-16' or left(a.dmodifysystime,10) >= '2019-02-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-16' or left(a.dmodifysystime,10) >= '2019-02-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190217011021
SQL开始执行时间：20190217011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190217011021

20190218011033开始执行2019-02-17数据加载日志:
SQL开始执行时间：20190218011033


use edw
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-17' or left(a.dmodifysystime,10) >= '2019-02-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-17' or left(a.dmodifysystime,10) >= '2019-02-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190218011033
SQL开始执行时间：20190218011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190218011033

20190219011021开始执行2019-02-18数据加载日志:
SQL开始执行时间：20190219011021


use edw
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-18' or left(a.dmodifysystime,10) >= '2019-02-18')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-18' or left(a.dmodifysystime,10) >= '2019-02-18')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190219011021
SQL开始执行时间：20190219011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190219011022
SQL开始执行时间：20190219011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190219011022
SQL开始执行时间：20190219011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190219011022

20190220011021开始执行2019-02-19数据加载日志:
SQL开始执行时间：20190220011021


use edw
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-19' or left(a.dmodifysystime,10) >= '2019-02-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-19' or left(a.dmodifysystime,10) >= '2019-02-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190220011021
SQL开始执行时间：20190220011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190220011022
SQL开始执行时间：20190220011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190220011022
SQL开始执行时间：20190220011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190220011022
SQL开始执行时间：20190220011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190220011022

20190221011021开始执行2019-02-20数据加载日志:
SQL开始执行时间：20190221011021


use edw
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-20' or left(a.dmodifysystime,10) >= '2019-02-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-20' or left(a.dmodifysystime,10) >= '2019-02-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190221011021
SQL开始执行时间：20190221011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190221011022
SQL开始执行时间：20190221011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190221011022
SQL开始执行时间：20190221011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190221011022

20190222011021开始执行2019-02-21数据加载日志:
SQL开始执行时间：20190222011021


use edw
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-21' or left(a.dmodifysystime,10) >= '2019-02-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-21' or left(a.dmodifysystime,10) >= '2019-02-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190222011021
SQL开始执行时间：20190222011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190222011022
SQL开始执行时间：20190222011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190222011022
SQL开始执行时间：20190222011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190222011022
SQL开始执行时间：20190222011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190222011022

20190223011021开始执行2019-02-22数据加载日志:
SQL开始执行时间：20190223011021


use edw
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-22' or left(a.dmodifysystime,10) >= '2019-02-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-22' or left(a.dmodifysystime,10) >= '2019-02-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190223011021
SQL开始执行时间：20190223011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190223011022
SQL开始执行时间：20190223011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190223011022

20190224011021开始执行2019-02-23数据加载日志:
SQL开始执行时间：20190224011021


use edw
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-23' or left(a.dmodifysystime,10) >= '2019-02-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-23' or left(a.dmodifysystime,10) >= '2019-02-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190224011021
SQL开始执行时间：20190224011021


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190224011021

20190225011024开始执行2019-02-24数据加载日志:
SQL开始执行时间：20190225011024


use edw
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-24' or left(a.dmodifysystime,10) >= '2019-02-24')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-24' or left(a.dmodifysystime,10) >= '2019-02-24')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190225011024
SQL开始执行时间：20190225011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190225011024

20190226011021开始执行2019-02-25数据加载日志:
SQL开始执行时间：20190226011021


use edw
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-25' or left(a.dmodifysystime,10) >= '2019-02-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-25' or left(a.dmodifysystime,10) >= '2019-02-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190226011021
SQL开始执行时间：20190226011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190226011022
SQL开始执行时间：20190226011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190226011022

20190227011024开始执行2019-02-26数据加载日志:
SQL开始执行时间：20190227011024


use edw
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-26' or left(a.dmodifysystime,10) >= '2019-02-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-26' or left(a.dmodifysystime,10) >= '2019-02-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190227011024
SQL开始执行时间：20190227011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190227011024

20190228011021开始执行2019-02-27数据加载日志:
SQL开始执行时间：20190228011021


use edw
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-27' or left(a.dmodifysystime,10) >= '2019-02-27')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-27' or left(a.dmodifysystime,10) >= '2019-02-27')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190228011021
SQL开始执行时间：20190228011021


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190228011022
SQL开始执行时间：20190228011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190228011022
SQL开始执行时间：20190228011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190228011022
SQL开始执行时间：20190228011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190228011022

20190301011024开始执行2019-02-28数据加载日志:
SQL开始执行时间：20190301011024


use edw
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-02-28' or left(a.dmodifysystime,10) >= '2019-02-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-02-28' or left(a.dmodifysystime,10) >= '2019-02-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190301011024
SQL开始执行时间：20190301011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190301011025
SQL开始执行时间：20190301011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190301011025
SQL开始执行时间：20190301011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190301011025
SQL开始执行时间：20190301011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190301011025

20190302011021开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190302011021


use edw
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-01' or left(a.dmodifysystime,10) >= '2019-03-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-01' or left(a.dmodifysystime,10) >= '2019-03-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190302011021
SQL开始执行时间：20190302011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190302011022
SQL开始执行时间：20190302011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190302011022

20190303011022开始执行2019-03-02数据加载日志:
SQL开始执行时间：20190303011022


use edw
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-02' or left(a.dmodifysystime,10) >= '2019-03-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-02' or left(a.dmodifysystime,10) >= '2019-03-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190303011022
SQL开始执行时间：20190303011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190303011022

20190304011022开始执行2019-03-03数据加载日志:
SQL开始执行时间：20190304011022


use edw
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-03' or left(a.dmodifysystime,10) >= '2019-03-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-03' or left(a.dmodifysystime,10) >= '2019-03-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190304011022
SQL开始执行时间：20190304011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190304011022

20190305011022开始执行2019-03-04数据加载日志:
SQL开始执行时间：20190305011022


use edw
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-04' or left(a.dmodifysystime,10) >= '2019-03-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-04' or left(a.dmodifysystime,10) >= '2019-03-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190305011022
SQL开始执行时间：20190305011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190305011023
SQL开始执行时间：20190305011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190305011023
SQL开始执行时间：20190305011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190305011023
SQL开始执行时间：20190305011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190305011023

20190306011024开始执行2019-03-05数据加载日志:
SQL开始执行时间：20190306011024


use edw
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-05' or left(a.dmodifysystime,10) >= '2019-03-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-05' or left(a.dmodifysystime,10) >= '2019-03-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190306011024
SQL开始执行时间：20190306011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190306011025
SQL开始执行时间：20190306011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190306011025

20190307011022开始执行2019-03-06数据加载日志:
SQL开始执行时间：20190307011022


use edw
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-06' or left(a.dmodifysystime,10) >= '2019-03-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-06' or left(a.dmodifysystime,10) >= '2019-03-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190307011022
SQL开始执行时间：20190307011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190307011023
SQL开始执行时间：20190307011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190307011023
SQL开始执行时间：20190307011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190307011023
SQL开始执行时间：20190307011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190307011023

20190308011024开始执行2019-03-07数据加载日志:
SQL开始执行时间：20190308011024


use edw
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-07' or left(a.dmodifysystime,10) >= '2019-03-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-07' or left(a.dmodifysystime,10) >= '2019-03-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190308011024
SQL开始执行时间：20190308011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190308011025
SQL开始执行时间：20190308011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190308011025

20190309011022开始执行2019-03-08数据加载日志:
SQL开始执行时间：20190309011022


use edw
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-08' or left(a.dmodifysystime,10) >= '2019-03-08')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-08' or left(a.dmodifysystime,10) >= '2019-03-08')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190309011022
SQL开始执行时间：20190309011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190309011023
SQL开始执行时间：20190309011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190309011023
SQL开始执行时间：20190309011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190309011023
SQL开始执行时间：20190309011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190309011023

20190310011021开始执行2019-03-09数据加载日志:
SQL开始执行时间：20190310011021


use edw
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-09' or left(a.dmodifysystime,10) >= '2019-03-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-09' or left(a.dmodifysystime,10) >= '2019-03-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190310011021
SQL开始执行时间：20190310011021
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190310011022
SQL开始执行时间：20190310011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190310011022
SQL开始执行时间：20190310011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190310011022
SQL开始执行时间：20190310011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190310011022
SQL开始执行时间：20190310011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190310011022

20190311011022开始执行2019-03-10数据加载日志:
SQL开始执行时间：20190311011022


use edw
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-10' or left(a.dmodifysystime,10) >= '2019-03-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-10' or left(a.dmodifysystime,10) >= '2019-03-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190311011022
SQL开始执行时间：20190311011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190311011022

20190312011022开始执行2019-03-11数据加载日志:
SQL开始执行时间：20190312011022


use edw
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-11' or left(a.dmodifysystime,10) >= '2019-03-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-11' or left(a.dmodifysystime,10) >= '2019-03-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190312011022
SQL开始执行时间：20190312011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190312011023
SQL开始执行时间：20190312011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190312011023

20190313011022开始执行2019-03-12数据加载日志:
SQL开始执行时间：20190313011022


use edw
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-12' or left(a.dmodifysystime,10) >= '2019-03-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-12' or left(a.dmodifysystime,10) >= '2019-03-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190313011022
SQL开始执行时间：20190313011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190313011023
SQL开始执行时间：20190313011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190313011023
SQL开始执行时间：20190313011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190313011023
SQL开始执行时间：20190313011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190313011023

20190314011022开始执行2019-03-13数据加载日志:
SQL开始执行时间：20190314011022


use edw
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-13' or left(a.dmodifysystime,10) >= '2019-03-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-13' or left(a.dmodifysystime,10) >= '2019-03-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190314011022
SQL开始执行时间：20190314011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190314011023
SQL开始执行时间：20190314011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190314011023

20190315011022开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190315011022


use edw
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-14' or left(a.dmodifysystime,10) >= '2019-03-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-14' or left(a.dmodifysystime,10) >= '2019-03-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190315011022
SQL开始执行时间：20190315011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190315011023
SQL开始执行时间：20190315011023


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190315011023

20190316011023开始执行2019-03-15数据加载日志:
SQL开始执行时间：20190316011023


use edw
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-15' or left(a.dmodifysystime,10) >= '2019-03-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-15' or left(a.dmodifysystime,10) >= '2019-03-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190316011023
SQL开始执行时间：20190316011023


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190316011024
SQL开始执行时间：20190316011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190316011024
SQL开始执行时间：20190316011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190316011024
SQL开始执行时间：20190316011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190316011024

20190317011025开始执行2019-03-16数据加载日志:
SQL开始执行时间：20190317011025


use edw
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-16' or left(a.dmodifysystime,10) >= '2019-03-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-16' or left(a.dmodifysystime,10) >= '2019-03-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190317011025
SQL开始执行时间：20190317011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190317011025

20190318011022开始执行2019-03-17数据加载日志:
SQL开始执行时间：20190318011022


use edw
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-17' or left(a.dmodifysystime,10) >= '2019-03-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-17' or left(a.dmodifysystime,10) >= '2019-03-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190318011022
SQL开始执行时间：20190318011022


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190318011022

20190319011024开始执行2019-03-18数据加载日志:
SQL开始执行时间：20190319011024


use edw
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-18' or left(a.dmodifysystime,10) >= '2019-03-18')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-18' or left(a.dmodifysystime,10) >= '2019-03-18')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190319011024
SQL开始执行时间：20190319011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190319011025
SQL开始执行时间：20190319011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190319011025

20190320011025开始执行2019-03-19数据加载日志:
SQL开始执行时间：20190320011025


use edw
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-19' or left(a.dmodifysystime,10) >= '2019-03-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-19' or left(a.dmodifysystime,10) >= '2019-03-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190320011025
SQL开始执行时间：20190320011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190320011026
SQL开始执行时间：20190320011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190320011026

20190321011024开始执行2019-03-20数据加载日志:
SQL开始执行时间：20190321011024


use edw
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-20' or left(a.dmodifysystime,10) >= '2019-03-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-20' or left(a.dmodifysystime,10) >= '2019-03-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190321011024
SQL开始执行时间：20190321011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190321011024

20190322011024开始执行2019-03-21数据加载日志:
SQL开始执行时间：20190322011024


use edw
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-21' or left(a.dmodifysystime,10) >= '2019-03-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-21' or left(a.dmodifysystime,10) >= '2019-03-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190322011024
SQL开始执行时间：20190322011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190322011025
SQL开始执行时间：20190322011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190322011025
SQL开始执行时间：20190322011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190322011025
SQL开始执行时间：20190322011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190322011025

20190323011024开始执行2019-03-22数据加载日志:
SQL开始执行时间：20190323011024


use edw
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-22' or left(a.dmodifysystime,10) >= '2019-03-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-22' or left(a.dmodifysystime,10) >= '2019-03-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190323011024
SQL开始执行时间：20190323011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190323011025

20190326011026开始执行2019-03-25数据加载日志:
SQL开始执行时间：20190326011026


use edw
;
SQL结束执行时间：20190326011026
SQL开始执行时间：20190326011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190326011026
SQL开始执行时间：20190326011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-25' or left(a.dmodifysystime,10) >= '2019-03-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190326011026
SQL开始执行时间：20190326011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-25' or left(a.dmodifysystime,10) >= '2019-03-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190326011026
SQL开始执行时间：20190326011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190326011026
SQL开始执行时间：20190326011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190326011027
SQL开始执行时间：20190326011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190326011028
SQL开始执行时间：20190326011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190326011028
SQL开始执行时间：20190326011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190326011028

20190327011024开始执行2019-03-26数据加载日志:
SQL开始执行时间：20190327011024


use edw
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-26' or left(a.dmodifysystime,10) >= '2019-03-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-26' or left(a.dmodifysystime,10) >= '2019-03-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190327011024
SQL开始执行时间：20190327011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190327011025
SQL开始执行时间：20190327011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190327011025

20190328011026开始执行2019-03-27数据加载日志:
SQL开始执行时间：20190328011026


use edw
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-27' or left(a.dmodifysystime,10) >= '2019-03-27')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-27' or left(a.dmodifysystime,10) >= '2019-03-27')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190328011026
SQL开始执行时间：20190328011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190328011027
SQL开始执行时间：20190328011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190328011027

20190329011026开始执行2019-03-28数据加载日志:
SQL开始执行时间：20190329011026


use edw
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-28' or left(a.dmodifysystime,10) >= '2019-03-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-28' or left(a.dmodifysystime,10) >= '2019-03-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190329011026
SQL开始执行时间：20190329011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190329011027
SQL开始执行时间：20190329011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190329011027

20190330011025开始执行2019-03-29数据加载日志:
SQL开始执行时间：20190330011025


use edw
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-29' or left(a.dmodifysystime,10) >= '2019-03-29')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-29' or left(a.dmodifysystime,10) >= '2019-03-29')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190330011025
SQL开始执行时间：20190330011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190330011026
SQL开始执行时间：20190330011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190330011026
SQL开始执行时间：20190330011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190330011026
SQL开始执行时间：20190330011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190330011026

20190331011026开始执行2019-03-30数据加载日志:
SQL开始执行时间：20190331011026


use edw
;
SQL结束执行时间：20190331011026
SQL开始执行时间：20190331011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190331011026
SQL开始执行时间：20190331011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-30' or left(a.dmodifysystime,10) >= '2019-03-30')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-30' or left(a.dmodifysystime,10) >= '2019-03-30')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190331011027
SQL开始执行时间：20190331011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190331011027

20190401011027开始执行2019-03-31数据加载日志:
SQL开始执行时间：20190401011027


use edw
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-03-31' or left(a.dmodifysystime,10) >= '2019-03-31')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-03-31' or left(a.dmodifysystime,10) >= '2019-03-31')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190401011027
SQL开始执行时间：20190401011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190401011027

20190402011024开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190402011024


use edw
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-01' or left(a.dmodifysystime,10) >= '2019-04-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-01' or left(a.dmodifysystime,10) >= '2019-04-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190402011024
SQL开始执行时间：20190402011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190402011025
SQL开始执行时间：20190402011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190402011025

20190403011025开始执行2019-04-02数据加载日志:
SQL开始执行时间：20190403011025


use edw
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-02' or left(a.dmodifysystime,10) >= '2019-04-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-02' or left(a.dmodifysystime,10) >= '2019-04-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190403011025
SQL开始执行时间：20190403011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190403011026
SQL开始执行时间：20190403011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190403011026

20190404011024开始执行2019-04-03数据加载日志:
SQL开始执行时间：20190404011024


use edw
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-03' or left(a.dmodifysystime,10) >= '2019-04-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-03' or left(a.dmodifysystime,10) >= '2019-04-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190404011024
SQL开始执行时间：20190404011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190404011025
SQL开始执行时间：20190404011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190404011025
SQL开始执行时间：20190404011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190404011025
SQL开始执行时间：20190404011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190404011025
SQL开始执行时间：20190404011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190404011025

20190405011026开始执行2019-04-04数据加载日志:
SQL开始执行时间：20190405011026


use edw
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-04' or left(a.dmodifysystime,10) >= '2019-04-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-04' or left(a.dmodifysystime,10) >= '2019-04-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190405011026
SQL开始执行时间：20190405011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190405011027
SQL开始执行时间：20190405011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190405011027

20190406011027开始执行2019-04-05数据加载日志:
SQL开始执行时间：20190406011027


use edw
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-05' or left(a.dmodifysystime,10) >= '2019-04-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-05' or left(a.dmodifysystime,10) >= '2019-04-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190406011027
SQL开始执行时间：20190406011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190406011027

20190407011027开始执行2019-04-06数据加载日志:
SQL开始执行时间：20190407011027


use edw
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-06' or left(a.dmodifysystime,10) >= '2019-04-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-06' or left(a.dmodifysystime,10) >= '2019-04-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190407011027
SQL开始执行时间：20190407011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190407011027

20190408011024开始执行2019-04-07数据加载日志:
SQL开始执行时间：20190408011024


use edw
;
SQL结束执行时间：20190408011024
SQL开始执行时间：20190408011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-07' or left(a.dmodifysystime,10) >= '2019-04-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-07' or left(a.dmodifysystime,10) >= '2019-04-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190408011025
SQL开始执行时间：20190408011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190408011025

20190409011025开始执行2019-04-08数据加载日志:
SQL开始执行时间：20190409011025


use edw
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-08' or left(a.dmodifysystime,10) >= '2019-04-08')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-08' or left(a.dmodifysystime,10) >= '2019-04-08')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190409011025
SQL开始执行时间：20190409011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190409011026
SQL开始执行时间：20190409011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190409011026

20190410011025开始执行2019-04-09数据加载日志:
SQL开始执行时间：20190410011025


use edw
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-09' or left(a.dmodifysystime,10) >= '2019-04-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-09' or left(a.dmodifysystime,10) >= '2019-04-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190410011025
SQL开始执行时间：20190410011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190410011026
SQL开始执行时间：20190410011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190410011026
SQL开始执行时间：20190410011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190410011026
SQL开始执行时间：20190410011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190410011026

20190411011027开始执行2019-04-10数据加载日志:
SQL开始执行时间：20190411011027


use edw
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-10' or left(a.dmodifysystime,10) >= '2019-04-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-10' or left(a.dmodifysystime,10) >= '2019-04-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190411011027
SQL开始执行时间：20190411011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190411011028
SQL开始执行时间：20190411011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190411011028

20190412011025开始执行2019-04-11数据加载日志:
SQL开始执行时间：20190412011025


use edw
;
SQL结束执行时间：20190412011025
SQL开始执行时间：20190412011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190412011025
SQL开始执行时间：20190412011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-11' or left(a.dmodifysystime,10) >= '2019-04-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190412011025
SQL开始执行时间：20190412011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-11' or left(a.dmodifysystime,10) >= '2019-04-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190412011025
SQL开始执行时间：20190412011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190412011025
SQL开始执行时间：20190412011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190412011026
SQL开始执行时间：20190412011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190412011026

20190413011026开始执行2019-04-12数据加载日志:
SQL开始执行时间：20190413011026


use edw
;
SQL结束执行时间：20190413011026
SQL开始执行时间：20190413011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190413011026
SQL开始执行时间：20190413011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-12' or left(a.dmodifysystime,10) >= '2019-04-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190413011026
SQL开始执行时间：20190413011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-12' or left(a.dmodifysystime,10) >= '2019-04-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190413011026
SQL开始执行时间：20190413011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190413011026
SQL开始执行时间：20190413011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190413011027
SQL开始执行时间：20190413011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190413011027

20190414011027开始执行2019-04-13数据加载日志:
SQL开始执行时间：20190414011027


use edw
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-13' or left(a.dmodifysystime,10) >= '2019-04-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-13' or left(a.dmodifysystime,10) >= '2019-04-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190414011027
SQL开始执行时间：20190414011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190414011027

20190415011028开始执行2019-04-14数据加载日志:
SQL开始执行时间：20190415011028


use edw
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-14' or left(a.dmodifysystime,10) >= '2019-04-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-14' or left(a.dmodifysystime,10) >= '2019-04-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190415011028
SQL开始执行时间：20190415011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190415011028

20190416011027开始执行2019-04-15数据加载日志:
SQL开始执行时间：20190416011027


use edw
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-15' or left(a.dmodifysystime,10) >= '2019-04-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-15' or left(a.dmodifysystime,10) >= '2019-04-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190416011027
SQL开始执行时间：20190416011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190416011028
SQL开始执行时间：20190416011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190416011028
SQL开始执行时间：20190416011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190416011028
SQL开始执行时间：20190416011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190416011028

20190417011027开始执行2019-04-16数据加载日志:
SQL开始执行时间：20190417011027


use edw
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-16' or left(a.dmodifysystime,10) >= '2019-04-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-16' or left(a.dmodifysystime,10) >= '2019-04-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190417011027
SQL开始执行时间：20190417011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190417011028
SQL开始执行时间：20190417011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190417011028
SQL开始执行时间：20190417011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190417011028
SQL开始执行时间：20190417011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190417011028

20190418011024开始执行2019-04-17数据加载日志:
SQL开始执行时间：20190418011024


use edw
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-17' or left(a.dmodifysystime,10) >= '2019-04-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-17' or left(a.dmodifysystime,10) >= '2019-04-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190418011024
SQL开始执行时间：20190418011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190418011025
SQL开始执行时间：20190418011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190418011025
SQL开始执行时间：20190418011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190418011025
SQL开始执行时间：20190418011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190418011025

20190419011027开始执行2019-04-18数据加载日志:
SQL开始执行时间：20190419011027


use edw
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-18' or left(a.dmodifysystime,10) >= '2019-04-18')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-18' or left(a.dmodifysystime,10) >= '2019-04-18')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190419011027
SQL开始执行时间：20190419011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190419011027

20190420011024开始执行2019-04-19数据加载日志:
SQL开始执行时间：20190420011024


use edw
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-19' or left(a.dmodifysystime,10) >= '2019-04-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-19' or left(a.dmodifysystime,10) >= '2019-04-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190420011024
SQL开始执行时间：20190420011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190420011025
SQL开始执行时间：20190420011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190420011025
SQL开始执行时间：20190420011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190420011025
SQL开始执行时间：20190420011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190420011025
SQL开始执行时间：20190420011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190420011025

20190421011024开始执行2019-04-20数据加载日志:
SQL开始执行时间：20190421011024


use edw
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-20' or left(a.dmodifysystime,10) >= '2019-04-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-20' or left(a.dmodifysystime,10) >= '2019-04-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190421011024
SQL开始执行时间：20190421011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190421011024

20190422011037开始执行2019-04-21数据加载日志:
SQL开始执行时间：20190422011037


use edw
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-21' or left(a.dmodifysystime,10) >= '2019-04-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-21' or left(a.dmodifysystime,10) >= '2019-04-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190422011037
SQL开始执行时间：20190422011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190422011037

20190423011024开始执行2019-04-22数据加载日志:
SQL开始执行时间：20190423011024


use edw
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-22' or left(a.dmodifysystime,10) >= '2019-04-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-22' or left(a.dmodifysystime,10) >= '2019-04-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190423011024
SQL开始执行时间：20190423011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190423011025
SQL开始执行时间：20190423011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190423011025
SQL开始执行时间：20190423011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190423011025
SQL开始执行时间：20190423011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190423011025

20190424011024开始执行2019-04-23数据加载日志:
SQL开始执行时间：20190424011024


use edw
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-23' or left(a.dmodifysystime,10) >= '2019-04-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-23' or left(a.dmodifysystime,10) >= '2019-04-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190424011024
SQL开始执行时间：20190424011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190424011025
SQL开始执行时间：20190424011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190424011025
SQL开始执行时间：20190424011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190424011025
SQL开始执行时间：20190424011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190424011025

20190425011024开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425011024


use edw
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-24' or left(a.dmodifysystime,10) >= '2019-04-24')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-24' or left(a.dmodifysystime,10) >= '2019-04-24')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190425011024
SQL开始执行时间：20190425011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190425011025
SQL开始执行时间：20190425011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190425011025

20190426011024开始执行2019-04-25数据加载日志:
SQL开始执行时间：20190426011024


use edw
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-25' or left(a.dmodifysystime,10) >= '2019-04-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-25' or left(a.dmodifysystime,10) >= '2019-04-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190426011024
SQL开始执行时间：20190426011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190426011025
SQL开始执行时间：20190426011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190426011025

20190427011026开始执行2019-04-26数据加载日志:
SQL开始执行时间：20190427011026


use edw
;
SQL结束执行时间：20190427011026
SQL开始执行时间：20190427011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190427011026
SQL开始执行时间：20190427011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-26' or left(a.dmodifysystime,10) >= '2019-04-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190427011026
SQL开始执行时间：20190427011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-26' or left(a.dmodifysystime,10) >= '2019-04-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190427011026
SQL开始执行时间：20190427011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190427011026
SQL开始执行时间：20190427011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190427011027
SQL开始执行时间：20190427011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190427011027

20190428011025开始执行2019-04-27数据加载日志:
SQL开始执行时间：20190428011025


use edw
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-27' or left(a.dmodifysystime,10) >= '2019-04-27')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-27' or left(a.dmodifysystime,10) >= '2019-04-27')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190428011025
SQL开始执行时间：20190428011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190428011025

20190429011025开始执行2019-04-28数据加载日志:
SQL开始执行时间：20190429011025


use edw
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-28' or left(a.dmodifysystime,10) >= '2019-04-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-28' or left(a.dmodifysystime,10) >= '2019-04-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190429011025
SQL开始执行时间：20190429011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190429011026
SQL开始执行时间：20190429011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190429011026
SQL开始执行时间：20190429011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190429011026
SQL开始执行时间：20190429011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190429011026
SQL开始执行时间：20190429011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190429011026
SQL开始执行时间：20190429011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190429011026

20190430011025开始执行2019-04-29数据加载日志:
SQL开始执行时间：20190430011025


use edw
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-29' or left(a.dmodifysystime,10) >= '2019-04-29')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-29' or left(a.dmodifysystime,10) >= '2019-04-29')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190430011025
SQL开始执行时间：20190430011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190430011025

20190501011024开始执行2019-04-30数据加载日志:
SQL开始执行时间：20190501011024


use edw
;
SQL结束执行时间：20190501011024
SQL开始执行时间：20190501011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190501011024
SQL开始执行时间：20190501011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-04-30' or left(a.dmodifysystime,10) >= '2019-04-30')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190501011024
SQL开始执行时间：20190501011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-04-30' or left(a.dmodifysystime,10) >= '2019-04-30')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190501011024
SQL开始执行时间：20190501011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190501011024
SQL开始执行时间：20190501011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190501011025
SQL开始执行时间：20190501011025


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190501011025

20190502011024开始执行2019-05-01数据加载日志:
SQL开始执行时间：20190502011024


use edw
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-01' or left(a.dmodifysystime,10) >= '2019-05-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-01' or left(a.dmodifysystime,10) >= '2019-05-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190502011024
SQL开始执行时间：20190502011024


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190502011024

20190503011027开始执行2019-05-02数据加载日志:
SQL开始执行时间：20190503011027


use edw
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-02' or left(a.dmodifysystime,10) >= '2019-05-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-02' or left(a.dmodifysystime,10) >= '2019-05-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190503011027
SQL开始执行时间：20190503011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190503011027

20190504011027开始执行2019-05-03数据加载日志:
SQL开始执行时间：20190504011027


use edw
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-03' or left(a.dmodifysystime,10) >= '2019-05-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-03' or left(a.dmodifysystime,10) >= '2019-05-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190504011027
SQL开始执行时间：20190504011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190504011027

20190505011026开始执行2019-05-04数据加载日志:
SQL开始执行时间：20190505011026


use edw
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-04' or left(a.dmodifysystime,10) >= '2019-05-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-04' or left(a.dmodifysystime,10) >= '2019-05-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190505011026
SQL开始执行时间：20190505011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190505011027
SQL开始执行时间：20190505011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190505011027
SQL开始执行时间：20190505011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190505011027

20190506011026开始执行2019-05-05数据加载日志:
SQL开始执行时间：20190506011026


use edw
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-05' or left(a.dmodifysystime,10) >= '2019-05-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-05' or left(a.dmodifysystime,10) >= '2019-05-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190506011026
SQL开始执行时间：20190506011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190506011027
SQL开始执行时间：20190506011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190506011027
SQL开始执行时间：20190506011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190506011027
SQL开始执行时间：20190506011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190506011027
SQL开始执行时间：20190506011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190506011028
SQL开始执行时间：20190506011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190506011028
SQL开始执行时间：20190506011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190506011028

20190507011026开始执行2019-05-06数据加载日志:
SQL开始执行时间：20190507011026


use edw
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-06' or left(a.dmodifysystime,10) >= '2019-05-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-06' or left(a.dmodifysystime,10) >= '2019-05-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190507011026
SQL开始执行时间：20190507011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190507011027
SQL开始执行时间：20190507011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190507011027

20190508011026开始执行2019-05-07数据加载日志:
SQL开始执行时间：20190508011026


use edw
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-07' or left(a.dmodifysystime,10) >= '2019-05-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-07' or left(a.dmodifysystime,10) >= '2019-05-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190508011026
SQL开始执行时间：20190508011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190508011027
SQL开始执行时间：20190508011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190508011027

20190509174216开始执行2019-05-06数据加载日志:
SQL开始执行时间：20190509174216


use edw
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-06' or left(a.dmodifysystime,10) >= '2019-05-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-06' or left(a.dmodifysystime,10) >= '2019-05-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190509174216
SQL开始执行时间：20190509174216

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190509174217
SQL开始执行时间：20190509174217
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190509174217
SQL开始执行时间：20190509174217
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190509174217
SQL开始执行时间：20190509174217


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190509174218
SQL开始执行时间：20190509174218

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190509174218
SQL开始执行时间：20190509174218

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190509174218
SQL开始执行时间：20190509174218


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190509174218

20190510011028开始执行2019-05-09数据加载日志:
SQL开始执行时间：20190510011028


use edw
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-09' or left(a.dmodifysystime,10) >= '2019-05-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-09' or left(a.dmodifysystime,10) >= '2019-05-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190510011028
SQL开始执行时间：20190510011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190510011029
SQL开始执行时间：20190510011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190510011029

20190511011026开始执行2019-05-10数据加载日志:
SQL开始执行时间：20190511011026


use edw
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-10' or left(a.dmodifysystime,10) >= '2019-05-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-10' or left(a.dmodifysystime,10) >= '2019-05-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190511011026
SQL开始执行时间：20190511011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190511011026

20190512011028开始执行2019-05-11数据加载日志:
SQL开始执行时间：20190512011028


use edw
;
SQL结束执行时间：20190512011028
SQL开始执行时间：20190512011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190512011028
SQL开始执行时间：20190512011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-11' or left(a.dmodifysystime,10) >= '2019-05-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-11' or left(a.dmodifysystime,10) >= '2019-05-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190512011029
SQL开始执行时间：20190512011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190512011029

20190513011028开始执行2019-05-12数据加载日志:
SQL开始执行时间：20190513011028


use edw
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-12' or left(a.dmodifysystime,10) >= '2019-05-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-12' or left(a.dmodifysystime,10) >= '2019-05-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190513011028
SQL开始执行时间：20190513011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190513011028

20190514011026开始执行2019-05-13数据加载日志:
SQL开始执行时间：20190514011026


use edw
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-13' or left(a.dmodifysystime,10) >= '2019-05-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-13' or left(a.dmodifysystime,10) >= '2019-05-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190514011026
SQL开始执行时间：20190514011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190514011027
SQL开始执行时间：20190514011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190514011027

20190515011026开始执行2019-05-14数据加载日志:
SQL开始执行时间：20190515011026


use edw
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-14' or left(a.dmodifysystime,10) >= '2019-05-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-14' or left(a.dmodifysystime,10) >= '2019-05-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190515011026
SQL开始执行时间：20190515011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190515011027
SQL开始执行时间：20190515011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190515011027

20190516011026开始执行2019-05-15数据加载日志:
SQL开始执行时间：20190516011026


use edw
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-15' or left(a.dmodifysystime,10) >= '2019-05-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-15' or left(a.dmodifysystime,10) >= '2019-05-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190516011026
SQL开始执行时间：20190516011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190516011027
SQL开始执行时间：20190516011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190516011027

20190517011027开始执行2019-05-16数据加载日志:
SQL开始执行时间：20190517011027


use edw
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-16' or left(a.dmodifysystime,10) >= '2019-05-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-16' or left(a.dmodifysystime,10) >= '2019-05-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190517011027
SQL开始执行时间：20190517011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190517011028
SQL开始执行时间：20190517011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190517011028
SQL开始执行时间：20190517011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190517011028
SQL开始执行时间：20190517011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190517011028

20190518011027开始执行2019-05-17数据加载日志:
SQL开始执行时间：20190518011027


use edw
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-17' or left(a.dmodifysystime,10) >= '2019-05-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-17' or left(a.dmodifysystime,10) >= '2019-05-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190518011027
SQL开始执行时间：20190518011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190518011028
SQL开始执行时间：20190518011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190518011028
SQL开始执行时间：20190518011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190518011028
SQL开始执行时间：20190518011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190518011028

20190519011029开始执行2019-05-18数据加载日志:
SQL开始执行时间：20190519011029


use edw
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-18' or left(a.dmodifysystime,10) >= '2019-05-18')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-18' or left(a.dmodifysystime,10) >= '2019-05-18')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190519011029
SQL开始执行时间：20190519011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190519011029

20190520011029开始执行2019-05-19数据加载日志:
SQL开始执行时间：20190520011029


use edw
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-19' or left(a.dmodifysystime,10) >= '2019-05-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-19' or left(a.dmodifysystime,10) >= '2019-05-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190520011029
SQL开始执行时间：20190520011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190520011029

20190521011026开始执行2019-05-20数据加载日志:
SQL开始执行时间：20190521011026


use edw
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-20' or left(a.dmodifysystime,10) >= '2019-05-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-20' or left(a.dmodifysystime,10) >= '2019-05-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190521011026
SQL开始执行时间：20190521011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190521011027
SQL开始执行时间：20190521011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190521011027

20190522011029开始执行2019-05-21数据加载日志:
SQL开始执行时间：20190522011029


use edw
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-21' or left(a.dmodifysystime,10) >= '2019-05-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-21' or left(a.dmodifysystime,10) >= '2019-05-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190522011029
SQL开始执行时间：20190522011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190522011029

20190523011026开始执行2019-05-22数据加载日志:
SQL开始执行时间：20190523011026


use edw
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-22' or left(a.dmodifysystime,10) >= '2019-05-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-22' or left(a.dmodifysystime,10) >= '2019-05-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190523011026
SQL开始执行时间：20190523011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190523011026

20190524011029开始执行2019-05-23数据加载日志:
SQL开始执行时间：20190524011029


use edw
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-23' or left(a.dmodifysystime,10) >= '2019-05-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-23' or left(a.dmodifysystime,10) >= '2019-05-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190524011029
SQL开始执行时间：20190524011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190524011030
SQL开始执行时间：20190524011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190524011030
SQL开始执行时间：20190524011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190524011030
SQL开始执行时间：20190524011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190524011030

20190525011026开始执行2019-05-24数据加载日志:
SQL开始执行时间：20190525011026


use edw
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-24' or left(a.dmodifysystime,10) >= '2019-05-24')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-24' or left(a.dmodifysystime,10) >= '2019-05-24')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190525011026
SQL开始执行时间：20190525011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190525011027
SQL开始执行时间：20190525011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190525011027

20190526011029开始执行2019-05-25数据加载日志:
SQL开始执行时间：20190526011029


use edw
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-25' or left(a.dmodifysystime,10) >= '2019-05-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-25' or left(a.dmodifysystime,10) >= '2019-05-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190526011029
SQL开始执行时间：20190526011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190526011029

20190527011038开始执行2019-05-26数据加载日志:
SQL开始执行时间：20190527011038


use edw
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-26' or left(a.dmodifysystime,10) >= '2019-05-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-26' or left(a.dmodifysystime,10) >= '2019-05-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190527011038
SQL开始执行时间：20190527011038

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190527011039
SQL开始执行时间：20190527011039


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190527011039

20190528011026开始执行2019-05-27数据加载日志:
SQL开始执行时间：20190528011026


use edw
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-27' or left(a.dmodifysystime,10) >= '2019-05-27')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-27' or left(a.dmodifysystime,10) >= '2019-05-27')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190528011026
SQL开始执行时间：20190528011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190528011027
SQL开始执行时间：20190528011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190528011027

20190529011030开始执行2019-05-28数据加载日志:
SQL开始执行时间：20190529011030


use edw
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-28' or left(a.dmodifysystime,10) >= '2019-05-28')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-28' or left(a.dmodifysystime,10) >= '2019-05-28')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190529011030
SQL开始执行时间：20190529011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190529011031
SQL开始执行时间：20190529011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190529011031

20190530011029开始执行2019-05-29数据加载日志:
SQL开始执行时间：20190530011029


use edw
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-29' or left(a.dmodifysystime,10) >= '2019-05-29')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-29' or left(a.dmodifysystime,10) >= '2019-05-29')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190530011029
SQL开始执行时间：20190530011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190530011030
SQL开始执行时间：20190530011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190530011030

20190531011030开始执行2019-05-30数据加载日志:
SQL开始执行时间：20190531011030


use edw
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-30' or left(a.dmodifysystime,10) >= '2019-05-30')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-30' or left(a.dmodifysystime,10) >= '2019-05-30')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190531011030
SQL开始执行时间：20190531011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190531011031
SQL开始执行时间：20190531011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190531011031
SQL开始执行时间：20190531011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190531011031
SQL开始执行时间：20190531011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190531011031

20190601011029开始执行2019-05-31数据加载日志:
SQL开始执行时间：20190601011029


use edw
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-05-31' or left(a.dmodifysystime,10) >= '2019-05-31')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-05-31' or left(a.dmodifysystime,10) >= '2019-05-31')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190601011029
SQL开始执行时间：20190601011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190601011030
SQL开始执行时间：20190601011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190601011030

20190602011026开始执行2019-06-01数据加载日志:
SQL开始执行时间：20190602011026


use edw
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-01' or left(a.dmodifysystime,10) >= '2019-06-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-01' or left(a.dmodifysystime,10) >= '2019-06-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190602011026
SQL开始执行时间：20190602011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190602011026

20190603011026开始执行2019-06-02数据加载日志:
SQL开始执行时间：20190603011026


use edw
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-02' or left(a.dmodifysystime,10) >= '2019-06-02')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-02' or left(a.dmodifysystime,10) >= '2019-06-02')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190603011026
SQL开始执行时间：20190603011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190603011027
SQL开始执行时间：20190603011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190603011027
SQL开始执行时间：20190603011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190603011027
SQL开始执行时间：20190603011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190603011027
SQL开始执行时间：20190603011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190603011027

20190604011025开始执行2019-06-03数据加载日志:
SQL开始执行时间：20190604011025


use edw
;
SQL结束执行时间：20190604011025
SQL开始执行时间：20190604011025
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190604011025
SQL开始执行时间：20190604011025
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-03' or left(a.dmodifysystime,10) >= '2019-06-03')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190604011025
SQL开始执行时间：20190604011025


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-03' or left(a.dmodifysystime,10) >= '2019-06-03')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190604011025
SQL开始执行时间：20190604011025


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190604011025
SQL开始执行时间：20190604011025
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190604011026
SQL开始执行时间：20190604011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190604011026

20190605011030开始执行2019-06-04数据加载日志:
SQL开始执行时间：20190605011030


use edw
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-04' or left(a.dmodifysystime,10) >= '2019-06-04')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-04' or left(a.dmodifysystime,10) >= '2019-06-04')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190605011030
SQL开始执行时间：20190605011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190605011031
SQL开始执行时间：20190605011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190605011031
SQL开始执行时间：20190605011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190605011031
SQL开始执行时间：20190605011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190605011031

20190606011027开始执行2019-06-05数据加载日志:
SQL开始执行时间：20190606011027


use edw
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-05' or left(a.dmodifysystime,10) >= '2019-06-05')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-05' or left(a.dmodifysystime,10) >= '2019-06-05')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190606011027
SQL开始执行时间：20190606011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190606011028
SQL开始执行时间：20190606011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190606011028
SQL开始执行时间：20190606011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190606011028
SQL开始执行时间：20190606011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190606011028

20190607011029开始执行2019-06-06数据加载日志:
SQL开始执行时间：20190607011029


use edw
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-06' or left(a.dmodifysystime,10) >= '2019-06-06')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-06' or left(a.dmodifysystime,10) >= '2019-06-06')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190607011029
SQL开始执行时间：20190607011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190607011030
SQL开始执行时间：20190607011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190607011030

20190608011026开始执行2019-06-07数据加载日志:
SQL开始执行时间：20190608011026


use edw
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-07' or left(a.dmodifysystime,10) >= '2019-06-07')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-07' or left(a.dmodifysystime,10) >= '2019-06-07')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190608011026
SQL开始执行时间：20190608011026


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190608011026

20190609011042开始执行2019-06-08数据加载日志:
SQL开始执行时间：20190609011042


use edw
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-08' or left(a.dmodifysystime,10) >= '2019-06-08')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-08' or left(a.dmodifysystime,10) >= '2019-06-08')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190609011042
SQL开始执行时间：20190609011042


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190609011042

20190610011037开始执行2019-06-09数据加载日志:
SQL开始执行时间：20190610011037


use edw
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-09' or left(a.dmodifysystime,10) >= '2019-06-09')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-09' or left(a.dmodifysystime,10) >= '2019-06-09')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190610011037
SQL开始执行时间：20190610011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190610011037

20190611011026开始执行2019-06-10数据加载日志:
SQL开始执行时间：20190611011026


use edw
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-10' or left(a.dmodifysystime,10) >= '2019-06-10')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-10' or left(a.dmodifysystime,10) >= '2019-06-10')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190611011026
SQL开始执行时间：20190611011026

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190611011027
SQL开始执行时间：20190611011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190611011027

20190612011027开始执行2019-06-11数据加载日志:
SQL开始执行时间：20190612011027


use edw
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-11' or left(a.dmodifysystime,10) >= '2019-06-11')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-11' or left(a.dmodifysystime,10) >= '2019-06-11')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190612011027
SQL开始执行时间：20190612011027


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190612011027

20190613011039开始执行2019-06-12数据加载日志:
SQL开始执行时间：20190613011039


use edw
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-12' or left(a.dmodifysystime,10) >= '2019-06-12')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-12' or left(a.dmodifysystime,10) >= '2019-06-12')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190613011039
SQL开始执行时间：20190613011039

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190613011040
SQL开始执行时间：20190613011040


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190613011040

20190614011027开始执行2019-06-13数据加载日志:
SQL开始执行时间：20190614011027


use edw
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-13' or left(a.dmodifysystime,10) >= '2019-06-13')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-13' or left(a.dmodifysystime,10) >= '2019-06-13')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190614011027
SQL开始执行时间：20190614011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190614011028
SQL开始执行时间：20190614011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190614011028

20190615011030开始执行2019-06-14数据加载日志:
SQL开始执行时间：20190615011030


use edw
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-14' or left(a.dmodifysystime,10) >= '2019-06-14')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-14' or left(a.dmodifysystime,10) >= '2019-06-14')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190615011030
SQL开始执行时间：20190615011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190615011031
SQL开始执行时间：20190615011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190615011031
SQL开始执行时间：20190615011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190615011031
SQL开始执行时间：20190615011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190615011031
SQL开始执行时间：20190615011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190615011031

20190616011027开始执行2019-06-15数据加载日志:
SQL开始执行时间：20190616011027


use edw
;
SQL结束执行时间：20190616011027
SQL开始执行时间：20190616011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190616011027
SQL开始执行时间：20190616011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-15' or left(a.dmodifysystime,10) >= '2019-06-15')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-15' or left(a.dmodifysystime,10) >= '2019-06-15')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190616011028
SQL开始执行时间：20190616011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190616011028

20190617011029开始执行2019-06-16数据加载日志:
SQL开始执行时间：20190617011029


use edw
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-16' or left(a.dmodifysystime,10) >= '2019-06-16')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-16' or left(a.dmodifysystime,10) >= '2019-06-16')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190617011029
SQL开始执行时间：20190617011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190617011030
SQL开始执行时间：20190617011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190617011030
SQL开始执行时间：20190617011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190617011030
SQL开始执行时间：20190617011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190617011030
SQL开始执行时间：20190617011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190617011030
SQL开始执行时间：20190617011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190617011030

20190618011030开始执行2019-06-17数据加载日志:
SQL开始执行时间：20190618011030


use edw
;
SQL结束执行时间：20190618011030
SQL开始执行时间：20190618011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190618011030
SQL开始执行时间：20190618011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-17' or left(a.dmodifysystime,10) >= '2019-06-17')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190618011030
SQL开始执行时间：20190618011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-17' or left(a.dmodifysystime,10) >= '2019-06-17')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190618011030
SQL开始执行时间：20190618011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190618011030
SQL开始执行时间：20190618011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190618011031
SQL开始执行时间：20190618011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190618011032

20190619011030开始执行2019-06-18数据加载日志:
SQL开始执行时间：20190619011030


use edw
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-18' or left(a.dmodifysystime,10) >= '2019-06-18')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-18' or left(a.dmodifysystime,10) >= '2019-06-18')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190619011030
SQL开始执行时间：20190619011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190619011031
SQL开始执行时间：20190619011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190619011031
SQL开始执行时间：20190619011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190619011031
SQL开始执行时间：20190619011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190619011032
SQL开始执行时间：20190619011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190619011032
SQL开始执行时间：20190619011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190619011032
SQL开始执行时间：20190619011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190619011032

20190620011031开始执行2019-06-19数据加载日志:
SQL开始执行时间：20190620011031


use edw
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-19' or left(a.dmodifysystime,10) >= '2019-06-19')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-19' or left(a.dmodifysystime,10) >= '2019-06-19')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190620011031
SQL开始执行时间：20190620011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190620011032
SQL开始执行时间：20190620011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190620011032
SQL开始执行时间：20190620011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190620011032
SQL开始执行时间：20190620011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190620011032

20190621011029开始执行2019-06-20数据加载日志:
SQL开始执行时间：20190621011029


use edw
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-20' or left(a.dmodifysystime,10) >= '2019-06-20')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-20' or left(a.dmodifysystime,10) >= '2019-06-20')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190621011029
SQL开始执行时间：20190621011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190621011030
SQL开始执行时间：20190621011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190621011030
SQL开始执行时间：20190621011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190621011030
SQL开始执行时间：20190621011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190621011030

20190622011031开始执行2019-06-21数据加载日志:
SQL开始执行时间：20190622011031


use edw
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-21' or left(a.dmodifysystime,10) >= '2019-06-21')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-21' or left(a.dmodifysystime,10) >= '2019-06-21')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190622011031
SQL开始执行时间：20190622011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190622011033
SQL开始执行时间：20190622011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190622011033
SQL开始执行时间：20190622011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190622011033
SQL开始执行时间：20190622011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190622011033

20190623011027开始执行2019-06-22数据加载日志:
SQL开始执行时间：20190623011027


use edw
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-22' or left(a.dmodifysystime,10) >= '2019-06-22')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-22' or left(a.dmodifysystime,10) >= '2019-06-22')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190623011027
SQL开始执行时间：20190623011027

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190623011028
SQL开始执行时间：20190623011028


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190623011028

20190624011045开始执行2019-06-23数据加载日志:
SQL开始执行时间：20190624011045


use edw
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-23' or left(a.dmodifysystime,10) >= '2019-06-23')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-23' or left(a.dmodifysystime,10) >= '2019-06-23')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190624011045
SQL开始执行时间：20190624011045


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190624011045

20190625011031开始执行2019-06-24数据加载日志:
SQL开始执行时间：20190625011031


use edw
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-24' or left(a.dmodifysystime,10) >= '2019-06-24')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-24' or left(a.dmodifysystime,10) >= '2019-06-24')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190625011031
SQL开始执行时间：20190625011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190625011032
SQL开始执行时间：20190625011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190625011032
SQL开始执行时间：20190625011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190625011032
SQL开始执行时间：20190625011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190625011032

20190626011028开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190626011028


use edw
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-25' or left(a.dmodifysystime,10) >= '2019-06-25')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-25' or left(a.dmodifysystime,10) >= '2019-06-25')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190626011028
SQL开始执行时间：20190626011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190626011029
SQL开始执行时间：20190626011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190626011029
SQL开始执行时间：20190626011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190626011029
SQL开始执行时间：20190626011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190626011030
SQL开始执行时间：20190626011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190626011030
SQL开始执行时间：20190626011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190626011030
SQL开始执行时间：20190626011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190626011030

20190627011030开始执行2019-06-26数据加载日志:
SQL开始执行时间：20190627011030


use edw
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-26' or left(a.dmodifysystime,10) >= '2019-06-26')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-26' or left(a.dmodifysystime,10) >= '2019-06-26')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190627011030
SQL开始执行时间：20190627011030

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190627011031
SQL开始执行时间：20190627011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190627011031
SQL开始执行时间：20190627011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190627011031
SQL开始执行时间：20190627011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190627011032
SQL开始执行时间：20190627011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190627011032
SQL开始执行时间：20190627011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627011032
SQL开始执行时间：20190627011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190627011032

20190627092258开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190627092258


use edw
;
SQL结束执行时间：20190627092258
SQL开始执行时间：20190627092258
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190627092258
SQL开始执行时间：20190627092258
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode not in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190627092259
SQL开始执行时间：20190627092259


insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.ccuscode in ("001","002","003","004","005","006","007","008","009","010","011","012","013")
;
SQL结束执行时间：20190627092259
SQL开始执行时间：20190627092259


drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190627092259
SQL开始执行时间：20190627092259
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190627092259
SQL开始执行时间：20190627092259

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190627092259
SQL开始执行时间：20190627092259

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190627092323
SQL开始执行时间：20190627092323
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190627092323
SQL开始执行时间：20190627092323
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190627092324
SQL开始执行时间：20190627092324


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190627092449
SQL开始执行时间：20190627092449

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db in('UFDATA_111_2018','UFDATA_118_2018','UFDATA_123_2018','UFDATA_168_2018','UFDATA_168_2019','UFDATA_333_2018','UFDATA_666_2018','UFDATA_169_2018')

;
SQL结束执行时间：20190627092449
SQL开始执行时间：20190627092449

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627092449
SQL开始执行时间：20190627092449


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190627092449

20190627095732开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190627095732


use edw
;
SQL结束执行时间：20190627095732
SQL开始执行时间：20190627095732
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190627095732
SQL开始执行时间：20190627095732
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190627095732
SQL开始执行时间：20190627095732

;

20190627095808开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190627095808


use edw
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190627095808
SQL开始执行时间：20190627095808

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190627095833
SQL开始执行时间：20190627095833
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190627095833
SQL开始执行时间：20190627095833
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190627095833
SQL开始执行时间：20190627095833


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190627095956
SQL开始执行时间：20190627095956

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627095957
SQL开始执行时间：20190627095957

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627095957
SQL开始执行时间：20190627095957


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190627095957

20190627103246开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190627103246


use edw
;
SQL结束执行时间：20190627103246
SQL开始执行时间：20190627103246
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190627103246
SQL开始执行时间：20190627103246
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190627103247
SQL开始执行时间：20190627103247



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190627103247
SQL开始执行时间：20190627103247



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190627103247
SQL开始执行时间：20190627103247
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190627103247
SQL开始执行时间：20190627103247

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190627103247
SQL开始执行时间：20190627103247

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190627103311
SQL开始执行时间：20190627103311
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190627103311
SQL开始执行时间：20190627103311
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190627103312
SQL开始执行时间：20190627103312


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190627103337
SQL开始执行时间：20190627103337

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627103337
SQL开始执行时间：20190627103337

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190627103337
SQL开始执行时间：20190627103337


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190627103337

20190628011031开始执行2019-06-27数据加载日志:
SQL开始执行时间：20190628011031


use edw
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-27' or left(a.dmodifysystime,10) >= '2019-06-27')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-27' or left(a.dmodifysystime,10) >= '2019-06-27')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628011031
SQL开始执行时间：20190628011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628011032
SQL开始执行时间：20190628011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628011032
SQL开始执行时间：20190628011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628011032
SQL开始执行时间：20190628011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628011033
SQL开始执行时间：20190628011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628011033
SQL开始执行时间：20190628011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628011033
SQL开始执行时间：20190628011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628011033
SQL开始执行时间：20190628011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628011033
SQL开始执行时间：20190628011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628011036

20190628095822开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190628095822


use edw
;
SQL结束执行时间：20190628095822
SQL开始执行时间：20190628095822
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628095822
SQL开始执行时间：20190628095822
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628095822
SQL开始执行时间：20190628095822



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628095822
SQL开始执行时间：20190628095822



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628095822
SQL开始执行时间：20190628095822
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628095823
SQL开始执行时间：20190628095823

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628095823
SQL开始执行时间：20190628095823

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628095909
SQL开始执行时间：20190628095909
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628095909
SQL开始执行时间：20190628095909
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628095910
SQL开始执行时间：20190628095910


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628100318
SQL开始执行时间：20190628100318

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628100318
SQL开始执行时间：20190628100318

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on a.db = b.db
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628100318
SQL开始执行时间：20190628100318


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628100319
SQL开始执行时间：20190628100319

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628100319
SQL开始执行时间：20190628100319

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628100321

20190628100628开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190628100628


use edw
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628100628
SQL开始执行时间：20190628100628

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628100629
SQL开始执行时间：20190628100629

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628100718
SQL开始执行时间：20190628100718
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628100718
SQL开始执行时间：20190628100718
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628100718
SQL开始执行时间：20190628100718


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628101125
SQL开始执行时间：20190628101125

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628101126
SQL开始执行时间：20190628101126

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628101126
SQL开始执行时间：20190628101126


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628101127
SQL开始执行时间：20190628101127

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628101127
SQL开始执行时间：20190628101127

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628101129

20190628154548开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190628154548


use edw
;
SQL结束执行时间：20190628154548
SQL开始执行时间：20190628154548
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628154548
SQL开始执行时间：20190628154548
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628154548
SQL开始执行时间：20190628154548



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628154548
SQL开始执行时间：20190628154548



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628154548
SQL开始执行时间：20190628154548
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628154549
SQL开始执行时间：20190628154549

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628154549
SQL开始执行时间：20190628154549

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628154734
SQL开始执行时间：20190628154734
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628154734
SQL开始执行时间：20190628154734
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628154735
SQL开始执行时间：20190628154735


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628155210
SQL开始执行时间：20190628155210

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628155210
SQL开始执行时间：20190628155210

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628155211
SQL开始执行时间：20190628155211


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628155211
SQL开始执行时间：20190628155211

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628155212
SQL开始执行时间：20190628155212

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628155214

20190628155715开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190628155715


use edw
;
SQL结束执行时间：20190628155715
SQL开始执行时间：20190628155715
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628155715
SQL开始执行时间：20190628155715
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628155715
SQL开始执行时间：20190628155715



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628155715
SQL开始执行时间：20190628155715



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628155715
SQL开始执行时间：20190628155715
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628155716
SQL开始执行时间：20190628155716

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628155716
SQL开始执行时间：20190628155716

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628155804
SQL开始执行时间：20190628155804
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628155804
SQL开始执行时间：20190628155804
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628155805
SQL开始执行时间：20190628155805


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628160210
SQL开始执行时间：20190628160210

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628160211
SQL开始执行时间：20190628160211

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628160211
SQL开始执行时间：20190628160211


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628160212
SQL开始执行时间：20190628160212

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628160212
SQL开始执行时间：20190628160212

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628160214

20190628160346开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190628160346


use edw
;
SQL结束执行时间：20190628160346
SQL开始执行时间：20190628160346
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190628160346
SQL开始执行时间：20190628160346
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190628160346
SQL开始执行时间：20190628160346



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190628160346
SQL开始执行时间：20190628160346



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190628160346
SQL开始执行时间：20190628160346
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190628160347
SQL开始执行时间：20190628160347

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190628160347
SQL开始执行时间：20190628160347

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190628160506
SQL开始执行时间：20190628160506
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190628160507
SQL开始执行时间：20190628160507
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190628160507
SQL开始执行时间：20190628160507


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190628161101
SQL开始执行时间：20190628161101

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628161101
SQL开始执行时间：20190628161101

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190628161102
SQL开始执行时间：20190628161102


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190628161103
SQL开始执行时间：20190628161103

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190628161103
SQL开始执行时间：20190628161103

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190628161106

20190629011029开始执行2019-06-28数据加载日志:
SQL开始执行时间：20190629011029


use edw
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-28' or left(a.dmodifysystime,10) >= '2019-06-28')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-28' or left(a.dmodifysystime,10) >= '2019-06-28')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190629011029
SQL开始执行时间：20190629011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190629011030
SQL开始执行时间：20190629011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190629011030
SQL开始执行时间：20190629011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190629011030
SQL开始执行时间：20190629011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190629011030
SQL开始执行时间：20190629011030

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190629011030
SQL开始执行时间：20190629011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190629011033

20190630011031开始执行2019-06-29数据加载日志:
SQL开始执行时间：20190630011031


use edw
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-29' or left(a.dmodifysystime,10) >= '2019-06-29')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-29' or left(a.dmodifysystime,10) >= '2019-06-29')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190630011031
SQL开始执行时间：20190630011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190630011032
SQL开始执行时间：20190630011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190630011034

20190701011029开始执行2019-06-30数据加载日志:
SQL开始执行时间：20190701011029


use edw
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-30' or left(a.dmodifysystime,10) >= '2019-06-30')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-30' or left(a.dmodifysystime,10) >= '2019-06-30')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190701011029
SQL开始执行时间：20190701011029

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190701011030
SQL开始执行时间：20190701011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190701011032

20190702011032开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190702011032


use edw
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-01' or left(a.dmodifysystime,10) >= '2019-07-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-01' or left(a.dmodifysystime,10) >= '2019-07-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190702011032
SQL开始执行时间：20190702011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190702011033
SQL开始执行时间：20190702011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190702011033
SQL开始执行时间：20190702011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190702011033
SQL开始执行时间：20190702011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190702011033
SQL开始执行时间：20190702011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190702011033
SQL开始执行时间：20190702011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190702011036

20190702164437开始执行2019-06-18数据加载日志:
SQL开始执行时间：20190702164437


use edw
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-18' or left(a.dmodifysystime,10) >= '2019-06-18')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-18' or left(a.dmodifysystime,10) >= '2019-06-18')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190702164437
SQL开始执行时间：20190702164437

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190702164440
SQL开始执行时间：20190702164440
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190702164441
SQL开始执行时间：20190702164441
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190702164441
SQL开始执行时间：20190702164441


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190702164449
SQL开始执行时间：20190702164449

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190702164449
SQL开始执行时间：20190702164449

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190702164449
SQL开始执行时间：20190702164449


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190702164449
SQL开始执行时间：20190702164449

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190702164450
SQL开始执行时间：20190702164450

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190702164452

20190703011028开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190703011028


use edw
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-02' or left(a.dmodifysystime,10) >= '2019-07-02')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-02' or left(a.dmodifysystime,10) >= '2019-07-02')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190703011028
SQL开始执行时间：20190703011028

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190703011029
SQL开始执行时间：20190703011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190703011029
SQL开始执行时间：20190703011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190703011029
SQL开始执行时间：20190703011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190703011030
SQL开始执行时间：20190703011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190703011030
SQL开始执行时间：20190703011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190703011030
SQL开始执行时间：20190703011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190703011030
SQL开始执行时间：20190703011030

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190703011030
SQL开始执行时间：20190703011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190703011032

20190703084211开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190703084211


use edw
;
SQL结束执行时间：20190703084211
SQL开始执行时间：20190703084211
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190703084211
SQL开始执行时间：20190703084211
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190703084211
SQL开始执行时间：20190703084211



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190703084211
SQL开始执行时间：20190703084211



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190703084211
SQL开始执行时间：20190703084211
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190703084212
SQL开始执行时间：20190703084212

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190703084212
SQL开始执行时间：20190703084212

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190703084305
SQL开始执行时间：20190703084305
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190703084305
SQL开始执行时间：20190703084305
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190703084306
SQL开始执行时间：20190703084306


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190703084710
SQL开始执行时间：20190703084710

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190703084710
SQL开始执行时间：20190703084710

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190703084711
SQL开始执行时间：20190703084711


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190703084712
SQL开始执行时间：20190703084712

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190703084712
SQL开始执行时间：20190703084712

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190703084714

20190704011031开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190704011031


use edw
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-03' or left(a.dmodifysystime,10) >= '2019-07-03')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-03' or left(a.dmodifysystime,10) >= '2019-07-03')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190704011031
SQL开始执行时间：20190704011031

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190704011032
SQL开始执行时间：20190704011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190704011032
SQL开始执行时间：20190704011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190704011032
SQL开始执行时间：20190704011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190704011033
SQL开始执行时间：20190704011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704011033
SQL开始执行时间：20190704011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704011033
SQL开始执行时间：20190704011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190704011033
SQL开始执行时间：20190704011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190704011033
SQL开始执行时间：20190704011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190704011035

20190704094441开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190704094441


use edw
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190704094441
SQL开始执行时间：20190704094441

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190704094442
SQL开始执行时间：20190704094442

delete from edw.sales_order where id in (select id from  edw.sales_order_pre)
;
SQL结束执行时间：20190704094546
SQL开始执行时间：20190704094546
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190704094547
SQL开始执行时间：20190704094547
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190704094547
SQL开始执行时间：20190704094547


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190704095232
SQL开始执行时间：20190704095232

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704095232
SQL开始执行时间：20190704095232

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704095233
SQL开始执行时间：20190704095233


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190704095234
SQL开始执行时间：20190704095234

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190704095234
SQL开始执行时间：20190704095234

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190704095237

20190704103917开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190704103917


use edw
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-02' or left(a.dmodifysystime,10) >= '2019-07-02')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-02' or left(a.dmodifysystime,10) >= '2019-07-02')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190704103917
SQL开始执行时间：20190704103917

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190704103918
SQL开始执行时间：20190704103918
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190704103918
SQL开始执行时间：20190704103918
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190704103918
SQL开始执行时间：20190704103918


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190704103920
SQL开始执行时间：20190704103920

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704103920
SQL开始执行时间：20190704103920

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190704103920
SQL开始执行时间：20190704103920


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190704103920
SQL开始执行时间：20190704103920

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190704103921
SQL开始执行时间：20190704103921

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190704103923

20190705011032开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190705011032


use edw
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-04' or left(a.dmodifysystime,10) >= '2019-07-04')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-04' or left(a.dmodifysystime,10) >= '2019-07-04')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190705011032
SQL开始执行时间：20190705011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190705011033
SQL开始执行时间：20190705011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190705011033
SQL开始执行时间：20190705011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190705011033
SQL开始执行时间：20190705011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190705011034
SQL开始执行时间：20190705011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190705011034
SQL开始执行时间：20190705011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190705011034
SQL开始执行时间：20190705011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190705011034
SQL开始执行时间：20190705011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190705011034
SQL开始执行时间：20190705011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190705011036

20190705101508开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190705101508


use edw
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-03' or left(a.dmodifysystime,10) >= '2019-07-03')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-03' or left(a.dmodifysystime,10) >= '2019-07-03')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190705101508
SQL开始执行时间：20190705101508

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190705101509
SQL开始执行时间：20190705101509
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190705101509
SQL开始执行时间：20190705101509
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190705101509
SQL开始执行时间：20190705101509


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190705101511
SQL开始执行时间：20190705101511

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190705101511
SQL开始执行时间：20190705101511

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190705101511
SQL开始执行时间：20190705101511


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190705101511
SQL开始执行时间：20190705101511

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190705101511
SQL开始执行时间：20190705101511

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190705101514

20190706011030开始执行2019-07-05数据加载日志:
SQL开始执行时间：20190706011030


use edw
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-05' or left(a.dmodifysystime,10) >= '2019-07-05')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-05' or left(a.dmodifysystime,10) >= '2019-07-05')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190706011030
SQL开始执行时间：20190706011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190706011031
SQL开始执行时间：20190706011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190706011032
SQL开始执行时间：20190706011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190706011034

20190707011029开始执行2019-07-06数据加载日志:
SQL开始执行时间：20190707011029


use edw
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-06' or left(a.dmodifysystime,10) >= '2019-07-06')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-06' or left(a.dmodifysystime,10) >= '2019-07-06')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190707011029
SQL开始执行时间：20190707011029

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190707011030
SQL开始执行时间：20190707011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190707011032

20190708011030开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190708011030


use edw
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-07' or left(a.dmodifysystime,10) >= '2019-07-07')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-07' or left(a.dmodifysystime,10) >= '2019-07-07')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190708011030
SQL开始执行时间：20190708011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190708011033

20190708091409开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190708091409


use edw
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-04' or left(a.dmodifysystime,10) >= '2019-07-04')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-04' or left(a.dmodifysystime,10) >= '2019-07-04')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190708091409
SQL开始执行时间：20190708091409

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190708091410
SQL开始执行时间：20190708091410
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190708091410
SQL开始执行时间：20190708091410
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190708091410
SQL开始执行时间：20190708091410


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190708091412
SQL开始执行时间：20190708091412

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190708091412
SQL开始执行时间：20190708091412

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190708091412
SQL开始执行时间：20190708091412


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190708091412
SQL开始执行时间：20190708091412

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190708091412
SQL开始执行时间：20190708091412

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190708091414

20190709011030开始执行2019-07-08数据加载日志:
SQL开始执行时间：20190709011030


use edw
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-08' or left(a.dmodifysystime,10) >= '2019-07-08')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-08' or left(a.dmodifysystime,10) >= '2019-07-08')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190709011030
SQL开始执行时间：20190709011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190709011031
SQL开始执行时间：20190709011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190709011031
SQL开始执行时间：20190709011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190709011031
SQL开始执行时间：20190709011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190709011032
SQL开始执行时间：20190709011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190709011032
SQL开始执行时间：20190709011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190709011032
SQL开始执行时间：20190709011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190709011032
SQL开始执行时间：20190709011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190709011032
SQL开始执行时间：20190709011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190709011035

20190709103439开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190709103439


use edw
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-07' or left(a.dmodifysystime,10) >= '2019-07-07')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-07' or left(a.dmodifysystime,10) >= '2019-07-07')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190709103439
SQL开始执行时间：20190709103439

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190709103440
SQL开始执行时间：20190709103440
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190709103440
SQL开始执行时间：20190709103440
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190709103440
SQL开始执行时间：20190709103440


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190709103441
SQL开始执行时间：20190709103441

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190709103441
SQL开始执行时间：20190709103441

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190709103441
SQL开始执行时间：20190709103441


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190709103441
SQL开始执行时间：20190709103441

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190709103441
SQL开始执行时间：20190709103441

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190709103444

20190710011029开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190710011029


use edw
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-09' or left(a.dmodifysystime,10) >= '2019-07-09')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-09' or left(a.dmodifysystime,10) >= '2019-07-09')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190710011029
SQL开始执行时间：20190710011029

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190710011030
SQL开始执行时间：20190710011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190710011030
SQL开始执行时间：20190710011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190710011030
SQL开始执行时间：20190710011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190710011030
SQL开始执行时间：20190710011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190710011031
SQL开始执行时间：20190710011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190710011031
SQL开始执行时间：20190710011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190710011031
SQL开始执行时间：20190710011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190710011031
SQL开始执行时间：20190710011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190710011031
SQL开始执行时间：20190710011031

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190710011033

20190711011032开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190711011032


use edw
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190711011032
SQL开始执行时间：20190711011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190711011033
SQL开始执行时间：20190711011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190711011033
SQL开始执行时间：20190711011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190711011033
SQL开始执行时间：20190711011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190711011034
SQL开始执行时间：20190711011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190711011034
SQL开始执行时间：20190711011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190711011034
SQL开始执行时间：20190711011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190711011034
SQL开始执行时间：20190711011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190711011034
SQL开始执行时间：20190711011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190711011036

20190711090853开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190711090853


use edw
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-09' or left(a.dmodifysystime,10) >= '2019-07-09')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-09' or left(a.dmodifysystime,10) >= '2019-07-09')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190711090853
SQL开始执行时间：20190711090853

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190711090854
SQL开始执行时间：20190711090854
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190711090854
SQL开始执行时间：20190711090854
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190711090854
SQL开始执行时间：20190711090854


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190711090855
SQL开始执行时间：20190711090855

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190711090855
SQL开始执行时间：20190711090855

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190711090855
SQL开始执行时间：20190711090855


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190711090855
SQL开始执行时间：20190711090855

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190711090856
SQL开始执行时间：20190711090856

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190711090858

20190712011033开始执行2019-07-11数据加载日志:
SQL开始执行时间：20190712011033


use edw
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-11' or left(a.dmodifysystime,10) >= '2019-07-11')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-11' or left(a.dmodifysystime,10) >= '2019-07-11')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190712011033
SQL开始执行时间：20190712011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190712011034
SQL开始执行时间：20190712011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190712011034
SQL开始执行时间：20190712011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190712011034
SQL开始执行时间：20190712011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190712011035
SQL开始执行时间：20190712011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190712011035
SQL开始执行时间：20190712011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190712011035
SQL开始执行时间：20190712011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190712011035
SQL开始执行时间：20190712011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190712011035
SQL开始执行时间：20190712011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190712011038

20190713011031开始执行2019-07-12数据加载日志:
SQL开始执行时间：20190713011031


use edw
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-12' or left(a.dmodifysystime,10) >= '2019-07-12')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-12' or left(a.dmodifysystime,10) >= '2019-07-12')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190713011031
SQL开始执行时间：20190713011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190713011032
SQL开始执行时间：20190713011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190713011032
SQL开始执行时间：20190713011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190713011032
SQL开始执行时间：20190713011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190713011032
SQL开始执行时间：20190713011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190713011033
SQL开始执行时间：20190713011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190713011035

20190714011033开始执行2019-07-13数据加载日志:
SQL开始执行时间：20190714011033


use edw
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-13' or left(a.dmodifysystime,10) >= '2019-07-13')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-13' or left(a.dmodifysystime,10) >= '2019-07-13')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190714011033
SQL开始执行时间：20190714011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190714011034
SQL开始执行时间：20190714011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190714011036

20190715011032开始执行2019-07-14数据加载日志:
SQL开始执行时间：20190715011032


use edw
;
SQL结束执行时间：20190715011032
SQL开始执行时间：20190715011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190715011032
SQL开始执行时间：20190715011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-14' or left(a.dmodifysystime,10) >= '2019-07-14')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190715011032
SQL开始执行时间：20190715011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-14' or left(a.dmodifysystime,10) >= '2019-07-14')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190715011033
SQL开始执行时间：20190715011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190715011036

20190715131214开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190715131214


use edw
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190715131214
SQL开始执行时间：20190715131214

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190715131215
SQL开始执行时间：20190715131215

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190715131216
SQL开始执行时间：20190715131216
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190715131216
SQL开始执行时间：20190715131216
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190715131216
SQL开始执行时间：20190715131216


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190715131219
SQL开始执行时间：20190715131219

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190715131219
SQL开始执行时间：20190715131219

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190715131219
SQL开始执行时间：20190715131219


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190715131219
SQL开始执行时间：20190715131219

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190715131219
SQL开始执行时间：20190715131219

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190715131221

20190716011034开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190716011034


use edw
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and a.db <> 'UFDATA_889_2019'
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and a.db = 'UFDATA_889_2019'
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190716011034
SQL开始执行时间：20190716011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190716011035
SQL开始执行时间：20190716011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190716011036
SQL开始执行时间：20190716011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018')

;
SQL结束执行时间：20190716011036
SQL开始执行时间：20190716011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190716011036
SQL开始执行时间：20190716011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190716011036
SQL开始执行时间：20190716011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190716011038

20190716160121开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190716160121


use edw
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018'
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190716160121
SQL开始执行时间：20190716160121

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190716160123
SQL开始执行时间：20190716160123
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190716160123
SQL开始执行时间：20190716160123
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190716160123
SQL开始执行时间：20190716160123


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190716160126
SQL开始执行时间：20190716160126

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716160126
SQL开始执行时间：20190716160126

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716160126
SQL开始执行时间：20190716160126


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190716160126
SQL开始执行时间：20190716160126

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190716160127
SQL开始执行时间：20190716160127

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190716160129

20190716161443开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190716161443


use edw
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018'
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190716161443
SQL开始执行时间：20190716161443

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190716161445
SQL开始执行时间：20190716161445
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190716161445
SQL开始执行时间：20190716161445
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190716161445
SQL开始执行时间：20190716161445


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190716161449
SQL开始执行时间：20190716161449

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716161449
SQL开始执行时间：20190716161449

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716161449
SQL开始执行时间：20190716161449


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190716161449
SQL开始执行时间：20190716161449

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190716161449
SQL开始执行时间：20190716161449

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190716161452

20190716165218开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190716165218


use edw
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-10' or left(a.dmodifysystime,10) >= '2019-07-10')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190716165218
SQL开始执行时间：20190716165218

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190716165220
SQL开始执行时间：20190716165220
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190716165220
SQL开始执行时间：20190716165220
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190716165220
SQL开始执行时间：20190716165220


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190716165224
SQL开始执行时间：20190716165224

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716165224
SQL开始执行时间：20190716165224

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190716165224
SQL开始执行时间：20190716165224


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190716165224
SQL开始执行时间：20190716165224

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190716165224
SQL开始执行时间：20190716165224

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190716165227

20190717011031开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190717011031


use edw
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-16' or left(a.dmodifysystime,10) >= '2019-07-16')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-16' or left(a.dmodifysystime,10) >= '2019-07-16')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190717011031
SQL开始执行时间：20190717011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190717011032
SQL开始执行时间：20190717011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190717011032
SQL开始执行时间：20190717011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190717011032
SQL开始执行时间：20190717011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190717011033
SQL开始执行时间：20190717011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717011033
SQL开始执行时间：20190717011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717011033
SQL开始执行时间：20190717011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190717011033
SQL开始执行时间：20190717011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190717011033
SQL开始执行时间：20190717011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190717011036

20190717085444开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190717085444


use edw
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190717085444
SQL开始执行时间：20190717085444

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190717085445
SQL开始执行时间：20190717085445
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190717085445
SQL开始执行时间：20190717085445
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190717085445
SQL开始执行时间：20190717085445


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190717085447
SQL开始执行时间：20190717085447

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717085447
SQL开始执行时间：20190717085447

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717085447
SQL开始执行时间：20190717085447


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190717085447
SQL开始执行时间：20190717085447

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190717085448
SQL开始执行时间：20190717085448

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190717085450

20190717093211开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190717093211


use edw
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-15' or left(a.dmodifysystime,10) >= '2019-07-15')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190717093211
SQL开始执行时间：20190717093211

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190717093212
SQL开始执行时间：20190717093212
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190717093212
SQL开始执行时间：20190717093212
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190717093212
SQL开始执行时间：20190717093212


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190717093214
SQL开始执行时间：20190717093214

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717093214
SQL开始执行时间：20190717093214

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190717093214
SQL开始执行时间：20190717093214


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190717093214
SQL开始执行时间：20190717093214

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190717093215
SQL开始执行时间：20190717093215

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190717093217

20190718011031开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190718011031


use edw
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-17' or left(a.dmodifysystime,10) >= '2019-07-17')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-17' or left(a.dmodifysystime,10) >= '2019-07-17')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190718011031
SQL开始执行时间：20190718011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190718011032
SQL开始执行时间：20190718011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190718011033
SQL开始执行时间：20190718011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190718011035

20190718092832开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190718092832


use edw
;
SQL结束执行时间：20190718092832
SQL开始执行时间：20190718092832
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190718092832
SQL开始执行时间：20190718092832
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-16' or left(a.dmodifysystime,10) >= '2019-07-16')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-16' or left(a.dmodifysystime,10) >= '2019-07-16')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190718092833
SQL开始执行时间：20190718092833
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190718092834
SQL开始执行时间：20190718092834


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190718092835
SQL开始执行时间：20190718092835

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190718092835
SQL开始执行时间：20190718092835

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190718092835
SQL开始执行时间：20190718092835


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190718092835
SQL开始执行时间：20190718092835

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190718092835
SQL开始执行时间：20190718092835

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190718092838

20190719011031开始执行2019-07-18数据加载日志:
SQL开始执行时间：20190719011031


use edw
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-18' or left(a.dmodifysystime,10) >= '2019-07-18')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-18' or left(a.dmodifysystime,10) >= '2019-07-18')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190719011031
SQL开始执行时间：20190719011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190719011032
SQL开始执行时间：20190719011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190719011032
SQL开始执行时间：20190719011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190719011032
SQL开始执行时间：20190719011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190719011032
SQL开始执行时间：20190719011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190719011032
SQL开始执行时间：20190719011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190719011035

20190719090315开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190719090315


use edw
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-17' or left(a.dmodifysystime,10) >= '2019-07-17')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-17' or left(a.dmodifysystime,10) >= '2019-07-17')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190719090315
SQL开始执行时间：20190719090315

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190719090316
SQL开始执行时间：20190719090316
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190719090316
SQL开始执行时间：20190719090316
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190719090316
SQL开始执行时间：20190719090316


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190719090318
SQL开始执行时间：20190719090318

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190719090318
SQL开始执行时间：20190719090318

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190719090318
SQL开始执行时间：20190719090318


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190719090318
SQL开始执行时间：20190719090318

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190719090318
SQL开始执行时间：20190719090318

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190719090320

20190720011031开始执行2019-07-19数据加载日志:
SQL开始执行时间：20190720011031


use edw
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-19' or left(a.dmodifysystime,10) >= '2019-07-19')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-19' or left(a.dmodifysystime,10) >= '2019-07-19')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190720011031
SQL开始执行时间：20190720011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190720011032
SQL开始执行时间：20190720011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190720011033
SQL开始执行时间：20190720011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190720011035

20190721011033开始执行2019-07-20数据加载日志:
SQL开始执行时间：20190721011033


use edw
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-20' or left(a.dmodifysystime,10) >= '2019-07-20')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-20' or left(a.dmodifysystime,10) >= '2019-07-20')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190721011033
SQL开始执行时间：20190721011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190721011034
SQL开始执行时间：20190721011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190721011036

20190722011030开始执行2019-07-21数据加载日志:
SQL开始执行时间：20190722011030


use edw
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-21' or left(a.dmodifysystime,10) >= '2019-07-21')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-21' or left(a.dmodifysystime,10) >= '2019-07-21')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190722011030
SQL开始执行时间：20190722011030

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190722011033

20190723011030开始执行2019-07-22数据加载日志:
SQL开始执行时间：20190723011030


use edw
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-22' or left(a.dmodifysystime,10) >= '2019-07-22')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-22' or left(a.dmodifysystime,10) >= '2019-07-22')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190723011030
SQL开始执行时间：20190723011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190723011031
SQL开始执行时间：20190723011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190723011031
SQL开始执行时间：20190723011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190723011031
SQL开始执行时间：20190723011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190723011032
SQL开始执行时间：20190723011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190723011032
SQL开始执行时间：20190723011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190723011032
SQL开始执行时间：20190723011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190723011032
SQL开始执行时间：20190723011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190723011033
SQL开始执行时间：20190723011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190723011035

20190723164637开始执行2019-06-24数据加载日志:
SQL开始执行时间：20190723164637


use edw
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-06-24' or left(a.dmodifysystime,10) >= '2019-06-24')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-06-24' or left(a.dmodifysystime,10) >= '2019-06-24')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190723164637
SQL开始执行时间：20190723164637

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190723164647
SQL开始执行时间：20190723164647
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190723164647
SQL开始执行时间：20190723164647
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190723164647
SQL开始执行时间：20190723164647


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190723164704
SQL开始执行时间：20190723164704

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190723164704
SQL开始执行时间：20190723164704

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190723164704
SQL开始执行时间：20190723164704


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190723164704
SQL开始执行时间：20190723164704

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190723164705
SQL开始执行时间：20190723164705

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190723164707

20190724011030开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190724011030


use edw
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-23' or left(a.dmodifysystime,10) >= '2019-07-23')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-23' or left(a.dmodifysystime,10) >= '2019-07-23')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190724011030
SQL开始执行时间：20190724011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190724011031
SQL开始执行时间：20190724011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190724011031
SQL开始执行时间：20190724011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190724011031
SQL开始执行时间：20190724011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190724011032
SQL开始执行时间：20190724011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190724011032
SQL开始执行时间：20190724011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190724011032
SQL开始执行时间：20190724011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190724011032
SQL开始执行时间：20190724011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190724011032
SQL开始执行时间：20190724011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190724011035

20190724140040开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190724140040


use edw
;
SQL结束执行时间：20190724140040
SQL开始执行时间：20190724140040
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190724140040
SQL开始执行时间：20190724140040
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190724140041
SQL开始执行时间：20190724140041



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190724140041
SQL开始执行时间：20190724140041



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190724140041
SQL开始执行时间：20190724140041
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190724140041
SQL开始执行时间：20190724140041

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190724140042
SQL开始执行时间：20190724140042

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190724140207
SQL开始执行时间：20190724140207
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190724140208
SQL开始执行时间：20190724140208
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190724140208
SQL开始执行时间：20190724140208


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190724140637
SQL开始执行时间：20190724140637

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190724140638
SQL开始执行时间：20190724140638

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190724140639
SQL开始执行时间：20190724140639


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190724140640
SQL开始执行时间：20190724140640

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190724140640
SQL开始执行时间：20190724140640

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190724140642

20190725011032开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190725011032


use edw
;
SQL结束执行时间：20190725011032
SQL开始执行时间：20190725011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190725011032
SQL开始执行时间：20190725011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-24' or left(a.dmodifysystime,10) >= '2019-07-24')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190725011032
SQL开始执行时间：20190725011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-24' or left(a.dmodifysystime,10) >= '2019-07-24')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190725011033
SQL开始执行时间：20190725011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190725011034
SQL开始执行时间：20190725011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190725011034
SQL开始执行时间：20190725011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190725011034
SQL开始执行时间：20190725011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190725011034
SQL开始执行时间：20190725011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190725011034
SQL开始执行时间：20190725011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190725011037

20190725133448开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190725133448


use edw
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-23' or left(a.dmodifysystime,10) >= '2019-07-23')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-23' or left(a.dmodifysystime,10) >= '2019-07-23')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190725133448
SQL开始执行时间：20190725133448

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190725133449
SQL开始执行时间：20190725133449

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190725133450
SQL开始执行时间：20190725133450
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190725133450
SQL开始执行时间：20190725133450
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190725133450
SQL开始执行时间：20190725133450


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190725133451
SQL开始执行时间：20190725133451

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190725133451
SQL开始执行时间：20190725133451

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190725133451
SQL开始执行时间：20190725133451


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190725133451
SQL开始执行时间：20190725133451

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190725133452
SQL开始执行时间：20190725133452

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190725133454

20190726011030开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190726011030


use edw
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-25' or left(a.dmodifysystime,10) >= '2019-07-25')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-25' or left(a.dmodifysystime,10) >= '2019-07-25')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190726011030
SQL开始执行时间：20190726011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190726011031
SQL开始执行时间：20190726011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190726011032
SQL开始执行时间：20190726011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190726011034

20190726085553开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190726085553


use edw
;
SQL结束执行时间：20190726085553
SQL开始执行时间：20190726085553
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190726085553
SQL开始执行时间：20190726085553
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-24' or left(a.dmodifysystime,10) >= '2019-07-24')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190726085554
SQL开始执行时间：20190726085554



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-24' or left(a.dmodifysystime,10) >= '2019-07-24')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190726085554
SQL开始执行时间：20190726085554



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190726085554
SQL开始执行时间：20190726085554
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190726085554
SQL开始执行时间：20190726085554

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190726085554
SQL开始执行时间：20190726085554

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190726085555
SQL开始执行时间：20190726085555
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190726085555
SQL开始执行时间：20190726085555
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190726085555
SQL开始执行时间：20190726085555


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190726085556
SQL开始执行时间：20190726085556

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190726085556
SQL开始执行时间：20190726085556

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190726085556
SQL开始执行时间：20190726085556


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190726085556
SQL开始执行时间：20190726085556

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190726085556
SQL开始执行时间：20190726085556

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190726085559

20190727011035开始执行2019-07-26数据加载日志:
SQL开始执行时间：20190727011035


use edw
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-26' or left(a.dmodifysystime,10) >= '2019-07-26')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-26' or left(a.dmodifysystime,10) >= '2019-07-26')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190727011035
SQL开始执行时间：20190727011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190727011036
SQL开始执行时间：20190727011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190727011036
SQL开始执行时间：20190727011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190727011036
SQL开始执行时间：20190727011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190727011036
SQL开始执行时间：20190727011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190727011036
SQL开始执行时间：20190727011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190727011039

20190728011031开始执行2019-07-27数据加载日志:
SQL开始执行时间：20190728011031


use edw
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-27' or left(a.dmodifysystime,10) >= '2019-07-27')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-27' or left(a.dmodifysystime,10) >= '2019-07-27')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190728011031
SQL开始执行时间：20190728011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190728011032
SQL开始执行时间：20190728011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190728011035

20190729011032开始执行2019-07-28数据加载日志:
SQL开始执行时间：20190729011032


use edw
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-28' or left(a.dmodifysystime,10) >= '2019-07-28')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-28' or left(a.dmodifysystime,10) >= '2019-07-28')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190729011032
SQL开始执行时间：20190729011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190729011035

20190729111036开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190729111036


use edw
;
SQL结束执行时间：20190729111036
SQL开始执行时间：20190729111036
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190729111036
SQL开始执行时间：20190729111036
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-25' or left(a.dmodifysystime,10) >= '2019-07-25')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190729111037
SQL开始执行时间：20190729111037



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-25' or left(a.dmodifysystime,10) >= '2019-07-25')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190729111037
SQL开始执行时间：20190729111037



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190729111037
SQL开始执行时间：20190729111037
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190729111037
SQL开始执行时间：20190729111037

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190729111037
SQL开始执行时间：20190729111037

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190729111038
SQL开始执行时间：20190729111038
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190729111038
SQL开始执行时间：20190729111038
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190729111038
SQL开始执行时间：20190729111038


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190729111039
SQL开始执行时间：20190729111039

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190729111039
SQL开始执行时间：20190729111039

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190729111039
SQL开始执行时间：20190729111039


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190729111039
SQL开始执行时间：20190729111039

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190729111040
SQL开始执行时间：20190729111040

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190729111042

20190730011031开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190730011031


use edw
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-29' or left(a.dmodifysystime,10) >= '2019-07-29')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-29' or left(a.dmodifysystime,10) >= '2019-07-29')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190730011031
SQL开始执行时间：20190730011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190730011032
SQL开始执行时间：20190730011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190730011032
SQL开始执行时间：20190730011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190730011032
SQL开始执行时间：20190730011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190730011033
SQL开始执行时间：20190730011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190730011033
SQL开始执行时间：20190730011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190730011033
SQL开始执行时间：20190730011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190730011033
SQL开始执行时间：20190730011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190730011034
SQL开始执行时间：20190730011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190730011036

20190731011034开始执行2019-07-30数据加载日志:
SQL开始执行时间：20190731011034


use edw
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-30' or left(a.dmodifysystime,10) >= '2019-07-30')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-30' or left(a.dmodifysystime,10) >= '2019-07-30')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190731011034
SQL开始执行时间：20190731011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190731011035
SQL开始执行时间：20190731011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190731011036
SQL开始执行时间：20190731011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190731011039

20190731103335开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190731103335


use edw
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-29' or left(a.dmodifysystime,10) >= '2019-07-29')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-29' or left(a.dmodifysystime,10) >= '2019-07-29')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190731103335
SQL开始执行时间：20190731103335

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190731103336
SQL开始执行时间：20190731103336
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190731103336
SQL开始执行时间：20190731103336
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190731103336
SQL开始执行时间：20190731103336


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190731103338
SQL开始执行时间：20190731103338

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190731103338
SQL开始执行时间：20190731103338

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190731103338
SQL开始执行时间：20190731103338


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190731103338
SQL开始执行时间：20190731103338

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190731103338
SQL开始执行时间：20190731103338

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190731103341

20190801011034开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190801011034


use edw
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-31' or left(a.dmodifysystime,10) >= '2019-07-31')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-31' or left(a.dmodifysystime,10) >= '2019-07-31')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190801011034
SQL开始执行时间：20190801011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190801011035
SQL开始执行时间：20190801011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190801011035
SQL开始执行时间：20190801011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190801011035
SQL开始执行时间：20190801011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190801011036
SQL开始执行时间：20190801011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190801011036
SQL开始执行时间：20190801011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190801011036
SQL开始执行时间：20190801011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190801011036
SQL开始执行时间：20190801011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190801011037
SQL开始执行时间：20190801011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190801011040

20190802011031开始执行2019-08-01数据加载日志:
SQL开始执行时间：20190802011031


use edw
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-01' or left(a.dmodifysystime,10) >= '2019-08-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-01' or left(a.dmodifysystime,10) >= '2019-08-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190802011031
SQL开始执行时间：20190802011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190802011032
SQL开始执行时间：20190802011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190802011032
SQL开始执行时间：20190802011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190802011032
SQL开始执行时间：20190802011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190802011033
SQL开始执行时间：20190802011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190802011033
SQL开始执行时间：20190802011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190802011033
SQL开始执行时间：20190802011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190802011033
SQL开始执行时间：20190802011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190802011033
SQL开始执行时间：20190802011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190802011036

20190803011032开始执行2019-08-02数据加载日志:
SQL开始执行时间：20190803011032


use edw
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-02' or left(a.dmodifysystime,10) >= '2019-08-02')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-02' or left(a.dmodifysystime,10) >= '2019-08-02')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190803011032
SQL开始执行时间：20190803011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190803011033
SQL开始执行时间：20190803011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190803011033
SQL开始执行时间：20190803011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190803011033
SQL开始执行时间：20190803011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190803011033
SQL开始执行时间：20190803011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190803011033
SQL开始执行时间：20190803011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190803011037

20190804011031开始执行2019-08-03数据加载日志:
SQL开始执行时间：20190804011031


use edw
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-03' or left(a.dmodifysystime,10) >= '2019-08-03')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-03' or left(a.dmodifysystime,10) >= '2019-08-03')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190804011031
SQL开始执行时间：20190804011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190804011032
SQL开始执行时间：20190804011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190804011035

20190805011031开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190805011031


use edw
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-04' or left(a.dmodifysystime,10) >= '2019-08-04')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-04' or left(a.dmodifysystime,10) >= '2019-08-04')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190805011031
SQL开始执行时间：20190805011031

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190805011034

20190805132314开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190805132314


use edw
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-07-31' or left(a.dmodifysystime,10) >= '2019-07-31')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-07-31' or left(a.dmodifysystime,10) >= '2019-07-31')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190805132314
SQL开始执行时间：20190805132314

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190805132316
SQL开始执行时间：20190805132316
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190805132316
SQL开始执行时间：20190805132316
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190805132316
SQL开始执行时间：20190805132316


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190805132318
SQL开始执行时间：20190805132318

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190805132318
SQL开始执行时间：20190805132318

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190805132318
SQL开始执行时间：20190805132318


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190805132318
SQL开始执行时间：20190805132318

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190805132319
SQL开始执行时间：20190805132319

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190805132322

20190806011034开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190806011034


use edw
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-05' or left(a.dmodifysystime,10) >= '2019-08-05')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-05' or left(a.dmodifysystime,10) >= '2019-08-05')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190806011034
SQL开始执行时间：20190806011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190806011035
SQL开始执行时间：20190806011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190806011035
SQL开始执行时间：20190806011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190806011035
SQL开始执行时间：20190806011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190806011036
SQL开始执行时间：20190806011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190806011036
SQL开始执行时间：20190806011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190806011036
SQL开始执行时间：20190806011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190806011036
SQL开始执行时间：20190806011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190806011036
SQL开始执行时间：20190806011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190806011039

20190806093411开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190806093411


use edw
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-04' or left(a.dmodifysystime,10) >= '2019-08-04')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-04' or left(a.dmodifysystime,10) >= '2019-08-04')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190806093411
SQL开始执行时间：20190806093411

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190806093412
SQL开始执行时间：20190806093412
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190806093412
SQL开始执行时间：20190806093412
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190806093412
SQL开始执行时间：20190806093412


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190806093413
SQL开始执行时间：20190806093413

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190806093413
SQL开始执行时间：20190806093413

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190806093413
SQL开始执行时间：20190806093413


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190806093413
SQL开始执行时间：20190806093413

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190806093414
SQL开始执行时间：20190806093414

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190806093417

20190807011031开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190807011031


use edw
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-06' or left(a.dmodifysystime,10) >= '2019-08-06')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-06' or left(a.dmodifysystime,10) >= '2019-08-06')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190807011031
SQL开始执行时间：20190807011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190807011032
SQL开始执行时间：20190807011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190807011032
SQL开始执行时间：20190807011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190807011032
SQL开始执行时间：20190807011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190807011032
SQL开始执行时间：20190807011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190807011033
SQL开始执行时间：20190807011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190807011036

20190807153610开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190807153610


use edw
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-05' or left(a.dmodifysystime,10) >= '2019-08-05')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-05' or left(a.dmodifysystime,10) >= '2019-08-05')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190807153610
SQL开始执行时间：20190807153610

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190807153611
SQL开始执行时间：20190807153611

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190807153612
SQL开始执行时间：20190807153612
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190807153612
SQL开始执行时间：20190807153612
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190807153612
SQL开始执行时间：20190807153612


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190807153614
SQL开始执行时间：20190807153614

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190807153614
SQL开始执行时间：20190807153614

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190807153614
SQL开始执行时间：20190807153614


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190807153614
SQL开始执行时间：20190807153614

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190807153614
SQL开始执行时间：20190807153614

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190807153617

20190808011031开始执行2019-08-07数据加载日志:
SQL开始执行时间：20190808011031


use edw
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-07' or left(a.dmodifysystime,10) >= '2019-08-07')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-07' or left(a.dmodifysystime,10) >= '2019-08-07')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190808011031
SQL开始执行时间：20190808011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190808011032
SQL开始执行时间：20190808011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190808011032
SQL开始执行时间：20190808011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190808011032
SQL开始执行时间：20190808011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190808011033
SQL开始执行时间：20190808011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190808011033
SQL开始执行时间：20190808011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190808011033
SQL开始执行时间：20190808011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190808011033
SQL开始执行时间：20190808011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190808011033
SQL开始执行时间：20190808011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190808011036

20190809011030开始执行2019-08-08数据加载日志:
SQL开始执行时间：20190809011030


use edw
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-08' or left(a.dmodifysystime,10) >= '2019-08-08')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-08' or left(a.dmodifysystime,10) >= '2019-08-08')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190809011030
SQL开始执行时间：20190809011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190809011031
SQL开始执行时间：20190809011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190809011031
SQL开始执行时间：20190809011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190809011031
SQL开始执行时间：20190809011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190809011031
SQL开始执行时间：20190809011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190809011032
SQL开始执行时间：20190809011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190809011032
SQL开始执行时间：20190809011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190809011032
SQL开始执行时间：20190809011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190809011032
SQL开始执行时间：20190809011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190809011032
SQL开始执行时间：20190809011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190809011035
SQL开始执行时间：20190809011035

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190809011035

20190810011035开始执行2019-08-09数据加载日志:
SQL开始执行时间：20190810011035


use edw
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-09' or left(a.dmodifysystime,10) >= '2019-08-09')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-09' or left(a.dmodifysystime,10) >= '2019-08-09')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190810011035
SQL开始执行时间：20190810011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190810011036
SQL开始执行时间：20190810011036
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190810011036
SQL开始执行时间：20190810011036
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190810011036
SQL开始执行时间：20190810011036


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190810011037
SQL开始执行时间：20190810011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190810011037
SQL开始执行时间：20190810011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190810011037
SQL开始执行时间：20190810011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190810011037
SQL开始执行时间：20190810011037

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190810011037
SQL开始执行时间：20190810011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190810011040
SQL开始执行时间：20190810011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190810011040

20190811011035开始执行2019-08-10数据加载日志:
SQL开始执行时间：20190811011035


use edw
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-10' or left(a.dmodifysystime,10) >= '2019-08-10')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-10' or left(a.dmodifysystime,10) >= '2019-08-10')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190811011035
SQL开始执行时间：20190811011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190811011039
SQL开始执行时间：20190811011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190811011039

20190812011031开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190812011031


use edw
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-11' or left(a.dmodifysystime,10) >= '2019-08-11')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-11' or left(a.dmodifysystime,10) >= '2019-08-11')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190812011031
SQL开始执行时间：20190812011031

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190812011034
SQL开始执行时间：20190812011034

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190812011034

20190813011033开始执行2019-08-12数据加载日志:
SQL开始执行时间：20190813011033


use edw
;
SQL结束执行时间：20190813011033
SQL开始执行时间：20190813011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190813011033
SQL开始执行时间：20190813011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-12' or left(a.dmodifysystime,10) >= '2019-08-12')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-12' or left(a.dmodifysystime,10) >= '2019-08-12')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190813011034
SQL开始执行时间：20190813011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190813011036
SQL开始执行时间：20190813011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190813011036
SQL开始执行时间：20190813011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190813011036
SQL开始执行时间：20190813011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190813011036
SQL开始执行时间：20190813011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190813011036
SQL开始执行时间：20190813011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190813011039
SQL开始执行时间：20190813011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190813011039

20190813111510开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190813111510


use edw
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-11' or left(a.dmodifysystime,10) >= '2019-08-11')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-11' or left(a.dmodifysystime,10) >= '2019-08-11')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190813111510
SQL开始执行时间：20190813111510


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190813111512
SQL开始执行时间：20190813111512

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190813111512
SQL开始执行时间：20190813111512

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190813111512
SQL开始执行时间：20190813111512


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190813111512
SQL开始执行时间：20190813111512

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190813111512
SQL开始执行时间：20190813111512

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190813111515
SQL开始执行时间：20190813111515

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190813111515

20190814011030开始执行2019-08-13数据加载日志:
SQL开始执行时间：20190814011030


use edw
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-13' or left(a.dmodifysystime,10) >= '2019-08-13')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and a.db = b.db
 where (left(a.dcreatesystime,10) >= '2019-08-13' or left(a.dmodifysystime,10) >= '2019-08-13')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190814011030
SQL开始执行时间：20190814011030

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190814011031
SQL开始执行时间：20190814011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190814011031
SQL开始执行时间：20190814011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190814011031
SQL开始执行时间：20190814011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190814011032
SQL开始执行时间：20190814011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190814011032
SQL开始执行时间：20190814011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190814011032
SQL开始执行时间：20190814011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190814011032
SQL开始执行时间：20190814011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190814011032
SQL开始执行时间：20190814011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190814011035
SQL开始执行时间：20190814011035

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190814011035

20190815011033开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190815011033


use edw
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-14' or left(a.dmodifysystime,10) >= '2019-08-14')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-14' or left(a.dmodifysystime,10) >= '2019-08-14')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190815011033
SQL开始执行时间：20190815011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190815011034
SQL开始执行时间：20190815011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190815011035
SQL开始执行时间：20190815011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190815011038
SQL开始执行时间：20190815011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190815011038

20190816011032开始执行2019-08-15数据加载日志:
SQL开始执行时间：20190816011032


use edw
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-15' or left(a.dmodifysystime,10) >= '2019-08-15')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-15' or left(a.dmodifysystime,10) >= '2019-08-15')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190816011032
SQL开始执行时间：20190816011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190816011033
SQL开始执行时间：20190816011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190816011033
SQL开始执行时间：20190816011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190816011033
SQL开始执行时间：20190816011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190816011033
SQL开始执行时间：20190816011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190816011034
SQL开始执行时间：20190816011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190816011037
SQL开始执行时间：20190816011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190816011037

20190817011033开始执行2019-08-16数据加载日志:
SQL开始执行时间：20190817011033


use edw
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-16' or left(a.dmodifysystime,10) >= '2019-08-16')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-16' or left(a.dmodifysystime,10) >= '2019-08-16')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190817011033
SQL开始执行时间：20190817011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190817011034
SQL开始执行时间：20190817011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190817011034
SQL开始执行时间：20190817011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190817011034
SQL开始执行时间：20190817011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190817011035
SQL开始执行时间：20190817011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190817011035
SQL开始执行时间：20190817011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190817011035
SQL开始执行时间：20190817011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190817011035
SQL开始执行时间：20190817011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190817011035
SQL开始执行时间：20190817011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190817011038
SQL开始执行时间：20190817011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190817011038

20190818011034开始执行2019-08-17数据加载日志:
SQL开始执行时间：20190818011034


use edw
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-17' or left(a.dmodifysystime,10) >= '2019-08-17')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-17' or left(a.dmodifysystime,10) >= '2019-08-17')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190818011034
SQL开始执行时间：20190818011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190818011035
SQL开始执行时间：20190818011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190818011038
SQL开始执行时间：20190818011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190818011038

20190819011031开始执行2019-08-18数据加载日志:
SQL开始执行时间：20190819011031


use edw
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190819011031
SQL开始执行时间：20190819011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190819011032
SQL开始执行时间：20190819011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190819011035
SQL开始执行时间：20190819011035

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190819011035

20190819142554开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190819142554


use edw
;
SQL结束执行时间：20190819142554
SQL开始执行时间：20190819142554
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190819142554
SQL开始执行时间：20190819142554
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-14' or left(a.dmodifysystime,10) >= '2019-08-14')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190819142554
SQL开始执行时间：20190819142554



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-14' or left(a.dmodifysystime,10) >= '2019-08-14')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190819142555
SQL开始执行时间：20190819142555



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190819142555
SQL开始执行时间：20190819142555
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190819142555
SQL开始执行时间：20190819142555

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190819142555
SQL开始执行时间：20190819142555

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190819142556
SQL开始执行时间：20190819142556
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190819142556
SQL开始执行时间：20190819142556
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190819142556
SQL开始执行时间：20190819142556


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190819142558
SQL开始执行时间：20190819142558

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190819142558
SQL开始执行时间：20190819142558

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190819142558
SQL开始执行时间：20190819142558


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190819142558
SQL开始执行时间：20190819142558

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190819142558
SQL开始执行时间：20190819142558

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190819142602
SQL开始执行时间：20190819142602

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190819142602

20190820011031开始执行2019-08-19数据加载日志:
SQL开始执行时间：20190820011031


use edw
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-19' or left(a.dmodifysystime,10) >= '2019-08-19')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-19' or left(a.dmodifysystime,10) >= '2019-08-19')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190820011031
SQL开始执行时间：20190820011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190820011032
SQL开始执行时间：20190820011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190820011032
SQL开始执行时间：20190820011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190820011032
SQL开始执行时间：20190820011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190820011032
SQL开始执行时间：20190820011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190820011034
SQL开始执行时间：20190820011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190820011034
SQL开始执行时间：20190820011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190820011034
SQL开始执行时间：20190820011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190820011034
SQL开始执行时间：20190820011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190820011034
SQL开始执行时间：20190820011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190820011037
SQL开始执行时间：20190820011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190820011037

20190821011031开始执行2019-08-20数据加载日志:
SQL开始执行时间：20190821011031


use edw
;
SQL结束执行时间：20190821011031
SQL开始执行时间：20190821011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190821011031
SQL开始执行时间：20190821011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-20' or left(a.dmodifysystime,10) >= '2019-08-20')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-20' or left(a.dmodifysystime,10) >= '2019-08-20')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190821011032
SQL开始执行时间：20190821011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190821011033
SQL开始执行时间：20190821011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190821011033
SQL开始执行时间：20190821011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190821011033
SQL开始执行时间：20190821011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190821011033
SQL开始执行时间：20190821011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190821011034
SQL开始执行时间：20190821011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190821011037
SQL开始执行时间：20190821011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190821011037

20190821100445开始执行2019-08-18数据加载日志:
SQL开始执行时间：20190821100445


use edw
;
SQL结束执行时间：20190821100445
SQL开始执行时间：20190821100445
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190821100445
SQL开始执行时间：20190821100445
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190821100445
SQL开始执行时间：20190821100445



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190821100446
SQL开始执行时间：20190821100446



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190821100446
SQL开始执行时间：20190821100446
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190821100446
SQL开始执行时间：20190821100446

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190821100446
SQL开始执行时间：20190821100446

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190821100447
SQL开始执行时间：20190821100447
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190821100447
SQL开始执行时间：20190821100447
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190821100447
SQL开始执行时间：20190821100447


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190821100449
SQL开始执行时间：20190821100449

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190821100449
SQL开始执行时间：20190821100449

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190821100449
SQL开始执行时间：20190821100449


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190821100449
SQL开始执行时间：20190821100449

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190821100449
SQL开始执行时间：20190821100449

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190821100453
SQL开始执行时间：20190821100453

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190821100453

20190822011032开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190822011032


use edw
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-21' or left(a.dmodifysystime,10) >= '2019-08-21')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-21' or left(a.dmodifysystime,10) >= '2019-08-21')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190822011032
SQL开始执行时间：20190822011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190822011033
SQL开始执行时间：20190822011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190822011033
SQL开始执行时间：20190822011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190822011033
SQL开始执行时间：20190822011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190822011034
SQL开始执行时间：20190822011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190822011034
SQL开始执行时间：20190822011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190822011034
SQL开始执行时间：20190822011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190822011034
SQL开始执行时间：20190822011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190822011034
SQL开始执行时间：20190822011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190822011037
SQL开始执行时间：20190822011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190822011037

20190822091136开始执行2019-08-18数据加载日志:
SQL开始执行时间：20190822091136


use edw
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-18' or left(a.dmodifysystime,10) >= '2019-08-18')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190822091136
SQL开始执行时间：20190822091136

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190822091138
SQL开始执行时间：20190822091138
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190822091138
SQL开始执行时间：20190822091138
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190822091138
SQL开始执行时间：20190822091138


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190822091140
SQL开始执行时间：20190822091140

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190822091140
SQL开始执行时间：20190822091140

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190822091140
SQL开始执行时间：20190822091140


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190822091140
SQL开始执行时间：20190822091140

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190822091141
SQL开始执行时间：20190822091141

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190822091144
SQL开始执行时间：20190822091144

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190822091144

20190823011032开始执行2019-08-22数据加载日志:
SQL开始执行时间：20190823011032


use edw
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-22' or left(a.dmodifysystime,10) >= '2019-08-22')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-22' or left(a.dmodifysystime,10) >= '2019-08-22')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190823011032
SQL开始执行时间：20190823011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190823011033
SQL开始执行时间：20190823011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190823011033
SQL开始执行时间：20190823011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190823011033
SQL开始执行时间：20190823011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190823011034
SQL开始执行时间：20190823011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190823011034
SQL开始执行时间：20190823011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190823011034
SQL开始执行时间：20190823011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190823011034
SQL开始执行时间：20190823011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190823011034
SQL开始执行时间：20190823011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190823011038
SQL开始执行时间：20190823011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190823011038

20190823092040开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190823092040


use edw
;
SQL结束执行时间：20190823092040
SQL开始执行时间：20190823092040
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190823092040
SQL开始执行时间：20190823092040
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-21' or left(a.dmodifysystime,10) >= '2019-08-21')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190823092041
SQL开始执行时间：20190823092041



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-21' or left(a.dmodifysystime,10) >= '2019-08-21')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190823092041
SQL开始执行时间：20190823092041



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190823092041
SQL开始执行时间：20190823092041
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190823092041
SQL开始执行时间：20190823092041

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190823092041
SQL开始执行时间：20190823092041

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190823092042
SQL开始执行时间：20190823092042
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190823092042
SQL开始执行时间：20190823092042
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190823092042
SQL开始执行时间：20190823092042


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190823092044
SQL开始执行时间：20190823092044

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190823092044
SQL开始执行时间：20190823092044

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190823092044
SQL开始执行时间：20190823092044


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190823092044
SQL开始执行时间：20190823092044

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190823092044
SQL开始执行时间：20190823092044

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190823092047
SQL开始执行时间：20190823092047

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190823092047

20190824011032开始执行2019-08-23数据加载日志:
SQL开始执行时间：20190824011032


use edw
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-23' or left(a.dmodifysystime,10) >= '2019-08-23')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-23' or left(a.dmodifysystime,10) >= '2019-08-23')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190824011032
SQL开始执行时间：20190824011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190824011033
SQL开始执行时间：20190824011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190824011033
SQL开始执行时间：20190824011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190824011033
SQL开始执行时间：20190824011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190824011033
SQL开始执行时间：20190824011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190824011034
SQL开始执行时间：20190824011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190824011037
SQL开始执行时间：20190824011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190824011037

20190825011032开始执行2019-08-24数据加载日志:
SQL开始执行时间：20190825011032


use edw
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-24' or left(a.dmodifysystime,10) >= '2019-08-24')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-24' or left(a.dmodifysystime,10) >= '2019-08-24')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190825011032
SQL开始执行时间：20190825011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190825011036
SQL开始执行时间：20190825011036

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190825011036

20190826011034开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190826011034


use edw
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-25' or left(a.dmodifysystime,10) >= '2019-08-25')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-25' or left(a.dmodifysystime,10) >= '2019-08-25')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190826011034
SQL开始执行时间：20190826011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190826011035
SQL开始执行时间：20190826011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190826011038
SQL开始执行时间：20190826011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190826011038

20190827011032开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190827011032


use edw
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-26' or left(a.dmodifysystime,10) >= '2019-08-26')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-26' or left(a.dmodifysystime,10) >= '2019-08-26')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190827011032
SQL开始执行时间：20190827011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190827011033
SQL开始执行时间：20190827011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190827011033
SQL开始执行时间：20190827011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190827011033
SQL开始执行时间：20190827011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190827011034
SQL开始执行时间：20190827011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190827011034
SQL开始执行时间：20190827011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190827011034
SQL开始执行时间：20190827011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190827011034
SQL开始执行时间：20190827011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190827011034
SQL开始执行时间：20190827011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190827011038
SQL开始执行时间：20190827011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190827011038

20190827092545开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190827092545


use edw
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-25' or left(a.dmodifysystime,10) >= '2019-08-25')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-25' or left(a.dmodifysystime,10) >= '2019-08-25')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190827092545
SQL开始执行时间：20190827092545

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190827092546
SQL开始执行时间：20190827092546
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190827092546
SQL开始执行时间：20190827092546
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190827092546
SQL开始执行时间：20190827092546


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190827092547
SQL开始执行时间：20190827092547

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190827092547
SQL开始执行时间：20190827092547

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190827092547
SQL开始执行时间：20190827092547


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190827092547
SQL开始执行时间：20190827092547

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190827092548
SQL开始执行时间：20190827092548

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190827092551
SQL开始执行时间：20190827092551

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190827092551

20190828011032开始执行2019-08-27数据加载日志:
SQL开始执行时间：20190828011032


use edw
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-27' or left(a.dmodifysystime,10) >= '2019-08-27')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-27' or left(a.dmodifysystime,10) >= '2019-08-27')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190828011032
SQL开始执行时间：20190828011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190828011033
SQL开始执行时间：20190828011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190828011033
SQL开始执行时间：20190828011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190828011033
SQL开始执行时间：20190828011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190828011033
SQL开始执行时间：20190828011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190828011033
SQL开始执行时间：20190828011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190828011034
SQL开始执行时间：20190828011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190828011034
SQL开始执行时间：20190828011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190828011034
SQL开始执行时间：20190828011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190828011038
SQL开始执行时间：20190828011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190828011038

20190828093153开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190828093153


use edw
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-26' or left(a.dmodifysystime,10) >= '2019-08-26')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-26' or left(a.dmodifysystime,10) >= '2019-08-26')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190828093153
SQL开始执行时间：20190828093153

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190828093154
SQL开始执行时间：20190828093154
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190828093154
SQL开始执行时间：20190828093154
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190828093154
SQL开始执行时间：20190828093154


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190828093156
SQL开始执行时间：20190828093156

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190828093156
SQL开始执行时间：20190828093156

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190828093156
SQL开始执行时间：20190828093156


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190828093156
SQL开始执行时间：20190828093156

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190828093157
SQL开始执行时间：20190828093157

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190828093200
SQL开始执行时间：20190828093200

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190828093200

20190829011033开始执行2019-08-28数据加载日志:
SQL开始执行时间：20190829011033


use edw
;
SQL结束执行时间：20190829011033
SQL开始执行时间：20190829011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190829011033
SQL开始执行时间：20190829011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-28' or left(a.dmodifysystime,10) >= '2019-08-28')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-28' or left(a.dmodifysystime,10) >= '2019-08-28')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190829011034
SQL开始执行时间：20190829011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190829011035
SQL开始执行时间：20190829011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190829011035
SQL开始执行时间：20190829011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190829011035
SQL开始执行时间：20190829011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190829011035
SQL开始执行时间：20190829011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190829011036
SQL开始执行时间：20190829011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190829011039
SQL开始执行时间：20190829011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190829011039

20190830011034开始执行2019-08-29数据加载日志:
SQL开始执行时间：20190830011034


use edw
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-29' or left(a.dmodifysystime,10) >= '2019-08-29')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-29' or left(a.dmodifysystime,10) >= '2019-08-29')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190830011034
SQL开始执行时间：20190830011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190830011035
SQL开始执行时间：20190830011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190830011035
SQL开始执行时间：20190830011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190830011035
SQL开始执行时间：20190830011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190830011035
SQL开始执行时间：20190830011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190830011036
SQL开始执行时间：20190830011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190830011036
SQL开始执行时间：20190830011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190830011036
SQL开始执行时间：20190830011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190830011036
SQL开始执行时间：20190830011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190830011036
SQL开始执行时间：20190830011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190830011040
SQL开始执行时间：20190830011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190830011040

20190831011050开始执行2019-08-30数据加载日志:
SQL开始执行时间：20190831011050


use edw
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-30' or left(a.dmodifysystime,10) >= '2019-08-30')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-30' or left(a.dmodifysystime,10) >= '2019-08-30')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190831011050
SQL开始执行时间：20190831011050

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190831011051
SQL开始执行时间：20190831011051
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190831011051
SQL开始执行时间：20190831011051
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190831011051
SQL开始执行时间：20190831011051


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190831011052
SQL开始执行时间：20190831011052

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190831011052
SQL开始执行时间：20190831011052

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190831011052
SQL开始执行时间：20190831011052


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190831011052
SQL开始执行时间：20190831011052

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190831011053
SQL开始执行时间：20190831011053

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190831011057
SQL开始执行时间：20190831011057

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190831011057

20190901011031开始执行2019-08-31数据加载日志:
SQL开始执行时间：20190901011031


use edw
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-08-31' or left(a.dmodifysystime,10) >= '2019-08-31')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-08-31' or left(a.dmodifysystime,10) >= '2019-08-31')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190901011031
SQL开始执行时间：20190901011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190901011032
SQL开始执行时间：20190901011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190901011036
SQL开始执行时间：20190901011036

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190901011036

20190902011046开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190902011046


use edw
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190902011046
SQL开始执行时间：20190902011046

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190902011050
SQL开始执行时间：20190902011050

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190902011050

20190902151359开始执行1900-01-01数据加载日志:
SQL开始执行时间：20190902151359


use edw
;
SQL结束执行时间：20190902151359
SQL开始执行时间：20190902151359
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190902151359
SQL开始执行时间：20190902151359
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190902151400
SQL开始执行时间：20190902151400



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '1900-01-01' or left(a.dmodifysystime,10) >= '1900-01-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190902151400
SQL开始执行时间：20190902151400



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190902151400
SQL开始执行时间：20190902151400
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190902151400
SQL开始执行时间：20190902151400

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190902151400
SQL开始执行时间：20190902151400

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190902151546
SQL开始执行时间：20190902151546
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190902151546
SQL开始执行时间：20190902151546
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190902151547
SQL开始执行时间：20190902151547


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190902152345
SQL开始执行时间：20190902152345

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190902152346
SQL开始执行时间：20190902152346

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190902152347
SQL开始执行时间：20190902152347


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190902152348
SQL开始执行时间：20190902152348

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190902152348
SQL开始执行时间：20190902152348

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190902152355
SQL开始执行时间：20190902152355

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190902152355

20190903011031开始执行2019-09-02数据加载日志:
SQL开始执行时间：20190903011031


use edw
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-02' or left(a.dmodifysystime,10) >= '2019-09-02')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-02' or left(a.dmodifysystime,10) >= '2019-09-02')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190903011031
SQL开始执行时间：20190903011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190903011032
SQL开始执行时间：20190903011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190903011032
SQL开始执行时间：20190903011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190903011032
SQL开始执行时间：20190903011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190903011033
SQL开始执行时间：20190903011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190903011033
SQL开始执行时间：20190903011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190903011033
SQL开始执行时间：20190903011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190903011033
SQL开始执行时间：20190903011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190903011033
SQL开始执行时间：20190903011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190903011038
SQL开始执行时间：20190903011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190903011038

20190904011032开始执行2019-09-03数据加载日志:
SQL开始执行时间：20190904011032


use edw
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-03' or left(a.dmodifysystime,10) >= '2019-09-03')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-03' or left(a.dmodifysystime,10) >= '2019-09-03')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190904011032
SQL开始执行时间：20190904011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190904011033
SQL开始执行时间：20190904011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190904011033
SQL开始执行时间：20190904011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190904011033
SQL开始执行时间：20190904011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190904011034
SQL开始执行时间：20190904011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190904011034
SQL开始执行时间：20190904011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190904011034
SQL开始执行时间：20190904011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190904011034
SQL开始执行时间：20190904011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190904011034
SQL开始执行时间：20190904011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190904011039
SQL开始执行时间：20190904011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190904011039

20190904183043开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190904183043


use edw
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190904183043
SQL开始执行时间：20190904183043

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190904183045
SQL开始执行时间：20190904183045
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190904183045
SQL开始执行时间：20190904183045
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190904183045
SQL开始执行时间：20190904183045


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190904183047
SQL开始执行时间：20190904183047

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190904183047
SQL开始执行时间：20190904183047

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190904183047
SQL开始执行时间：20190904183047


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190904183047
SQL开始执行时间：20190904183047

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190904183047
SQL开始执行时间：20190904183047

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190904183051
SQL开始执行时间：20190904183051

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190904183051

20190905011031开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190905011031


use edw
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-04' or left(a.dmodifysystime,10) >= '2019-09-04')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-04' or left(a.dmodifysystime,10) >= '2019-09-04')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190905011031
SQL开始执行时间：20190905011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190905011032
SQL开始执行时间：20190905011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190905011032
SQL开始执行时间：20190905011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190905011032
SQL开始执行时间：20190905011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190905011033
SQL开始执行时间：20190905011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190905011033
SQL开始执行时间：20190905011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190905011033
SQL开始执行时间：20190905011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190905011033
SQL开始执行时间：20190905011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190905011033
SQL开始执行时间：20190905011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190905011038
SQL开始执行时间：20190905011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190905011038

20190905110623开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190905110623


use edw
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-01' or left(a.dmodifysystime,10) >= '2019-09-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190905110623
SQL开始执行时间：20190905110623

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190905110625
SQL开始执行时间：20190905110625
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190905110625
SQL开始执行时间：20190905110625
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190905110625
SQL开始执行时间：20190905110625


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190905110628
SQL开始执行时间：20190905110628

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190905110628
SQL开始执行时间：20190905110628

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190905110628
SQL开始执行时间：20190905110628


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190905110628
SQL开始执行时间：20190905110628

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190905110628
SQL开始执行时间：20190905110628

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190905110632
SQL开始执行时间：20190905110632

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190905110632

20190906011034开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190906011034


use edw
;
SQL结束执行时间：20190906011034
SQL开始执行时间：20190906011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190906011034
SQL开始执行时间：20190906011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-05' or left(a.dmodifysystime,10) >= '2019-09-05')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-05' or left(a.dmodifysystime,10) >= '2019-09-05')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190906011035
SQL开始执行时间：20190906011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190906011036
SQL开始执行时间：20190906011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190906011036
SQL开始执行时间：20190906011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190906011036
SQL开始执行时间：20190906011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190906011036
SQL开始执行时间：20190906011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190906011037
SQL开始执行时间：20190906011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190906011041
SQL开始执行时间：20190906011041

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190906011041

20190907011035开始执行2019-09-06数据加载日志:
SQL开始执行时间：20190907011035


use edw
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-06' or left(a.dmodifysystime,10) >= '2019-09-06')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-06' or left(a.dmodifysystime,10) >= '2019-09-06')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190907011035
SQL开始执行时间：20190907011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190907011036
SQL开始执行时间：20190907011036
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190907011036
SQL开始执行时间：20190907011036
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190907011036
SQL开始执行时间：20190907011036


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190907011037
SQL开始执行时间：20190907011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190907011037
SQL开始执行时间：20190907011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190907011037
SQL开始执行时间：20190907011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190907011037
SQL开始执行时间：20190907011037

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190907011037
SQL开始执行时间：20190907011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190907011042
SQL开始执行时间：20190907011042

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190907011042

20190908011031开始执行2019-09-07数据加载日志:
SQL开始执行时间：20190908011031


use edw
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-07' or left(a.dmodifysystime,10) >= '2019-09-07')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-07' or left(a.dmodifysystime,10) >= '2019-09-07')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190908011031
SQL开始执行时间：20190908011031

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190908011032
SQL开始执行时间：20190908011032

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190908011036
SQL开始执行时间：20190908011036

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190908011036

20190909011032开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190909011032


use edw
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-08' or left(a.dmodifysystime,10) >= '2019-09-08')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-08' or left(a.dmodifysystime,10) >= '2019-09-08')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190909011032
SQL开始执行时间：20190909011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190909011033
SQL开始执行时间：20190909011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190909011037
SQL开始执行时间：20190909011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190909011037

20190909090557开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190909090557


use edw
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-04' or left(a.dmodifysystime,10) >= '2019-09-04')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-04' or left(a.dmodifysystime,10) >= '2019-09-04')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190909090557
SQL开始执行时间：20190909090557

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190909090558
SQL开始执行时间：20190909090558

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190909090600
SQL开始执行时间：20190909090600
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190909090600
SQL开始执行时间：20190909090600
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190909090600
SQL开始执行时间：20190909090600


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190909090603
SQL开始执行时间：20190909090603

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190909090603
SQL开始执行时间：20190909090603

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190909090603
SQL开始执行时间：20190909090603


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190909090603
SQL开始执行时间：20190909090603

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190909090603
SQL开始执行时间：20190909090603

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190909090608
SQL开始执行时间：20190909090608

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190909090608

20190910011034开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190910011034


use edw
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190910011034
SQL开始执行时间：20190910011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190910011035
SQL开始执行时间：20190910011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190910011035
SQL开始执行时间：20190910011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190910011035
SQL开始执行时间：20190910011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190910011035
SQL开始执行时间：20190910011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190910011036
SQL开始执行时间：20190910011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190910011036
SQL开始执行时间：20190910011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190910011036
SQL开始执行时间：20190910011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190910011036
SQL开始执行时间：20190910011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190910011040
SQL开始执行时间：20190910011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190910011040

20190910101535开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190910101535


use edw
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-08' or left(a.dmodifysystime,10) >= '2019-09-08')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-08' or left(a.dmodifysystime,10) >= '2019-09-08')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190910101535
SQL开始执行时间：20190910101535

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190910101536
SQL开始执行时间：20190910101536
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190910101536
SQL开始执行时间：20190910101536
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190910101536
SQL开始执行时间：20190910101536


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190910101537
SQL开始执行时间：20190910101537

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190910101537
SQL开始执行时间：20190910101537

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190910101537
SQL开始执行时间：20190910101537


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190910101537
SQL开始执行时间：20190910101537

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190910101537
SQL开始执行时间：20190910101537

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190910101541
SQL开始执行时间：20190910101541

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190910101541

20190911011032开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190911011032


use edw
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-10' or left(a.dmodifysystime,10) >= '2019-09-10')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-10' or left(a.dmodifysystime,10) >= '2019-09-10')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190911011032
SQL开始执行时间：20190911011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190911011033
SQL开始执行时间：20190911011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190911011033
SQL开始执行时间：20190911011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190911011033
SQL开始执行时间：20190911011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190911011034
SQL开始执行时间：20190911011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190911011034
SQL开始执行时间：20190911011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190911011034
SQL开始执行时间：20190911011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190911011034
SQL开始执行时间：20190911011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190911011034
SQL开始执行时间：20190911011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190911011038
SQL开始执行时间：20190911011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190911011038

20190912011032开始执行2019-09-11数据加载日志:
SQL开始执行时间：20190912011032


use edw
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-11' or left(a.dmodifysystime,10) >= '2019-09-11')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-11' or left(a.dmodifysystime,10) >= '2019-09-11')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190912011032
SQL开始执行时间：20190912011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190912011033
SQL开始执行时间：20190912011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190912011033
SQL开始执行时间：20190912011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190912011033
SQL开始执行时间：20190912011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190912011034
SQL开始执行时间：20190912011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190912011034
SQL开始执行时间：20190912011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190912011034
SQL开始执行时间：20190912011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190912011034
SQL开始执行时间：20190912011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190912011034
SQL开始执行时间：20190912011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190912011038
SQL开始执行时间：20190912011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190912011038

20190913011035开始执行2019-09-12数据加载日志:
SQL开始执行时间：20190913011035


use edw
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-12' or left(a.dmodifysystime,10) >= '2019-09-12')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-12' or left(a.dmodifysystime,10) >= '2019-09-12')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190913011035
SQL开始执行时间：20190913011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190913011036
SQL开始执行时间：20190913011036
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190913011036
SQL开始执行时间：20190913011036
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190913011036
SQL开始执行时间：20190913011036


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190913011037
SQL开始执行时间：20190913011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190913011037
SQL开始执行时间：20190913011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190913011037
SQL开始执行时间：20190913011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190913011037
SQL开始执行时间：20190913011037

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190913011037
SQL开始执行时间：20190913011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190913011042
SQL开始执行时间：20190913011042

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190913011042

20190914011050开始执行2019-09-13数据加载日志:
SQL开始执行时间：20190914011050


use edw
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-13' or left(a.dmodifysystime,10) >= '2019-09-13')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-13' or left(a.dmodifysystime,10) >= '2019-09-13')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190914011050
SQL开始执行时间：20190914011050

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190914011051
SQL开始执行时间：20190914011051

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190914011055
SQL开始执行时间：20190914011055

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190914011055

20190915011034开始执行2019-09-14数据加载日志:
SQL开始执行时间：20190915011034


use edw
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-14' or left(a.dmodifysystime,10) >= '2019-09-14')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-14' or left(a.dmodifysystime,10) >= '2019-09-14')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190915011034
SQL开始执行时间：20190915011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190915011035
SQL开始执行时间：20190915011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190915011039
SQL开始执行时间：20190915011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190915011039

20190916011035开始执行2019-09-15数据加载日志:
SQL开始执行时间：20190916011035


use edw
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-15' or left(a.dmodifysystime,10) >= '2019-09-15')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-15' or left(a.dmodifysystime,10) >= '2019-09-15')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190916011035
SQL开始执行时间：20190916011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190916011036
SQL开始执行时间：20190916011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190916011040
SQL开始执行时间：20190916011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190916011040

20190916084632开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190916084632


use edw
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190916084632
SQL开始执行时间：20190916084632

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190916084635
SQL开始执行时间：20190916084635
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190916084635
SQL开始执行时间：20190916084635
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190916084635
SQL开始执行时间：20190916084635


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190916084639
SQL开始执行时间：20190916084639

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916084639
SQL开始执行时间：20190916084639

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916084639
SQL开始执行时间：20190916084639


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190916084639
SQL开始执行时间：20190916084639

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190916084640
SQL开始执行时间：20190916084640

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190916084644
SQL开始执行时间：20190916084644

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190916084644

20190916093036开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190916093036


use edw
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190916093036
SQL开始执行时间：20190916093036

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190916093039
SQL开始执行时间：20190916093039
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190916093039
SQL开始执行时间：20190916093039
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190916093039
SQL开始执行时间：20190916093039


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190916093043
SQL开始执行时间：20190916093043

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916093043
SQL开始执行时间：20190916093043

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916093043
SQL开始执行时间：20190916093043


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190916093043
SQL开始执行时间：20190916093043

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190916093043
SQL开始执行时间：20190916093043

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190916093048
SQL开始执行时间：20190916093048

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190916093048

20190916095755开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190916095755


use edw
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-09' or left(a.dmodifysystime,10) >= '2019-09-09')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190916095755
SQL开始执行时间：20190916095755

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190916095758
SQL开始执行时间：20190916095758
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190916095758
SQL开始执行时间：20190916095758
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190916095758
SQL开始执行时间：20190916095758


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190916095802
SQL开始执行时间：20190916095802

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916095802
SQL开始执行时间：20190916095802

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190916095802
SQL开始执行时间：20190916095802


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190916095802
SQL开始执行时间：20190916095802

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190916095802
SQL开始执行时间：20190916095802

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190916095807
SQL开始执行时间：20190916095807

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190916095807

20190917011033开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190917011033


use edw
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-16' or left(a.dmodifysystime,10) >= '2019-09-16')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-16' or left(a.dmodifysystime,10) >= '2019-09-16')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190917011033
SQL开始执行时间：20190917011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190917011034
SQL开始执行时间：20190917011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190917011034
SQL开始执行时间：20190917011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190917011034
SQL开始执行时间：20190917011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190917011035
SQL开始执行时间：20190917011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190917011035
SQL开始执行时间：20190917011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190917011035
SQL开始执行时间：20190917011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190917011035
SQL开始执行时间：20190917011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190917011036
SQL开始执行时间：20190917011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190917011040
SQL开始执行时间：20190917011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190917011040

20190917192916开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190917192916


use edw
;
SQL结束执行时间：20190917192916
SQL开始执行时间：20190917192916
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190917192916
SQL开始执行时间：20190917192916
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190917192916
SQL开始执行时间：20190917192916



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-01-01' or left(a.dmodifysystime,10) >= '2019-01-01')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190917192916
SQL开始执行时间：20190917192916



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190917192916
SQL开始执行时间：20190917192916
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190917192917
SQL开始执行时间：20190917192917

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190917192917
SQL开始执行时间：20190917192917

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190917193030
SQL开始执行时间：20190917193030
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190917193030
SQL开始执行时间：20190917193030
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190917193030
SQL开始执行时间：20190917193030


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190917193253
SQL开始执行时间：20190917193253

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190917193253
SQL开始执行时间：20190917193253

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190917193255
SQL开始执行时间：20190917193255


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190917193255
SQL开始执行时间：20190917193255

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190917193255
SQL开始执行时间：20190917193255

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190917193300
SQL开始执行时间：20190917193300

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190917193300

20190918011033开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190918011033


use edw
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-17' or left(a.dmodifysystime,10) >= '2019-09-17')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-17' or left(a.dmodifysystime,10) >= '2019-09-17')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190918011033
SQL开始执行时间：20190918011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190918011034
SQL开始执行时间：20190918011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190918011034
SQL开始执行时间：20190918011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190918011034
SQL开始执行时间：20190918011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190918011035
SQL开始执行时间：20190918011035

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190918011035
SQL开始执行时间：20190918011035

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190918011035
SQL开始执行时间：20190918011035


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190918011035
SQL开始执行时间：20190918011035

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190918011036
SQL开始执行时间：20190918011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190918011040
SQL开始执行时间：20190918011040

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190918011040

20190918094116开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190918094116


use edw
;
SQL结束执行时间：20190918094116
SQL开始执行时间：20190918094116
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190918094116
SQL开始执行时间：20190918094116
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-16' or left(a.dmodifysystime,10) >= '2019-09-16')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190918094116
SQL开始执行时间：20190918094116



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-16' or left(a.dmodifysystime,10) >= '2019-09-16')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190918094116
SQL开始执行时间：20190918094116



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190918094116
SQL开始执行时间：20190918094116
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190918094117
SQL开始执行时间：20190918094117

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190918094117
SQL开始执行时间：20190918094117

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190918094118
SQL开始执行时间：20190918094118
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190918094118
SQL开始执行时间：20190918094118
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190918094118
SQL开始执行时间：20190918094118


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190918094121
SQL开始执行时间：20190918094121

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190918094121
SQL开始执行时间：20190918094121

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190918094121
SQL开始执行时间：20190918094121


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190918094121
SQL开始执行时间：20190918094121

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190918094121
SQL开始执行时间：20190918094121

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190918094125
SQL开始执行时间：20190918094125

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190918094125

20190919011036开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190919011036


use edw
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-18' or left(a.dmodifysystime,10) >= '2019-09-18')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-18' or left(a.dmodifysystime,10) >= '2019-09-18')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190919011036
SQL开始执行时间：20190919011036

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190919011037
SQL开始执行时间：20190919011037
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190919011037
SQL开始执行时间：20190919011037
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190919011037
SQL开始执行时间：20190919011037


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190919011038
SQL开始执行时间：20190919011038

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190919011038
SQL开始执行时间：20190919011038

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190919011038
SQL开始执行时间：20190919011038


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190919011038
SQL开始执行时间：20190919011038

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190919011039
SQL开始执行时间：20190919011039

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190919011043
SQL开始执行时间：20190919011043

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190919011043

20190919102002开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190919102002


use edw
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-17' or left(a.dmodifysystime,10) >= '2019-09-17')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-17' or left(a.dmodifysystime,10) >= '2019-09-17')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190919102002
SQL开始执行时间：20190919102002

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190919102003
SQL开始执行时间：20190919102003
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190919102003
SQL开始执行时间：20190919102003
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190919102003
SQL开始执行时间：20190919102003


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190919102006
SQL开始执行时间：20190919102006

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190919102006
SQL开始执行时间：20190919102006

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190919102006
SQL开始执行时间：20190919102006


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190919102006
SQL开始执行时间：20190919102006

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190919102006
SQL开始执行时间：20190919102006

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190919102011
SQL开始执行时间：20190919102011

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190919102011

20190920011033开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190920011033


use edw
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-19' or left(a.dmodifysystime,10) >= '2019-09-19')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-19' or left(a.dmodifysystime,10) >= '2019-09-19')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190920011033
SQL开始执行时间：20190920011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190920011034
SQL开始执行时间：20190920011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190920011035
SQL开始执行时间：20190920011035

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190920011039
SQL开始执行时间：20190920011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190920011039

20190921011035开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190921011035


use edw
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-20' or left(a.dmodifysystime,10) >= '2019-09-20')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-20' or left(a.dmodifysystime,10) >= '2019-09-20')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190921011035
SQL开始执行时间：20190921011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190921011036
SQL开始执行时间：20190921011036
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190921011036
SQL开始执行时间：20190921011036
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190921011036
SQL开始执行时间：20190921011036


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190921011037
SQL开始执行时间：20190921011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190921011037
SQL开始执行时间：20190921011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190921011037
SQL开始执行时间：20190921011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190921011037
SQL开始执行时间：20190921011037

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190921011038
SQL开始执行时间：20190921011038

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190921011042
SQL开始执行时间：20190921011042

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190921011042

20190922011032开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190922011032


use edw
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-21' or left(a.dmodifysystime,10) >= '2019-09-21')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-21' or left(a.dmodifysystime,10) >= '2019-09-21')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190922011032
SQL开始执行时间：20190922011032

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190922011033
SQL开始执行时间：20190922011033

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190922011037
SQL开始执行时间：20190922011037

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190922011037

20190923011033开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190923011033


use edw
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-22' or left(a.dmodifysystime,10) >= '2019-09-22')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-22' or left(a.dmodifysystime,10) >= '2019-09-22')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190923011033
SQL开始执行时间：20190923011033

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190923011034
SQL开始执行时间：20190923011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190923011038
SQL开始执行时间：20190923011038

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190923011038

20190923113026开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190923113026


use edw
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-19' or left(a.dmodifysystime,10) >= '2019-09-19')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-19' or left(a.dmodifysystime,10) >= '2019-09-19')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190923113026
SQL开始执行时间：20190923113026

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190923113027
SQL开始执行时间：20190923113027
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190923113027
SQL开始执行时间：20190923113027
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190923113027
SQL开始执行时间：20190923113027


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190923113029
SQL开始执行时间：20190923113029

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190923113029
SQL开始执行时间：20190923113029

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190923113029
SQL开始执行时间：20190923113029


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190923113029
SQL开始执行时间：20190923113029

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190923113029
SQL开始执行时间：20190923113029

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190923113034
SQL开始执行时间：20190923113034

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190923113034

20190924011036开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190924011036


use edw
;
SQL结束执行时间：20190924011036
SQL开始执行时间：20190924011036
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190924011036
SQL开始执行时间：20190924011036
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-23' or left(a.dmodifysystime,10) >= '2019-09-23')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190924011037
SQL开始执行时间：20190924011037



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-23' or left(a.dmodifysystime,10) >= '2019-09-23')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190924011037
SQL开始执行时间：20190924011037



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190924011037
SQL开始执行时间：20190924011037
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190924011037
SQL开始执行时间：20190924011037

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190924011037
SQL开始执行时间：20190924011037

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190924011038
SQL开始执行时间：20190924011038
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190924011038
SQL开始执行时间：20190924011038
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190924011038
SQL开始执行时间：20190924011038


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190924011039
SQL开始执行时间：20190924011039

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190924011039
SQL开始执行时间：20190924011039

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190924011039
SQL开始执行时间：20190924011039


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190924011039
SQL开始执行时间：20190924011039

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190924011040
SQL开始执行时间：20190924011040

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190924011044
SQL开始执行时间：20190924011044

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190924011044

20190924094342开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190924094342


use edw
;
SQL结束执行时间：20190924094342
SQL开始执行时间：20190924094342
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190924094342
SQL开始执行时间：20190924094342
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-22' or left(a.dmodifysystime,10) >= '2019-09-22')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190924094343
SQL开始执行时间：20190924094343



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-22' or left(a.dmodifysystime,10) >= '2019-09-22')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190924094343
SQL开始执行时间：20190924094343



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190924094343
SQL开始执行时间：20190924094343
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190924094343
SQL开始执行时间：20190924094343

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190924094343
SQL开始执行时间：20190924094343

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190924094344
SQL开始执行时间：20190924094344
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190924094344
SQL开始执行时间：20190924094344
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190924094344
SQL开始执行时间：20190924094344


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190924094345
SQL开始执行时间：20190924094345

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190924094345
SQL开始执行时间：20190924094345

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190924094345
SQL开始执行时间：20190924094345


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190924094345
SQL开始执行时间：20190924094345

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190924094346
SQL开始执行时间：20190924094346

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190924094350
SQL开始执行时间：20190924094350

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190924094350

20190925011035开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190925011035


use edw
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-24' or left(a.dmodifysystime,10) >= '2019-09-24')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-24' or left(a.dmodifysystime,10) >= '2019-09-24')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190925011035
SQL开始执行时间：20190925011035

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190925011036
SQL开始执行时间：20190925011036
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190925011036
SQL开始执行时间：20190925011036
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190925011036
SQL开始执行时间：20190925011036


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190925011038
SQL开始执行时间：20190925011038

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190925011038
SQL开始执行时间：20190925011038

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190925011038
SQL开始执行时间：20190925011038


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190925011038
SQL开始执行时间：20190925011038

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190925011038
SQL开始执行时间：20190925011038

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190925011043
SQL开始执行时间：20190925011043

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190925011043

20190925113125开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190925113125


use edw
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-23' or left(a.dmodifysystime,10) >= '2019-09-23')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-23' or left(a.dmodifysystime,10) >= '2019-09-23')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190925113125
SQL开始执行时间：20190925113125

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190925113127
SQL开始执行时间：20190925113127
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190925113127
SQL开始执行时间：20190925113127
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190925113127
SQL开始执行时间：20190925113127


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190925113130
SQL开始执行时间：20190925113130

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190925113130
SQL开始执行时间：20190925113130

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190925113130
SQL开始执行时间：20190925113130


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190925113130
SQL开始执行时间：20190925113130

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190925113130
SQL开始执行时间：20190925113130

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190925113135
SQL开始执行时间：20190925113135

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190925113135

20190926011034开始执行2019-09-25数据加载日志:
SQL开始执行时间：20190926011034


use edw
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-25' or left(a.dmodifysystime,10) >= '2019-09-25')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-25' or left(a.dmodifysystime,10) >= '2019-09-25')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190926011034
SQL开始执行时间：20190926011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190926011035
SQL开始执行时间：20190926011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190926011035
SQL开始执行时间：20190926011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190926011035
SQL开始执行时间：20190926011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190926011037
SQL开始执行时间：20190926011037

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190926011037
SQL开始执行时间：20190926011037

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190926011037
SQL开始执行时间：20190926011037


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190926011037
SQL开始执行时间：20190926011037

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190926011037
SQL开始执行时间：20190926011037

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190926011042
SQL开始执行时间：20190926011042

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190926011042

20190927011034开始执行2019-09-26数据加载日志:
SQL开始执行时间：20190927011034


use edw
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-26' or left(a.dmodifysystime,10) >= '2019-09-26')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-26' or left(a.dmodifysystime,10) >= '2019-09-26')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190927011034
SQL开始执行时间：20190927011034

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190927011035
SQL开始执行时间：20190927011035
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190927011035
SQL开始执行时间：20190927011035
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190927011035
SQL开始执行时间：20190927011035


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190927011036
SQL开始执行时间：20190927011036

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190927011036
SQL开始执行时间：20190927011036

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190927011036
SQL开始执行时间：20190927011036


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190927011036
SQL开始执行时间：20190927011036

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190927011036
SQL开始执行时间：20190927011036

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190927011041
SQL开始执行时间：20190927011041

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190927011041

20190928011036开始执行2019-09-27数据加载日志:
SQL开始执行时间：20190928011036


use edw
;
SQL结束执行时间：20190928011036
SQL开始执行时间：20190928011036
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190928011036
SQL开始执行时间：20190928011036
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-27' or left(a.dmodifysystime,10) >= '2019-09-27')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190928011036
SQL开始执行时间：20190928011036



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-27' or left(a.dmodifysystime,10) >= '2019-09-27')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190928011036
SQL开始执行时间：20190928011036



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190928011036
SQL开始执行时间：20190928011036
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190928011037
SQL开始执行时间：20190928011037

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190928011037
SQL开始执行时间：20190928011037

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190928011037
SQL开始执行时间：20190928011037
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190928011037
SQL开始执行时间：20190928011037
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190928011037
SQL开始执行时间：20190928011037


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190928011038
SQL开始执行时间：20190928011038

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190928011038
SQL开始执行时间：20190928011038

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190928011038
SQL开始执行时间：20190928011038


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190928011038
SQL开始执行时间：20190928011038

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190928011039
SQL开始执行时间：20190928011039

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190928011043
SQL开始执行时间：20190928011043

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190928011043

20190929011033开始执行2019-09-28数据加载日志:
SQL开始执行时间：20190929011033


use edw
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033
drop table if exists edw.sales_order_pre
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033
create temporary table edw.sales_order_pre as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join (select ccusname,ccuscode,bi_cusname,bi_cuscode from edw.dic_customer group by ccuscode) b
    on a.ccuscode = b.ccuscode
 where (left(a.dcreatesystime,10) >= '2019-09-28' or left(a.dmodifysystime,10) >= '2019-09-28')
   and a.db <> 'UFDATA_889_2019'
   and a.db <> 'UFDATA_555_2018'
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033



insert into edw.sales_order_pre
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,case when b.ccusname is null then "请核查"
       else b.bi_cuscode end as true_ccuscode 
      ,case when b.ccusname is null then "请核查"
       else b.bi_cusname end as true_ccusname 
      ,a.cdefine10 as finnal_ccusname
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from ufdata.so_somain a
  left join edw.dic_customer b
    on a.ccuscode = b.ccuscode
   and left(a.db,10) = left(b.db,10)
 where (left(a.dcreatesystime,10) >= '2019-09-28' or left(a.dmodifysystime,10) >= '2019-09-28')
   and (a.db = 'UFDATA_889_2019' or a.db = 'UFDATA_555_2018')
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033



drop table if exists edw.mid1_sales_order
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033
create temporary table edw.mid1_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when b.bi_cuscode is null then "请核查"
       else b.finnal_ccusname end as true_finnal_ccusname1
      ,case when a.finnal_ccusname is null then
            case when b.bi_cuscode is null then "请核查"
                 else b.finnal_ccusname end
            else case when c.ccusname is null then a.finnal_ccusname
                 else c.bi_cusname end 
       end  as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.sales_order_pre a
  left join edw.map_customer b
    on a.true_ccuscode = b.bi_cuscode
  left join (select ccusname,bi_cusname from edw.dic_customer group by ccusname) c
    on a.finnal_ccusname = c.ccusname
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033

create temporary table edw.mid2_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccusname1
      ,case when a.true_finnal_ccusname2 like "个人%" and char_LENGTH(a.true_finnal_ccusname2) > 6 then substr(a.true_finnal_ccusname2,4,char_length(a.true_finnal_ccusname2)-4) else a.true_finnal_ccusname2 end as true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
  from edw.mid1_sales_order a
  left join (select bi_cuscode,bi_cusname from edw.dic_customer group by bi_cusname) c
    on a.true_finnal_ccusname2 = c.bi_cusname

;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033

delete from edw.sales_order where concat(id,db) in (select concat(id,db) from edw.sales_order_pre)
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033
CREATE INDEX index_mid2_sales_order_db ON edw.mid2_sales_order(db)
;
SQL结束执行时间：20190929011033
SQL开始执行时间：20190929011033
CREATE INDEX index_mid2_sales_order_id ON edw.mid2_sales_order(id)
;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034


create temporary table edw.mid3_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,case when c.ccusname is null then "请核查"
       else c.bi_cuscode end as true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,b.autoid
      ,b.cdefine22
      ,b.csocode as child_csocode
      ,b.cinvcode
      ,b.iquantity
      ,b.itaxunitprice
      ,b.itax
      ,b.isum
      ,b.itaxrate
      ,b.citemcode
      ,b.citem_class
      ,b.citemname
      ,b.citem_cname
      ,b.isosid
      ,localtimestamp() as sys_time
  from edw.mid2_sales_order a
  left join ufdata.so_sodetails b
    on a.id = b.id
   and a.db = b.db
  left join (select bi_cuscode,ccusname from edw.dic_customer group by ccusname) c
    on a.true_finnal_ccusname2 = c.ccusname

;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034

create temporary table edw.mid4_sales_order as
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end as bi_cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end as bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join (select cinvcode,db,bi_cinvcode,bi_cinvname from dic_inventory group by cinvcode) b
    on a.cinvcode = b.cinvcode
 where a.db not in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034

insert into edw.mid4_sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvcode is null then '请核查' else b.bi_cinvcode end
      ,case when b.cinvcode is null then '请核查' 
            when b.bi_cinvname is null then '请核查' else b.bi_cinvname end
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,a.isosid
      ,a.sys_time
  from edw.mid3_sales_order a
  left join dic_inventory b
    on left(a.db,10) = left(b.db,10)
   and a.cinvcode = b.cinvcode
 where a.db in('UFDATA_222_2018','UFDATA_222_2019','UFDATA_588_2019','UFDATA_889_2019','UFDATA_588_2018','UFDATA_889_2018','UFDATA_555_2018')

;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034


insert into edw.sales_order
select a.db
      ,a.csocode
      ,a.id
      ,a.ddate
      ,a.ccuscode
      ,a.ccusname
      ,a.true_ccuscode
      ,a.true_ccusname
      ,a.finnal_ccusname
      ,a.true_finnal_ccuscode
      ,a.true_finnal_ccusname1
      ,a.true_finnal_ccusname2
      ,a.cmaker
      ,a.cverifier
      ,a.cmodifier
      ,a.dcreatesystime
      ,a.dmodifysystime
      ,a.cdepcode
      ,a.cstcode
      ,a.cpersoncode
      ,a.ccusperson
      ,a.ccuspersoncode
      ,a.cdefine2
      ,a.cdefine3
      ,a.autoid
      ,a.cdefine22
      ,a.child_csocode
      ,a.cinvcode
      ,a.bi_cinvcode
      ,a.bi_cinvname
      ,a.iquantity
      ,a.itaxunitprice
      ,a.itax
      ,a.isum
      ,a.itaxrate
      ,a.citemcode
      ,case when b.bi_cinvcode is null then '请核查' else b.item_code end as true_itemcode
      ,a.citem_class
      ,a.citemname
      ,a.citem_cname
      ,'有效'
      ,a.isosid
      ,a.sys_time
  from edw.mid4_sales_order a
  left join edw.map_inventory b
    on a.bi_cinvcode = b.bi_cinvcode
;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034

create temporary table edw.mid5_sales_order as 
select a.csocode
      ,a.db
  from edw.sales_order a
  left join (select * from ufdata.so_somain where year(ddate) > '2018') b
    on a.csocode = b.csocode
   and a.db = b.db
 where b.csocode is null
   and a.db <> 'UFDATA_889_2018'
   and year(a.ddate) > '2018'

;
SQL结束执行时间：20190929011034
SQL开始执行时间：20190929011034

update edw.sales_order set state = '无效',sys_time = localtimestamp() where concat(db,csocode) in (select concat(db,csocode) from edw.mid5_sales_order) 
;
SQL结束执行时间：20190929011039
SQL开始执行时间：20190929011039

delete from ufdata.so_sodetails where autoid = '48568'
;
SQL结束执行时间：20190929011039
