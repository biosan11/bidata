
20190102110836开始执行2018-01-02数据加载日志:
SQL开始执行时间：20190102110836

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2018-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102110836
SQL开始执行时间：20190102110836


update edw.ehr_employee set end_dt = '{start_dt}' where userid in (select userid from edw.ehr_employee_pre) a
;

20190102111004开始执行2018-01-02数据加载日志:
SQL开始执行时间：20190102111004

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2018-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102111004
SQL开始执行时间：20190102111004


update edw.ehr_employee set end_dt = '2018-01-02' where userid in (select userid from edw.ehr_employee_pre) a
;

20190102111054开始执行2018-01-02数据加载日志:
SQL开始执行时间：20190102111054

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2018-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102111054
SQL开始执行时间：20190102111054


update edw.ehr_employee set end_dt = '2018-01-02' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190102111054
SQL开始执行时间：20190102111054

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190102111054
SQL开始执行时间：20190102111054



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,b.oidjoblevel
      ,b.oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2018-01-02'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid

;
SQL结束执行时间：20190102111054

20190102111611开始执行2018-01-02数据加载日志:
SQL开始执行时间：20190102111611

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2018-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102111611
SQL开始执行时间：20190102111611


update edw.ehr_employee set end_dt = '2018-01-02' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190102111611
SQL开始执行时间：20190102111611

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190102111611
SQL开始执行时间：20190102111611



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,b.oidjoblevel
      ,b.oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2018-01-02'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid

;
SQL结束执行时间：20190102111611

20190102111650开始执行2019-01-02数据加载日志:
SQL开始执行时间：20190102111650

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102111650
SQL开始执行时间：20190102111650


update edw.ehr_employee set end_dt = '2019-01-02' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190102111650
SQL开始执行时间：20190102111650

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190102111650
SQL开始执行时间：20190102111650



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,b.oidjoblevel
      ,b.oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-02'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid

;
SQL结束执行时间：20190102111651

20190102131820开始执行2019-01-02数据加载日志:
SQL开始执行时间：20190102131820

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102131820
SQL开始执行时间：20190102131820


update edw.ehr_employee set end_dt = '2019-01-02' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190102131820
SQL开始执行时间：20190102131820

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190102131820
SQL开始执行时间：20190102131820



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-02'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = g.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = g.oid

;
SQL结束执行时间：20190102131821

20190102131922开始执行2019-01-02数据加载日志:
SQL开始执行时间：20190102131922

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-02'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190102131922
SQL开始执行时间：20190102131922


update edw.ehr_employee set end_dt = '2019-01-02' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190102131922
SQL开始执行时间：20190102131922

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190102131922
SQL开始执行时间：20190102131922



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-02'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190102131923

20190103090721开始执行2019-01-03数据加载日志:
SQL开始执行时间：20190103090721

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-03'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190103090721
SQL开始执行时间：20190103090721


update edw.ehr_employee set end_dt = '2019-01-03' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190103090721
SQL开始执行时间：20190103090721

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190103090722
SQL开始执行时间：20190103090722



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-03'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190103090722

20190105095151开始执行2019-01-05数据加载日志:
SQL开始执行时间：20190105095151

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-05'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190105095151
SQL开始执行时间：20190105095151


update edw.ehr_employee set end_dt = '2019-01-05' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190105095151
SQL开始执行时间：20190105095151

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190105095152
SQL开始执行时间：20190105095152



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-05'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190105095152

20190105095303开始执行2019-01-05数据加载日志:
SQL开始执行时间：20190105095303

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-05'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190105095303
SQL开始执行时间：20190105095303


update edw.ehr_employee set end_dt = '2019-01-05' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190105095303
SQL开始执行时间：20190105095303

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190105095304
SQL开始执行时间：20190105095304



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-05'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190105095304

20190107085802开始执行2019-01-07数据加载日志:
SQL开始执行时间：20190107085802

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-07'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190107085802
SQL开始执行时间：20190107085802


update edw.ehr_employee set end_dt = '2019-01-07' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190107085802
SQL开始执行时间：20190107085802

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190107085803
SQL开始执行时间：20190107085803



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-07'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190107085803

20190107090103开始执行2019-01-07数据加载日志:
SQL开始执行时间：20190107090103

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-07'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190107090103
SQL开始执行时间：20190107090103


update edw.ehr_employee set end_dt = '2019-01-07' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190107090103
SQL开始执行时间：20190107090103

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190107090104
SQL开始执行时间：20190107090104



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-07'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190107090104

20190108015809开始执行2019-01-08数据加载日志:
SQL开始执行时间：20190108015809

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-08'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190108015809
SQL开始执行时间：20190108015809


update edw.ehr_employee set end_dt = '2019-01-08' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190108015809
SQL开始执行时间：20190108015809

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190108015810
SQL开始执行时间：20190108015810



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-08'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190108015810

20190109015808开始执行2019-01-09数据加载日志:
SQL开始执行时间：20190109015808

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-09'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190109015808
SQL开始执行时间：20190109015808


update edw.ehr_employee set end_dt = '2019-01-09' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190109015808
SQL开始执行时间：20190109015808

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190109015809
SQL开始执行时间：20190109015809



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-09'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190109015809

20190110015809开始执行2019-01-10数据加载日志:
SQL开始执行时间：20190110015809

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-10'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190110015809
SQL开始执行时间：20190110015809


update edw.ehr_employee set end_dt = '2019-01-10' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190110015809
SQL开始执行时间：20190110015809

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190110015809
SQL开始执行时间：20190110015809



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-10'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190110015809

20190111015809开始执行2019-01-11数据加载日志:
SQL开始执行时间：20190111015809

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-11'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190111015809
SQL开始执行时间：20190111015809


update edw.ehr_employee set end_dt = '2019-01-11' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190111015809
SQL开始执行时间：20190111015809

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190111015809
SQL开始执行时间：20190111015809



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-11'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;
SQL结束执行时间：20190111015809

20190114091133开始执行2019-01-14数据加载日志:
SQL开始执行时间：20190114091133

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-14'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190114091133
SQL开始执行时间：20190114091133


update edw.ehr_employee set end_dt = '2019-01-14' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190114091133
SQL开始执行时间：20190114091133

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190114091133
SQL开始执行时间：20190114091133



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-14'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;

20190114091509开始执行2019-01-14数据加载日志:
SQL开始执行时间：20190114091509

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-14'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190114091509
SQL开始执行时间：20190114091509


update edw.ehr_employee set end_dt = '2019-01-14' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190114091509
SQL开始执行时间：20190114091509

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190114091509
SQL开始执行时间：20190114091509



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-14'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;

20190114091618开始执行2019-01-14数据加载日志:
SQL开始执行时间：20190114091618

create temporary table edw.ehr_employee_pre as
select a.userid
      ,a.name
      ,a.age
      ,case when a.gender = 'c4ca4238a0b923820dcc509a6f75849b' then '女'
            when a.gender = 'c81e728d9d4c2f636f067f89cc14862c' then '保密'
            else '男' end as gender
      ,b.name as nation
      ,d.name as politicalstatus
      ,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
            when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
            when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
            else '保密' end as marrycategory
      ,a.major
      ,case when a.educationlevel = '45c48cce2e2d7fbdea1afc51c7c6ad26' then '小学'
            when a.educationlevel = 'c9f0f895fb98ab9159f51fd0297e236d' then '初中'
            when a.educationlevel = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '高中'
            when a.educationlevel = 'a87ff679a2f3e71d9181a67b7542122c' then '中技（中专/技校/职高）'
            when a.educationlevel = 'e4da3b7fbbce2345d7772b0674a318d5' then '大专'
            when a.educationlevel = 'c4ca4238a0b923820dcc509a6f75849b' then '本科'
            when a.educationlevel = 'c81e728d9d4c2f636f067f89cc14862c' then '硕士研究生'
            when a.educationlevel = '1679091c5a880faf6fb5e6087eb1b2dc' then 'MBA'
            when a.educationlevel = '8f14e45fceea167a5a36dedd4bea2543' then '博士研究生'
            else '未知' end as educationlevel
      ,a.mobilephone
      ,CONCAT(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-14'
   and a.stdisdeleted = 'False'
;
SQL结束执行时间：20190114091618
SQL开始执行时间：20190114091618


update edw.ehr_employee set end_dt = '2019-01-14' where userid in (select userid from edw.ehr_employee_pre) 
;
SQL结束执行时间：20190114091618
SQL开始执行时间：20190114091618

create temporary table edw.employment_record as
select a.userid
      ,a.oiddepartment
      ,d.firstlevelorganization
      ,d.secondlevelorganization
      ,d.thirdlevelorganization
      ,d.fourthlevelorganization
      ,d.fifthlevelorganization
      ,e.name as position_name
      ,f.name as jobpost_name
      ,a.oidjoblevel
      ,a.oidjobgrade
      ,a.entrydate
      ,a.startdate
      ,a.stopdate
      ,g.TransitionType
      ,a.probation
      ,c.name as employeestatus
      ,a.workyeartotal
      ,a.workyearcompanytotal
      ,a.probationstartdate
      ,a.probationstopdate
      ,a.regularizationdate
      ,b.name as probationresult
      ,a.lastworkdate
      ,a.extlizhireason_107502_632202192
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190114091618
SQL开始执行时间：20190114091618



insert into edw.ehr_employee
select a.userid
      ,a.name
      ,a.age
      ,a.gender
      ,a.nation
      ,a.politicalstatus
      ,a.marrycategory
      ,a.major
      ,a.educationlevel
      ,a.mobilephone
      ,a.workdate
      ,c.name as first_dept
      ,d.name as second_dept
      ,e.name as third_dept
      ,f.name as fourth_dept
      ,g.name as fifth_dept
      ,b.position_name
      ,b.jobpost_name
      ,h.name as oidjoblevel
      ,i.name as oidjobgrade
      ,b.workyeartotal
      ,b.workyearcompanytotal
      ,b.entrydate
      ,b.startdate
      ,b.stopdate
      ,b.TransitionType
      ,b.probation
      ,b.employeestatus
      ,b.probationstartdate
      ,b.probationstopdate
      ,b.regularizationdate
      ,b.probationresult
      ,b.lastworkdate
      ,b.extlizhireason_107502_632202192
      ,'2019-01-14'
      ,'3000-12-31'
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid
  left join ufdata.ehr_jobgrade i
    on b.oidjobgrade = i.oid

;

20190115083438开始执行2019-01-15数据加载日志:
SQL开始执行时间：20190115083438

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,a.age
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-15'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190115083438
SQL开始执行时间：20190115083438



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190115083439
SQL开始执行时间：20190115083439



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.age
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190115083439
SQL开始执行时间：20190115083439


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190115083439
SQL开始执行时间：20190115083439

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.age,'') = ifnull(b.age,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190115083439
SQL开始执行时间：20190115083439

update edw.ehr_employee set end_dt = '2019-01-15' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190115083439
SQL开始执行时间：20190115083439

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190115083439

20190115083808开始执行2019-01-15数据加载日志:
SQL开始执行时间：20190115083808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,a.age
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-15'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190115083808
SQL开始执行时间：20190115083808



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190115083809
SQL开始执行时间：20190115083809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.age
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190115083809
SQL开始执行时间：20190115083809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190115083809
SQL开始执行时间：20190115083809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.age,'') = ifnull(b.age,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190115083809
SQL开始执行时间：20190115083809

update edw.ehr_employee set end_dt = '2019-01-15' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190115083809
SQL开始执行时间：20190115083809

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190115083809

20190115084606开始执行2019-01-15数据加载日志:
SQL开始执行时间：20190115084606

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,a.age
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-15'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190115084606
SQL开始执行时间：20190115084606



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190115084607
SQL开始执行时间：20190115084607



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.age
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190115084607
SQL开始执行时间：20190115084607


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190115084607
SQL开始执行时间：20190115084607

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.age,'') = ifnull(b.age,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190115084607
SQL开始执行时间：20190115084607

update edw.ehr_employee set end_dt = '2019-01-15' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190115084607
SQL开始执行时间：20190115084607

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190115084607

20190116015809开始执行2019-01-16数据加载日志:
SQL开始执行时间：20190116015809

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,a.age
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-16'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190116015809
SQL开始执行时间：20190116015809



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190116015810
SQL开始执行时间：20190116015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.age
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-16' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190116015810
SQL开始执行时间：20190116015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190116015810
SQL开始执行时间：20190116015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.age,'') = ifnull(b.age,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190116015810
SQL开始执行时间：20190116015810

update edw.ehr_employee set end_dt = '2019-01-16' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190116015810
SQL开始执行时间：20190116015810

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190116015810

20190117015809开始执行2019-01-17数据加载日志:
SQL开始执行时间：20190117015809

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,a.age
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-17'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.age
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-17' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.age,'') = ifnull(b.age,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809

update edw.ehr_employee set end_dt = '2019-01-17' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190117015809
SQL开始执行时间：20190117015809

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190117015809

20190118015809开始执行2019-01-18数据加载日志:
SQL开始执行时间：20190118015809

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-18'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-18' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809

delete from edw.ehr_employee where end_dt = '2019-01-18'
;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809
update edw.ehr_employee set end_dt = '2019-01-18' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190118015809
SQL开始执行时间：20190118015809

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190118015809

20190119015814开始执行2019-01-19数据加载日志:
SQL开始执行时间：20190119015814

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-19'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190119015814
SQL开始执行时间：20190119015814



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-19' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815

delete from edw.ehr_employee where end_dt = '2019-01-19'
;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815
update edw.ehr_employee set end_dt = '2019-01-19' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190119015815
SQL开始执行时间：20190119015815

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190119015815

20190121102729开始执行2019-01-21数据加载日志:
SQL开始执行时间：20190121102729

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-21'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190121102729
SQL开始执行时间：20190121102729



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-21' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730

delete from edw.ehr_employee where end_dt = '2019-01-21'
;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730
update edw.ehr_employee set end_dt = '2019-01-21' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190121102730
SQL开始执行时间：20190121102730

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190121102730

20190122015815开始执行2019-01-22数据加载日志:
SQL开始执行时间：20190122015815

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-22'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190122015815
SQL开始执行时间：20190122015815



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-22' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816

delete from edw.ehr_employee where end_dt = '2019-01-22'
;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816
update edw.ehr_employee set end_dt = '2019-01-22' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190122015816
SQL开始执行时间：20190122015816

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190122015816

20190123015817开始执行2019-01-23数据加载日志:
SQL开始执行时间：20190123015817

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-23'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190123015817
SQL开始执行时间：20190123015817



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190123015818
SQL开始执行时间：20190123015818



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-23' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190123015818
SQL开始执行时间：20190123015818


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190123015818
SQL开始执行时间：20190123015818

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190123015819
SQL开始执行时间：20190123015819

delete from edw.ehr_employee where end_dt = '2019-01-23'
;
SQL结束执行时间：20190123015819
SQL开始执行时间：20190123015819
update edw.ehr_employee set end_dt = '2019-01-23' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190123015819
SQL开始执行时间：20190123015819

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190123015819

20190124015811开始执行2019-01-24数据加载日志:
SQL开始执行时间：20190124015811

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-24'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190124015811
SQL开始执行时间：20190124015811



create temporary table edw.employment_record as
select a.userid
,a.oiddepartment
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 group by userid order by sys_date desc

;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812

delete from edw.ehr_employee where end_dt = '2019-01-24'
;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812
update edw.ehr_employee set end_dt = '2019-01-24' where userid in (select userid from edw.mid2_ehr_employee) 
;
SQL结束执行时间：20190124015812
SQL开始执行时间：20190124015812

insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190124015812

20190126015827开始执行2019-01-26数据加载日志:
SQL开始执行时间：20190126015827

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-26'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190126015827
SQL开始执行时间：20190126015827



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190126015828
SQL开始执行时间：20190126015828



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-26' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190126015829
SQL开始执行时间：20190126015829


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190126015829
SQL开始执行时间：20190126015829

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190126015829
SQL开始执行时间：20190126015829

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190126015829
SQL开始执行时间：20190126015829
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-26'
;
SQL结束执行时间：20190126015829
SQL开始执行时间：20190126015829

update edw.ehr_employee set end_dt = '2019-01-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190126015830
SQL开始执行时间：20190126015830
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190126015830

20190127015808开始执行2019-01-27数据加载日志:
SQL开始执行时间：20190127015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-27'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-27'
;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808

update edw.ehr_employee set end_dt = '2019-01-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190127015808
SQL开始执行时间：20190127015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190127015808

20190128015808开始执行2019-01-28数据加载日志:
SQL开始执行时间：20190128015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-28'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190128015808
SQL开始执行时间：20190128015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190128015808
SQL开始执行时间：20190128015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190128015808
SQL开始执行时间：20190128015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190128015809
SQL开始执行时间：20190128015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190128015809
SQL开始执行时间：20190128015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190128015809
SQL开始执行时间：20190128015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-28'
;
SQL结束执行时间：20190128015809
SQL开始执行时间：20190128015809

update edw.ehr_employee set end_dt = '2019-01-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190128015809
SQL开始执行时间：20190128015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190128015809

20190129015807开始执行2019-01-29数据加载日志:
SQL开始执行时间：20190129015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-29'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190129015807
SQL开始执行时间：20190129015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190129015810
SQL开始执行时间：20190129015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-29' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190129015810
SQL开始执行时间：20190129015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190129015810
SQL开始执行时间：20190129015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190129015811
SQL开始执行时间：20190129015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190129015811
SQL开始执行时间：20190129015811
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-29'
;
SQL结束执行时间：20190129015811
SQL开始执行时间：20190129015811

update edw.ehr_employee set end_dt = '2019-01-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190129015811
SQL开始执行时间：20190129015811
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190129015811

20190130015807开始执行2019-01-30数据加载日志:
SQL开始执行时间：20190130015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-30'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190130015807
SQL开始执行时间：20190130015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-30' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-30'
;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808

update edw.ehr_employee set end_dt = '2019-01-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190130015808
SQL开始执行时间：20190130015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190130015808

20190131015807开始执行2019-01-31数据加载日志:
SQL开始执行时间：20190131015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-01-31'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190131015807
SQL开始执行时间：20190131015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-31' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-01-31'
;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808

update edw.ehr_employee set end_dt = '2019-01-31' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190131015808
SQL开始执行时间：20190131015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190131015808

20190201015807开始执行2019-02-01数据加载日志:
SQL开始执行时间：20190201015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-01'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190201015807
SQL开始执行时间：20190201015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190201015808
SQL开始执行时间：20190201015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190201015809
SQL开始执行时间：20190201015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190201015810
SQL开始执行时间：20190201015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190201015810
SQL开始执行时间：20190201015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190201015810
SQL开始执行时间：20190201015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-01'
;
SQL结束执行时间：20190201015810
SQL开始执行时间：20190201015810

update edw.ehr_employee set end_dt = '2019-02-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190201015810
SQL开始执行时间：20190201015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190201015810

20190202015807开始执行2019-02-02数据加载日志:
SQL开始执行时间：20190202015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-02'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190202015807
SQL开始执行时间：20190202015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-02' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-02'
;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808

update edw.ehr_employee set end_dt = '2019-02-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190202015808
SQL开始执行时间：20190202015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190202015808

20190203015807开始执行2019-02-03数据加载日志:
SQL开始执行时间：20190203015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-03'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190203015807
SQL开始执行时间：20190203015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-03' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-03'
;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808

update edw.ehr_employee set end_dt = '2019-02-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190203015808
SQL开始执行时间：20190203015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190203015808

20190204015808开始执行2019-02-04数据加载日志:
SQL开始执行时间：20190204015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-04'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190204015808
SQL开始执行时间：20190204015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-04' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-04'
;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809

update edw.ehr_employee set end_dt = '2019-02-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190204015809
SQL开始执行时间：20190204015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190204015809

20190205015807开始执行2019-02-05数据加载日志:
SQL开始执行时间：20190205015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-05'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190205015807
SQL开始执行时间：20190205015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-05'
;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808

update edw.ehr_employee set end_dt = '2019-02-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190205015808
SQL开始执行时间：20190205015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190205015808

20190206015807开始执行2019-02-06数据加载日志:
SQL开始执行时间：20190206015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-06'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190206015807
SQL开始执行时间：20190206015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-06' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-06'
;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808

update edw.ehr_employee set end_dt = '2019-02-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190206015808
SQL开始执行时间：20190206015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190206015808

20190207015807开始执行2019-02-07数据加载日志:
SQL开始执行时间：20190207015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-07'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190207015807
SQL开始执行时间：20190207015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-07' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-07'
;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808

update edw.ehr_employee set end_dt = '2019-02-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190207015808
SQL开始执行时间：20190207015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190207015808

20190211091400开始执行2019-02-11数据加载日志:
SQL开始执行时间：20190211091400

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-11'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190211091400
SQL开始执行时间：20190211091400



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-11' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-11'
;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401

update edw.ehr_employee set end_dt = '2019-02-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190211091401
SQL开始执行时间：20190211091401
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190211091401

20190212015806开始执行2019-02-12数据加载日志:
SQL开始执行时间：20190212015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-12'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190212015806
SQL开始执行时间：20190212015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-12' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-12'
;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807

update edw.ehr_employee set end_dt = '2019-02-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190212015807
SQL开始执行时间：20190212015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190212015807

20190213015808开始执行2019-02-13数据加载日志:
SQL开始执行时间：20190213015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-13'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190213015808
SQL开始执行时间：20190213015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190213015809
SQL开始执行时间：20190213015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-13' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-13'
;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810

update edw.ehr_employee set end_dt = '2019-02-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190213015810
SQL开始执行时间：20190213015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190213015810

20190214015806开始执行2019-02-14数据加载日志:
SQL开始执行时间：20190214015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-14'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190214015806
SQL开始执行时间：20190214015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-14' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-14'
;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807

update edw.ehr_employee set end_dt = '2019-02-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190214015807
SQL开始执行时间：20190214015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190214015807

20190215015806开始执行2019-02-15数据加载日志:
SQL开始执行时间：20190215015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-15'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190215015806
SQL开始执行时间：20190215015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-15'
;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807

update edw.ehr_employee set end_dt = '2019-02-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190215015807
SQL开始执行时间：20190215015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190215015807

20190216015806开始执行2019-02-16数据加载日志:
SQL开始执行时间：20190216015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-16'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190216015806
SQL开始执行时间：20190216015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190216015807
SQL开始执行时间：20190216015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-16' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-16'
;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808

update edw.ehr_employee set end_dt = '2019-02-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190216015808
SQL开始执行时间：20190216015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190216015808

20190217015806开始执行2019-02-17数据加载日志:
SQL开始执行时间：20190217015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-17'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190217015806
SQL开始执行时间：20190217015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-17' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-17'
;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807

update edw.ehr_employee set end_dt = '2019-02-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190217015807
SQL开始执行时间：20190217015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190217015807

20190218015806开始执行2019-02-18数据加载日志:
SQL开始执行时间：20190218015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-18'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190218015806
SQL开始执行时间：20190218015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-18' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-18'
;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807

update edw.ehr_employee set end_dt = '2019-02-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190218015807
SQL开始执行时间：20190218015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190218015807

20190219015806开始执行2019-02-19数据加载日志:
SQL开始执行时间：20190219015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-19'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190219015806
SQL开始执行时间：20190219015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-19' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-19'
;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807

update edw.ehr_employee set end_dt = '2019-02-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190219015807
SQL开始执行时间：20190219015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190219015807

20190220015807开始执行2019-02-20数据加载日志:
SQL开始执行时间：20190220015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-20'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190220015807
SQL开始执行时间：20190220015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-20' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-20'
;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808

update edw.ehr_employee set end_dt = '2019-02-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190220015808
SQL开始执行时间：20190220015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190220015808

20190221015807开始执行2019-02-21数据加载日志:
SQL开始执行时间：20190221015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-21'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190221015807
SQL开始执行时间：20190221015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-21' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-21'
;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809

update edw.ehr_employee set end_dt = '2019-02-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190221015809
SQL开始执行时间：20190221015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190221015809

20190222015806开始执行2019-02-22数据加载日志:
SQL开始执行时间：20190222015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-22'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190222015807
SQL开始执行时间：20190222015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-22' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-22'
;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808

update edw.ehr_employee set end_dt = '2019-02-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190222015808
SQL开始执行时间：20190222015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190222015808

20190223015807开始执行2019-02-23数据加载日志:
SQL开始执行时间：20190223015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-23'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190223015807
SQL开始执行时间：20190223015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190223015808
SQL开始执行时间：20190223015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-23' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190223015808
SQL开始执行时间：20190223015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190223015808
SQL开始执行时间：20190223015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190223015808
SQL开始执行时间：20190223015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190223015809
SQL开始执行时间：20190223015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-23'
;
SQL结束执行时间：20190223015809
SQL开始执行时间：20190223015809

update edw.ehr_employee set end_dt = '2019-02-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190223015809
SQL开始执行时间：20190223015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190223015809

20190224015806开始执行2019-02-24数据加载日志:
SQL开始执行时间：20190224015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-24'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190224015806
SQL开始执行时间：20190224015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-24'
;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807

update edw.ehr_employee set end_dt = '2019-02-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190224015807
SQL开始执行时间：20190224015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190224015807

20190225015806开始执行2019-02-25数据加载日志:
SQL开始执行时间：20190225015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-25'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190225015806
SQL开始执行时间：20190225015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-25' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-25'
;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807

update edw.ehr_employee set end_dt = '2019-02-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190225015807
SQL开始执行时间：20190225015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190225015807

20190226015808开始执行2019-02-26数据加载日志:
SQL开始执行时间：20190226015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-26'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190226015808
SQL开始执行时间：20190226015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190226015809
SQL开始执行时间：20190226015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-26' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190226015809
SQL开始执行时间：20190226015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190226015809
SQL开始执行时间：20190226015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190226015810
SQL开始执行时间：20190226015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190226015810
SQL开始执行时间：20190226015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-26'
;
SQL结束执行时间：20190226015810
SQL开始执行时间：20190226015810

update edw.ehr_employee set end_dt = '2019-02-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190226015810
SQL开始执行时间：20190226015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190226015810

20190227015806开始执行2019-02-27数据加载日志:
SQL开始执行时间：20190227015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-27'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190227015806
SQL开始执行时间：20190227015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-27'
;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808

update edw.ehr_employee set end_dt = '2019-02-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190227015808
SQL开始执行时间：20190227015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190227015808

20190228015806开始执行2019-02-28数据加载日志:
SQL开始执行时间：20190228015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-02-28'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190228015806
SQL开始执行时间：20190228015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-02-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-02-28'
;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808

update edw.ehr_employee set end_dt = '2019-02-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190228015808
SQL开始执行时间：20190228015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190228015808

20190301015806开始执行2019-03-01数据加载日志:
SQL开始执行时间：20190301015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-01'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190301015806
SQL开始执行时间：20190301015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190301015807
SQL开始执行时间：20190301015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190301015807
SQL开始执行时间：20190301015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190301015808
SQL开始执行时间：20190301015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190301015808
SQL开始执行时间：20190301015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190301015808
SQL开始执行时间：20190301015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-01'
;
SQL结束执行时间：20190301015808
SQL开始执行时间：20190301015808

update edw.ehr_employee set end_dt = '2019-03-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190301015808
SQL开始执行时间：20190301015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190301015808

20190302015806开始执行2019-03-02数据加载日志:
SQL开始执行时间：20190302015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-02'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190302015806
SQL开始执行时间：20190302015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-02' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-02'
;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808

update edw.ehr_employee set end_dt = '2019-03-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190302015808
SQL开始执行时间：20190302015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190302015808

20190303015807开始执行2019-03-03数据加载日志:
SQL开始执行时间：20190303015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-03'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190303015807
SQL开始执行时间：20190303015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-03' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-03'
;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809

update edw.ehr_employee set end_dt = '2019-03-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190303015809
SQL开始执行时间：20190303015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190303015809

20190304015806开始执行2019-03-04数据加载日志:
SQL开始执行时间：20190304015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-04'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190304015806
SQL开始执行时间：20190304015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-04' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-04'
;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807

update edw.ehr_employee set end_dt = '2019-03-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190304015807
SQL开始执行时间：20190304015807
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190304015807

20190305083656开始执行2019-03-05数据加载日志:
SQL开始执行时间：20190305083656

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-05'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190305083656
SQL开始执行时间：20190305083656



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-05'
;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658

update edw.ehr_employee set end_dt = '2019-03-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190305083658
SQL开始执行时间：20190305083658
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;

20190305084020开始执行2019-03-05数据加载日志:
SQL开始执行时间：20190305084020

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-05'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190305084020
SQL开始执行时间：20190305084020



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-05'
;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022

update edw.ehr_employee set end_dt = '2019-03-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190305084022
SQL开始执行时间：20190305084022
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190305084022

20190306015806开始执行2019-03-06数据加载日志:
SQL开始执行时间：20190306015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-06'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190306015806
SQL开始执行时间：20190306015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-06' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-06'
;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808

update edw.ehr_employee set end_dt = '2019-03-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190306015808
SQL开始执行时间：20190306015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190306015808

20190307015806开始执行2019-03-07数据加载日志:
SQL开始执行时间：20190307015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-07'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190307015806
SQL开始执行时间：20190307015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-07' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-07'
;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808

update edw.ehr_employee set end_dt = '2019-03-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190307015808
SQL开始执行时间：20190307015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190307015808

20190308015806开始执行2019-03-08数据加载日志:
SQL开始执行时间：20190308015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-08'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190308015806
SQL开始执行时间：20190308015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-08' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-08'
;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808

update edw.ehr_employee set end_dt = '2019-03-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190308015808
SQL开始执行时间：20190308015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190308015808

20190309015806开始执行2019-03-09数据加载日志:
SQL开始执行时间：20190309015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-09'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190309015806
SQL开始执行时间：20190309015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-09' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-09'
;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808

update edw.ehr_employee set end_dt = '2019-03-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190309015808
SQL开始执行时间：20190309015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190309015808

20190310015806开始执行2019-03-10数据加载日志:
SQL开始执行时间：20190310015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-10'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190310015806
SQL开始执行时间：20190310015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190310015808
SQL开始执行时间：20190310015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-10' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190310015808
SQL开始执行时间：20190310015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190310015808
SQL开始执行时间：20190310015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190310015809
SQL开始执行时间：20190310015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190310015809
SQL开始执行时间：20190310015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-10'
;
SQL结束执行时间：20190310015809
SQL开始执行时间：20190310015809

update edw.ehr_employee set end_dt = '2019-03-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190310015809
SQL开始执行时间：20190310015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190310015809

20190311015806开始执行2019-03-11数据加载日志:
SQL开始执行时间：20190311015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-11'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190311015806
SQL开始执行时间：20190311015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-11' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-11'
;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808

update edw.ehr_employee set end_dt = '2019-03-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190311015808
SQL开始执行时间：20190311015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190311015808

20190312015806开始执行2019-03-12数据加载日志:
SQL开始执行时间：20190312015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-12'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190312015806
SQL开始执行时间：20190312015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-12' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-12'
;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808

update edw.ehr_employee set end_dt = '2019-03-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190312015808
SQL开始执行时间：20190312015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190312015808

20190313015807开始执行2019-03-13数据加载日志:
SQL开始执行时间：20190313015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-13'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190313015807
SQL开始执行时间：20190313015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-13' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-13'
;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809

update edw.ehr_employee set end_dt = '2019-03-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190313015809
SQL开始执行时间：20190313015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190313015809

20190314015808开始执行2019-03-14数据加载日志:
SQL开始执行时间：20190314015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-14'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190314015808
SQL开始执行时间：20190314015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-14' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-14'
;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810

update edw.ehr_employee set end_dt = '2019-03-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190314015810
SQL开始执行时间：20190314015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190314015810

20190315015806开始执行2019-03-15数据加载日志:
SQL开始执行时间：20190315015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-15'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190315015806
SQL开始执行时间：20190315015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-15'
;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808

update edw.ehr_employee set end_dt = '2019-03-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190315015808
SQL开始执行时间：20190315015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190315015808

20190316015806开始执行2019-03-16数据加载日志:
SQL开始执行时间：20190316015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-16'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190316015806
SQL开始执行时间：20190316015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-16' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-16'
;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809

update edw.ehr_employee set end_dt = '2019-03-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190316015809
SQL开始执行时间：20190316015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190316015809

20190317015807开始执行2019-03-17数据加载日志:
SQL开始执行时间：20190317015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-17'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190317015807
SQL开始执行时间：20190317015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-17' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-17'
;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810

update edw.ehr_employee set end_dt = '2019-03-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190317015810
SQL开始执行时间：20190317015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190317015810

20190318015806开始执行2019-03-18数据加载日志:
SQL开始执行时间：20190318015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-18'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190318015806
SQL开始执行时间：20190318015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-18' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-18'
;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808

update edw.ehr_employee set end_dt = '2019-03-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190318015808
SQL开始执行时间：20190318015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190318015808

20190319015805开始执行2019-03-19数据加载日志:
SQL开始执行时间：20190319015805

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-19'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190319015805
SQL开始执行时间：20190319015805



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-19' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-19'
;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808

update edw.ehr_employee set end_dt = '2019-03-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190319015808
SQL开始执行时间：20190319015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190319015808

20190320015807开始执行2019-03-20数据加载日志:
SQL开始执行时间：20190320015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-20'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190320015807
SQL开始执行时间：20190320015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190320015809
SQL开始执行时间：20190320015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-20' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190320015809
SQL开始执行时间：20190320015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190320015809
SQL开始执行时间：20190320015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190320015810
SQL开始执行时间：20190320015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190320015810
SQL开始执行时间：20190320015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-20'
;
SQL结束执行时间：20190320015810
SQL开始执行时间：20190320015810

update edw.ehr_employee set end_dt = '2019-03-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190320015810
SQL开始执行时间：20190320015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190320015810

20190321015811开始执行2019-03-21数据加载日志:
SQL开始执行时间：20190321015811

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-21'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190321015811
SQL开始执行时间：20190321015811



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-21' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-21'
;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814

update edw.ehr_employee set end_dt = '2019-03-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190321015814
SQL开始执行时间：20190321015814
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190321015814

20190322015807开始执行2019-03-22数据加载日志:
SQL开始执行时间：20190322015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-22'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190322015807
SQL开始执行时间：20190322015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-22' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-22'
;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809

update edw.ehr_employee set end_dt = '2019-03-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190322015809
SQL开始执行时间：20190322015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190322015809

20190323015808开始执行2019-03-23数据加载日志:
SQL开始执行时间：20190323015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-23'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190323015808
SQL开始执行时间：20190323015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190323015810
SQL开始执行时间：20190323015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-23' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-23'
;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811

update edw.ehr_employee set end_dt = '2019-03-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190323015811
SQL开始执行时间：20190323015811
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190323015811

20190324015806开始执行2019-03-24数据加载日志:
SQL开始执行时间：20190324015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-24'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190324015806
SQL开始执行时间：20190324015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-24'
;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809

update edw.ehr_employee set end_dt = '2019-03-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190324015809
SQL开始执行时间：20190324015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190324015809

20190325015806开始执行2019-03-25数据加载日志:
SQL开始执行时间：20190325015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-25'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190325015806
SQL开始执行时间：20190325015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-25' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-25'
;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808

update edw.ehr_employee set end_dt = '2019-03-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190325015808
SQL开始执行时间：20190325015808
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190325015808

20190326015809开始执行2019-03-26数据加载日志:
SQL开始执行时间：20190326015809

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-26'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190326015809
SQL开始执行时间：20190326015809



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-26' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-26'
;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811

update edw.ehr_employee set end_dt = '2019-03-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190326015811
SQL开始执行时间：20190326015811
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190326015811

20190327015807开始执行2019-03-27数据加载日志:
SQL开始执行时间：20190327015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-27'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190327015807
SQL开始执行时间：20190327015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-27'
;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810

update edw.ehr_employee set end_dt = '2019-03-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190327015810
SQL开始执行时间：20190327015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190327015810

20190328015806开始执行2019-03-28数据加载日志:
SQL开始执行时间：20190328015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-28'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190328015806
SQL开始执行时间：20190328015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-28'
;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809

update edw.ehr_employee set end_dt = '2019-03-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190328015809
SQL开始执行时间：20190328015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190328015809

20190329015806开始执行2019-03-29数据加载日志:
SQL开始执行时间：20190329015806

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-29'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190329015806
SQL开始执行时间：20190329015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190329015808
SQL开始执行时间：20190329015808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-29' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190329015808
SQL开始执行时间：20190329015808


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190329015808
SQL开始执行时间：20190329015808

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190329015809
SQL开始执行时间：20190329015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190329015809
SQL开始执行时间：20190329015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-29'
;
SQL结束执行时间：20190329015809
SQL开始执行时间：20190329015809

update edw.ehr_employee set end_dt = '2019-03-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190329015809
SQL开始执行时间：20190329015809
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190329015809

20190330015807开始执行2019-03-30数据加载日志:
SQL开始执行时间：20190330015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-30'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190330015807
SQL开始执行时间：20190330015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-30' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-30'
;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810

update edw.ehr_employee set end_dt = '2019-03-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190330015810
SQL开始执行时间：20190330015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190330015810

20190331015807开始执行2019-03-31数据加载日志:
SQL开始执行时间：20190331015807

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-03-31'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190331015807
SQL开始执行时间：20190331015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-03-31' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-03-31'
;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810

update edw.ehr_employee set end_dt = '2019-03-31' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190331015810
SQL开始执行时间：20190331015810
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190331015810

20190401015808开始执行2019-04-01数据加载日志:
SQL开始执行时间：20190401015808

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-01'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190401015808
SQL开始执行时间：20190401015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-01'
;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811

update edw.ehr_employee set end_dt = '2019-04-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190401015811
SQL开始执行时间：20190401015811
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190401015811

20190402015816开始执行2019-04-02数据加载日志:
SQL开始执行时间：20190402015816

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-02'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190402015816
SQL开始执行时间：20190402015816



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-02' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-02'
;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819

update edw.ehr_employee set end_dt = '2019-04-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190402015819
SQL开始执行时间：20190402015819
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190402015819

20190403094548开始执行2019-04-03数据加载日志:
SQL开始执行时间：20190403094548

create temporary table edw.ehr_employee_pre as
select a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-03'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190403094548
SQL开始执行时间：20190403094548



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190403094551
SQL开始执行时间：20190403094551



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-03' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190403094552
SQL开始执行时间：20190403094552


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190403094552
SQL开始执行时间：20190403094552

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190403094553
SQL开始执行时间：20190403094553

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190403094553
SQL开始执行时间：20190403094553
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-03'
;
SQL结束执行时间：20190403094553
SQL开始执行时间：20190403094553

update edw.ehr_employee set end_dt = '2019-04-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190403094553
SQL开始执行时间：20190403094553
insert into edw.ehr_employee
select * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190403094553

20190404015809开始执行2019-04-04数据加载日志:
SQL开始执行时间：20190404015809

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-04'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190404015809
SQL开始执行时间：20190404015809



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-04' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-04'
;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812

update edw.ehr_employee set end_dt = '2019-04-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190404015812
SQL开始执行时间：20190404015812
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190404015812

20190405015809开始执行2019-04-05数据加载日志:
SQL开始执行时间：20190405015809

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-05'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190405015809
SQL开始执行时间：20190405015809



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190405015812
SQL开始执行时间：20190405015812



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-05'
;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813

update edw.ehr_employee set end_dt = '2019-04-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190405015813
SQL开始执行时间：20190405015813
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190405015813

20190406015807开始执行2019-04-06数据加载日志:
SQL开始执行时间：20190406015807

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-06'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190406015807
SQL开始执行时间：20190406015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190406015809
SQL开始执行时间：20190406015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-06' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190406015809
SQL开始执行时间：20190406015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190406015810
SQL开始执行时间：20190406015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190406015810
SQL开始执行时间：20190406015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190406015810
SQL开始执行时间：20190406015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-06'
;
SQL结束执行时间：20190406015810
SQL开始执行时间：20190406015810

update edw.ehr_employee set end_dt = '2019-04-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190406015810
SQL开始执行时间：20190406015810
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190406015810

20190407015807开始执行2019-04-07数据加载日志:
SQL开始执行时间：20190407015807

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-07'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190407015807
SQL开始执行时间：20190407015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-07' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-07'
;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810

update edw.ehr_employee set end_dt = '2019-04-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190407015810
SQL开始执行时间：20190407015810
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190407015810

20190408015808开始执行2019-04-08数据加载日志:
SQL开始执行时间：20190408015808

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-08'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190408015808
SQL开始执行时间：20190408015808



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-08' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-08'
;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811

update edw.ehr_employee set end_dt = '2019-04-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190408015811
SQL开始执行时间：20190408015811
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190408015811

20190409015806开始执行2019-04-09数据加载日志:
SQL开始执行时间：20190409015806

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-09'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190409015806
SQL开始执行时间：20190409015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-09' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-09'
;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809

update edw.ehr_employee set end_dt = '2019-04-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190409015809
SQL开始执行时间：20190409015809
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190409015809

20190410015806开始执行2019-04-10数据加载日志:
SQL开始执行时间：20190410015806

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-10'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190410015806
SQL开始执行时间：20190410015806



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-10' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-10'
;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809

update edw.ehr_employee set end_dt = '2019-04-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190410015809
SQL开始执行时间：20190410015809
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190410015809

20190411142754开始执行2019-04-11数据加载日志:
SQL开始执行时间：20190411142754

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-11'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190411142754
SQL开始执行时间：20190411142754



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-11' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-11'
;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757

update edw.ehr_employee set end_dt = '2019-04-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190411142757
SQL开始执行时间：20190411142757
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190411142757

20190412015809开始执行2019-04-12数据加载日志:
SQL开始执行时间：20190412015809

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-12'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190412015809
SQL开始执行时间：20190412015809



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190412015812
SQL开始执行时间：20190412015812



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-12' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-12'
;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813

update edw.ehr_employee set end_dt = '2019-04-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190412015813
SQL开始执行时间：20190412015813
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190412015813

20190413015807开始执行2019-04-13数据加载日志:
SQL开始执行时间：20190413015807

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.sys_date = '2019-04-13'
   and a.stdisdeleted = 'false'
;
SQL结束执行时间：20190413015807
SQL开始执行时间：20190413015807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190413015811
SQL开始执行时间：20190413015811



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-13' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190413015811
SQL开始执行时间：20190413015811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190413015811
SQL开始执行时间：20190413015811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190413015811
SQL开始执行时间：20190413015811

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190413015812
SQL开始执行时间：20190413015812
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-13'
;
SQL结束执行时间：20190413015812
SQL开始执行时间：20190413015812

update edw.ehr_employee set end_dt = '2019-04-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190413015812
SQL开始执行时间：20190413015812
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190413015812

20190424142203开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190424142203

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190424142203
SQL开始执行时间：20190424142203



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190424142204
SQL开始执行时间：20190424142204



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190424142206
SQL开始执行时间：20190424142206


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190424142206
SQL开始执行时间：20190424142206

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190424142208
SQL开始执行时间：20190424142208

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190424142209
SQL开始执行时间：20190424142209
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190424142209
SQL开始执行时间：20190424142209

update edw.ehr_employee set end_dt = '2019-04-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190424142209
SQL开始执行时间：20190424142209
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190424142209

20190425103219开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425103219

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190425103219
SQL开始执行时间：20190425103219



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 order by sys_date desc) b
 where a.stdisdeleted = 'false'
 group by b.userid order by b.sys_date desc

;

20190425103527开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425103527

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190425103527
SQL开始执行时间：20190425103527



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190425103528
SQL开始执行时间：20190425103528



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190425103530
SQL开始执行时间：20190425103530


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190425103530
SQL开始执行时间：20190425103530

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190425103532
SQL开始执行时间：20190425103532

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425103532
SQL开始执行时间：20190425103532
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190425103532
SQL开始执行时间：20190425103532

update edw.ehr_employee set end_dt = '2019-04-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425103533
SQL开始执行时间：20190425103533
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190425103533

20190425103807开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425103807

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190425103807
SQL开始执行时间：20190425103807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190425103808
SQL开始执行时间：20190425103808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190425103810
SQL开始执行时间：20190425103810


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190425103810
SQL开始执行时间：20190425103810

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190425103812
SQL开始执行时间：20190425103812

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425103812
SQL开始执行时间：20190425103812
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190425103812
SQL开始执行时间：20190425103812

update edw.ehr_employee set end_dt = '2019-04-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425103812
SQL开始执行时间：20190425103812
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190425103812

20190425104559开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425104559

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190425104559
SQL开始执行时间：20190425104559



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190425104600
SQL开始执行时间：20190425104600



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190425104602
SQL开始执行时间：20190425104602


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190425104603
SQL开始执行时间：20190425104603

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190425104604
SQL开始执行时间：20190425104604

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425104604
SQL开始执行时间：20190425104604
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190425104604
SQL开始执行时间：20190425104604

update edw.ehr_employee set end_dt = '2019-04-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425104604
SQL开始执行时间：20190425104604
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190425104605

20190425104732开始执行2019-04-24数据加载日志:
SQL开始执行时间：20190425104732

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190425104732
SQL开始执行时间：20190425104732



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190425104733
SQL开始执行时间：20190425104733



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-24'
;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735

update edw.ehr_employee set end_dt = '2019-04-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190425104735
SQL开始执行时间：20190425104735
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190425104735

20190427015841开始执行2019-04-27数据加载日志:
SQL开始执行时间：20190427015841

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190427015841
SQL开始执行时间：20190427015841



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190427015842
SQL开始执行时间：20190427015842



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190427015844
SQL开始执行时间：20190427015844


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190427015844
SQL开始执行时间：20190427015844

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190427015845
SQL开始执行时间：20190427015845

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190427015845
SQL开始执行时间：20190427015845
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-27'
;
SQL结束执行时间：20190427015845
SQL开始执行时间：20190427015845

update edw.ehr_employee set end_dt = '2019-04-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190427015845
SQL开始执行时间：20190427015845
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190427015845

20190428015840开始执行2019-04-28数据加载日志:
SQL开始执行时间：20190428015840

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190428015840
SQL开始执行时间：20190428015840



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190428015841
SQL开始执行时间：20190428015841



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190428015843
SQL开始执行时间：20190428015843


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190428015843
SQL开始执行时间：20190428015843

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190428015844
SQL开始执行时间：20190428015844

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190428015844
SQL开始执行时间：20190428015844
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-28'
;
SQL结束执行时间：20190428015844
SQL开始执行时间：20190428015844

update edw.ehr_employee set end_dt = '2019-04-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190428015844
SQL开始执行时间：20190428015844
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190428015844

20190429015842开始执行2019-04-29数据加载日志:
SQL开始执行时间：20190429015842

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190429015842
SQL开始执行时间：20190429015842



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190429015843
SQL开始执行时间：20190429015843



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-29' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190429015845
SQL开始执行时间：20190429015845


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190429015845
SQL开始执行时间：20190429015845

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190429015846
SQL开始执行时间：20190429015846

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190429015846
SQL开始执行时间：20190429015846
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-29'
;
SQL结束执行时间：20190429015846
SQL开始执行时间：20190429015846

update edw.ehr_employee set end_dt = '2019-04-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190429015846
SQL开始执行时间：20190429015846
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190429015846

20190430015843开始执行2019-04-30数据加载日志:
SQL开始执行时间：20190430015843

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190430015844
SQL开始执行时间：20190430015844



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190430015844
SQL开始执行时间：20190430015844



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-04-30' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-04-30'
;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847

update edw.ehr_employee set end_dt = '2019-04-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190430015847
SQL开始执行时间：20190430015847
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190430015847

20190501015835开始执行2019-05-01数据加载日志:
SQL开始执行时间：20190501015835

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190501015835
SQL开始执行时间：20190501015835



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190501015836
SQL开始执行时间：20190501015836



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190501015838
SQL开始执行时间：20190501015838


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190501015838
SQL开始执行时间：20190501015838

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190501015839
SQL开始执行时间：20190501015839

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190501015839
SQL开始执行时间：20190501015839
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-01'
;
SQL结束执行时间：20190501015839
SQL开始执行时间：20190501015839

update edw.ehr_employee set end_dt = '2019-05-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190501015839
SQL开始执行时间：20190501015839
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190501015839

20190502015836开始执行2019-05-02数据加载日志:
SQL开始执行时间：20190502015836

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190502015836
SQL开始执行时间：20190502015836



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190502015837
SQL开始执行时间：20190502015837



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-02' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190502015839
SQL开始执行时间：20190502015839


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190502015839
SQL开始执行时间：20190502015839

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190502015840
SQL开始执行时间：20190502015840

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190502015840
SQL开始执行时间：20190502015840
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-02'
;
SQL结束执行时间：20190502015840
SQL开始执行时间：20190502015840

update edw.ehr_employee set end_dt = '2019-05-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190502015840
SQL开始执行时间：20190502015840
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190502015840

20190505092522开始执行2019-05-05数据加载日志:
SQL开始执行时间：20190505092522

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190505092522
SQL开始执行时间：20190505092522



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190505092523
SQL开始执行时间：20190505092523



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190505092525
SQL开始执行时间：20190505092525


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190505092525
SQL开始执行时间：20190505092525

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190505092526
SQL开始执行时间：20190505092526

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190505092526
SQL开始执行时间：20190505092526
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-05'
;
SQL结束执行时间：20190505092526
SQL开始执行时间：20190505092526

update edw.ehr_employee set end_dt = '2019-05-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190505092526
SQL开始执行时间：20190505092526
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190505092526

20190506015836开始执行2019-05-06数据加载日志:
SQL开始执行时间：20190506015836

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190506015836
SQL开始执行时间：20190506015836



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190506015837
SQL开始执行时间：20190506015837



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-06' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190506015839
SQL开始执行时间：20190506015839


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190506015839
SQL开始执行时间：20190506015839

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190506015840
SQL开始执行时间：20190506015840

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190506015840
SQL开始执行时间：20190506015840
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-06'
;
SQL结束执行时间：20190506015840
SQL开始执行时间：20190506015840

update edw.ehr_employee set end_dt = '2019-05-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190506015840
SQL开始执行时间：20190506015840
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190506015840

20190507015836开始执行2019-05-07数据加载日志:
SQL开始执行时间：20190507015836

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190507015836
SQL开始执行时间：20190507015836



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190507015837
SQL开始执行时间：20190507015837



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-07' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190507015839
SQL开始执行时间：20190507015839


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190507015839
SQL开始执行时间：20190507015839

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190507015840
SQL开始执行时间：20190507015840

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190507015840
SQL开始执行时间：20190507015840
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-07'
;
SQL结束执行时间：20190507015840
SQL开始执行时间：20190507015840

update edw.ehr_employee set end_dt = '2019-05-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190507015840
SQL开始执行时间：20190507015840
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190507015840

20190508015835开始执行2019-05-08数据加载日志:
SQL开始执行时间：20190508015835

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190508015835
SQL开始执行时间：20190508015835



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190508015836
SQL开始执行时间：20190508015836



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-08' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190508015838
SQL开始执行时间：20190508015838


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190508015838
SQL开始执行时间：20190508015838

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190508015839
SQL开始执行时间：20190508015839

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190508015839
SQL开始执行时间：20190508015839
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-08'
;
SQL结束执行时间：20190508015839
SQL开始执行时间：20190508015839

update edw.ehr_employee set end_dt = '2019-05-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190508015839
SQL开始执行时间：20190508015839
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190508015839

20190510015845开始执行2019-05-10数据加载日志:
SQL开始执行时间：20190510015845

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190510015845
SQL开始执行时间：20190510015845



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190510015846
SQL开始执行时间：20190510015846



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-10' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190510015848
SQL开始执行时间：20190510015848


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190510015848
SQL开始执行时间：20190510015848

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190510015849
SQL开始执行时间：20190510015849

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190510015849
SQL开始执行时间：20190510015849
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-10'
;
SQL结束执行时间：20190510015849
SQL开始执行时间：20190510015849

update edw.ehr_employee set end_dt = '2019-05-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190510015849
SQL开始执行时间：20190510015849
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190510015849

20190511015853开始执行2019-05-11数据加载日志:
SQL开始执行时间：20190511015853

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190511015853
SQL开始执行时间：20190511015853



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190511015854
SQL开始执行时间：20190511015854



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-11' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-11'
;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857

update edw.ehr_employee set end_dt = '2019-05-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190511015857
SQL开始执行时间：20190511015857
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190511015857

20190512015841开始执行2019-05-12数据加载日志:
SQL开始执行时间：20190512015841

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190512015841
SQL开始执行时间：20190512015841



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190512015842
SQL开始执行时间：20190512015842



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-12' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190512015844
SQL开始执行时间：20190512015844


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190512015844
SQL开始执行时间：20190512015844

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190512015845
SQL开始执行时间：20190512015845

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190512015845
SQL开始执行时间：20190512015845
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-12'
;
SQL结束执行时间：20190512015845
SQL开始执行时间：20190512015845

update edw.ehr_employee set end_dt = '2019-05-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190512015845
SQL开始执行时间：20190512015845
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190512015845

20190513015840开始执行2019-05-13数据加载日志:
SQL开始执行时间：20190513015840

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190513015840
SQL开始执行时间：20190513015840



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190513015841
SQL开始执行时间：20190513015841



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-13' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190513015843
SQL开始执行时间：20190513015843


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190513015843
SQL开始执行时间：20190513015843

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190513015844
SQL开始执行时间：20190513015844

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190513015844
SQL开始执行时间：20190513015844
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-13'
;
SQL结束执行时间：20190513015844
SQL开始执行时间：20190513015844

update edw.ehr_employee set end_dt = '2019-05-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190513015844
SQL开始执行时间：20190513015844
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190513015844

20190514015844开始执行2019-05-14数据加载日志:
SQL开始执行时间：20190514015844

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190514015844
SQL开始执行时间：20190514015844



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190514015844
SQL开始执行时间：20190514015844



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-14' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190514015847
SQL开始执行时间：20190514015847


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190514015847
SQL开始执行时间：20190514015847

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190514015848
SQL开始执行时间：20190514015848

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190514015848
SQL开始执行时间：20190514015848
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-14'
;
SQL结束执行时间：20190514015848
SQL开始执行时间：20190514015848

update edw.ehr_employee set end_dt = '2019-05-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190514015848
SQL开始执行时间：20190514015848
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190514015848

20190515015842开始执行2019-05-15数据加载日志:
SQL开始执行时间：20190515015842

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190515015842
SQL开始执行时间：20190515015842



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190515015843
SQL开始执行时间：20190515015843



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190515015845
SQL开始执行时间：20190515015845


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190515015846
SQL开始执行时间：20190515015846

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190515015846
SQL开始执行时间：20190515015846

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190515015846
SQL开始执行时间：20190515015846
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-15'
;
SQL结束执行时间：20190515015846
SQL开始执行时间：20190515015846

update edw.ehr_employee set end_dt = '2019-05-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190515015846
SQL开始执行时间：20190515015846
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190515015846

20190516015856开始执行2019-05-16数据加载日志:
SQL开始执行时间：20190516015856

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190516015857
SQL开始执行时间：20190516015857



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190516015857
SQL开始执行时间：20190516015857



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-16' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190516015900
SQL开始执行时间：20190516015900


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190516015900
SQL开始执行时间：20190516015900

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190516015901
SQL开始执行时间：20190516015901

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190516015901
SQL开始执行时间：20190516015901
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-16'
;
SQL结束执行时间：20190516015901
SQL开始执行时间：20190516015901

update edw.ehr_employee set end_dt = '2019-05-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190516015901
SQL开始执行时间：20190516015901
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190516015901

20190517015844开始执行2019-05-17数据加载日志:
SQL开始执行时间：20190517015844

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190517015844
SQL开始执行时间：20190517015844



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190517015845
SQL开始执行时间：20190517015845



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-17' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190517015847
SQL开始执行时间：20190517015847


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190517015847
SQL开始执行时间：20190517015847

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190517015848
SQL开始执行时间：20190517015848

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190517015848
SQL开始执行时间：20190517015848
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-17'
;
SQL结束执行时间：20190517015848
SQL开始执行时间：20190517015848

update edw.ehr_employee set end_dt = '2019-05-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190517015848
SQL开始执行时间：20190517015848
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190517015848

20190518015854开始执行2019-05-18数据加载日志:
SQL开始执行时间：20190518015854

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190518015855
SQL开始执行时间：20190518015855



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190518015855
SQL开始执行时间：20190518015855



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-18' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190518015858
SQL开始执行时间：20190518015858


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190518015858
SQL开始执行时间：20190518015858

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190518015859
SQL开始执行时间：20190518015859

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190518015859
SQL开始执行时间：20190518015859
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-18'
;
SQL结束执行时间：20190518015859
SQL开始执行时间：20190518015859

update edw.ehr_employee set end_dt = '2019-05-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190518015859
SQL开始执行时间：20190518015859
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190518015859

20190519015843开始执行2019-05-19数据加载日志:
SQL开始执行时间：20190519015843

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190519015843
SQL开始执行时间：20190519015843



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190519015844
SQL开始执行时间：20190519015844



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-19' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190519015846
SQL开始执行时间：20190519015846


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190519015846
SQL开始执行时间：20190519015847

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190519015847
SQL开始执行时间：20190519015847

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190519015847
SQL开始执行时间：20190519015847
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-19'
;
SQL结束执行时间：20190519015847
SQL开始执行时间：20190519015847

update edw.ehr_employee set end_dt = '2019-05-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190519015847
SQL开始执行时间：20190519015847
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190519015847

20190520015843开始执行2019-05-20数据加载日志:
SQL开始执行时间：20190520015843

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190520015844
SQL开始执行时间：20190520015844



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190520015844
SQL开始执行时间：20190520015844



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-20' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190520015847
SQL开始执行时间：20190520015847


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190520015847
SQL开始执行时间：20190520015847

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190520015848
SQL开始执行时间：20190520015848

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190520015848
SQL开始执行时间：20190520015848
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-20'
;
SQL结束执行时间：20190520015848
SQL开始执行时间：20190520015848

update edw.ehr_employee set end_dt = '2019-05-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190520015848
SQL开始执行时间：20190520015848
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190520015848

20190521015918开始执行2019-05-21数据加载日志:
SQL开始执行时间：20190521015918

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190521015918
SQL开始执行时间：20190521015918



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190521015919
SQL开始执行时间：20190521015919



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-21' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190521015921
SQL开始执行时间：20190521015921


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190521015921
SQL开始执行时间：20190521015921

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190521015922
SQL开始执行时间：20190521015922

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190521015922
SQL开始执行时间：20190521015922
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-21'
;
SQL结束执行时间：20190521015922
SQL开始执行时间：20190521015922

update edw.ehr_employee set end_dt = '2019-05-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190521015922
SQL开始执行时间：20190521015922
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190521015922

20190522015845开始执行2019-05-22数据加载日志:
SQL开始执行时间：20190522015845

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190522015845
SQL开始执行时间：20190522015845



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190522015846
SQL开始执行时间：20190522015846



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-22' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849

delete from edw.ehr_employee where end_dt = '3000-12-31' and userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849
update edw.ehr_employee set end_dt = '3000-12-31' where end_dt = '2019-05-22'
;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849

update edw.ehr_employee set end_dt = '2019-05-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190522015849
SQL开始执行时间：20190522015849
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190522015849

20190523015846开始执行2019-05-23数据加载日志:
SQL开始执行时间：20190523015846

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190523015846
SQL开始执行时间：20190523015846



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190523015847
SQL开始执行时间：20190523015847



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-23' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190523015850
SQL开始执行时间：20190523015850


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190523015850
SQL开始执行时间：20190523015850

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190523015851
SQL开始执行时间：20190523015851


update edw.ehr_employee set end_dt = '2019-05-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190523015851
SQL开始执行时间：20190523015851
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190523015851

20190524015929开始执行2019-05-24数据加载日志:
SQL开始执行时间：20190524015929

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190524015929
SQL开始执行时间：20190524015929



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190524015930
SQL开始执行时间：20190524015930



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190524015933
SQL开始执行时间：20190524015933


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190524015933
SQL开始执行时间：20190524015933

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190524015933
SQL开始执行时间：20190524015933


update edw.ehr_employee set end_dt = '2019-05-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190524015933
SQL开始执行时间：20190524015933
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190524015933

20190525015927开始执行2019-05-25数据加载日志:
SQL开始执行时间：20190525015927

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190525015927
SQL开始执行时间：20190525015927



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190525015928
SQL开始执行时间：20190525015928



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-25' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190525015931
SQL开始执行时间：20190525015931


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190525015931
SQL开始执行时间：20190525015931

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190525015932
SQL开始执行时间：20190525015932


update edw.ehr_employee set end_dt = '2019-05-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190525015932
SQL开始执行时间：20190525015932
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190525015932

20190526015946开始执行2019-05-26数据加载日志:
SQL开始执行时间：20190526015946

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190526015947
SQL开始执行时间：20190526015947



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190526015947
SQL开始执行时间：20190526015947



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-26' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190526015950
SQL开始执行时间：20190526015950


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190526015950
SQL开始执行时间：20190526015950

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190526015951
SQL开始执行时间：20190526015951


update edw.ehr_employee set end_dt = '2019-05-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190526015951
SQL开始执行时间：20190526015951
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190526015951

20190527015925开始执行2019-05-27数据加载日志:
SQL开始执行时间：20190527015925

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190527015925
SQL开始执行时间：20190527015925



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190527015926
SQL开始执行时间：20190527015926



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190527015929
SQL开始执行时间：20190527015929


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190527015929
SQL开始执行时间：20190527015929

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190527015930
SQL开始执行时间：20190527015930


update edw.ehr_employee set end_dt = '2019-05-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190527015930
SQL开始执行时间：20190527015930
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190527015930

20190527105004开始执行2019-01-01数据加载日志:
SQL开始执行时间：20190527105004

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190527105004
SQL开始执行时间：20190527105004



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190527105005
SQL开始执行时间：20190527105005



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-01-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190527105007
SQL开始执行时间：20190527105007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190527105007
SQL开始执行时间：20190527105007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190527105008
SQL开始执行时间：20190527105008


update edw.ehr_employee set end_dt = '2019-01-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190527105008
SQL开始执行时间：20190527105008
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190527105008

20190528015929开始执行2019-05-28数据加载日志:
SQL开始执行时间：20190528015929

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190528015929
SQL开始执行时间：20190528015929



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190528015930
SQL开始执行时间：20190528015930



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190528015933
SQL开始执行时间：20190528015933


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190528015933
SQL开始执行时间：20190528015933

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190528015933
SQL开始执行时间：20190528015933


update edw.ehr_employee set end_dt = '2019-05-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190528015933
SQL开始执行时间：20190528015933
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190528015933

20190529015926开始执行2019-05-29数据加载日志:
SQL开始执行时间：20190529015926

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190529015926
SQL开始执行时间：20190529015926



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190529015927
SQL开始执行时间：20190529015927



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-29' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190529015930
SQL开始执行时间：20190529015930


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190529015930
SQL开始执行时间：20190529015930

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190529015930
SQL开始执行时间：20190529015930


update edw.ehr_employee set end_dt = '2019-05-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190529015930
SQL开始执行时间：20190529015930
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190529015930

20190530015930开始执行2019-05-30数据加载日志:
SQL开始执行时间：20190530015930

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190530015930
SQL开始执行时间：20190530015930



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190530015931
SQL开始执行时间：20190530015931



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-30' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190530015934
SQL开始执行时间：20190530015934


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190530015934
SQL开始执行时间：20190530015934

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190530015934
SQL开始执行时间：20190530015934


update edw.ehr_employee set end_dt = '2019-05-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190530015934
SQL开始执行时间：20190530015934
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190530015934

20190531015932开始执行2019-05-31数据加载日志:
SQL开始执行时间：20190531015932

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190531015932
SQL开始执行时间：20190531015932



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190531015932
SQL开始执行时间：20190531015932



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-05-31' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190531015935
SQL开始执行时间：20190531015935


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190531015935
SQL开始执行时间：20190531015935

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190531015936
SQL开始执行时间：20190531015936


update edw.ehr_employee set end_dt = '2019-05-31' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190531015936
SQL开始执行时间：20190531015936
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190531015936

20190601015942开始执行2019-06-01数据加载日志:
SQL开始执行时间：20190601015942

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190601015943
SQL开始执行时间：20190601015943



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190601015943
SQL开始执行时间：20190601015943



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-01' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190601015946
SQL开始执行时间：20190601015946


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190601015946
SQL开始执行时间：20190601015946

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190601015947
SQL开始执行时间：20190601015947


update edw.ehr_employee set end_dt = '2019-06-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190601015947
SQL开始执行时间：20190601015947
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190601015947

20190602015934开始执行2019-06-02数据加载日志:
SQL开始执行时间：20190602015934

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190602015934
SQL开始执行时间：20190602015934



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190602015935
SQL开始执行时间：20190602015935



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-02' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190602015937
SQL开始执行时间：20190602015937


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190602015937
SQL开始执行时间：20190602015937

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190602015938
SQL开始执行时间：20190602015938


update edw.ehr_employee set end_dt = '2019-06-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190602015938
SQL开始执行时间：20190602015938
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190602015938

20190603015935开始执行2019-06-03数据加载日志:
SQL开始执行时间：20190603015935

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190603015935
SQL开始执行时间：20190603015935



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190603015936
SQL开始执行时间：20190603015936



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-03' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190603015938
SQL开始执行时间：20190603015938


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190603015938
SQL开始执行时间：20190603015938

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190603015939
SQL开始执行时间：20190603015939


update edw.ehr_employee set end_dt = '2019-06-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190603015939
SQL开始执行时间：20190603015939
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190603015939

20190604015946开始执行2019-06-04数据加载日志:
SQL开始执行时间：20190604015946

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190604015946
SQL开始执行时间：20190604015946



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190604015947
SQL开始执行时间：20190604015947



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-04' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190604015950
SQL开始执行时间：20190604015950


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190604015950
SQL开始执行时间：20190604015950

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190604015951
SQL开始执行时间：20190604015951


update edw.ehr_employee set end_dt = '2019-06-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190604015951
SQL开始执行时间：20190604015951
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190604015951

20190605015958开始执行2019-06-05数据加载日志:
SQL开始执行时间：20190605015958

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190605015958
SQL开始执行时间：20190605015958



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190605015959
SQL开始执行时间：20190605015959



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-05' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190605020001
SQL开始执行时间：20190605020001


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190605020001
SQL开始执行时间：20190605020001

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190605020002
SQL开始执行时间：20190605020002


update edw.ehr_employee set end_dt = '2019-06-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190605020002
SQL开始执行时间：20190605020002
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190605020002

20190606015940开始执行2019-06-06数据加载日志:
SQL开始执行时间：20190606015940

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190606015940
SQL开始执行时间：20190606015940



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190606015941
SQL开始执行时间：20190606015941



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-06' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190606015944
SQL开始执行时间：20190606015944


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190606015944
SQL开始执行时间：20190606015944

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190606015945
SQL开始执行时间：20190606015945


update edw.ehr_employee set end_dt = '2019-06-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190606015945
SQL开始执行时间：20190606015945
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190606015945

20190607015936开始执行2019-06-07数据加载日志:
SQL开始执行时间：20190607015936

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190607015936
SQL开始执行时间：20190607015936



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190607015937
SQL开始执行时间：20190607015937



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-07' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190607015939
SQL开始执行时间：20190607015939


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190607015939
SQL开始执行时间：20190607015939

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190607015940
SQL开始执行时间：20190607015940


update edw.ehr_employee set end_dt = '2019-06-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190607015940
SQL开始执行时间：20190607015940
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190607015940

20190608015941开始执行2019-06-08数据加载日志:
SQL开始执行时间：20190608015941

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190608015941
SQL开始执行时间：20190608015941



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190608015942
SQL开始执行时间：20190608015942



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-08' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190608015944
SQL开始执行时间：20190608015944


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190608015944
SQL开始执行时间：20190608015944

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190608015945
SQL开始执行时间：20190608015945


update edw.ehr_employee set end_dt = '2019-06-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190608015945
SQL开始执行时间：20190608015945
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190608015945

20190609015941开始执行2019-06-09数据加载日志:
SQL开始执行时间：20190609015941

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190609015941
SQL开始执行时间：20190609015941



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190609015942
SQL开始执行时间：20190609015942



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-09' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190609015944
SQL开始执行时间：20190609015944


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190609015944
SQL开始执行时间：20190609015944

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190609015945
SQL开始执行时间：20190609015945


update edw.ehr_employee set end_dt = '2019-06-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190609015945
SQL开始执行时间：20190609015945
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190609015945

20190610020002开始执行2019-06-10数据加载日志:
SQL开始执行时间：20190610020002

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190610020002
SQL开始执行时间：20190610020002



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190610020003
SQL开始执行时间：20190610020003



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-10' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190610020005
SQL开始执行时间：20190610020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190610020005
SQL开始执行时间：20190610020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190610020006
SQL开始执行时间：20190610020006


update edw.ehr_employee set end_dt = '2019-06-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190610020006
SQL开始执行时间：20190610020006
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190610020006

20190611015934开始执行2019-06-11数据加载日志:
SQL开始执行时间：20190611015934

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190611015934
SQL开始执行时间：20190611015934



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190611015935
SQL开始执行时间：20190611015935



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-11' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190611015937
SQL开始执行时间：20190611015937


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190611015937
SQL开始执行时间：20190611015937

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190611015938
SQL开始执行时间：20190611015938


update edw.ehr_employee set end_dt = '2019-06-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190611015938
SQL开始执行时间：20190611015938
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190611015938

20190612020011开始执行2019-06-12数据加载日志:
SQL开始执行时间：20190612020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190612020011
SQL开始执行时间：20190612020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190612020012
SQL开始执行时间：20190612020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-12' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190612020015
SQL开始执行时间：20190612020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190612020015
SQL开始执行时间：20190612020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190612020015
SQL开始执行时间：20190612020015


update edw.ehr_employee set end_dt = '2019-06-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190612020015
SQL开始执行时间：20190612020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190612020015

20190613020005开始执行2019-06-13数据加载日志:
SQL开始执行时间：20190613020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190613020005
SQL开始执行时间：20190613020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190613020006
SQL开始执行时间：20190613020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-13' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190613020008
SQL开始执行时间：20190613020008


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190613020008
SQL开始执行时间：20190613020008

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190613020009
SQL开始执行时间：20190613020009


update edw.ehr_employee set end_dt = '2019-06-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190613020009
SQL开始执行时间：20190613020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190613020009

20190614020004开始执行2019-06-14数据加载日志:
SQL开始执行时间：20190614020004

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190614020004
SQL开始执行时间：20190614020004



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190614020005
SQL开始执行时间：20190614020005



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-14' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190614020007
SQL开始执行时间：20190614020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190614020008
SQL开始执行时间：20190614020008

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190614020008
SQL开始执行时间：20190614020008


update edw.ehr_employee set end_dt = '2019-06-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190614020008
SQL开始执行时间：20190614020008
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190614020008

20190615020000开始执行2019-06-15数据加载日志:
SQL开始执行时间：20190615020000

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190615020000
SQL开始执行时间：20190615020000



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190615020001
SQL开始执行时间：20190615020001



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-15' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190615020004
SQL开始执行时间：20190615020004


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190615020004
SQL开始执行时间：20190615020004

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190615020005
SQL开始执行时间：20190615020005


update edw.ehr_employee set end_dt = '2019-06-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190615020005
SQL开始执行时间：20190615020005
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190615020005

20190616020005开始执行2019-06-16数据加载日志:
SQL开始执行时间：20190616020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190616020005
SQL开始执行时间：20190616020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190616020006
SQL开始执行时间：20190616020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-16' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190616020009
SQL开始执行时间：20190616020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190616020009
SQL开始执行时间：20190616020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190616020010
SQL开始执行时间：20190616020010


update edw.ehr_employee set end_dt = '2019-06-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190616020010
SQL开始执行时间：20190616020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190616020010

20190617020011开始执行2019-06-17数据加载日志:
SQL开始执行时间：20190617020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190617020012
SQL开始执行时间：20190617020012



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190617020013
SQL开始执行时间：20190617020013



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-17' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190617020015
SQL开始执行时间：20190617020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190617020015
SQL开始执行时间：20190617020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190617020016
SQL开始执行时间：20190617020016


update edw.ehr_employee set end_dt = '2019-06-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190617020016
SQL开始执行时间：20190617020016
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190617020016

20190618015947开始执行2019-06-18数据加载日志:
SQL开始执行时间：20190618015947

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190618015947
SQL开始执行时间：20190618015947



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190618015948
SQL开始执行时间：20190618015948



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-18' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190618015951
SQL开始执行时间：20190618015951


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190618015951
SQL开始执行时间：20190618015951

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190618015952
SQL开始执行时间：20190618015952


update edw.ehr_employee set end_dt = '2019-06-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190618015952
SQL开始执行时间：20190618015952
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190618015952

20190619020005开始执行2019-06-19数据加载日志:
SQL开始执行时间：20190619020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190619020005
SQL开始执行时间：20190619020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190619020006
SQL开始执行时间：20190619020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-19' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190619020008
SQL开始执行时间：20190619020008


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190619020008
SQL开始执行时间：20190619020008

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190619020009
SQL开始执行时间：20190619020009


update edw.ehr_employee set end_dt = '2019-06-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190619020009
SQL开始执行时间：20190619020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190619020009

20190620015943开始执行2019-06-20数据加载日志:
SQL开始执行时间：20190620015943

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190620015943
SQL开始执行时间：20190620015943



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190620015944
SQL开始执行时间：20190620015944



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-20' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190620015946
SQL开始执行时间：20190620015946


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190620015946
SQL开始执行时间：20190620015946

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190620015947
SQL开始执行时间：20190620015947


update edw.ehr_employee set end_dt = '2019-06-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190620015947
SQL开始执行时间：20190620015947
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190620015947

20190621015942开始执行2019-06-21数据加载日志:
SQL开始执行时间：20190621015942

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190621015942
SQL开始执行时间：20190621015942



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190621015943
SQL开始执行时间：20190621015943



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-21' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190621015946
SQL开始执行时间：20190621015946


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190621015946
SQL开始执行时间：20190621015946

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190621015947
SQL开始执行时间：20190621015947


update edw.ehr_employee set end_dt = '2019-06-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190621015947
SQL开始执行时间：20190621015947
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190621015947

20190622015958开始执行2019-06-22数据加载日志:
SQL开始执行时间：20190622015958

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190622015958
SQL开始执行时间：20190622015958



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190622015959
SQL开始执行时间：20190622015959



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-22' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190622020001
SQL开始执行时间：20190622020001


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190622020001
SQL开始执行时间：20190622020001

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190622020002
SQL开始执行时间：20190622020002


update edw.ehr_employee set end_dt = '2019-06-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190622020002
SQL开始执行时间：20190622020002
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190622020002

20190623015943开始执行2019-06-23数据加载日志:
SQL开始执行时间：20190623015943

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190623015943
SQL开始执行时间：20190623015943



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190623015944
SQL开始执行时间：20190623015944



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-23' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190623015946
SQL开始执行时间：20190623015946


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190623015946
SQL开始执行时间：20190623015946

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190623015947
SQL开始执行时间：20190623015947


update edw.ehr_employee set end_dt = '2019-06-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190623015947
SQL开始执行时间：20190623015947
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190623015947

20190624015952开始执行2019-06-24数据加载日志:
SQL开始执行时间：20190624015952

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190624015952
SQL开始执行时间：20190624015952



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190624015953
SQL开始执行时间：20190624015953



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-24' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190624015955
SQL开始执行时间：20190624015955


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190624015955
SQL开始执行时间：20190624015955

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190624015956
SQL开始执行时间：20190624015956


update edw.ehr_employee set end_dt = '2019-06-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190624015956
SQL开始执行时间：20190624015956
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190624015956

20190625020045开始执行2019-06-25数据加载日志:
SQL开始执行时间：20190625020045

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190625020045
SQL开始执行时间：20190625020045



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190625020046
SQL开始执行时间：20190625020046



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-25' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190625020049
SQL开始执行时间：20190625020049


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190625020049
SQL开始执行时间：20190625020049

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190625020049
SQL开始执行时间：20190625020049


update edw.ehr_employee set end_dt = '2019-06-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190625020050
SQL开始执行时间：20190625020050
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190625020050

20190626015948开始执行2019-06-26数据加载日志:
SQL开始执行时间：20190626015948

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190626015948
SQL开始执行时间：20190626015948



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190626015949
SQL开始执行时间：20190626015949



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-26' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190626015952
SQL开始执行时间：20190626015952


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190626015952
SQL开始执行时间：20190626015952

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190626015953
SQL开始执行时间：20190626015953


update edw.ehr_employee set end_dt = '2019-06-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190626015953
SQL开始执行时间：20190626015953
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190626015953

20190627020010开始执行2019-06-27数据加载日志:
SQL开始执行时间：20190627020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190627020011
SQL开始执行时间：20190627020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190627020012
SQL开始执行时间：20190627020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-27' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190627020014
SQL开始执行时间：20190627020014


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190627020014
SQL开始执行时间：20190627020014

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190627020015
SQL开始执行时间：20190627020015


update edw.ehr_employee set end_dt = '2019-06-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190627020015
SQL开始执行时间：20190627020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190627020015

20190628020027开始执行2019-06-28数据加载日志:
SQL开始执行时间：20190628020027

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190628020027
SQL开始执行时间：20190628020027



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190628020028
SQL开始执行时间：20190628020028



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-28' as start_dt
,'3000-12-31' as end_dt
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190628020031
SQL开始执行时间：20190628020031


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190628020031
SQL开始执行时间：20190628020031

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190628020032
SQL开始执行时间：20190628020032


update edw.ehr_employee set end_dt = '2019-06-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190628020032
SQL开始执行时间：20190628020032
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190628020032

20190629015938开始执行2019-06-29数据加载日志:
SQL开始执行时间：20190629015938

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190629015938
SQL开始执行时间：20190629015938



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190629015939
SQL开始执行时间：20190629015939



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-29' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190629015942
SQL开始执行时间：20190629015942


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190629015942
SQL开始执行时间：20190629015942

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190629015943
SQL开始执行时间：20190629015943


update edw.ehr_employee set end_dt = '2019-06-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190629015943
SQL开始执行时间：20190629015943
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190629015943

20190630020005开始执行2019-06-30数据加载日志:
SQL开始执行时间：20190630020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190630020005
SQL开始执行时间：20190630020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190630020006
SQL开始执行时间：20190630020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-06-30' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190630020008
SQL开始执行时间：20190630020008


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190630020008
SQL开始执行时间：20190630020008

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190630020009
SQL开始执行时间：20190630020009


update edw.ehr_employee set end_dt = '2019-06-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190630020009
SQL开始执行时间：20190630020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190630020009

20190701015941开始执行2019-07-01数据加载日志:
SQL开始执行时间：20190701015941

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190701015941
SQL开始执行时间：20190701015941



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190701015942
SQL开始执行时间：20190701015942



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-01' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190701015945
SQL开始执行时间：20190701015945


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190701015945
SQL开始执行时间：20190701015945

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190701015946
SQL开始执行时间：20190701015946


update edw.ehr_employee set end_dt = '2019-07-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190701015946
SQL开始执行时间：20190701015946
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190701015946

20190702020001开始执行2019-07-02数据加载日志:
SQL开始执行时间：20190702020001

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190702020001
SQL开始执行时间：20190702020001



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190702020002
SQL开始执行时间：20190702020002



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-02' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190702020005
SQL开始执行时间：20190702020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190702020005
SQL开始执行时间：20190702020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190702020006
SQL开始执行时间：20190702020006


update edw.ehr_employee set end_dt = '2019-07-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190702020006
SQL开始执行时间：20190702020006
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190702020006

20190703020005开始执行2019-07-03数据加载日志:
SQL开始执行时间：20190703020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190703020005
SQL开始执行时间：20190703020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190703020006
SQL开始执行时间：20190703020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-03' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190703020009
SQL开始执行时间：20190703020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190703020009
SQL开始执行时间：20190703020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190703020010
SQL开始执行时间：20190703020010


update edw.ehr_employee set end_dt = '2019-07-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190703020010
SQL开始执行时间：20190703020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190703020010

20190704015948开始执行2019-07-04数据加载日志:
SQL开始执行时间：20190704015948

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190704015948
SQL开始执行时间：20190704015948



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190704015949
SQL开始执行时间：20190704015949



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-04' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190704015952
SQL开始执行时间：20190704015952


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190704015952
SQL开始执行时间：20190704015952

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190704015953
SQL开始执行时间：20190704015953


update edw.ehr_employee set end_dt = '2019-07-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190704015953
SQL开始执行时间：20190704015953
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190704015953

20190705020009开始执行2019-07-05数据加载日志:
SQL开始执行时间：20190705020009

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190705020009
SQL开始执行时间：20190705020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190705020010
SQL开始执行时间：20190705020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-05' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190705020013
SQL开始执行时间：20190705020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190705020013
SQL开始执行时间：20190705020013

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190705020014
SQL开始执行时间：20190705020014


update edw.ehr_employee set end_dt = '2019-07-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190705020014
SQL开始执行时间：20190705020014
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190705020014

20190706020020开始执行2019-07-06数据加载日志:
SQL开始执行时间：20190706020020

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190706020020
SQL开始执行时间：20190706020020



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190706020021
SQL开始执行时间：20190706020021



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190706020024
SQL开始执行时间：20190706020024


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190706020024
SQL开始执行时间：20190706020024

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190706020025
SQL开始执行时间：20190706020025


update edw.ehr_employee set end_dt = '2019-07-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190706020025
SQL开始执行时间：20190706020025
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190706020025

20190707015957开始执行2019-07-07数据加载日志:
SQL开始执行时间：20190707015957

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190707015957
SQL开始执行时间：20190707015957



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190707015958
SQL开始执行时间：20190707015958



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-07' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190707020001
SQL开始执行时间：20190707020001


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190707020001
SQL开始执行时间：20190707020001

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190707020002
SQL开始执行时间：20190707020002


update edw.ehr_employee set end_dt = '2019-07-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190707020002
SQL开始执行时间：20190707020002
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190707020002

20190708020008开始执行2019-07-08数据加载日志:
SQL开始执行时间：20190708020008

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190708020009
SQL开始执行时间：20190708020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190708020010
SQL开始执行时间：20190708020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-08' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190708020012
SQL开始执行时间：20190708020012


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190708020012
SQL开始执行时间：20190708020012

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190708020013
SQL开始执行时间：20190708020013


update edw.ehr_employee set end_dt = '2019-07-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190708020013
SQL开始执行时间：20190708020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190708020013

20190709015949开始执行2019-07-09数据加载日志:
SQL开始执行时间：20190709015949

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190709015949
SQL开始执行时间：20190709015949



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190709015950
SQL开始执行时间：20190709015950



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-09' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190709015953
SQL开始执行时间：20190709015953


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190709015953
SQL开始执行时间：20190709015953

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190709015954
SQL开始执行时间：20190709015954


update edw.ehr_employee set end_dt = '2019-07-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190709015954
SQL开始执行时间：20190709015954
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190709015954

20190710020008开始执行2019-07-10数据加载日志:
SQL开始执行时间：20190710020008

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190710020008
SQL开始执行时间：20190710020008



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190710020009
SQL开始执行时间：20190710020009



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-10' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190710020012
SQL开始执行时间：20190710020012


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190710020012
SQL开始执行时间：20190710020012

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190710020013
SQL开始执行时间：20190710020013


update edw.ehr_employee set end_dt = '2019-07-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190710020013
SQL开始执行时间：20190710020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190710020013

20190711015957开始执行2019-07-11数据加载日志:
SQL开始执行时间：20190711015957

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190711015957
SQL开始执行时间：20190711015957



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190711015958
SQL开始执行时间：20190711015958



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-11' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190711020001
SQL开始执行时间：20190711020001


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190711020001
SQL开始执行时间：20190711020001

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190711020002
SQL开始执行时间：20190711020002


update edw.ehr_employee set end_dt = '2019-07-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190711020002
SQL开始执行时间：20190711020002
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190711020002

20190712020005开始执行2019-07-12数据加载日志:
SQL开始执行时间：20190712020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190712020005
SQL开始执行时间：20190712020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190712020006
SQL开始执行时间：20190712020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-12' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190712020009
SQL开始执行时间：20190712020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190712020009
SQL开始执行时间：20190712020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190712020010
SQL开始执行时间：20190712020010


update edw.ehr_employee set end_dt = '2019-07-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190712020010
SQL开始执行时间：20190712020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190712020010

20190713015945开始执行2019-07-13数据加载日志:
SQL开始执行时间：20190713015945

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190713015945
SQL开始执行时间：20190713015945



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190713015946
SQL开始执行时间：20190713015946



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-13' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190713015949
SQL开始执行时间：20190713015949


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190713015949
SQL开始执行时间：20190713015949

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190713015950
SQL开始执行时间：20190713015950


update edw.ehr_employee set end_dt = '2019-07-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190713015950
SQL开始执行时间：20190713015950
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190713015950

20190714015945开始执行2019-07-14数据加载日志:
SQL开始执行时间：20190714015945

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190714015945
SQL开始执行时间：20190714015945



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190714015946
SQL开始执行时间：20190714015946



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-14' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190714015949
SQL开始执行时间：20190714015949


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190714015949
SQL开始执行时间：20190714015949

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190714015950
SQL开始执行时间：20190714015950


update edw.ehr_employee set end_dt = '2019-07-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190714015950
SQL开始执行时间：20190714015950
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190714015950

20190715015944开始执行2019-07-15数据加载日志:
SQL开始执行时间：20190715015944

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190715015944
SQL开始执行时间：20190715015944



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190715015945
SQL开始执行时间：20190715015945



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-15' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190715015948
SQL开始执行时间：20190715015948


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190715015948
SQL开始执行时间：20190715015948

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190715015949
SQL开始执行时间：20190715015949


update edw.ehr_employee set end_dt = '2019-07-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190715015949
SQL开始执行时间：20190715015949
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190715015949

20190716015944开始执行2019-07-16数据加载日志:
SQL开始执行时间：20190716015944

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190716015944
SQL开始执行时间：20190716015944



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190716015945
SQL开始执行时间：20190716015945



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-16' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190716015948
SQL开始执行时间：20190716015948


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190716015948
SQL开始执行时间：20190716015948

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190716015949
SQL开始执行时间：20190716015949


update edw.ehr_employee set end_dt = '2019-07-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190716015949
SQL开始执行时间：20190716015949
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190716015949

20190717015958开始执行2019-07-17数据加载日志:
SQL开始执行时间：20190717015958

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190717015958
SQL开始执行时间：20190717015958



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190717015959
SQL开始执行时间：20190717015959



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-17' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190717020002
SQL开始执行时间：20190717020002


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190717020002
SQL开始执行时间：20190717020002

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190717020003
SQL开始执行时间：20190717020003


update edw.ehr_employee set end_dt = '2019-07-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190717020003
SQL开始执行时间：20190717020003
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190717020003

20190718015947开始执行2019-07-18数据加载日志:
SQL开始执行时间：20190718015947

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190718015947
SQL开始执行时间：20190718015947



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190718015948
SQL开始执行时间：20190718015948



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-18' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190718015951
SQL开始执行时间：20190718015951


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190718015951
SQL开始执行时间：20190718015951

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190718015952
SQL开始执行时间：20190718015952


update edw.ehr_employee set end_dt = '2019-07-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190718015952
SQL开始执行时间：20190718015952
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190718015952

20190719015940开始执行2019-07-19数据加载日志:
SQL开始执行时间：20190719015940

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190719015940
SQL开始执行时间：20190719015940



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190719015942
SQL开始执行时间：20190719015942



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-19' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190719015944
SQL开始执行时间：20190719015944


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190719015944
SQL开始执行时间：20190719015944

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190719015946
SQL开始执行时间：20190719015946


update edw.ehr_employee set end_dt = '2019-07-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190719015946
SQL开始执行时间：20190719015946
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190719015946

20190722094821开始执行2019-07-22数据加载日志:
SQL开始执行时间：20190722094821

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190722094821
SQL开始执行时间：20190722094821



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190722094823
SQL开始执行时间：20190722094823



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-22' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190722094825
SQL开始执行时间：20190722094825


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190722094825
SQL开始执行时间：20190722094825

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190722094827
SQL开始执行时间：20190722094827


update edw.ehr_employee set end_dt = '2019-07-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190722094827
SQL开始执行时间：20190722094827
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190722094827

20190723015954开始执行2019-07-23数据加载日志:
SQL开始执行时间：20190723015954

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190723015954
SQL开始执行时间：20190723015954



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190723015955
SQL开始执行时间：20190723015955



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-23' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190723015958
SQL开始执行时间：20190723015958


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190723015958
SQL开始执行时间：20190723015958

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190723015959
SQL开始执行时间：20190723015959


update edw.ehr_employee set end_dt = '2019-07-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190723015959
SQL开始执行时间：20190723015959
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190723015959

20190724020033开始执行2019-07-24数据加载日志:
SQL开始执行时间：20190724020033

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190724020033
SQL开始执行时间：20190724020033



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190724020034
SQL开始执行时间：20190724020034



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-24' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190724020036
SQL开始执行时间：20190724020036


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190724020037
SQL开始执行时间：20190724020037

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190724020038
SQL开始执行时间：20190724020038


update edw.ehr_employee set end_dt = '2019-07-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190724020038
SQL开始执行时间：20190724020038
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190724020038

20190725020057开始执行2019-07-25数据加载日志:
SQL开始执行时间：20190725020057

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190725020057
SQL开始执行时间：20190725020057



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190725020058
SQL开始执行时间：20190725020058



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-25' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190725020100
SQL开始执行时间：20190725020100


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190725020101
SQL开始执行时间：20190725020101

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190725020102
SQL开始执行时间：20190725020102


update edw.ehr_employee set end_dt = '2019-07-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190725020103
SQL开始执行时间：20190725020103
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190725020103

20190726091901开始执行2019-07-26数据加载日志:
SQL开始执行时间：20190726091901

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190726091901
SQL开始执行时间：20190726091901



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190726091902
SQL开始执行时间：20190726091902



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-26' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190726091905
SQL开始执行时间：20190726091905


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190726091905
SQL开始执行时间：20190726091905

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190726091907
SQL开始执行时间：20190726091907


update edw.ehr_employee set end_dt = '2019-07-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190726091907
SQL开始执行时间：20190726091907
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190726091907

20190727020008开始执行2019-07-27数据加载日志:
SQL开始执行时间：20190727020008

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190727020008
SQL开始执行时间：20190727020008



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190727020009
SQL开始执行时间：20190727020009



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-27' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190727020012
SQL开始执行时间：20190727020012


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190727020012
SQL开始执行时间：20190727020012

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190727020014
SQL开始执行时间：20190727020014


update edw.ehr_employee set end_dt = '2019-07-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190727020015
SQL开始执行时间：20190727020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190727020015

20190728015951开始执行2019-07-28数据加载日志:
SQL开始执行时间：20190728015951

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190728015951
SQL开始执行时间：20190728015951



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190728015952
SQL开始执行时间：20190728015952



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-28' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190728015955
SQL开始执行时间：20190728015955


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190728015955
SQL开始执行时间：20190728015955

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190728015957
SQL开始执行时间：20190728015957


update edw.ehr_employee set end_dt = '2019-07-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190728015957
SQL开始执行时间：20190728015957
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190728015957

20190729015952开始执行2019-07-29数据加载日志:
SQL开始执行时间：20190729015952

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190729015952
SQL开始执行时间：20190729015952



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190729015953
SQL开始执行时间：20190729015953



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-29' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190729015956
SQL开始执行时间：20190729015956


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190729015956
SQL开始执行时间：20190729015956

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190729015959
SQL开始执行时间：20190729015959


update edw.ehr_employee set end_dt = '2019-07-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190729015959
SQL开始执行时间：20190729015959
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190729015959

20190730015946开始执行2019-07-30数据加载日志:
SQL开始执行时间：20190730015946

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190730015946
SQL开始执行时间：20190730015946



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190730015948
SQL开始执行时间：20190730015948



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-30' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190730015951
SQL开始执行时间：20190730015951


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190730015951
SQL开始执行时间：20190730015951

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190730015953
SQL开始执行时间：20190730015953


update edw.ehr_employee set end_dt = '2019-07-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190730015953
SQL开始执行时间：20190730015953
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190730015953

20190731020037开始执行2019-07-31数据加载日志:
SQL开始执行时间：20190731020037

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190731020037
SQL开始执行时间：20190731020037



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190731020038
SQL开始执行时间：20190731020038



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-07-31' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190731020041
SQL开始执行时间：20190731020041


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190731020041
SQL开始执行时间：20190731020041

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190731020043
SQL开始执行时间：20190731020043


update edw.ehr_employee set end_dt = '2019-07-31' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190731020043
SQL开始执行时间：20190731020043
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190731020043

20190801020003开始执行2019-08-01数据加载日志:
SQL开始执行时间：20190801020003

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190801020003
SQL开始执行时间：20190801020003



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190801020004
SQL开始执行时间：20190801020004



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-01' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190801020007
SQL开始执行时间：20190801020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190801020007
SQL开始执行时间：20190801020007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190801020009
SQL开始执行时间：20190801020009


update edw.ehr_employee set end_dt = '2019-08-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190801020009
SQL开始执行时间：20190801020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190801020009

20190802020019开始执行2019-08-02数据加载日志:
SQL开始执行时间：20190802020019

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190802020019
SQL开始执行时间：20190802020019



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190802020020
SQL开始执行时间：20190802020020



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-02' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190802020023
SQL开始执行时间：20190802020023


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190802020023
SQL开始执行时间：20190802020023

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190802020025
SQL开始执行时间：20190802020025


update edw.ehr_employee set end_dt = '2019-08-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190802020025
SQL开始执行时间：20190802020025
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190802020025

20190803020007开始执行2019-08-03数据加载日志:
SQL开始执行时间：20190803020007

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190803020007
SQL开始执行时间：20190803020007



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190803020008
SQL开始执行时间：20190803020008



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-03' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190803020011
SQL开始执行时间：20190803020011


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190803020011
SQL开始执行时间：20190803020011

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190803020013
SQL开始执行时间：20190803020013


update edw.ehr_employee set end_dt = '2019-08-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190803020013
SQL开始执行时间：20190803020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190803020013

20190804020003开始执行2019-08-04数据加载日志:
SQL开始执行时间：20190804020003

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190804020003
SQL开始执行时间：20190804020003



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190804020004
SQL开始执行时间：20190804020004



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-04' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190804020007
SQL开始执行时间：20190804020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190804020007
SQL开始执行时间：20190804020007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190804020010
SQL开始执行时间：20190804020010


update edw.ehr_employee set end_dt = '2019-08-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190804020010
SQL开始执行时间：20190804020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190804020010

20190805015959开始执行2019-08-05数据加载日志:
SQL开始执行时间：20190805015959

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190805015959
SQL开始执行时间：20190805015959



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190805020000
SQL开始执行时间：20190805020000



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-05' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190805020003
SQL开始执行时间：20190805020003


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190805020003
SQL开始执行时间：20190805020003

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190805020005
SQL开始执行时间：20190805020005


update edw.ehr_employee set end_dt = '2019-08-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190805020005
SQL开始执行时间：20190805020005
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190805020005

20190806015957开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190806015957

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190806015957
SQL开始执行时间：20190806015957



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190806015958
SQL开始执行时间：20190806015958



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190806020001
SQL开始执行时间：20190806020001


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190806020001
SQL开始执行时间：20190806020001

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190806020003
SQL开始执行时间：20190806020003


update edw.ehr_employee set end_dt = '2019-08-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190806020003
SQL开始执行时间：20190806020003
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190806020003

20190806095221开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190806095221

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190806095221
SQL开始执行时间：20190806095221



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190806095222
SQL开始执行时间：20190806095222



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190806095225
SQL开始执行时间：20190806095225


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190806095225
SQL开始执行时间：20190806095225

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190806095227
SQL开始执行时间：20190806095227


update edw.ehr_employee set end_dt = '2019-08-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190806095227
SQL开始执行时间：20190806095227
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190806095227

20190806095257开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190806095257

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190806095257
SQL开始执行时间：20190806095257



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190806095258
SQL开始执行时间：20190806095258



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190806095301
SQL开始执行时间：20190806095301


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190806095301
SQL开始执行时间：20190806095301

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190806095304
SQL开始执行时间：20190806095304


update edw.ehr_employee set end_dt = '2019-08-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190806095304
SQL开始执行时间：20190806095304
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190806095304

20190806101807开始执行2019-08-06数据加载日志:
SQL开始执行时间：20190806101807

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190806101807
SQL开始执行时间：20190806101807



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190806101808
SQL开始执行时间：20190806101808



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190806101811
SQL开始执行时间：20190806101811


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190806101811
SQL开始执行时间：20190806101811

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190806101811
SQL开始执行时间：20190806101811


update edw.ehr_employee set end_dt = '2019-08-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190806101811
SQL开始执行时间：20190806101811
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190806101811
SQL开始执行时间：20190806101811

delete from edw.ehr_employee where employmenttype = '未知' and lastworkdate is null
;
SQL结束执行时间：20190806101811

20190807015958开始执行2019-08-07数据加载日志:
SQL开始执行时间：20190807015958

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190807015958
SQL开始执行时间：20190807015958



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190807015959
SQL开始执行时间：20190807015959



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-07' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002


update edw.ehr_employee set end_dt = '2019-08-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190807020002
SQL开始执行时间：20190807020002
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190807020002

20190808015954开始执行2019-08-08数据加载日志:
SQL开始执行时间：20190808015954

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190808015954
SQL开始执行时间：20190808015954



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190808015956
SQL开始执行时间：20190808015956



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-08' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190808015958
SQL开始执行时间：20190808015958


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959


update edw.ehr_employee set end_dt = '2019-08-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190808015959
SQL开始执行时间：20190808015959
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190808015959

20190809015956开始执行2019-08-09数据加载日志:
SQL开始执行时间：20190809015956

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190809015956
SQL开始执行时间：20190809015956



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190809015957
SQL开始执行时间：20190809015957



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-09' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190809020000
SQL开始执行时间：20190809020000


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190809020000
SQL开始执行时间：20190809020000

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001


update edw.ehr_employee set end_dt = '2019-08-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190809020001
SQL开始执行时间：20190809020001
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190809020001

20190810015953开始执行2019-08-10数据加载日志:
SQL开始执行时间：20190810015953

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190810015953
SQL开始执行时间：20190810015953



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190810015954
SQL开始执行时间：20190810015954



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-10' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190810015958
SQL开始执行时间：20190810015958


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190810015958
SQL开始执行时间：20190810015958

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959


update edw.ehr_employee set end_dt = '2019-08-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190810015959
SQL开始执行时间：20190810015959
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190810015959

20190811015953开始执行2019-08-11数据加载日志:
SQL开始执行时间：20190811015953

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190811015953
SQL开始执行时间：20190811015953



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190811015954
SQL开始执行时间：20190811015954



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-11' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190811015957
SQL开始执行时间：20190811015957


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190811015957
SQL开始执行时间：20190811015957

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958


update edw.ehr_employee set end_dt = '2019-08-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190811015958
SQL开始执行时间：20190811015958
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190811015958

20190812015956开始执行2019-08-12数据加载日志:
SQL开始执行时间：20190812015956

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190812015956
SQL开始执行时间：20190812015956



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190812015957
SQL开始执行时间：20190812015957



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-12' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190812020000
SQL开始执行时间：20190812020000


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190812020000
SQL开始执行时间：20190812020000

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001


update edw.ehr_employee set end_dt = '2019-08-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190812020001
SQL开始执行时间：20190812020001
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190812020001

20190813015954开始执行2019-08-13数据加载日志:
SQL开始执行时间：20190813015954

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190813015954
SQL开始执行时间：20190813015954



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190813015955
SQL开始执行时间：20190813015955



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-13' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190813015958
SQL开始执行时间：20190813015958


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190813015958
SQL开始执行时间：20190813015958

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959


update edw.ehr_employee set end_dt = '2019-08-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190813015959
SQL开始执行时间：20190813015959
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190813015959

20190814015956开始执行2019-08-14数据加载日志:
SQL开始执行时间：20190814015956

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190814015956
SQL开始执行时间：20190814015956



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190814015957
SQL开始执行时间：20190814015957



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-14' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190814020000
SQL开始执行时间：20190814020000


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190814020000
SQL开始执行时间：20190814020000

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001


update edw.ehr_employee set end_dt = '2019-08-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190814020001
SQL开始执行时间：20190814020001
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190814020001

20190815020007开始执行2019-08-15数据加载日志:
SQL开始执行时间：20190815020007

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190815020007
SQL开始执行时间：20190815020007



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190815020008
SQL开始执行时间：20190815020008



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-15' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190815020011
SQL开始执行时间：20190815020011


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190815020011
SQL开始执行时间：20190815020011

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013


update edw.ehr_employee set end_dt = '2019-08-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190815020013
SQL开始执行时间：20190815020013
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190815020013

20190816020005开始执行2019-08-16数据加载日志:
SQL开始执行时间：20190816020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190816020005
SQL开始执行时间：20190816020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190816020006
SQL开始执行时间：20190816020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-16' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190816020009
SQL开始执行时间：20190816020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190816020009
SQL开始执行时间：20190816020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190816020010
SQL开始执行时间：20190816020010


update edw.ehr_employee set end_dt = '2019-08-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190816020011
SQL开始执行时间：20190816020011
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190816020011

20190817020006开始执行2019-08-17数据加载日志:
SQL开始执行时间：20190817020006

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190817020006
SQL开始执行时间：20190817020006



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190817020007
SQL开始执行时间：20190817020007



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-17' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190817020010
SQL开始执行时间：20190817020010


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190817020010
SQL开始执行时间：20190817020010

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012


update edw.ehr_employee set end_dt = '2019-08-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190817020012
SQL开始执行时间：20190817020012
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190817020012

20190818020001开始执行2019-08-18数据加载日志:
SQL开始执行时间：20190818020001

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190818020001
SQL开始执行时间：20190818020001



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190818020002
SQL开始执行时间：20190818020002



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-18' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190818020005
SQL开始执行时间：20190818020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190818020005
SQL开始执行时间：20190818020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007


update edw.ehr_employee set end_dt = '2019-08-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190818020007
SQL开始执行时间：20190818020007
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190818020007

20190819020003开始执行2019-08-19数据加载日志:
SQL开始执行时间：20190819020003

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190819020003
SQL开始执行时间：20190819020003



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190819020005
SQL开始执行时间：20190819020005



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-19' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190819020008
SQL开始执行时间：20190819020008


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190819020008
SQL开始执行时间：20190819020008

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190819020009
SQL开始执行时间：20190819020009


update edw.ehr_employee set end_dt = '2019-08-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190819020009
SQL开始执行时间：20190819020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190819020009
SQL开始执行时间：20190819020009

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190819020010
SQL开始执行时间：20190819020010
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190819020010
SQL开始执行时间：20190819020010
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190819020010
SQL开始执行时间：20190819020010
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190819020010
SQL开始执行时间：20190819020010
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190819020010

20190820020009开始执行2019-08-20数据加载日志:
SQL开始执行时间：20190820020009

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190820020009
SQL开始执行时间：20190820020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190820020010
SQL开始执行时间：20190820020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-20' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190820020013
SQL开始执行时间：20190820020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190820020014
SQL开始执行时间：20190820020014

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016


update edw.ehr_employee set end_dt = '2019-08-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190820020016
SQL开始执行时间：20190820020016
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190820020016

20190821020012开始执行2019-08-21数据加载日志:
SQL开始执行时间：20190821020012

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190821020012
SQL开始执行时间：20190821020012



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190821020013
SQL开始执行时间：20190821020013



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-21' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190821020017
SQL开始执行时间：20190821020017


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190821020017
SQL开始执行时间：20190821020017

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019


update edw.ehr_employee set end_dt = '2019-08-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190821020019
SQL开始执行时间：20190821020019
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190821020019

20190822020016开始执行2019-08-22数据加载日志:
SQL开始执行时间：20190822020016

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190822020016
SQL开始执行时间：20190822020016



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190822020018
SQL开始执行时间：20190822020018



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-22' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190822020021
SQL开始执行时间：20190822020021


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190822020021
SQL开始执行时间：20190822020021

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023


update edw.ehr_employee set end_dt = '2019-08-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190822020023
SQL开始执行时间：20190822020023
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190822020023

20190823020011开始执行2019-08-23数据加载日志:
SQL开始执行时间：20190823020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190823020011
SQL开始执行时间：20190823020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190823020012
SQL开始执行时间：20190823020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-23' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190823020015
SQL开始执行时间：20190823020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190823020015
SQL开始执行时间：20190823020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017


update edw.ehr_employee set end_dt = '2019-08-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190823020017
SQL开始执行时间：20190823020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190823020017

20190824020010开始执行2019-08-24数据加载日志:
SQL开始执行时间：20190824020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190824020010
SQL开始执行时间：20190824020010



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190824020011
SQL开始执行时间：20190824020011



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-24' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190824020015
SQL开始执行时间：20190824020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190824020015
SQL开始执行时间：20190824020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017


update edw.ehr_employee set end_dt = '2019-08-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190824020017
SQL开始执行时间：20190824020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190824020017

20190825020008开始执行2019-08-25数据加载日志:
SQL开始执行时间：20190825020008

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190825020009
SQL开始执行时间：20190825020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190825020010
SQL开始执行时间：20190825020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-25' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190825020013
SQL开始执行时间：20190825020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190825020013
SQL开始执行时间：20190825020013

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015


update edw.ehr_employee set end_dt = '2019-08-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190825020015
SQL开始执行时间：20190825020015
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190825020015

20190826020012开始执行2019-08-26数据加载日志:
SQL开始执行时间：20190826020012

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190826020012
SQL开始执行时间：20190826020012



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190826020013
SQL开始执行时间：20190826020013



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-26' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190826020016
SQL开始执行时间：20190826020016


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190826020016
SQL开始执行时间：20190826020016

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018


update edw.ehr_employee set end_dt = '2019-08-26' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190826020018
SQL开始执行时间：20190826020018
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190826020018

20190827020009开始执行2019-08-27数据加载日志:
SQL开始执行时间：20190827020009

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190827020009
SQL开始执行时间：20190827020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190827020010
SQL开始执行时间：20190827020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-27' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190827020013
SQL开始执行时间：20190827020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190827020014
SQL开始执行时间：20190827020014

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016


update edw.ehr_employee set end_dt = '2019-08-27' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190827020016
SQL开始执行时间：20190827020016
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190827020016

20190828020008开始执行2019-08-28数据加载日志:
SQL开始执行时间：20190828020008

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190828020008
SQL开始执行时间：20190828020008



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190828020010
SQL开始执行时间：20190828020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-28' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190828020013
SQL开始执行时间：20190828020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190828020013
SQL开始执行时间：20190828020013

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015


update edw.ehr_employee set end_dt = '2019-08-28' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190828020015
SQL开始执行时间：20190828020015
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190828020015

20190829020010开始执行2019-08-29数据加载日志:
SQL开始执行时间：20190829020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190829020010
SQL开始执行时间：20190829020010



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190829020011
SQL开始执行时间：20190829020011



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-29' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190829020015
SQL开始执行时间：20190829020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190829020015
SQL开始执行时间：20190829020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017


update edw.ehr_employee set end_dt = '2019-08-29' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190829020017
SQL开始执行时间：20190829020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190829020017

20190830020010开始执行2019-08-30数据加载日志:
SQL开始执行时间：20190830020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190830020010
SQL开始执行时间：20190830020010



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190830020012
SQL开始执行时间：20190830020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-30' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190830020015
SQL开始执行时间：20190830020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190830020015
SQL开始执行时间：20190830020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017


update edw.ehr_employee set end_dt = '2019-08-30' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190830020017
SQL开始执行时间：20190830020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190830020017

20190831020011开始执行2019-08-31数据加载日志:
SQL开始执行时间：20190831020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190831020011
SQL开始执行时间：20190831020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190831020012
SQL开始执行时间：20190831020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-08-31' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190831020015
SQL开始执行时间：20190831020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190831020015
SQL开始执行时间：20190831020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190831020017
SQL开始执行时间：20190831020017


update edw.ehr_employee set end_dt = '2019-08-31' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190831020018
SQL开始执行时间：20190831020018
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190831020018

20190901020010开始执行2019-09-01数据加载日志:
SQL开始执行时间：20190901020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190901020010
SQL开始执行时间：20190901020010



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190901020011
SQL开始执行时间：20190901020011



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-01' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190901020014
SQL开始执行时间：20190901020014


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190901020015
SQL开始执行时间：20190901020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017


update edw.ehr_employee set end_dt = '2019-09-01' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190901020017
SQL开始执行时间：20190901020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190901020017

20190902020005开始执行2019-09-02数据加载日志:
SQL开始执行时间：20190902020005

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190902020005
SQL开始执行时间：20190902020005



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190902020007
SQL开始执行时间：20190902020007



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-02' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190902020010
SQL开始执行时间：20190902020010


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190902020010
SQL开始执行时间：20190902020010

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012


update edw.ehr_employee set end_dt = '2019-09-02' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190902020012
SQL开始执行时间：20190902020012
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190902020012

20190903020006开始执行2019-09-03数据加载日志:
SQL开始执行时间：20190903020006

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190903020006
SQL开始执行时间：20190903020006



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190903020007
SQL开始执行时间：20190903020007



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-03' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190903020010
SQL开始执行时间：20190903020010


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190903020011
SQL开始执行时间：20190903020011

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013


update edw.ehr_employee set end_dt = '2019-09-03' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190903020013
SQL开始执行时间：20190903020013
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190903020013

20190904020006开始执行2019-09-04数据加载日志:
SQL开始执行时间：20190904020006

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190904020006
SQL开始执行时间：20190904020006



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190904020007
SQL开始执行时间：20190904020007



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-04' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190904020010
SQL开始执行时间：20190904020010


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190904020010
SQL开始执行时间：20190904020010

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012


update edw.ehr_employee set end_dt = '2019-09-04' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190904020012
SQL开始执行时间：20190904020012
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190904020012

20190905020016开始执行2019-09-05数据加载日志:
SQL开始执行时间：20190905020016

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190905020016
SQL开始执行时间：20190905020016



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190905020017
SQL开始执行时间：20190905020017



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-05' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190905020020
SQL开始执行时间：20190905020020


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190905020021
SQL开始执行时间：20190905020021

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023


update edw.ehr_employee set end_dt = '2019-09-05' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190905020023
SQL开始执行时间：20190905020023
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190905020023

20190906020011开始执行2019-09-06数据加载日志:
SQL开始执行时间：20190906020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190906020011
SQL开始执行时间：20190906020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190906020012
SQL开始执行时间：20190906020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-06' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190906020015
SQL开始执行时间：20190906020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190906020015
SQL开始执行时间：20190906020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018


update edw.ehr_employee set end_dt = '2019-09-06' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190906020018
SQL开始执行时间：20190906020018
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190906020018

20190907020010开始执行2019-09-07数据加载日志:
SQL开始执行时间：20190907020010

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190907020010
SQL开始执行时间：20190907020010



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190907020011
SQL开始执行时间：20190907020011



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-07' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190907020015
SQL开始执行时间：20190907020015


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190907020015
SQL开始执行时间：20190907020015

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016


update edw.ehr_employee set end_dt = '2019-09-07' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190907020016
SQL开始执行时间：20190907020016
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190907020016

20190908020011开始执行2019-09-08数据加载日志:
SQL开始执行时间：20190908020011

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190908020011
SQL开始执行时间：20190908020011



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190908020012
SQL开始执行时间：20190908020012



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-08' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190908020016
SQL开始执行时间：20190908020016


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190908020016
SQL开始执行时间：20190908020016

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017


update edw.ehr_employee set end_dt = '2019-09-08' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190908020017
SQL开始执行时间：20190908020017
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190908020017

20190909020007开始执行2019-09-09数据加载日志:
SQL开始执行时间：20190909020007

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190909020008
SQL开始执行时间：20190909020008



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190909020009
SQL开始执行时间：20190909020009



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-09' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190909020012
SQL开始执行时间：20190909020012


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190909020012
SQL开始执行时间：20190909020012

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013


update edw.ehr_employee set end_dt = '2019-09-09' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190909020013
SQL开始执行时间：20190909020013
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190909020013

20190910020016开始执行2019-09-10数据加载日志:
SQL开始执行时间：20190910020016

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190910020016
SQL开始执行时间：20190910020016



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190910020018
SQL开始执行时间：20190910020018



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-10' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190910020021
SQL开始执行时间：20190910020021


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190910020021
SQL开始执行时间：20190910020021

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022


update edw.ehr_employee set end_dt = '2019-09-10' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190910020022
SQL开始执行时间：20190910020022
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190910020022

20190911020012开始执行2019-09-11数据加载日志:
SQL开始执行时间：20190911020012

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190911020012
SQL开始执行时间：20190911020012



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190911020013
SQL开始执行时间：20190911020013



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-11' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190911020016
SQL开始执行时间：20190911020016


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190911020017
SQL开始执行时间：20190911020017

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018


update edw.ehr_employee set end_dt = '2019-09-11' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190911020018
SQL开始执行时间：20190911020018
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190911020018

20190912020009开始执行2019-09-12数据加载日志:
SQL开始执行时间：20190912020009

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190912020009
SQL开始执行时间：20190912020009



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190912020010
SQL开始执行时间：20190912020010



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-12' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190912020013
SQL开始执行时间：20190912020013


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190912020013
SQL开始执行时间：20190912020013

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015


update edw.ehr_employee set end_dt = '2019-09-12' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190912020015
SQL开始执行时间：20190912020015
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190912020015

20190913020001开始执行2019-09-13数据加载日志:
SQL开始执行时间：20190913020001

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190913020001
SQL开始执行时间：20190913020001



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190913020002
SQL开始执行时间：20190913020002



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-13' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190913020005
SQL开始执行时间：20190913020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190913020005
SQL开始执行时间：20190913020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007


update edw.ehr_employee set end_dt = '2019-09-13' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190913020007
SQL开始执行时间：20190913020007
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190913020007

20190914015959开始执行2019-09-14数据加载日志:
SQL开始执行时间：20190914015959

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190914015959
SQL开始执行时间：20190914015959



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190914020001
SQL开始执行时间：20190914020001



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-14' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190914020004
SQL开始执行时间：20190914020004


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190914020004
SQL开始执行时间：20190914020004

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005


update edw.ehr_employee set end_dt = '2019-09-14' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190914020005
SQL开始执行时间：20190914020005
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190914020005

20190915020001开始执行2019-09-15数据加载日志:
SQL开始执行时间：20190915020001

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190915020001
SQL开始执行时间：20190915020001



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190915020002
SQL开始执行时间：20190915020002



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-15' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190915020005
SQL开始执行时间：20190915020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190915020005
SQL开始执行时间：20190915020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007


update edw.ehr_employee set end_dt = '2019-09-15' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190915020007
SQL开始执行时间：20190915020007
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190915020007

20190916020000开始执行2019-09-16数据加载日志:
SQL开始执行时间：20190916020000

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190916020000
SQL开始执行时间：20190916020000



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190916020002
SQL开始执行时间：20190916020002



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-16' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190916020005
SQL开始执行时间：20190916020005


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190916020005
SQL开始执行时间：20190916020005

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006


update edw.ehr_employee set end_dt = '2019-09-16' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190916020006
SQL开始执行时间：20190916020006
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190916020006

20190917020001开始执行2019-09-17数据加载日志:
SQL开始执行时间：20190917020001

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190917020001
SQL开始执行时间：20190917020001



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190917020003
SQL开始执行时间：20190917020003



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-17' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190917020006
SQL开始执行时间：20190917020006


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190917020006
SQL开始执行时间：20190917020006

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007


update edw.ehr_employee set end_dt = '2019-09-17' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190917020007
SQL开始执行时间：20190917020007
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190917020007

20190918020007开始执行2019-09-18数据加载日志:
SQL开始执行时间：20190918020007

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190918020007
SQL开始执行时间：20190918020007



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190918020008
SQL开始执行时间：20190918020008



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-18' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190918020011
SQL开始执行时间：20190918020011


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190918020012
SQL开始执行时间：20190918020012

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013


update edw.ehr_employee set end_dt = '2019-09-18' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190918020013
SQL开始执行时间：20190918020013
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190918020013

20190919015959开始执行2019-09-19数据加载日志:
SQL开始执行时间：20190919015959

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190919020000
SQL开始执行时间：20190919020000



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190919020001
SQL开始执行时间：20190919020001



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-19' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190919020004
SQL开始执行时间：20190919020004


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190919020004
SQL开始执行时间：20190919020004

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190919020005
SQL开始执行时间：20190919020005


update edw.ehr_employee set end_dt = '2019-09-19' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190919020006
SQL开始执行时间：20190919020006
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190919020006

20190920020004开始执行2019-09-20数据加载日志:
SQL开始执行时间：20190920020004

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190920020004
SQL开始执行时间：20190920020004



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190920020006
SQL开始执行时间：20190920020006



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-20' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190920020009
SQL开始执行时间：20190920020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190920020009
SQL开始执行时间：20190920020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010


update edw.ehr_employee set end_dt = '2019-09-20' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190920020010
SQL开始执行时间：20190920020010
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190920020010

20190921020002开始执行2019-09-21数据加载日志:
SQL开始执行时间：20190921020002

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190921020002
SQL开始执行时间：20190921020002



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190921020004
SQL开始执行时间：20190921020004



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-21' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190921020007
SQL开始执行时间：20190921020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190921020007
SQL开始执行时间：20190921020007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008


update edw.ehr_employee set end_dt = '2019-09-21' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190921020008
SQL开始执行时间：20190921020008
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190921020008

20190922020002开始执行2019-09-22数据加载日志:
SQL开始执行时间：20190922020002

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190922020002
SQL开始执行时间：20190922020002



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190922020004
SQL开始执行时间：20190922020004



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-22' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190922020007
SQL开始执行时间：20190922020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190922020007
SQL开始执行时间：20190922020007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008


update edw.ehr_employee set end_dt = '2019-09-22' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190922020008
SQL开始执行时间：20190922020008
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190922020008

20190923015959开始执行2019-09-23数据加载日志:
SQL开始执行时间：20190923015959

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190923020000
SQL开始执行时间：20190923020000



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190923020001
SQL开始执行时间：20190923020001



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-23' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190923020004
SQL开始执行时间：20190923020004


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190923020004
SQL开始执行时间：20190923020004

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005


update edw.ehr_employee set end_dt = '2019-09-23' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190923020005
SQL开始执行时间：20190923020005
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190923020005

20190924020003开始执行2019-09-24数据加载日志:
SQL开始执行时间：20190924020003

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190924020003
SQL开始执行时间：20190924020003



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190924020004
SQL开始执行时间：20190924020004



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-24' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190924020007
SQL开始执行时间：20190924020007


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190924020007
SQL开始执行时间：20190924020007

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009


update edw.ehr_employee set end_dt = '2019-09-24' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190924020009
SQL开始执行时间：20190924020009
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190924020009

20190925020004开始执行2019-09-25数据加载日志:
SQL开始执行时间：20190925020004

create temporary table edw.ehr_employee_pre as
select distinct a.userid
,a.name
,case when a.gender = '1' then '女'
  when a.gender = '0' then '男'
  else '保密' end as gender
,b.name as nation
,d.name as politicalstatus
,case when a.marrycategory = 'c4ca4238a0b923820dcc509a6f75849b' then '已婚'
  when a.marrycategory = 'c81e728d9d4c2f636f067f89cc14862c' then '未婚'
  when a.marrycategory = 'eccbc87e4b5ce2fe28308fd9f2a7baf3' then '离异'
  else '保密' end as marrycategory
,a.major
,case when a.educationlevel = '9' then '小学'
  when a.educationlevel = '8' then '初中'
  when a.educationlevel = '3' then '高中'
  when a.educationlevel = '4' then '中技（中专/技校/职高）'
  when a.educationlevel = '5' then '大专'
  when a.educationlevel = '1' then '本科'
  when a.educationlevel = '2' then '硕士研究生'
  when a.educationlevel = '6' then 'mba'
  when a.educationlevel = '7' then '博士研究生'
  when a.educationlevel = '1075021147935830' then '中专'
  else '未知' end as educationlevel
,a.mobilephone
,concat(a.workdateyear,'-',a.workdatemonth,'-',a.workdateday) as workdate -- 起始工作时间
,a.birthday
  from ufdata.ehr_employee_information a
  left join (select id,name from edw.dic_ehr where type = 'nation') b
    on a.nation = b.id
  left join (select id,name from edw.dic_ehr where type = 'politics') d
    on a.politicalstatus = d.id
 where a.stdisdeleted = 'false'
;
SQL结束执行时间：20190925020004
SQL开始执行时间：20190925020004



create temporary table edw.employment_record as
select * from (
select a.userid
,a.oiddepartment
,a.sys_date
,d.firstlevelorganization
,d.secondlevelorganization
,d.thirdlevelorganization
,d.fourthlevelorganization
,d.fifthlevelorganization
,d.sixthlevelorganization
,e.name as position_name
,f.name as jobpost_name
,a.oidjoblevel
,a.oidjobgrade
,a.entrydate
,a.startdate
,a.stopdate
,g.transitiontype
,a.probation
,c.name as employeestatus
,a.workyeartotal
,a.workyearcompanytotal
,a.probationstartdate
,a.probationstopdate
,a.regularizationdate
,b.name as probationresult
,a.lastworkdate
,a.extlizhireason_107502_632202192
,h.name as poidempadmin
,i.name as poidempreserve2
,a.jobnumber
,a.workyearbefore
,a.workyearcompanybefore
,a.employmenttype
,j.name as address_usual
  from ufdata.ehr_employment_record a
  left join (select id,name from edw.dic_ehr where type = 'probation') b
    on a.probationresult = b.id
  left join (select id,name from edw.dic_ehr where type = 'status') c
    on a.employeestatus = c.id
  left join ufdata.ehr_organization d
    on a.oiddepartment = d.oid
  left join ufdata.ehr_position e
    on a.oidjobposition = e.oid
  left join ufdata.ehr_jobpost f
    on a.oidjobpost = f.oid
  left join ufdata.ehr_emptransition_type g
    on a.transitiontypeoid = g.oid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) h
    on a.poidempadmin = h.userid
  left join (select userid,name from ufdata.ehr_employee_information where stdisdeleted = 'false' group by userid) i
    on a.poidempadmin = i.userid
  left join (select * from edw.dic_ehr where type = 'address') j
    on e.place = j.id
 where a.stdisdeleted = 'false'
 order by sys_date desc) b
 group by b.userid order by b.sys_date desc

;
SQL结束执行时间：20190925020005
SQL开始执行时间：20190925020005



create temporary table edw.mid1_ehr_employee as
select a.userid
,b.jobnumber
,a.name
,b.address_usual
,b.poidempadmin
,b.poidempreserve2
,a.gender
,a.major
,a.educationlevel
,a.mobilephone
,a.workdate
,a.birthday
,c.name as first_dept
,d.name as second_dept
,e.name as third_dept
,f.name as fourth_dept
,g.name as fifth_dept
,i.name as sixth_dept
,b.position_name
,b.jobpost_name
,h.name as oidjoblevel
,b.entrydate
,b.startdate
,b.stopdate
,b.transitiontype
,b.probation
,b.employeestatus
,case when b.employmenttype = 'c7a22d7d-e901-4af0-8e86-146c7134e4ec' then '正式'
      when b.employmenttype = 'cca4006e-a8d4-4e94-80c5-b214be7328ae' then '正式2'
      when b.employmenttype = 'e77dc025-491b-442d-83bc-8ecf3c83a96f' then '兼职'
      when b.employmenttype = '6a7a30a8-e3d0-44b5-9e27-abef75b0c471' then '兼职2'
      when b.employmenttype = 'f0c7ae2d-b674-4dad-ab58-8499273fb484' then '兼职3'
      when b.employmenttype = '080d32b6-8450-4621-8ae7-2b8e771ef21b' then '实习'
      when b.employmenttype = '53c1e5f0-00b5-4b19-a836-79524b419d04' then '实习2'
      when b.employmenttype = '56fcd60b-f6d5-4903-8a4d-3c0f016eea31' then '外部'
      when b.employmenttype = 'f924abfe-3b81-49cb-82fc-3a042e22674c' then '试用'
      else '未知' end as employmenttype
,b.probationstartdate
,b.probationstopdate
,b.regularizationdate
,b.probationresult
,b.lastworkdate
,b.extlizhireason_107502_632202192
,b.workyearbefore
,b.workyearcompanybefore
,'2019-09-25' as start_dt
,'3000-12-31' as end_dt
,localtimestamp() as sys_time
  from edw.ehr_employee_pre a 
  left join edw.employment_record b
    on a.userid = b.userid
  left join ufdata.ehr_organization c
    on b.firstlevelorganization = c.oid
  left join ufdata.ehr_organization d
    on b.secondlevelorganization = d.oid
  left join ufdata.ehr_organization e
    on b.thirdlevelorganization = e.oid
  left join ufdata.ehr_organization f
    on b.fourthlevelorganization = f.oid
  left join ufdata.ehr_organization g
    on b.fifthlevelorganization = g.oid
  left join ufdata.ehr_organization i
    on b.sixthlevelorganization = i.oid
  left join ufdata.ehr_joblevel h
    on b.oidjoblevel = h.oid

;
SQL结束执行时间：20190925020009
SQL开始执行时间：20190925020009


alter table edw.mid1_ehr_employee convert to character set utf8
;
SQL结束执行时间：20190925020009
SQL开始执行时间：20190925020009

create temporary table edw.mid2_ehr_employee as
select a.*
  from edw.mid1_ehr_employee a
 where not exists(select 1 from edw.ehr_employee b
 where ifnull(a.poidempadmin,'') = ifnull(b.poidempadmin,'')
   and ifnull(a.mobilephone,'') = ifnull(b.mobilephone,'')
   and ifnull(a.address_usual,'') = ifnull(b.address_usual,'')
   and ifnull(a.first_dept,'') = ifnull(b.first_dept,'')
   and ifnull(a.second_dept,'') = ifnull(b.second_dept,'')
   and ifnull(a.third_dept,'') = ifnull(b.third_dept,'')
   and ifnull(a.fourth_dept,'') = ifnull(b.fourth_dept,'')
   and ifnull(a.fifth_dept,'') = ifnull(b.fifth_dept,'')
   and ifnull(a.sixth_dept,'') = ifnull(b.sixth_dept,'')
   and ifnull(a.position_name,'') = ifnull(b.position_name,'')
   and ifnull(a.jobpost_name,'') = ifnull(b.jobpost_name,'')
   and ifnull(a.oidjoblevel,'') = ifnull(b.oidjoblevel,'')
   and ifnull(a.startdate,'') = ifnull(b.startdate,'')
   and ifnull(a.TransitionType,'') = ifnull(b.TransitionType,'')
   and ifnull(a.employeestatus,'') = ifnull(b.employeestatus,'')
   and ifnull(a.regularizationdate,'') = ifnull(b.regularizationdate,'')
   and ifnull(a.employmenttype,'') = ifnull(b.employmenttype,'')
   and ifnull(a.probationresult,'') = ifnull(b.probationresult,'')
   and ifnull(a.lastworkdate,'') = ifnull(b.lastworkdate,'')
   and ifnull(a.extlizhireason_107502_632202192,'') = ifnull(b.extlizhireason_107502_632202192,'')
   and ifnull(a.workyearbefore,'') = ifnull(b.workyearbefore,'')
   and ifnull(a.workyearcompanybefore,'') = ifnull(b.workyearcompanybefore,''))

;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010


update edw.ehr_employee set end_dt = '2019-09-25' where userid in (select userid from edw.mid2_ehr_employee)
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010
insert into edw.ehr_employee
select distinct * 
  from edw.mid2_ehr_employee
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010

delete from edw.ehr_employee where employmenttype = '未知' and oidjoblevel is null
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010
delete from edw.ehr_employee where employmenttype = '外部' and lastworkdate is null
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010
delete from edw.ehr_employee where userid = '124741099'
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010
delete from edw.ehr_employee where userid = '120421497'
;
SQL结束执行时间：20190925020010
SQL开始执行时间：20190925020010
delete from edw.ehr_employee where userid = '122762056'
;
SQL结束执行时间：20190925020010
